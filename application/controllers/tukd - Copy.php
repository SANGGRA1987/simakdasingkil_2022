<?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');

/**
 * Controller master data kegiatan
 */

class Tukd extends CI_Controller {

	function __contruct()
	{	
		parent::__construct();
  
	}


    function rp_minus($nilai){
        if($nilai<0){
            $nilai = $nilai * (-1);
            $nilai = '('.number_format($nilai,"2",",",".").')';    
        }else{
            $nilai = number_format($nilai,"2",",","."); 
        }
        
        return $nilai;
    } 
    
    function realisasi_peng()
    {
        $data['page_title']= 'REALISASI PENGELUARAN';
        $this->template->set('title', 'RELISASI PENGELUARAN');   
        $this->template->load('template','tukd/pendapatan/realisasi_pengeluaran',$data) ; 
    }
    
    
    function cetak_real_pengeluaran()
    {
        $thn_ang = $this->session->userdata('pcThang');
        $jnscetak = $this->uri->segment(3);
            $bulan =''; 
            $lcperiode = $this->tukd_model->getBulan($bulan);            
         $bulan= $_REQUEST['tgl1'];
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
         
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'BUD' AND a.kd_skpd = '1.20.00.00' and nip='19611019 198412 1 002'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmBP = $trh2->nama;
         $lcNipBP = $trh2->nip;                         
            
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"7\" style=\"font-size:14px;border: solid 1px white;\"><b>PEMERINTAH KABUPATEN SANGGAU <br>LAPORAN REALISASI PENGELUARAN KAS DAERAH<br/> 
                SAMPAI DENGAN ".strtoupper($this->tukd_model->getBulan($bulan))." <br/>
                TAHUN ANGGARAN ".$thn_ang."
                </b></td>
            </tr>
              <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
            </tr>
            
            <tr>                
				<td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\" >Nama SKPD</td>
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Kode</td>
                <td align=\"center\" width=\"40%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Rekening</td>
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Realisasi<br>(Rp)</td>             
            </tr>
            <tr>
                <td align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">1</td>
                <td align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">2</td>  
                <td align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">3</td>        
                <td align=\"center\"  style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">4</td>
            </tr>";
                                                                                                      					
                    $sql = "SELECT z.* FROM
(
SELECT '1' as urut,a.kd_skpd,'' as kd_rek,'' as nm_rek,'0' as nilai FROM trhsp2d a
inner join trdspp c on c.no_spp = a.no_spp and a.kd_skpd = c.kd_skpd 
WHERE a.status='1' and a.status_bud='1' and month(a.tgl_kas_bud)<='$bulan' and LEFT(c.kd_rek5,1)='5'
GROUP BY a.kd_skpd
union all
SELECT '5' as urut,a.kd_skpd,d.kd_rek4 as kd_rek,d.nm_rek4 as nm_rek,sum(c.nilai) AS nilai FROM trhsp2d a
inner join trdspp c on c.no_spp = a.no_spp and a.kd_skpd = c.kd_skpd 
inner join ms_rek4 d on d.kd_rek4 = LEFT(c.kd_rek5,5)
WHERE a.status='1' and a.status_bud='1' and month(a.tgl_kas_bud)<='$bulan' and LEFT(c.kd_rek5,1)='5'
GROUP BY a.kd_skpd,d.kd_rek4,d.nm_rek4
union all
SELECT '4' as urut,a.kd_skpd,d.kd_rek3 as kd_rek,d.nm_rek3 as nm_rek,sum(c.nilai) AS nilai FROM trhsp2d a
inner join trdspp c on c.no_spp = a.no_spp and a.kd_skpd = c.kd_skpd 
inner join ms_rek3 d on d.kd_rek3 = LEFT(c.kd_rek5,3)
WHERE a.status='1' and a.status_bud='1' and month(a.tgl_kas_bud)<='$bulan' and LEFT(c.kd_rek5,1)='5'
GROUP BY a.kd_skpd,d.kd_rek3,d.nm_rek3
union all
SELECT '3' as urut,a.kd_skpd,d.kd_rek2 as kd_rek,d.nm_rek2 as nm_rek,sum(c.nilai) AS nilai FROM trhsp2d a
inner join trdspp c on c.no_spp = a.no_spp and a.kd_skpd = c.kd_skpd 
inner join ms_rek2 d on d.kd_rek2 = LEFT(c.kd_rek5,2)
WHERE a.status='1' and a.status_bud='1' and month(a.tgl_kas_bud)<='$bulan' and LEFT(c.kd_rek5,1)='5'
GROUP BY a.kd_skpd,d.kd_rek2,d.nm_rek2
union all
SELECT '2' as urut,a.kd_skpd,d.kd_rek1 as kd_rek,d.nm_rek1 as nm_rek,sum(c.nilai) AS nilai FROM trhsp2d a
inner join trdspp c on c.no_spp = a.no_spp and a.kd_skpd = c.kd_skpd 
inner join ms_rek1 d on d.kd_rek1 = LEFT(c.kd_rek5,1)
WHERE a.status='1' and a.status_bud='1' and month(a.tgl_kas_bud)<='$bulan' and LEFT(c.kd_rek5,1)='5'
GROUP BY a.kd_skpd,d.kd_rek1,d.nm_rek1
union all
SELECT '6' as urut,a.kd_skpd,c.kd_rek5 as kd_rek,c.nm_rek5 as nm_rek,sum(c.nilai) AS nilai FROM trhsp2d a
inner join trdspp c on c.no_spp = a.no_spp and a.kd_skpd = c.kd_skpd 
WHERE a.status='1' and a.status_bud='1' and month(a.tgl_kas_bud)<='$bulan' and LEFT(c.kd_rek5,1)='5'
GROUP BY a.kd_skpd,c.kd_rek5,c.nm_rek5
) z 
ORDER BY kd_skpd,kd_rek,urut,nm_rek
";
                    
                    $hasil = $this->db->query($sql);       
                    $no=0;
                    foreach ($hasil->result() as $row)
                    {
                       $no      =$no+1;
                       $kun     =$row->urut;
                       $nilai   =$row->nilai;
                       $kdrek   =$row->kd_rek;      
                       $nmrek   =$row->nm_rek;                             
                       $kdskpd   =$row->kd_skpd;   
                       
                       $nm_skpd =  $this->tukd_model->get_nama($kdskpd,'nm_skpd','ms_skpd','kd_skpd');  
		
                        if($kun==1){
                             $cRet .="<tr>                                  
								  <td valign=\"top\" colspan=\"4\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;\"><b>$kdskpd - $nm_skpd</b></td>
                                  </tr>";                                                 
                        }else{
                             $cRet .="<tr>                                  
								  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$kdrek</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$nmrek</td>>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($nilai)."</td>
                                  </tr>";                                            
                    }
                    }
                    
         $cRet .="
                <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border-top: solid 1px black;\">&nbsp;</td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                </tr>                
                <tr>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\">Sanggau, tanggal ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\">Bendahara Umum Daerah</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
				<tr>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>                
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px; border: solid 1px white;\"></td>                    
                    <td align=\"center\" colspan=\"2\" style=\"font-size:15px; border: solid 1px white;\"><b><u>$lcNmBP</u></b></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\">NIP. $lcNipBP</td>
      
                </tr>";        
                                  
                
        $cRet .='</table>';
                 
                 $juduls = "Realisasi Pengeluaran";
                 
         $data['prev']= $cRet;    
         if($jnscetak=="0"){
                echo $cRet;
         }else if($jnscetak=="1"){
                $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
         }else if($jnscetak=="2"){
         header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $juduls.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
         }
         //$this->tukd_model->_mpdf('',$cRet,'10','10',5,'0');
         //$this->tukd_model->_mpdf('', $cRet, 10, 10, 10, 'L');
     
    }
    
	function get_status($tgl,$skpd){
        $n_status = '';
        $tanggal = $tgl;
        $sql = "select case when '$tanggal'>=tgl_dpa_ubah then 'nilai_ubah' 
                    when '$tanggal'>=tgl_dpa_sempurna then 'nilai_sempurna' 
                    when '$tanggal'<=tgl_dpa 
                    then 'nilai' else 'nilai' end as anggaran from trhrka where kd_skpd ='$skpd' ";
        
        $q_trhrka = $this->db->query($sql);
        $num_rows = $q_trhrka->num_rows();
        
        foreach ($q_trhrka->result() as $r_trhrka){
             $n_status = $r_trhrka->anggaran;                   
        }    
        return $n_status;                         
    }
	
	function load_pengirim() {        
        
        $skpd = $this->session->userdata('kdskpd');               
        $lccr = $this->input->post('q');
        
        $sql = "select * from ms_pengirim where (upper(kd_pengirim) like upper('%$lccr%') OR upper(nm_pengirim) like upper('%$lccr%'))
			order by cast(kd_pengirim as int)";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_pengirim' => $resulte['kd_pengirim'],  
                        'nm_pengirim' => $resulte['nm_pengirim'],
                        'kd_skpd'     => $resulte['kd_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}
	 
	function daftar_penerimaan()
    {
        $data['page_title']= 'DAFTAR PENERIMAAN';
        $this->template->set('title', 'DAFTAR PENERIMAAN');   
        $this->template->load('template','tukd/sp2d/daftar_penerimaan',$data) ; 
    } 
	
	function ctk_daftar_penerimaan(){
		$kd_kirim     = $this->uri->segment(3);
		$lcttd        = str_replace('123456789',' ',$this->uri->segment(5));
		$thn_ang      = $this->session->userdata('pcThang');
		$prv          = $this->db->query("SELECT provinsi,daerah from sclient where kd_skpd='1.20.00.00'");
		$prvn         = $prv->row();          
		$prov         = $prvn->provinsi;         
		$daerah       = $prvn->daerah;
		$cetk         = $this->uri->segment(10);
		
		if($cetk=='2'){
			$tgl          = $this->uri->segment(11);
			$nm_tglawal   = $this->tanggal_format_indonesia_kasda2($tgl);
			
			$tgl2         = $this->uri->segment(12);
			$nm_tglakhir  = $this->tanggal_format_indonesia_kasda2($tgl2);
		}else{
			$blnawal      = $this->uri->segment(6);
			$nm_bulanawal = $this->getBulan_kasda($blnawal);
			
			$blnakhir     = $this->uri->segment(7);
			$nm_bulakhir  = $this->getBulan_kasda($blnakhir);
		}
		$no_halaman   = $this->uri->segment(8);
		$spasi        = $this->uri->segment(9);
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		$pengirim      = $this->db->query("SELECT TOP 1 nm_pengirim,kd_skpd from ms_pengirim where kd_pengirim='$kd_kirim'");
		$nama_pengirim = $pengirim->row();          
		$h_pengirim   = $nama_pengirim->nm_pengirim;
		$h_skpd       = $nama_pengirim->kd_skpd;
		
		$pengirim2      = $this->db->query("SELECT TOP 1 nm_skpd from ms_skpd where kd_skpd='$h_skpd'");
		$nama_pengirim2 = $pengirim2->row();          
		$h_nmskpd   = $nama_pengirim2->nm_skpd;
		
		if($cetk=='3'){
			$judul_bulan = "BULAN : $nm_bulanawal S/D $nm_bulakhir";
		}else{
			$judul_bulan = "TANGGAL : $nm_tglawal S/D $nm_tglakhir";
		}
		
		$judul="DAFTAR PENERIMAAN<br>(".strtoupper($h_pengirim).") $h_nmskpd <br>$judul_bulan";
                                               
                    
		$cRet = '';
		
			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul $thn_ang</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:13px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"$spasi\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold;\">No. Kasda</td>  
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold;\">No. STS</td>  
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">Tanggal</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"25%\" style=\"font-weight:bold\">Penerimaan (Rp)</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"40%\" style=\"font-weight:bold\">Keterangan</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
				</tr>
				</thead>"; 
		
		if($cetk=='3'){
		//per periode
		$sql = "SELECT a.no_kas,a.no_sts, a.kd_skpd, a.tgl_sts, a.keterangan, a.total, a.sumber, b.nm_pengirim 
                  FROM trhkasin_ppkd a left join ms_pengirim b on a.sumber=b.kd_pengirim
                WHERE a.sumber='$kd_kirim' AND (month(a.tgl_sts)>='$blnawal' and month(a.tgl_sts)<='$blnakhir') 
                ORDER BY a.tgl_sts,a.no_sts  ";
		}else{
		//per per tanggal
		$sql = "SELECT a.no_kas,a.no_sts, a.kd_skpd, a.tgl_sts, a.keterangan, a.total, a.sumber, b.nm_pengirim 
                  FROM trhkasin_ppkd a left join ms_pengirim b on a.sumber=b.kd_pengirim
                WHERE a.sumber='$kd_kirim' AND (a.tgl_sts >= '$tgl' and a.tgl_sts <= '$tgl2') 
                ORDER BY a.tgl_sts,a.no_sts  ";	
		}
		$hasil = $this->db->query($sql);
		
		$jmlh_periode_ini = 0;
		$jmlh_periode_ini2 = 0;
		
		foreach ($hasil->result() as $row){
			$no_kas		  = $row->no_kas;
			$no_sts		  = $row->no_sts;
			$kd_skpd	  = $row->kd_skpd;
			$tgl_sts	  = $row->tgl_sts;
			$keterangan	  = $row->keterangan;
			$sumber	      = $row->sumber;
			$nm_pengirim  = $row->nm_pengirim;
			$nilai	      = $row->total;
			
			if($nilai=='' || empty($nilai)){
				$nilaix = 0;
			}else{
				$nilaix = $nilai;
			}
			$nilai1x = number_format($nilaix,"2",",",".");
			
			$jmlh_periode_ini  = $jmlh_periode_ini+$nilaix;
			$jmlh_periode_ini2 = number_format($jmlh_periode_ini,"2",",",".");
			
				$cRet .="<tr>
							<td align=\"center\">$no_kas</td>
							<td align=\"center\">$no_sts</td>
							<td align=\"left\">$tgl_sts</td>
							<td align=\"right\">$nilai1x</td>
							<td align=\"left\">$keterangan</td>
						</tr>";
			
		}
		if($cetk=='3'){ 
			//total sebelum
			$sql2 = "select sum(a.total) as nilai 
						from trhkasin_ppkd a
						where a.sumber='$kd_kirim' AND month(a.tgl_sts)<'$blnawal'";
		}else{
			//total sebelum
			$sql2 = "select sum(a.total) as nilai 
						from trhkasin_ppkd a
						where a.sumber='$kd_kirim' AND a.tgl_sts<'$tgl' ";
		}
		$hasil2=$this->db->query($sql2);
		
		foreach ($hasil2->result() as $row){
			$nilai2    = $row->nilai;
			
			if($nilai2=='' || empty($nilai2)){
				$nilai2x = 0;
			}else{
				$nilai2x = $nilai2;
			}
			
			$nilai_sbl = number_format($nilai2x,"2",",",".");
		}

		//total seluruh
		$total_periode = $jmlh_periode_ini+$nilai2x;
		if($total_periode=='' || empty($total_periode)){
				$total_periode2 = 0;
			}else{
				$total_periode2 = $total_periode;
			}
		
		$total_periode2x = number_format($total_periode2,"2",",",".");
		
		$cRet .= '
		<tr>
			<TD align="left" colspan="2">Jumlah Periode Ini </TD>
			<TD align="right"><b>'.$jmlh_periode_ini2.'</TD>
			<TD align="right" ></TD>
		</tr>
		
		<tr>
			
			<TD style="border-top:hidden" align="left" colspan="2">Jumlah s/d Periode Lalu </TD>
			<TD style="border-top:hidden;" align="right" ><b>'.$nilai_sbl.'</TD>
			<TD style="border-top:hidden;" align="right" ></TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;" align="left" colspan="2">Jumlah s/d Periode Ini</TD>
			<TD style="border-top:hidden;" align="right"><b>'.$total_periode2x.'</TD>
			<TD style="border-top:hidden;" align="right"></TD>
		</tr>';
		
		 $cRet .='</table>';
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(4);
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>DAFTAR PENERIMAAN</title>");
			 echo $cRet;
		}else{
			$this->_mpdf3('',$cRet,0,5,5,'0',$no_halaman,'');
		}
		
	}
	
	function ctk_daftar_penerimaan2(){
		$kd_kirim     = $this->uri->segment(3);
		$lcttd        = str_replace('123456789',' ',$this->uri->segment(5));
		$thn_ang      = $this->session->userdata('pcThang');
		$prv          = $this->db->query("SELECT provinsi,daerah from sclient where kd_skpd='1.20.00.00'");
		$prvn         = $prv->row();          
		$prov         = $prvn->provinsi;         
		$daerah       = $prvn->daerah;
		
		
		$cetk         = $this->uri->segment(10);
		
		if($cetk=='2'){
			$tgl          = $this->uri->segment(11);
			$nm_tglawal   = $this->tanggal_format_indonesia_kasda2($tgl);
			
			$tgl2         = $this->uri->segment(12);
			$nm_tglakhir  = $this->tanggal_format_indonesia_kasda2($tgl2);
		}else{
			$blnawal      = $this->uri->segment(6);
			$nm_bulanawal = $this->getBulan_kasda($blnawal);
			
			$blnakhir     = $this->uri->segment(7);
			$nm_bulakhir  = $this->getBulan_kasda($blnakhir);
		}
		$no_halaman   = $this->uri->segment(8);
		$spasi        = $this->uri->segment(9);
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}				
		
		if($cetk=='3'){
			$judul_bulan = "BULAN : $nm_bulanawal S/D $nm_bulakhir";
		}else{
			$judul_bulan = "TANGGAL : $nm_tglawal S/D $nm_tglakhir";
		}
		
		$judul="DAFTAR PENERIMAAN<br>(KASDA)<br>$judul_bulan";
                                               
                    
		$cRet = '';
		
			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul $thn_ang</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:13px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"$spasi\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold;\">No. Kasda</td>  
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold;\">No. Sts</td>  
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">Tanggal</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"25%\" style=\"font-weight:bold\">Penerimaan (Rp)</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"40%\" style=\"font-weight:bold\">Keterangan</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
				</tr>
				</thead>"; 
		
		if($cetk=='3'){
		//per periode
		$sql = "SELECT a.no_kas,a.no_sts, a.kd_skpd, a.tgl_sts, a.keterangan, a.total
                  FROM trhkasin_ppkd a 
                WHERE (month(a.tgl_sts)>='$blnawal' and month(a.tgl_sts)<='$blnakhir') 
                ORDER BY a.tgl_sts,a.no_sts  ";
		}else{
		//per per tanggal
		$sql = "SELECT a.no_kas,a.no_sts, a.kd_skpd, a.tgl_sts, a.keterangan, a.total 
                  FROM trhkasin_ppkd a 
                WHERE (a.tgl_sts >= '$tgl' and a.tgl_sts <= '$tgl2') 
                ORDER BY a.tgl_sts,a.no_sts  ";	
		}
		$hasil = $this->db->query($sql);
		
		$jmlh_periode_ini = 0;
		$jmlh_periode_ini2 = 0;
		
		foreach ($hasil->result() as $row){
			$no_kas		  = $row->no_kas;
			$no_sts		  = $row->no_sts;
			$kd_skpd	  = $row->kd_skpd;
			$tgl_sts	  = $row->tgl_sts;
			$keterangan	  = $row->keterangan;
			//$sumber	      = $row->sumber;
			//$nm_pengirim  = $row->nm_pengirim;
			$nilai	      = $row->total;
			
			if($nilai=='' || empty($nilai)){
				$nilaix = 0;
			}else{
				$nilaix = $nilai;
			}
			$nilai1x = number_format($nilaix,"2",",",".");
			
			$jmlh_periode_ini  = $jmlh_periode_ini+$nilaix;
			$jmlh_periode_ini2 = number_format($jmlh_periode_ini,"2",",",".");
			
				$cRet .="<tr>
							<td align=\"center\">$no_kas</td>
							<td align=\"center\">$no_sts</td>
							<td align=\"left\">$tgl_sts</td>
							<td align=\"right\">$nilai1x</td>
							<td align=\"left\">$keterangan</td>
						</tr>";
			
		}
		if($cetk=='3'){ 
			//total sebelum
			$sql2 = "select sum(a.total) as nilai 
						from trhkasin_ppkd a
						where month(a.tgl_sts)<'$blnawal'";
		}else{
			//total sebelum
			$sql2 = "select sum(a.total) as nilai 
						from trhkasin_ppkd a
						where a.tgl_sts<'$tgl' ";
		}
		$hasil2=$this->db->query($sql2);
		
		foreach ($hasil2->result() as $row){
			$nilai2    = $row->nilai;
			
			if($nilai2=='' || empty($nilai2)){
				$nilai2x = 0;
			}else{
				$nilai2x = $nilai2;
			}
			
			$nilai_sbl = number_format($nilai2x,"2",",",".");
		}

		//total seluruh
		$total_periode = $jmlh_periode_ini+$nilai2x;
		if($total_periode=='' || empty($total_periode)){
				$total_periode2 = 0;
			}else{
				$total_periode2 = $total_periode;
			}
		
		$total_periode2x = number_format($total_periode2,"2",",",".");
		
		$cRet .= '
		<tr>
			<TD align="left" colspan="2">Jumlah Periode Ini </TD>
			<TD align="right"><b>'.$jmlh_periode_ini2.'</TD>
			<TD align="right" ></TD>
		</tr>
		
		<tr>
			
			<TD style="border-top:hidden" align="left" colspan="2">Jumlah s/d Periode Lalu </TD>
			<TD style="border-top:hidden;" align="right" ><b>'.$nilai_sbl.'</TD>
			<TD style="border-top:hidden;" align="right" ></TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;" align="left" colspan="2">Jumlah s/d Periode Ini</TD>
			<TD style="border-top:hidden;" align="right"><b>'.$total_periode2x.'</TD>
			<TD style="border-top:hidden;" align="right"></TD>
		</tr>';
		
		 $cRet .='</table>';
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(4);
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>DAFTAR PENERIMAAN</title>");
			 echo $cRet;
		}else{
			$this->_mpdf3('',$cRet,0,5,5,'0',$no_halaman,'');
		}
		
	}
	
	
    function spp()
	{	
	 $this->index('0','trhspp','no_spp','kd_skpd','SPP','spp','');
	}
	
	function penerimaan_pajak_daerah()
    {
        $data['page_title']= 'PENERIMAAN PAJAK DAERAH';
        $this->template->set('title', 'PENERIMAAN PAJAK DAERAH');   
        $this->template->load('template','tukd/sp2d/penerimaan_pajak_daerah',$data) ; 
    }
	
	function ctk_penerimaan_pajak_daerah($bulan=''){
		
		$thn_ang    = $this->session->userdata('pcThang');
		$prv        = $this->db->query("SELECT provinsi,daerah from sclient where kd_skpd='1.20.00.00'");
		$prvn       = $prv->row();          
		$prov       = $prvn->provinsi;         
		$daerah     = $prvn->daerah;
		$no_halaman = $this->uri->segment(4);
		$buln       = $this->getBulan_kasda($bulan);
		
		$judul="REKAPITULASI PENERIMAAN PAJAK DAERAH";
		
		$cRet = '';
		
			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul TAHUN ANGGARAN $thn_ang</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\">&nbsp;</td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>BULAN : $buln</b></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"25%\" style=\"font-weight:bold;\">UPPD/SAMSAT</td>  
					<td align=\"center\" colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">PKB</td>
					<td align=\"center\" colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">BBN-KB</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">PKA</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">BBN-KA</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">PAP</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">SP 3</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">JUMLAH</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">PKB</td>  
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">DENDA PKB</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">Tgk. PKB</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">BBN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">Denda BBN</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">11</td>
				</tr>
				</thead>";
			
			//isi
					$sql="select * from ms_pengirim where jns_rek='411' order by kd_pengirim";
							  
					$hasil = $this->db->query($sql);
					
					//$jum_terima = number_format(0,"2",",",".");
					
					//$jum_pengeluaran=0;
					
					foreach ($hasil->result() as $rowttd)
					{
						$kd_pengirim=$rowttd->kd_pengirim;
						$nm_pengirim=$rowttd->nm_pengirim;
						$kd_skpd=$rowttd->kd_skpd;
						$jns_rek=$rowttd->jns_rek;
					
						$cRet .="<tr>
								<td align=\"left\">$kd_pengirim &nbsp; $nm_pengirim</td>
								<td align=\"center\"></td>
								<td align=\"center\"></td>
								<td align=\"center\"></td>
								<td align=\"center\"></td>
								<td align=\"center\"></td>
								<td align=\"center\"></td>
								<td align=\"center\"></td>
								<td align=\"center\"></td>
								<td align=\"center\"></td>
								<td align=\"center\"></td>
							</tr>";
					
					}

			
			$cRet .="<tr>
								<td align=\"left\"><b>Jumlah Bulan : $buln</b></td>
								<td align=\"center\">a</td>
								<td align=\"center\">b</td>
								<td align=\"center\">a</td>
								<td align=\"center\">b</td>
								<td align=\"center\">a</td>
								<td align=\"center\">b</td>
								<td align=\"center\">a</td>
								<td align=\"center\">b</td>
								<td align=\"center\">a</td>
								<td align=\"center\">a</td>
					</tr>
					<tr>
								<td align=\"left\"><b>Jumlah s/d Bulan : $buln</b></td>
								<td align=\"center\">a</td>
								<td align=\"center\">b</td>
								<td align=\"center\">a</td>
								<td align=\"center\">b</td>
								<td align=\"center\">a</td>
								<td align=\"center\">b</td>
								<td align=\"center\">a</td>
								<td align=\"center\">b</td>
								<td align=\"center\">a</td>
								<td align=\"center\">a</td>
							</tr>";

		$cRet .= '</table>';
		
		$print = $this->uri->segment(5);
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title></title>");
			 echo $cRet;
		}else{
			
			$this->_mpdf2('',$cRet,10,10,10,'1',$no_halaman,'');
			
		}
		
			
		
	}
	
	
	function cetak_amortisasi()
    {
        $data['page_title']= 'CETAK AMORTISASI';
        $this->template->set('title', 'CETAK AMORTISASI');   
        $this->template->load('template','tukd/transaksi/cetak_amortisasi',$data) ; 
    }
	
	function bk_penerimaan()
    {
        $data['page_title']= 'CETAK BUKU KAS PENERIMAAN';
        $this->template->set('title', 'CETAK BUKU KAS PENERIMAAN');   
        $this->template->load('template','tukd/sp2d/bk_penerimaan',$data) ; 
    }
	
	function ctk_bk_penerimaan($jns='', $ctk='',$ttd1='',$tgl=''){
		
		$lcttd = str_replace('123456789',' ',$this->uri->segment(5));
		$tanggal = $this->tanggal_format_indonesia($tgl);
		$z = strtotime("-1 day", strtotime($tgl));
		$n = date("Y-m-d", $z);
		$tanggalsbl = $this->tanggal_format_indonesia($n);
		$thn_ang = $this->session->userdata('pcThang');
		$prv = $this->db->query("SELECT kab_kota,daerah from sclient where kd_skpd='1.20.00.00'");
		$prvn = $prv->row();          
		$prov = $prvn->kab_kota;         
		$daerah = $prvn->daerah;
		$no_halaman = $this->uri->segment(7);
		$spasi = $this->uri->segment(8);
		
		$sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		
		switch ($jns){
                        case '0': //GAJI
						//$where2="and a.jns_spp='4'";
						$judul="BUKU KAS PEMBANTU PENERIMAAN";
                            break; 
                        /* case '1': //NON GAJI
						$where2="and a.jns_spp!='4'";
						$judul="BUKU KAS PENERIMAAN";
                            break; */
                                               
                    }
		$cRet = '';
		
			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul TAHUN ANGGARAN $thn_ang</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:13px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"$spasi\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">No. Urut</td>  
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"45%\" style=\"font-weight:bold\">Uraian</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"30%\" style=\"font-weight:bold\">Kode Rekening</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">Penerimaan (Rp)</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
				</tr>
				<tr>
					<td align=\"center\"></td>
					<td align=\"left\">Tanggal : $tanggal</td>
					<td align=\"center\"></td>
					<td align=\"center\"></td>
				</tr>
				</thead>";
		
		$nilai3=0; 
		
		//isi
		$sql = "select * from(
					SELECT
						1 as urut,
						''no_sts,
						''kd_skpd,
						f.nm_skpd,
						''kd_subkegiatan,
						''kd_rek5,
						b.no_kas,
						''tgl_kas,
						ISNULL(e.nm_pengirim, '') nm_pengirim,
						''nm_rek5,
						0 rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_sts = b.no_sts
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					INNER JOIN trhkasin_pkd d ON a.no_sts = d.no_sts
					LEFT JOIN ms_pengirim e ON d.sumber = e.kd_pengirim
					INNER JOIN ms_skpd f ON a.kd_skpd = f.kd_skpd
					WHERE b.tgl_kas='$tgl' AND a.kd_skpd !='1.20.00.00'
					GROUP BY b.no_kas,nm_pengirim, f.nm_skpd
					UNION ALL
					SELECT
						2 as urut,
						b.no_sts,
						a.kd_skpd,
						'' nm_skpd,
						a.kd_subkegiatan,
						a.kd_rek5,
						b.no_kas,
						b.tgl_kas,
						'' nm_pengirim,
						c.nm_rek5,
						a.rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_sts = b.no_sts 
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					INNER JOIN trhkasin_pkd d ON a.no_sts = d.no_sts
					LEFT JOIN ms_pengirim e ON d.sumber = e.kd_pengirim
					WHERE b.tgl_kas='$tgl' AND a.kd_skpd !='1.20.00.00'
					GROUP BY b.no_sts,a.kd_skpd,a.kd_subkegiatan,a.kd_rek5,b.no_kas,b.tgl_kas,c.nm_rek5,a.rupiah
					
					UNION ALL
					
					SELECT
						1 as urut,
						''no_sts,
						''kd_skpd,
						f.nm_skpd,
						''kd_kegiatan,
						''kd_rek5,
						b.no_kas,
						''tgl_kas,
						''nm_pengirim,
						''nm_rek5,
						0 rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_sts = b.no_sts
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					INNER JOIN ms_skpd f ON a.kd_skpd = f.kd_skpd
					WHERE b.tgl_kas='$tgl' AND a.kd_skpd ='1.20.00.00'
					GROUP BY b.no_kas,f.nm_skpd
					UNION ALL
					SELECT
						2 as urut,
						b.no_sts,
						a.kd_skpd,
						'' nm_skpd,
						a.kd_subkegiatan,
						a.kd_rek5,
						b.no_kas,
						b.tgl_kas,
						'' nm_pengirim,
						c.nm_rek5,
						a.rupiah
					FROM
						trdkasin_ppkd a
					INNER JOIN trhkasin_ppkd b ON a.no_sts = b.no_sts 
					INNER JOIN ms_rek5 c ON a.kd_rek5 = c.kd_rek5
					WHERE b.tgl_kas='$tgl' AND a.kd_skpd ='1.20.00.00'
					GROUP BY b.no_sts,a.kd_skpd,a.kd_subkegiatan,a.kd_rek5,b.no_kas,b.tgl_kas,c.nm_rek5,a.rupiah
					) a
					order by no_kas,urut";
		$hasil = $this->db->query($sql);
		
		foreach ($hasil->result() as $row){
			
			$urut		  = $row->urut;
			$no_sts       = $row->no_sts;
			$kd_skpd      = $row->kd_skpd;
			$nm_skpd      = $row->nm_skpd;
			$kd_kegiatan  = $row->kd_subkegiatan;
			$kd_rek5      = $row->kd_rek5;
			$no_kas       = $row->no_kas;
			$tgl_kas      = $row->tgl_kas;
			$nm_pengirim  = $row->nm_pengirim;
			
			if($nm_pengirim==''){
				$nama_kirim = $nm_skpd;
			}else{
				$nama_kirim = $nm_pengirim;
			}
			
			$nm_rek5      = $row->nm_rek5;
			$nilai        = $row->rupiah;
			$nilaix       = empty($nilai) || $nilai == 0 ? '' :number_format($nilai,"2",",",".");                      
			
			//$jumlah      = ($row->jumlah)+1;
			
			//total pertanggal
			$nilai3=$nilai3+$nilai;
												
			if ($kd_kegiatan==''){
				$kode="";
			} else {
				$kode="$kd_kegiatan.$kd_rek5";
			}
		
			if($urut=='1'){
				$cRet .="<tr>
							<td align=\"center\">$no_kas</td>
							<td align=\"left\">$nama_kirim</td>
							<td align=\"left\"></td>
							<td align=\"right\"></td>
						</tr>";
			}else{
				$cRet .="<tr>
							<td align=\"left\" style=\"border-top:hidden;\"></td>
							<td align=\"left\" style=\"border-top:hidden;\">$nm_rek5</td>
							<td align=\"left\" style=\"border-top:hidden;\">$kode</td>
							<td align=\"right\" style=\"border-top:hidden;\">$nilaix</td>
						</tr>";
			}
		}
		 
		
		 
		//total sebelum
		$sql2 = "select sum(total) as nilai from trhkasin_ppkd where tgl_kas<'$tgl'";
		$hasil2=$this->db->query($sql2);
		
		foreach ($hasil2->result() as $row){
			$nilai2  = $row->nilai;
			$nilai2x = number_format($nilai2,"2",",",".");
		}	
		
		
		$total  = $nilai3+$nilai2;
		$totalx = number_format($total,"2",",","."); 
		$nilai3x = number_format($nilai3,"2",",",".");
		
		$cRet .= '
		<tr>
			<TD></TD>
			<TD align="left" colspan="2" style="border-left:hidden;">Jumlah Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal.' </TD>
			<TD align="right" >'.$nilai3x.'</TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;"></TD>
			<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah Sampai Tanggal : '.$tanggalsbl.' </TD>
			<TD style="border-top:hidden;" align="right" >'.$nilai2x.'</TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;"></TD>
			<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah s.d Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal.' </TD>
			<TD align="right" >'.$totalx.'</TD>
		</tr>';
		
		 $cRet .='</table>';
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(4);
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>Buku Kas Penerimaan</title>");
			 echo $cRet;
		}else{
			//$this->_mpdf2('',$cRet,10,10,10,'0',$no_halaman,'');
			$this->_mpdf3('',$cRet,0,5,5,'0',$no_halaman,'');
		}
		
	}
	
	
	function daftar_pengeluaran()
    {
        $data['page_title']= 'DAFTAR PENGELUARAN';
        $this->template->set('title', 'DAFTAR PENGELUARAN');   
        $this->template->load('template','tukd/sp2d/daftar_pengeluaran',$data) ; 
    }
	
     function buku_kas_umum()
    {
        $data['page_title']= 'Buku Kas Umum';
        $this->template->set('title', 'Buku Kas Umum');   
        $this->template->load('template','tukd/pendapatan/kas_harian_umum',$data) ; 
    }
    
	function daftar_pajak()
    {
        $data['page_title']= 'DAFTAR PAJAK';
        $this->template->set('title', 'DAFTAR PAJAK');   
        $this->template->load('template','tukd/sp2d/daftar_pajak',$data) ; 
    }
	
	function buku_kas_penerimaan_pengeluaran_manual($ctk='',$ttd='',$tgl='',$number='',$no_halaman=''){
		
		$lcttd = str_replace('123456789',' ',$this->uri->segment(4));
		$tanggal = $this->tanggal_format_indonesia($tgl);
		$z = strtotime("-1 day", strtotime($tgl));
		$n = date("Y-m-d", $z);
		$tanggalsbl = $this->tanggal_format_indonesia($n);
		$thn_ang = $this->session->userdata('pcThang');
		$prv = $this->db->query("SELECT provinsi,daerah from sclient where kd_skpd='1.20.00.00'");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
	
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
			
		$sqlx="SELECT * from buku_kas where nomor='0'";	
		$sqlx1=$this->db->query($sqlx);
		 foreach ($sqlx1->result() as $rowttd)
			{
				$nomor=$rowttd->nomor;
				$uraian=$rowttd->uraian;
				$nilaiu= $rowttd->nilai;
				$nilaiu_x = number_format($nilaiu,"2",",",".");
			}
		if ($tgl=='2016-1-1'){	
		$cRet="";
		$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>BUKU KAS PENERIMAAN DAN PENGELUARAN</b><br> <b>TAHUN ANGGARAN $thn_ang</b></td>
            </tr>
            
			</table>
			<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
            <thead> 
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">NOMOR</td>  
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"50%\" style=\"font-weight:bold\">URAIAN</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">PENERIMAAN</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">PENGELUARAN</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
            </tr>
			<tr>
				<td></td>
                <td>Tanggal : $tanggal</td>
				<td></td>
                <td></td>
			</tr>
			<tr>
				<td align=\"center\">1</td>
                <td>$uraian</td>
				<td align=\"right\">$nilaiu_x</td>
                <td align=\"right\">0,00</td>
			</tr>
			</thead>";
		}else{
		$cRet="";
		$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>BUKU KAS PENERIMAAN DAN PENGELUARAN</b><br> <b>TAHUN ANGGARAN $thn_ang</b></td>
            </tr>
            
			</table>
			<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
            <thead> 
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">NOMOR</td>  
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"50%\" style=\"font-weight:bold\">URAIAN</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">PENERIMAAN</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">PENGELUARAN</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
            </tr>
			<tr>
				<td></td>
                <td>Tanggal : $tanggal</td>
				<td></td>
                <td></td>
			</tr>
			</thead>";
		}
		$tot_trm=0; 
		$tot_klr=0; 
		$sql="SELECT a.nomor, a.uraian,ISNULL(SUM(b.nilai),0) as nilai from 
				buku_kas a LEFT JOIN 
				(
				select jenis, sum(nilai) as nilai from buku_kas_penerimaan_pengeluaran
				where tanggal='$tgl' group by jenis
				UNION ALL
				select 11 as jenis
				, isnull(sum(d.nilai),0) as nilai
								from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
														INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
														INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd
								where a.status_bud='1' and  a.jns_spp !='4' and a.tgl_kas_bud='$tgl'
				UNION ALL
				select 11 as jenis
				, isnull(sum(d.nilai),0) as nilai
								from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
														INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
														INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd
								where a.status_bud='1' and  a.jns_spp ='4' and a.tgl_kas_bud='$tgl'
				UNION ALL
			SELECT
				13 AS jenis,
				isnull(SUM(x.nilai), 0) AS nilai
			FROM
				pengeluaran_non_sp2d x
			where x.tanggal = '$tgl') b
				on a.nomor=b.jenis 
				where nomor != '0' AND b.nilai !='0'
				GROUP BY a.nomor,a.uraian
				ORDER BY nomor";
		if ($tgl=='2016-1-1'){	
		$no=1;
		}else{
		$no=$number-1;	
		}
		$hasil = $this->db->query($sql);
		foreach ($hasil->result() as $row){
			$nomor  = $row->nomor;                    
			$uraian= $row->uraian;
			$nilai  = $row->nilai;
		if(($nomor==1) or ($nomor==2) or ($nomor==3) or ($nomor==4) or ($nomor==0) or ($nomor==5) or ($nomor==6) or ($nomor==7) or ($nomor==8) or ($nomor==9) or ($nomor==10)){
			$terima=$nilai;
			$keluar=0;
			
		} else {
			$terima=0;
			$keluar=$nilai;
		}
		$tot_trm=$tot_trm+$terima;
		$tot_klr=$tot_klr+$keluar;
		$no=$no+1;
		$cRet .= '<tr>
		<TD align="center" >'.$no.'</TD>
		<td valign="top">'.$uraian.'</td>
		<td valign="top" align="right">'.number_format($terima,"2",",",".").'</td>
		<td valign="top" align="right">'.number_format($keluar,"2",",",".").'</td>
		</tr>';
		
		}
		
		$sql3 = "select nilai from buku_kas where nomor ='0'";
		$hasil3 = $this->db->query($sql3);
		foreach ($hasil3->result() as $row){
		$nilai_ax = $row->nilai;
		$nilai_x = number_format($nilai_ax,"2",",",".");
		}
		
		$sql2 = "SELECT
				SUM(CASE WHEN nomor IN ('1','2','3','4','5','6','7','8','9','10') THEN nilai ELSE 0 END) as trm_sbl,
				SUM(CASE WHEN nomor IN ('11','12','13') THEN nilai ELSE 0 END) as klr_sbl
				FROM
				(SELECT a.nomor,ISNULL(SUM(b.nilai),0) as nilai from 
				buku_kas a LEFT JOIN 
				(
				select jenis, sum(nilai) as nilai from buku_kas_penerimaan_pengeluaran 
				where tanggal<'$tgl' group by jenis
				union ALL
				select 11 as jenis
				, isnull(sum(d.nilai),0) as nilai
								from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
														INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
														INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd
								where a.status_bud='1' and a.tgl_kas_bud <'$tgl'
				UNION ALL 
				SELECT 13 as jenis,
				isnull(sum(nilai),0) as nilai
				FROM pengeluaran_non_sp2d
				WHERE tanggal <'$tgl') b
				on a.nomor=b.jenis where a.nomor !='0'
				GROUP BY a.nomor) c";
		$hasil2 = $this->db->query($sql2);
		foreach ($hasil2->result() as $row){
		$trm_sbl = $row->trm_sbl+$nilai_ax;
		$klr_sbl = $row->klr_sbl;
		$nilai_2x = number_format($trm_sbl,"2",",",".");
		$nilai_3x = number_format($klr_sbl,"2",",",".");
		
		}	
		
			
		
		//$kas = ($tot_trm+$trm_sbl)-($tot_klr+$klr_sbl);
		//$kasnom = number_format($kas,"2",",",".");
		$total_terima = $tot_trm+$trm_sbl;
		$total_keluar = $tot_klr+$klr_sbl;
		$tot_saldo = $total_terima-$total_keluar;
		$totsaldo = number_format($tot_saldo,"2",",",".");
		
		if ($tgl=='2016-1-1'){
		$cRet .= '
		<tr>
			
			<TD align="left" colspan="2">Jumlah Tanggal &nbsp; '.$tanggal.'   </TD>
			
			<td align="right">'.$nilaiu_x.'</td>
			<TD align="right">0,00</TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;" align="left" colspan="2">Jumlah Sampai Dengan Tanggal &nbsp; '.$tanggalsbl.'</TD>
			<td style="border-top:hidden;" align="right">0,00</td>
			<TD style="border-top:hidden;" align="right" >'.$nilai_3x.'</TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;" align="left" colspan="2">Jumlah Sampai Dengan Tanggal &nbsp; '.$tanggal.'</TD>
			<td style="border-top:hidden;" align="right">'.number_format($total_terima,"2",",",".").'</td>
			<TD style="border-top:hidden;" align="right">'.number_format($total_keluar,"2",",",".").'</TD>
		</tr>';
		
		$cRet .='</table>';
		}else{
		$cRet .= '
		<tr>
			
			<TD align="left" colspan="2">Jumlah Tanggal &nbsp; '.$tanggal.'   </TD>
			
			<td align="right">'.number_format($tot_trm,"2",",",".").'</td>
			<TD align="right">'.number_format($tot_klr,"2",",",".").'</TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;" align="left" colspan="2">Jumlah Sampai Dengan Tanggal &nbsp; '.$tanggalsbl.'</TD>
			<td style="border-top:hidden;" align="right">'.$nilai_2x.'</td>
			<TD style="border-top:hidden;" align="right" >'.$nilai_3x.'</TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;" align="left" colspan="2">Jumlah Sampai Dengan Tanggal &nbsp; '.$tanggal.'</TD>
			<td style="border-top:hidden;" align="right">'.number_format($total_terima,"2",",",".").'</td>
			<TD style="border-top:hidden;" align="right">'.number_format($total_keluar,"2",",",".").'</TD>
		</tr>';
		
		$cRet .='</table>';	
		}
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
						<td width=\"50%\"></td>
						<td width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td width=\"50%\">Pada hari ini, tanggal $tanggal</td>
						<td width=\"50%\"></td>
					</tr>
					<tr>
						<td width=\"50%\">Oleh kami didapat dalam kas Rp. $totsaldo</td>
						<td width=\"50%\"></td>
					</tr>
					<tr>
						<td><i>(".$this->tukd_model->terbilang($tot_saldo).")</i></td>
						<td width=\"50%\"></td>
					</tr>
                    
                  </table>";
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(3);
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>Buku Kas Penerimaan dan Pengeluaran</title>");
			 echo $cRet;
		}else{
			//$this->_mpdf2('',$cRet,10,10,10,'0',$no_halaman,'');
			$this->_mpdf3('',$cRet,0,5,5,'0',$no_halaman,'');
		}	
	}
	
	function cetak_buku_kas_pembantu_manual()
    {
        $data['page_title']= 'BUKU KAS PENERIMAAN';
        $this->template->set('title', 'BUKU KAS PENERIMAAN');   
        $this->template->load('template','tukd/sp2d/ctk_bkp2_manual',$data) ; 
    }
	
	function load_rekening() {
       // $skpd     = $this->session->userdata('kdskpd');
		//$kriteria = '';
        //$kriteria = $this->input->post('cari');
        
		
		$sql = "
        select * from trdrka where left(kd_rek5,1)='4' and kd_skpd='1.20.00.00'
        union all
        select * from trdrka where kd_rek5 in ('6110101','6150501') and kd_skpd='1.20.00.00' order by kd_rek5                
        ";
		
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,           
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek5' => $resulte['nm_rek5']                                                                                          
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
	
	function kode_organisasi() {
        $sql = "SELECT kd_org, nm_org FROM ms_organisasi";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_org'],  
                        'nm_skpd' => $resulte['nm_org']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
		$query1->free_result(); 	   
	}
	
	function kode_skpd() {
        $sql = "select kd_skpd, nm_skpd from ms_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd'] 
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result(); 	   
	}
	
	
	function bkp2()
    {
        $data['page_title']= 'BUKU KAS PENERIMAAN';
        $this->template->set('title', 'BUKU KAS PENERIMAAN');   
        $this->template->load('template','tukd/sp2d/bkp2',$data) ; 
    }
	
	function penerimaan_kas_lainnya()
    {
        $data['page_title']= 'PENERIMAAN LAINNYA';
        $this->template->set('title', 'PENERIMAAN LAINNYA');   
        $this->template->load('template','tukd/sp2d/penerimaan_kas_lainnya',$data) ; 
    }
	
	function simpan_kas_lainnya(){
        
        $tabel  = $this->input->post('tabel');
        $nokas  = $this->input->post('nokas');
        $jns    = $this->input->post('jns');
        $ket    = $this->input->post('ket');
        $ttd    = $this->input->post('ttd');
        $nilai  = $this->input->post('nilai');
        $usernm = $this->session->userdata('pcNama');		

		$filter_jns = substr($jns,0,1);
		if($filter_jns=="4"){
			$kegiatan = "1.20.1.20.00.00.00.01";
			$subkeg = "1.20.1.20.00.00.00.01.01";
		}else{
			$kegiatan = "1.20.1.20.00.00.00.03";
			$subkeg = "1.20.1.20.00.00.00.03.01";
		}	
		
             $sql = "insert into trhkasin_ppkd(no_sts,kd_skpd,tgl_sts,keterangan,total,kd_kegiatan,jns_trans,no_kas,tgl_kas,sumber,kd_subkegiatan) 
                        values('$nokas','1.20.00.00','$ttd','$ket','$nilai','$kegiatan','$filter_jns','$nokas','$ttd','00012000','$subkeg')";
            $asg = $this->db->query($sql);
            
			 $sql = "insert into trdkasin_ppkd(kd_skpd,no_sts,kd_rek5,rupiah,no_kas,kd_kegiatan,kd_subkegiatan) values ('1.20.00.00','$nokas','$jns','$nilai','$nokas','$kegiatan','$subkeg')";
            $asg = $this->db->query($sql);
			
			if($asg){
                echo '2';
            }else{
                echo '0';
            }
  
    }
	
	function hapus_penerimaan_lainnya() {    	
		$no_kas = $this->input->post('no_kas');
		$tgl = $this->input->post('tgl_kas');
		//$nilai = $this->input->post('nilai');
        $query = "delete from trhkasin_ppkd where no_kas='$no_kas' and kd_skpd='1.20.00.00'";
		$asg = $this->db->query($query);
            if($asg){
				$query = "delete from trdkasin_ppkd where no_kas='$no_kas' and kd_skpd='1.20.00.00'";
				$asg = $this->db->query($query);
				if($asg){
                echo '1';
				}else{
					echo '0';
				}
            }else{
                echo '0';
            }
    }
	
	function load_penerimaan_lain_ppkd() {
        
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        if ($kriteria <> ''){                               
            $where="WHERE a.kd_skpd ='1.20.00.00' AND (upper(a.no_sts) like upper('%$kriteria%') or a.tgl_sts like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%'))";            
        } else{
			$where="WHERE a.kd_skpd ='1.20.00.00' AND (upper(a.no_sts) like upper('%%'))";
		}
        
        $sql = "SELECT count(*) as tot from trhkasin_ppkd a $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        /* $sql = " SELECT TOP $rows a.no_sts, a.tgl_sts,a.kd_skpd,a.keterangan,a.total,
a.kd_bank, b.kd_kegiatan,a.jns_trans,a.rek_bank,a.no_kas,a.tgl_kas,a.no_cek,a.status, b.kd_rek5,c.nm_rek5,
(
	SELECT
		nm_skpd
	FROM
		ms_skpd
	WHERE
		kd_skpd = a.kd_skpd
) AS nm_skpd
FROM
	trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON a.kd_skpd=b.kd_skpd
AND a.no_kas=b.no_kas 
LEFT JOIN ms_rek5 c ON b.kd_rek5=c.kd_rek5
 $where AND a.no_sts NOT in (SELECT TOP $offset no_sts FROM trhkasin_ppkd order by tgl_sts) AND a.kd_skpd = '1.20.12.02' 
 GROUP BY a.no_sts, a.tgl_sts,a.kd_skpd,a.keterangan,a.total,
a.kd_bank, b.kd_kegiatan,a.jns_trans,a.rek_bank,a.no_kas,a.tgl_kas,a.no_cek,a.status,b.kd_rek5, c.nm_rek5
 order by a.tgl_sts"; */
 
		$sql = " SELECT a.*, b.kd_kegiatan, b.kd_subkegiatan, b.kd_rek5, c.nm_rek5,(SELECT nm_skpd FROM ms_skpd WHERE kd_skpd = a.kd_skpd) AS nm_skpd from trhkasin_ppkd a  INNER JOIN trdkasin_ppkd b ON a.kd_skpd=b.kd_skpd
AND a.no_kas=b.no_kas 
LEFT JOIN ms_rek5 c ON b.kd_rek5=c.kd_rek5
$where AND a.no_sts NOT in (SELECT TOP $offset no_sts FROM trhkasin_ppkd order by tgl_sts) order by a.no_kas,b.kd_subkegiatan";
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,      
                        'no_sts' => $resulte['no_sts'],
                        'tgl_sts' => $resulte['tgl_sts'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'total' =>  number_format($resulte['total'],2),
                        'kd_bank' => $resulte['kd_bank'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'jns_trans' => $resulte['jns_trans'],
                        'rek_bank' => $resulte['rek_bank'],
                        'no_kas' => $resulte['no_kas'],
                        'tgl_kas' => $resulte['tgl_kas'],
                        'no_cek' => $resulte['no_cek'],
                        'status' => $resulte['status'],
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek5' => $resulte['nm_rek5'],
                        'nm_skpd' => $resulte['nm_skpd']                                                                                           
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
    	   
	}
	
	
	function update_kas_lainnya(){
        
		$nokas  = $this->input->post('nokas');
        $jns    = $this->input->post('jns');
        $ket    = $this->input->post('ket');
        $ttd    = $this->input->post('ttd');
        $nilai  = $this->input->post('nilai');
        $usernm = $this->session->userdata('pcNama');
		
		
             $sql = "update trhkasin_ppkd set tgl_sts='$ttd',keterangan='$ket',total='$nilai',tgl_kas='$ttd' WHERE no_kas='$nokas'";
            $asg = $this->db->query($sql);
            
			 $sql = "update trdkasin_ppkd set kd_rek5='$jns',rupiah='$nilai' WHERE no_kas='$nokas'";
            $asg = $this->db->query($sql);
			
			if($asg){
                echo '1';
            }else{
                echo '0';
            }
        

    }	
	
	function hapus_bkp2() {    	
		$jenis = $this->input->post('jns');
		$tgl = $this->input->post('tanggal');
		//$nilai = $this->input->post('nilai');
        $query = "delete from buku_kas_penerimaan_pengeluaran where jenis='$jenis' and tanggal='$tgl'";
		$asg = $this->db->query($query);
            if($asg){
                echo '1';
            }else{
                echo '0';
            }
    }

	
	function load_bkp2() {
        
        $sql = "SELECT * from buku_kas_penerimaan_pengeluaran order by tanggal";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'jenis' => $resulte['jenis'],
                        'tanggal' => $resulte['tanggal'],  
                        'nilai' => number_format($resulte['nilai'],"2",".",",")                                                                                         
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
	
	function simpan_bkp2(){
        
        $tabel  = $this->input->post('tabel');
        $lckolom = $this->input->post('kolom');
        $lcnilai = $this->input->post('nilai');
        $cid = $this->input->post('cid');
        $lcid = $this->input->post('lcid');
        
            $sql = "insert into $tabel $lckolom values $lcnilai";
            $asg = $this->db->query($sql);
            if($asg){
                echo '2';
            }else{
                echo '0';
            }
  
    }
	
	function simpan_pengeluaran_non_sp2d(){
        
        $tabel  = $this->input->post('tabel');
        $lckolom = $this->input->post('kolom');
        $lcnilai = $this->input->post('nilai');
        $cid = $this->input->post('cid');
        $lcid = $this->input->post('lcid');
        
        $sql = "select $cid from $tabel where $cid='$lcid'";
        $res = $this->db->query($sql);
        if($res->num_rows()>0){
			echo '1';
		}else{
            $sql = "insert into $tabel $lckolom values $lcnilai";
            $asg = $this->db->query($sql);
            if($asg){
                echo '2';
            }else{
                echo '0';
            }
		}
        
    }
	
	function skpd__pend() {

        $kd_skpd = $this->session->userdata('kdskpd');
        $vkdskpd = substr($kd_skpd, -2);
        if($vkdskpd=='00' || $vkdskpd=='01'){ 
            $kd_skpd = substr($kd_skpd, 0, 7); 
        }
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result(); 	  
	}
	
	function ctk_daftar_pengeluaran($jns='', $bulan='', $ctak='', $ttd1='', $tgl=''){
		
		$lcttd      = str_replace('123456789',' ',$this->uri->segment(6));
		$thn_ang    = $this->session->userdata('pcThang');
		$prv        = $this->db->query("SELECT provinsi,daerah from sclient where kd_skpd='1.20.00.00'");
		$prvn       = $prv->row();          
		$prov       = $prvn->provinsi;         
		$daerah     = $prvn->daerah;
		$jns_beban  = $this->uri->segment(3);
		$no_halaman = $this->uri->segment(8);
		$jns_cetak  = $this->uri->segment(9);
		$tgl_cetak  = $this->uri->segment(10);
		$tgl_cetak1	= $this->tanggal_format_indonesia($tgl_cetak);
		$spasi      = $this->uri->segment(11);
		$skpd       = $this->uri->segment(12);
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		
		if($jns_beban=='0'){
			//GJ
			$where = "AND a.jns_spp='4'";
			$judul="DAFTAR PENGELUARAN GAJI";	
		}else if($jns_beban=='1'){
			//LS
			$where = "AND (a.jns_spp='5' or a.jns_spp='6')";
			$judul="DAFTAR PENGELUARAN LS";
		}else if($jns_beban=='2'){
			//UP
			$where = "AND a.jns_spp='1'";
			$judul="DAFTAR PENGELUARAN UP";
		}else if($jns_beban=='3'){
			//TU
			$where = "AND a.jns_spp='3'";
			$judul="DAFTAR PENGELUARAN TU";
		}else{
			//GU
			$where = "AND a.jns_spp='2'";
			$judul="DAFTAR PENGELUARAN GU";
		}
	   
	   
	   if($jns_cetak=='0' || $jns_cetak=='2'){
			$where2 = "";
	   }else if($jns_cetak=='1' || $jns_cetak=='3'){
			$where2 = "AND LEFT(a.kd_skpd,7)='$skpd'";
	   }else{
		   $where2 = "AND a.kd_skpd='$skpd'";
	   }
						
		
		if($jns_cetak=='4'){
			$buln       = $this->getBulan_kasda($bulan);
			$bln="BULAN : $buln";
		}else{
			$bln="&nbsp;";
		}
		
		$cRet = '';
		
			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul TAHUN ANGGARAN $thn_ang</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"><b>$bln</b></td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"$spasi\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold;\">TANGGAL</td>  
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"9%\" style=\"font-weight:bold\">NOMOR KAS</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">NOMOR SP2D TANGGAL SP2D</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"29%\" style=\"font-weight:bold\">URAIAN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">KODE REKENING</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"9%\" style=\"font-weight:bold\">PENERIMAAN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"11%\" style=\"font-weight:bold\">PENGELUARAN</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
				</tr>
				</thead>";

					//isi
						$sql="select * from(
								select 1 urut, 
								       a.no_kas_bud as urut2, 
									   a.no_kas_bud, 
									   a.tgl_kas_bud, 
									   a.no_sp2d, 
									   a.tgl_sp2d,
									   a.kd_skpd,
									   a.keperluan,
									   a.nmrekan,
									   c.pimpinan,
									   a.nm_skpd,
									   '' kd_kegiatan,
									   '' kd_rek5, 
									   '' nm_rek5, 
									   0 nilai,
									   0 no_bukti 
								from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
											   INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd 
											   INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd 
								where a.status_bud='1' and a.tgl_kas_bud<='$tgl' $where $where2
								group by a.tgl_kas_bud, a.no_kas_bud, a.no_sp2d, a.tgl_sp2d, a.keperluan, a.nmrekan, c.pimpinan, a.kd_skpd, a.nm_skpd
								UNION ALL
								select 2 urut,
									   '' no_kas_bud,
										a.no_kas_bud as urut2,
										'' tgl_kas_bud,
										'' no_sp2d, 
										'' tgl_sp2d, 
										a.kd_skpd,
										'' keperluan,
										'' nmrekan,
										'' pimpinan,
										'' nm_skpd,
										d.kd_kegiatan, 
										d.kd_rek5,
										d.nm_rek5,
										d.nilai,
										d.no_bukti  
								from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
											   INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd 
											   INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd 
								where a.status_bud='1' and a.tgl_kas_bud<='$tgl' $where $where2
								GROUP BY a.no_kas_bud, a.kd_skpd, a.keperluan, d.kd_kegiatan, d.kd_rek5, d.nm_rek5,d.nilai,d.no_bukti) a
							  order by no_kas_bud,urut, kd_kegiatan, kd_rek5";
							  
					$hasil = $this->db->query($sql);
					
					$jum_terima = number_format(0,"2",",",".");
					
					$jum_pengeluaran=0;
					$jumlah_pengeluaran=0;
					$jmlh_pengeluaran=0;
					
					foreach ($hasil->result() as $rowttd)
					{
						$urut=$rowttd->urut;
						$urut2=$rowttd->urut2;
						$no_kas_bud=$rowttd->no_kas_bud;
						$tgl_kas_bud=$rowttd->tgl_kas_bud;
						$no_sp2d=$rowttd->no_sp2d;
						$tgl_sp2d=$rowttd->tgl_sp2d;
						$kd_skpd=$rowttd->kd_skpd;
						$keperluan=$rowttd->keperluan;
						$nmrekan=$rowttd->nmrekan;
						$pimpinan=$rowttd->pimpinan;
						$nm_skpd=$rowttd->nm_skpd;
						$kd_kegiatan=$rowttd->kd_kegiatan;
						$kd_rek5=$this->dotrek($rowttd->kd_rek5);
						$nm_rek5=$rowttd->nm_rek5;
						$nilai=$rowttd->nilai;
						$no_bukti=$rowttd->no_bukti;
					
						
						$jumlah_pengeluaran=number_format($nilai,"2",",",".");
						
						$jum_pengeluaran=$jum_pengeluaran+$nilai;
						$jmlh_pengeluaran=number_format($jum_pengeluaran,"2",",",".");
						
						if($kd_kegiatan==''){
							$kode="";
						}else{
							$kode="$kd_kegiatan.$kd_rek5";
						}
					
						if($urut=='1'){
						
							$sqlnam="SELECT TOP 1 * FROM ms_ttd WHERE kd_skpd = '$kd_skpd' AND kode='BK' ";
								 $sqlnam=$this->db->query($sqlnam);
								 foreach ($sqlnam->result() as $rownam)
								{
									$nama_ben=$rownam->nama;                    
									$jabat_ben=$rownam->jabatan;                    
								}
								
							$nama_ben = empty($nama_ben) ? 'Belum Ada data Bendahara' :$nama_ben;
							$jabat_ben = empty($jabat_ben) ? ' ' :$jabat_ben;
								
							$cRet .="<tr>
										<td align=\"center\">$tgl_kas_bud</td>
										<td align=\"center\">$no_kas_bud</td>
										<td align=\"center\">$no_sp2d <br>$tgl_sp2d</td>
										<td>$nama_ben, &nbsp; $nm_skpd</td>
										<td></td>
										<td></td>
										<td></td>
									</tr>";
						}else{
											
							$cRet .="<tr>
										<td style=\"border-top:hidden;\"></td>
										<td style=\"border-top:hidden;\"></td>
										<td style=\"border-top:hidden;\"></td>
										<td align=\"left\" style=\"border-top:hidden;\">$nm_rek5</td>
										<td align=\"center\" style=\"border-top:hidden;\">$kode</td>
										<td align=\"right\" style=\"border-top:hidden;\">$jum_terima</td>
										<td align=\"right\" style=\"border-top:hidden;\">$jumlah_pengeluaran</td>
									</tr>";
						}
					}
					
					$cRet .="<tr>
								<td colspan=\"5\" align=\"right\"><b>Jumlah</b></td>
								<td align=\"right\"><b>$jum_terima</b></td>
								<td align=\"right\"><b>$jmlh_pengeluaran</b></td>
							</tr>";
					
		$cRet .= '</table>';
	
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">Sanggau, $tgl_cetak1</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		
		$print = $this->uri->segment(5);
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title></title>");
			 echo $cRet;
		}else{
			
			$this->_mpdf2('',$cRet,10,10,10,'1',$no_halaman,'');
			
		}
		
			
		
	}
	
	
	function ctk_daftar_pajak($jns='', $belanja='', $ctak='', $tgl='', $tgl2=''){
		
		$lcttd      = str_replace('%20',' ',$this->uri->segment(10));
		$thn_ang    = $this->session->userdata('pcThang');
		$tanggal    = $this->tanggal_format_indonesia_kasda($tgl);
		$tanggal2   = $this->tanggal_format_indonesia_kasda($tgl2);
		$no_halaman = $this->uri->segment(8);	
		$cetk       = $this->uri->segment(9);	
		$skpd       = $this->uri->segment(11);
		
		$prv        = $this->db->query("SELECT provinsi,daerah from sclient where kd_skpd='1.20.00.00'");
		$prvn       = $prv->row();          
		$prov       = $prvn->provinsi;         
		$daerah     = $prvn->daerah;
		
		
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		
		if($jns=='0'){
                         //GAJI
						$judul="DAFTAR POTONGAN SP2D GAJI";
		}else{
						//NON GAJI
						$judul="DAFTAR POTONGAN SP2D NON GAJI";                         
        }
		
		$cRet = '';
				
		//Gaji
		if($jns=='0'){
			//rekap per SKPD
			if($cetk=='0'){
			 $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>DARI TANGGAL : $tanggal S/D $tanggal2</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">No. Urut</td>  
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"33%\" style=\"font-weight:bold\">Nama Instansi</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" style=\"font-weight:bold\">Nilai SP2D</td>
					<td align=\"center\" colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"40%\" style=\"font-weight:bold\">Potongan-Potongan</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">Jumlah Potongan</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">IWP</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">TAPERUM</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">HKPG</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">PPH</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
				</tr>
				</thead>"; 
			
				$sql = "SELECT a.kd_skpd, a.nm_skpd, ISNULL(a.nilai,0) as nilai,
					ISNULL(iwp,0) iwp,
					ISNULL(taperum,0) taperum,
					ISNULL(hkpg,0) hkpg,
					ISNULL(pph,0) pph,
					iwp+taperum+hkpg+pph as jumlah_potongan
					FROM
					(SELECT a.kd_skpd, a.nm_skpd, SUM(d.nilai) as nilai FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
					INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
					WHERE (a.jns_spp='4' AND a.jenis_beban='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd
					)a LEFT JOIN
					(SELECT a.kd_skpd, a.nm_skpd
					,SUM(CASE WHEN kd_rek5 ='2110701' THEN c.nilai ELSE 0 END) AS iwp 
					,SUM(CASE WHEN kd_rek5 ='2110501' THEN c.nilai ELSE 0 END) AS taperum 
					,SUM(CASE WHEN kd_rek5 ='2110801' THEN c.nilai ELSE 0 END) AS hkpg 
					,SUM(CASE WHEN kd_rek5 ='2130101' THEN c.nilai ELSE 0 END) AS pph 
					FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trspmpot c ON b.no_spm = c.no_spm AND b.kd_skpd = c.kd_skpd
					WHERE (a.jns_spp='4' AND a.jenis_beban='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd
					) b ON a.kd_skpd=b.kd_skpd";
			
				$hasil = $this->db->query($sql);
				
				$nomor               ='0';
				$jum_nilai           =0;
				$jum_iwp             =0;
				$jum_taperum         =0;
				$jum_hkpg            =0;
				$jum_pph             =0;
				$jum_jumlah_potongan =0;
				$jumlah_sp2d            =0;
				$jumlah_iwp             =0;
				$jumlah_sp2d            =0;
				$jumlah_iwp             =0;
				$jumlah_taperum         =0;
				$jumlah_hkpg            =0;
				$jumlah_pph             =0;
				$jumlah_jumlah_potongan =0;
				
				foreach ($hasil->result() as $row){
					$kd_skpd         = $row->kd_skpd;
					$nm_skpd         = $row->nm_skpd;
					$nilai           = $row->nilai;
					$iwp             = $row->iwp;
					$taperum         = $row->taperum;
					$hkpg            = $row->hkpg;
					$pph             = $row->pph;
					$jumlah_potongan = $row->jumlah_potongan;
					
					//TOTAL
					$jum_nilai=$jum_nilai+$nilai;
					$jumlah_sp2d=number_format($jum_nilai,"2",",",".");
					
					$jum_iwp=$jum_iwp+$iwp;
					$jumlah_iwp=number_format($jum_iwp,"2",",",".");
					
					$jum_taperum=$jum_taperum+$taperum;
					$jumlah_taperum=number_format($jum_taperum,"2",",",".");
					
					$jum_hkpg=$jum_hkpg+$hkpg;
					$jumlah_hkpg=number_format($jum_hkpg,"2",",",".");
					
					$jum_pph=$jum_pph+$pph;
					$jumlah_pph=number_format($jum_pph,"2",",",".");
					
					$jum_jumlah_potongan=$jum_jumlah_potongan+$jumlah_potongan;
					$jumlah_jumlah_potongan=number_format($jum_jumlah_potongan,"2",",",".");
					
					$nomor=$nomor+1;

					$nilai=number_format($nilai,"2",",",".");
					$iwp=number_format($iwp,"2",",",".");
					$taperum=number_format($taperum,"2",",",".");
					$hkpg=number_format($hkpg,"2",",",".");
					$pph=number_format($pph,"2",",",".");
					$jumlah_potongan=number_format($jumlah_potongan,"2",",",".");
					
					$cRet .="<tr>
								<td align=\"center\">$nomor</td>
								<td align=\"left\">$nm_skpd</td>
								<td align=\"right\">$nilai</td>
								<td align=\"right\">$iwp</td>
								<td align=\"right\">$taperum</td>
								<td align=\"right\">$hkpg</td>
								<td align=\"right\">$pph</td>
								<td align=\"right\">$jumlah_potongan</td>
							</tr>";
				}	
				
					$cRet .="<tr>
								<td colspan=\"2\" align=\"right\"><b>Jumlah</b></td>
								<td align=\"right\"><b>$jumlah_sp2d</b></td>
								<td align=\"right\"><b>$jumlah_iwp</b></td>
								<td align=\"right\"><b>$jumlah_taperum</b></td>
								<td align=\"right\"><b>$jumlah_hkpg</b></td>
								<td align=\"right\"><b>$jumlah_pph</b></td>
								<td align=\"right\"><b>$jumlah_jumlah_potongan</b></td>
							</tr>";
			
			
			}else if($cetk=='1'){
				//per SKPD
				$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>DARI TANGGAL : $tanggal S/D $tanggal2</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">No. Urut</td>  
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">Nama Instansi</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">No Kas/Tanggal Kas</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">No SP2D/Tanggal SP2D</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">Nilai SP2D</td>
					<td align=\"center\" colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"40%\" style=\"font-weight:bold\">Potongan-Potongan</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">Jumlah Potongan</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">IWP</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">TAPERUM</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">HKPG</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">PPH</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
				</tr>
				</thead>"; 
	
				$sql = "SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, ISNULL(a.nilai,0) as nilai,
					ISNULL(iwp,0) iwp,
					ISNULL(taperum,0) taperum,
					ISNULL(hkpg,0) hkpg,
					ISNULL(pph,0) pph,
					iwp+taperum+hkpg+pph as jumlah_potongan
					FROM
					(SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, SUM(d.nilai) as nilai FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
					INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
					WHERE (a.jns_spp='4' AND a.jenis_beban='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND LEFT(a.kd_skpd,7)='$skpd' AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d
					)a LEFT JOIN
					(SELECT a.kd_skpd, a.nm_skpd
					,SUM(CASE WHEN kd_rek5 ='2110701' THEN c.nilai ELSE 0 END) AS iwp 
					,SUM(CASE WHEN kd_rek5 ='2110501' THEN c.nilai ELSE 0 END) AS taperum 
					,SUM(CASE WHEN kd_rek5 ='2110801' THEN c.nilai ELSE 0 END) AS hkpg 
					,SUM(CASE WHEN kd_rek5 ='2130101' THEN c.nilai ELSE 0 END) AS pph 
					FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trspmpot c ON b.no_spm = c.no_spm AND b.kd_skpd = c.kd_skpd
					WHERE (a.jns_spp='4' AND a.jenis_beban='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND LEFT(a.kd_skpd,7)='$skpd' AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd
					) b ON a.kd_skpd=b.kd_skpd";
			
				$hasil = $this->db->query($sql);
				
				$nomor               ='0';
				$jum_nilai           =0;
				$jum_iwp             =0;
				$jum_taperum         =0;
				$jum_hkpg            =0;
				$jum_pph             =0;
				$jum_jumlah_potongan =0;
				$jumlah_sp2d            =0;
				$jumlah_iwp             =0;
				$jumlah_sp2d            =0;
				$jumlah_iwp             =0;
				$jumlah_taperum         =0;
				$jumlah_hkpg            =0;
				$jumlah_pph             =0;
				$jumlah_jumlah_potongan =0;
				
				foreach ($hasil->result() as $row){
					$kd_skpd         = $row->kd_skpd;
					$nm_skpd         = $row->nm_skpd;
					$no_kas_bud      = $row->no_kas_bud;
					$tgl_kas_bud     = $row->tgl_kas_bud;
					$no_sp2d         = $row->no_sp2d;
					$tgl_sp2d        = $row->tgl_sp2d;
					$nilai           = $row->nilai;
					$iwp             = $row->iwp;
					$taperum         = $row->taperum;
					$hkpg            = $row->hkpg;
					$pph             = $row->pph;
					$jumlah_potongan = $row->jumlah_potongan;
					
					//TOTAL
					$jum_nilai=$jum_nilai+$nilai;
					$jumlah_sp2d=number_format($jum_nilai,"2",",",".");
					
					$jum_iwp=$jum_iwp+$iwp;
					$jumlah_iwp=number_format($jum_iwp,"2",",",".");
					
					$jum_taperum=$jum_taperum+$taperum;
					$jumlah_taperum=number_format($jum_taperum,"2",",",".");
					
					$jum_hkpg=$jum_hkpg+$hkpg;
					$jumlah_hkpg=number_format($jum_hkpg,"2",",",".");
					
					$jum_pph=$jum_pph+$pph;
					$jumlah_pph=number_format($jum_pph,"2",",",".");
					
					$jum_jumlah_potongan=$jum_jumlah_potongan+$jumlah_potongan;
					$jumlah_jumlah_potongan=number_format($jum_jumlah_potongan,"2",",",".");
					
					$nomor=$nomor+1;
					
					$nilai=number_format($nilai,"2",",",".");
					$iwp=number_format($iwp,"2",",",".");
					$taperum=number_format($taperum,"2",",",".");
					$hkpg=number_format($hkpg,"2",",",".");
					$pph=number_format($pph,"2",",",".");
					$jumlah_potongan=number_format($jumlah_potongan,"2",",",".");
					
					$cRet .="<tr>
								<td align=\"center\">$nomor</td>
								<td align=\"left\">$nm_skpd</td>
								<td align=\"left\">$no_kas_bud $tgl_kas_bud</td>
								<td align=\"left\">$no_sp2d $tgl_sp2d</td>
								<td align=\"right\">$nilai</td>
								<td align=\"right\">$iwp</td>
								<td align=\"right\">$taperum</td>
								<td align=\"right\">$hkpg</td>
								<td align=\"right\">$pph</td>
								<td align=\"right\">$jumlah_potongan</td>
								
							</tr>";
				}	
				
					$cRet .="<tr>
								<td colspan=\"2\" align=\"right\"><b>Jumlah</b></td>
								<td align=\"right\"><b></b></td>
								<td align=\"right\"><b></b></td>
								<td align=\"right\"><b>$jumlah_sp2d</b></td>
								<td align=\"right\"><b>$jumlah_iwp</b></td>
								<td align=\"right\"><b>$jumlah_taperum</b></td>
								<td align=\"right\"><b>$jumlah_hkpg</b></td>
								<td align=\"right\"><b>$jumlah_pph</b></td>
								<td align=\"right\"><b>$jumlah_jumlah_potongan</b></td>
							</tr>";
							
			
			}else if($cetk=='2'){
				//per Unit
				$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>DARI TANGGAL : $tanggal S/D $tanggal2</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">No. Urut</td>  
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">Nama Instansi</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">No Kas/Tanggal Kas</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">No SP2D/Tanggal SP2D</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">Nilai SP2D</td>
					<td align=\"center\" colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"40%\" style=\"font-weight:bold\">Potongan-Potongan</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">Jumlah Potongan</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">IWP</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">TAPERUM</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">HKPG</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">PPH</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
				</tr>
				</thead>"; 
	
				$sql = "SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, ISNULL(a.nilai,0) as nilai,
					ISNULL(iwp,0) iwp,
					ISNULL(taperum,0) taperum,
					ISNULL(hkpg,0) hkpg,
					ISNULL(pph,0) pph,
					iwp+taperum+hkpg+pph as jumlah_potongan
					FROM
					(SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, SUM(d.nilai) as nilai FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
					INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
					WHERE (a.jns_spp='4' AND a.jenis_beban='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.kd_skpd='$skpd' AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d 
					)a LEFT JOIN
					(SELECT a.kd_skpd, a.nm_skpd
					,SUM(CASE WHEN kd_rek5 ='2110701' THEN c.nilai ELSE 0 END) AS iwp 
					,SUM(CASE WHEN kd_rek5 ='2110501' THEN c.nilai ELSE 0 END) AS taperum 
					,SUM(CASE WHEN kd_rek5 ='2110801' THEN c.nilai ELSE 0 END) AS hkpg 
					,SUM(CASE WHEN kd_rek5 ='2130101' THEN c.nilai ELSE 0 END) AS pph 
					FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trspmpot c ON b.no_spm = c.no_spm AND b.kd_skpd = c.kd_skpd
					WHERE (a.jns_spp='4' AND a.jenis_beban='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.kd_skpd='$skpd' AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd
					) b ON a.kd_skpd=b.kd_skpd";
			
				$hasil = $this->db->query($sql);
				
				$nomor                  ='0';
				$jum_nilai              =0;
				$jum_iwp                =0;
				$jum_taperum            =0;
				$jum_hkpg               =0;
				$jum_pph                =0;
				$jum_jumlah_potongan    =0;
				$jumlah_sp2d            =0;
				$jumlah_iwp             =0;
				$jumlah_sp2d            =0;
				$jumlah_iwp             =0;
				$jumlah_taperum         =0;
				$jumlah_hkpg            =0;
				$jumlah_pph             =0;
				$jumlah_jumlah_potongan =0;
				
				
				foreach ($hasil->result() as $row){
					$kd_skpd         = $row->kd_skpd;
					$nm_skpd         = $row->nm_skpd;
					$no_kas_bud      = $row->no_kas_bud;
					$tgl_kas_bud     = $row->tgl_kas_bud;
					$no_sp2d         = $row->no_sp2d;
					$tgl_sp2d        = $row->tgl_sp2d;
					$nilai           = $row->nilai;
					$iwp             = $row->iwp;
					$taperum         = $row->taperum;
					$hkpg            = $row->hkpg;
					$pph             = $row->pph;
					$jumlah_potongan = $row->jumlah_potongan;
					
					//TOTAL
					$jum_nilai=$jum_nilai+$nilai;
					$jumlah_sp2d=number_format($jum_nilai,"2",",",".");
					
					$jum_iwp=$jum_iwp+$iwp;
					$jumlah_iwp=number_format($jum_iwp,"2",",",".");
					
					$jum_taperum=$jum_taperum+$taperum;
					$jumlah_taperum=number_format($jum_taperum,"2",",",".");
					
					$jum_hkpg=$jum_hkpg+$hkpg;
					$jumlah_hkpg=number_format($jum_hkpg,"2",",",".");
					
					$jum_pph=$jum_pph+$pph;
					$jumlah_pph=number_format($jum_pph,"2",",",".");
					
					$jum_jumlah_potongan=$jum_jumlah_potongan+$jumlah_potongan;
					$jumlah_jumlah_potongan=number_format($jum_jumlah_potongan,"2",",",".");
					
					$nomor=$nomor+1;
					
					$nilai=number_format($nilai,"2",",",".");
					$iwp=number_format($iwp,"2",",",".");
					$taperum=number_format($taperum,"2",",",".");
					$hkpg=number_format($hkpg,"2",",",".");
					$pph=number_format($pph,"2",",",".");
					$jumlah_potongan=number_format($jumlah_potongan,"2",",",".");
					
					$cRet .="<tr>
								<td align=\"center\">$nomor</td>
								<td align=\"left\">$nm_skpd</td>
								<td align=\"left\">$no_kas_bud $tgl_kas_bud</td>
								<td align=\"left\">$no_sp2d $tgl_sp2d</td>
								<td align=\"right\">$nilai</td>
								<td align=\"right\">$iwp</td>
								<td align=\"right\">$taperum</td>
								<td align=\"right\">$hkpg</td>
								<td align=\"right\">$pph</td>
								<td align=\"right\">$jumlah_potongan</td>
								
							</tr>";
				}	
				
					$cRet .="<tr>
								<td colspan=\"2\" align=\"right\"><b>Jumlah</b></td>
								<td align=\"right\"><b></b></td>
								<td align=\"right\"><b></b></td>
								<td align=\"right\"><b>$jumlah_sp2d</b></td>
								<td align=\"right\"><b>$jumlah_iwp</b></td>
								<td align=\"right\"><b>$jumlah_taperum</b></td>
								<td align=\"right\"><b>$jumlah_hkpg</b></td>
								<td align=\"right\"><b>$jumlah_pph</b></td>
								<td align=\"right\"><b>$jumlah_jumlah_potongan</b></td>
							</tr>";
							
			
			}else{
				//Keseluruhan
				$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>DARI TANGGAL : $tanggal S/D $tanggal2</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">No. Urut</td>  
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">Nama Instansi</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">No Kas/Tanggal Kas</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">No SP2D/Tanggal SP2D</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" style=\"font-weight:bold\">Nilai SP2D</td>
					<td align=\"center\" colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"40%\" style=\"font-weight:bold\">Potongan-Potongan</td>
					<td align=\"center\" rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">Jumlah Potongan</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">IWP</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">TAPERUM</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">HKPG</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">PPH</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
				</tr>
				</thead>"; 
	
				$sql = "SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, ISNULL(a.nilai,0) as nilai,
					ISNULL(iwp,0) iwp,
					ISNULL(taperum,0) taperum,
					ISNULL(hkpg,0) hkpg,
					ISNULL(pph,0) pph,
					iwp+taperum+hkpg+pph as jumlah_potongan
					FROM
					(SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, SUM(d.nilai) as nilai FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
					INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
					WHERE (a.jns_spp='4' AND a.jenis_beban='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d
					)a LEFT JOIN
					(SELECT a.kd_skpd, a.nm_skpd, a.no_sp2d
					,SUM(CASE WHEN kd_rek5 ='2110701' THEN c.nilai ELSE 0 END) AS iwp 
					,SUM(CASE WHEN kd_rek5 ='2110501' THEN c.nilai ELSE 0 END) AS taperum 
					,SUM(CASE WHEN kd_rek5 ='2110801' THEN c.nilai ELSE 0 END) AS hkpg 
					,SUM(CASE WHEN kd_rek5 ='2130101' THEN c.nilai ELSE 0 END) AS pph 
					FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trspmpot c ON b.no_spm = c.no_spm AND b.kd_skpd = c.kd_skpd
					WHERE (a.jns_spp='4' AND a.jenis_beban='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd, a.no_sp2d
					) b ON a.kd_skpd=b.kd_skpd
					ORDER BY cast(no_kas_bud as int)";
			
				$hasil = $this->db->query($sql);
				
				$nomor               ='0';
				$jum_nilai           =0;
				$jum_iwp             =0;
				$jum_taperum         =0;
				$jum_hkpg            =0;
				$jum_pph             =0;
				$jum_jumlah_potongan =0;
				$jumlah_sp2d            =0;
				$jumlah_iwp             =0;
				$jumlah_sp2d            =0;
				$jumlah_iwp             =0;
				$jumlah_taperum         =0;
				$jumlah_hkpg            =0;
				$jumlah_pph             =0;
				$jumlah_jumlah_potongan =0;
				
				foreach ($hasil->result() as $row){
					$kd_skpd         = $row->kd_skpd;
					$nm_skpd         = $row->nm_skpd;
					$no_kas_bud      = $row->no_kas_bud;
					$tgl_kas_bud     = $row->tgl_kas_bud;
					$no_sp2d         = $row->no_sp2d;
					$tgl_sp2d        = $row->tgl_sp2d;
					$nilai           = $row->nilai;
					$iwp             = $row->iwp;
					$taperum         = $row->taperum;
					$hkpg            = $row->hkpg;
					$pph             = $row->pph;
					$jumlah_potongan = $row->jumlah_potongan;
					
					//TOTAL
					$jum_nilai=$jum_nilai+$nilai;
					$jumlah_sp2d=number_format($jum_nilai,"2",",",".");
					
					$jum_iwp=$jum_iwp+$iwp;
					$jumlah_iwp=number_format($jum_iwp,"2",",",".");
					
					$jum_taperum=$jum_taperum+$taperum;
					$jumlah_taperum=number_format($jum_taperum,"2",",",".");
					
					$jum_hkpg=$jum_hkpg+$hkpg;
					$jumlah_hkpg=number_format($jum_hkpg,"2",",",".");
					
					$jum_pph=$jum_pph+$pph;
					$jumlah_pph=number_format($jum_pph,"2",",",".");
					
					$jum_jumlah_potongan=$jum_jumlah_potongan+$jumlah_potongan;
					$jumlah_jumlah_potongan=number_format($jum_jumlah_potongan,"2",",",".");
					
					$nomor=$nomor+1;
					
					$nilai=number_format($nilai,"2",",",".");
					$iwp=number_format($iwp,"2",",",".");
					$taperum=number_format($taperum,"2",",",".");
					$hkpg=number_format($hkpg,"2",",",".");
					$pph=number_format($pph,"2",",",".");
					$jumlah_potongan=number_format($jumlah_potongan,"2",",",".");
					
					$cRet .="<tr>
								<td align=\"center\">$nomor</td>
								<td align=\"left\">$nm_skpd</td>
								<td align=\"left\">$no_kas_bud $tgl_kas_bud</td>
								<td align=\"left\">$no_sp2d $tgl_sp2d</td>
								<td align=\"right\">$nilai</td>
								<td align=\"right\">$iwp</td>
								<td align=\"right\">$taperum</td>
								<td align=\"right\">$hkpg</td>
								<td align=\"right\">$pph</td>
								<td align=\"right\">$jumlah_potongan</td>
								
							</tr>";
				}	
				
					$cRet .="<tr>
								<td colspan=\"2\" align=\"right\"><b>Jumlah</b></td>
								<td align=\"right\"><b></b></td>
								<td align=\"right\"><b></b></td>
								<td align=\"right\"><b>$jumlah_sp2d</b></td>
								<td align=\"right\"><b>$jumlah_iwp</b></td>
								<td align=\"right\"><b>$jumlah_taperum</b></td>
								<td align=\"right\"><b>$jumlah_hkpg</b></td>
								<td align=\"right\"><b>$jumlah_pph</b></td>
								<td align=\"right\"><b>$jumlah_jumlah_potongan</b></td>
							</tr>";
			
			}
			
		//Non Gaji
		}else{
			//Rekap per SKPD
			if($cetk=='0'){ 
			 $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>DARI TANGGAL : $tanggal S/D $tanggal2</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"3%\" style=\"font-weight:bold\">NO</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NAMA INSTANSI</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NILAI SP2D</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"9%\" style=\"font-weight:bold\">PPN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">PPH 21</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">PPH 22</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">PPH 23</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"9%\" style=\"font-weight:bold\">Pasal 4 ayat 2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">Iuran Wajib PPNPN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">Pot Lain-lain</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">JUMLAH POTONGAN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NILAI BERSIH</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">11</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">12</td>
				</tr>
				</thead>"; 
				
				$sql = "SELECT a.kd_skpd, a.nm_skpd, ISNULL(a.nilai,0) as nilai,
					ISNULL(ppn,0) ppn,
					ISNULL(pph21,0) pph21,
					ISNULL(pph22,0) pph22,
					ISNULL(pph23,0) pph23,
					ISNULL(psl4_a2,0) psl4_a2,
					ISNULL(iwppnpn,0) iwppnpn,
					ISNULL(pot_lain,0) pot_lain,
					ppn+pph21+pph22+pph23+psl4_a2+iwppnpn+pot_lain as jumlah_potongan
					FROM
					(SELECT a.kd_skpd, a.nm_skpd, SUM(d.nilai) as nilai FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
					INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
					WHERE (a.jns_spp!='4' AND a.jenis_beban!='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd
					)a LEFT JOIN
					(SELECT a.kd_skpd, a.nm_skpd
					,SUM(CASE WHEN kd_rek5 ='2130301' THEN c.nilai ELSE 0 END) AS ppn 
					,SUM(CASE WHEN kd_rek5 ='2130101' THEN c.nilai ELSE 0 END) AS pph21 
					,SUM(CASE WHEN kd_rek5 ='2130201' THEN c.nilai ELSE 0 END) AS pph22 
					,SUM(CASE WHEN kd_rek5 ='2130401' THEN c.nilai ELSE 0 END) AS pph23
					,SUM(CASE WHEN kd_rek5 ='2130501' THEN c.nilai ELSE 0 END) AS psl4_a2
					,SUM(CASE WHEN kd_rek5 ='2110901' THEN c.nilai ELSE 0 END) AS iwppnpn
					,SUM(CASE WHEN kd_rek5 not in ('2130301','2130101','2130201','2130401','2130501','2110901') THEN c.nilai ELSE 0 END) AS pot_lain
					FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trspmpot c ON b.no_spm = c.no_spm AND b.kd_skpd = c.kd_skpd
					WHERE (a.jns_spp!='4' AND a.jenis_beban!='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd
					) b ON a.kd_skpd=b.kd_skpd";
			
				$hasil = $this->db->query($sql);
				
				$nomor                  ='0';
				$jum_nilai              =0;
				$jum_ppn                =0;
				$jum_pph21              =0;
				$jum_pph22              =0;
				$jum_pph23              =0;
				$jum_psl4_a2            =0;
				$jum_iwppnpn            =0;
				$jum_pot_lain           =0;
				$jum_jumlah_potongan    =0;
				$jum_nilai_bersih       =0;
				$jumlah_sp2d            =0;
				$jumlah_ppn             =0;
				$jumlah_pph21           =0;
				$jumlah_pph22           =0;
				$jumlah_pph23           =0;
				$jumlah_psl4_a2         =0;
				$jumlah_iwppnpn         =0;
				$jumlah_pot_lain        =0;
				$jumlah_jumlah_potongan =0;
				$jumlah_nilai_bersih    =0;
				
				
				foreach ($hasil->result() as $row){
					$kd_skpd         = $row->kd_skpd;
					$nm_skpd         = $row->nm_skpd;
					$nilai           = $row->nilai;
					$ppn             = $row->ppn;
					$pph21           = $row->pph21;
					$pph22           = $row->pph22;
					$pph23           = $row->pph23;
					$psl4_a2         = $row->psl4_a2;
					$iwppnpn         = $row->iwppnpn;
					$pot_lain        = $row->pot_lain;
					$jumlah_potongan = $row->jumlah_potongan;
					$nilai_bersih    = $nilai-$jumlah_potongan;
					
					//Total
					$jum_nilai=$jum_nilai+$nilai;
					$jumlah_sp2d=number_format($jum_nilai,"2",",",".");
					
					$jum_ppn=$jum_ppn+$ppn;
					$jumlah_ppn=number_format($jum_ppn,"2",",",".");
					
					$jum_pph21=$jum_pph21+$pph21;
					$jumlah_pph21=number_format($jum_pph21,"2",",",".");
					
					$jum_pph22=$jum_pph22+$pph22;
					$jumlah_pph22=number_format($jum_pph22,"2",",",".");
					
					$jum_pph23=$jum_pph23+$pph23;
					$jumlah_pph23=number_format($jum_pph23,"2",",",".");
					
					$jum_psl4_a2=$jum_psl4_a2+$psl4_a2;
					$jumlah_psl4_a2=number_format($jum_psl4_a2,"2",",",".");
					
					$jum_iwppnpn=$jum_iwppnpn+$iwppnpn;
					$jumlah_iwppnpn=number_format($jum_iwppnpn,"2",",",".");
					
					$jum_pot_lain=$jum_pot_lain+$pot_lain;
					$jumlah_pot_lain=number_format($jum_pot_lain,"2",",",".");
					
					$jum_jumlah_potongan=$jum_jumlah_potongan+$jumlah_potongan;
					$jumlah_jumlah_potongan=number_format($jum_jumlah_potongan,"2",",",".");
					
					$jum_nilai_bersih=$jum_nilai_bersih+$nilai_bersih;
					$jumlah_nilai_bersih=number_format($jum_nilai_bersih,"2",",",".");
					
					$nomor=$nomor+1;
					
					$nilai=number_format($nilai,"2",",",".");
					$ppn=number_format($ppn,"2",",",".");
					$pph21=number_format($pph21,"2",",",".");
					$pph22=number_format($pph22,"2",",",".");
					$pph23=number_format($pph23,"2",",",".");
					$psl4_a2=number_format($psl4_a2,"2",",",".");
					$iwppnpn=number_format($iwppnpn,"2",",",".");
					$pot_lain=number_format($pot_lain,"2",",",".");
					$jumlah_potongan=number_format($jumlah_potongan,"2",",",".");
					$nilai_bersih=number_format($nilai_bersih,"2",",",".");
					
					
					
					
					$cRet .="<tr>
								<td align=\"center\">$nomor</td>
								<td align=\"left\">$kd_skpd-$nm_skpd</td>
								<td align=\"right\">$nilai</td>
								<td align=\"right\">$ppn</td>
								<td align=\"right\">$pph21</td>
								<td align=\"right\">$pph22</td>
								<td align=\"right\">$pph23</td>
								<td align=\"right\">$psl4_a2</td>
								<td align=\"right\">$iwppnpn</td>
								<td align=\"right\">$pot_lain</td>
								<td align=\"right\">$jumlah_potongan</td>
								<td align=\"right\">$nilai_bersih</td>
							</tr>";
				}	
			
				$cRet .="<tr>
							<td colspan=\"2\" align=\"right\"><b>Jumlah</b></td>
							<td align=\"center\"><b>$jumlah_sp2d</b></td>
							<td align=\"center\"><b>$jumlah_ppn</b></td>
							<td align=\"right\"><b>$jumlah_pph21</b></td>
							<td align=\"center\"><b>$jumlah_pph22</b></td>
							<td align=\"center\"><b>$jumlah_pph23</b></td>
							<td align=\"right\"><b>$jumlah_psl4_a2</b></td>
							<td align=\"right\"><b>$jumlah_iwppnpn</b></td>
							<td align=\"center\"><b>$jumlah_pot_lain</b></td>
							<td align=\"center\"><b>$jumlah_jumlah_potongan</b></td>
							<td align=\"right\"><b>$jumlah_nilai_bersih</b></td>
						</tr>";
			}else if($cetk=='1'){
			  //Rekap Per SKPD
			  $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>DARI TANGGAL : $tanggal S/D $tanggal2</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:11px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"3%\" style=\"font-weight:bold\">NO</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NAMA INSTANSI</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">NO. KAS/TGL. KAS</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">NO. SP2D/TGL. SP2D</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NILAI SP2D</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">PPN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 21</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 22</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 23</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">Pasal 4 ayat 2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">Iuran Wajib PPNPN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">Pot Lian-lain</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">JUMLAH POTONGAN &nbsp; (Kol.6 s.d 12)</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NILAI BERSIH &nbsp; (Kol.5 - 13)</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">11</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">12</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">13</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">14</td>
				</tr>
				</thead>"; 
				
				//isi
				$sql = "SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, 
				    ISNULL(a.nilai,0) as nilai,
					ISNULL(ppn,0) ppn,
					ISNULL(pph21,0) pph21,
					ISNULL(pph22,0) pph22,
					ISNULL(pph23,0) pph23,
					ISNULL(psl4_a2,0) psl4_a2,
					ISNULL(iwppnpn,0) iwppnpn,
					ISNULL(pot_lain,0) pot_lain,
					ppn+pph21+pph22+pph23+psl4_a2+iwppnpn+pot_lain as jumlah_potongan
					FROM
					(SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, SUM(d.nilai) as nilai FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
					INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
					WHERE (a.jns_spp!='4' AND a.jenis_beban!='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1' AND LEFT(a.kd_skpd,7)='$skpd'
					GROUP BY a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d
					)a LEFT JOIN
					(SELECT a.kd_skpd, a.nm_skpd, a.no_sp2d
					,SUM(CASE WHEN kd_rek5 ='2130301' THEN c.nilai ELSE 0 END) AS ppn 
					,SUM(CASE WHEN kd_rek5 ='2130101' THEN c.nilai ELSE 0 END) AS pph21 
					,SUM(CASE WHEN kd_rek5 ='2130201' THEN c.nilai ELSE 0 END) AS pph22 
					,SUM(CASE WHEN kd_rek5 ='2130401' THEN c.nilai ELSE 0 END) AS pph23
					,SUM(CASE WHEN kd_rek5 ='2130501' THEN c.nilai ELSE 0 END) AS psl4_a2
					,SUM(CASE WHEN kd_rek5 ='2110901' THEN c.nilai ELSE 0 END) AS iwppnpn
					,SUM(CASE WHEN kd_rek5 not in ('2130301','2130101','2130201','2130401','2130501','2110901') THEN c.nilai ELSE 0 END) AS pot_lain
					FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trspmpot c ON b.no_spm = c.no_spm AND b.kd_skpd = c.kd_skpd
					WHERE (a.jns_spp!='4' AND a.jenis_beban!='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1' AND LEFT(a.kd_skpd,7)='$skpd'
					GROUP BY a.kd_skpd, a.nm_skpd,a.no_sp2d
					) b ON a.kd_skpd=b.kd_skpd AND a.no_sp2d=b.no_sp2d
					ORDER BY cast(no_kas_bud as int)";
			
				$hasil = $this->db->query($sql);
				
				$nomor              ='0';
				$jum_nilai          =0;
				$jum_ppn            =0;
				$jum_pph21          =0;
				$jum_pph22          =0;
				$jum_pph23          =0;
				$jum_psl4_a2        =0;
				$jum_iwppnpn        =0;
				$jum_pot_lain       =0;
				$jum_jumlah_potongan=0;
				$jum_nilai_bersih   =0;
				$jumlah_sp2d            =0;
				$jumlah_ppn             =0;
				$jumlah_pph21           =0;
				$jumlah_pph22           =0;
				$jumlah_pph23           =0;
				$jumlah_psl4_a2         =0;
				$jumlah_iwppnpn         =0;
				$jumlah_pot_lain        =0;
				$jumlah_jumlah_potongan =0;
				$jumlah_nilai_bersih    =0;
				
				foreach ($hasil->result() as $row){
					$kd_skpd         = $row->kd_skpd;
					$nm_skpd         = $row->nm_skpd;
					$no_kas_bud      = $row->no_kas_bud;
					$tgl_kas_bud     = $row->tgl_kas_bud;
					$no_sp2d         = $row->no_sp2d;
					$tgl_sp2d        = $row->tgl_sp2d;
					$nilai           = $row->nilai;
					$ppn             = $row->ppn;
					$pph21           = $row->pph21;
					$pph22           = $row->pph22;
					$pph23           = $row->pph23;
					$psl4_a2         = $row->psl4_a2;
					$iwppnpn         = $row->iwppnpn;
					$pot_lain        = $row->pot_lain;
					$jumlah_potongan = $row->jumlah_potongan;
					$nilai_bersih    = $nilai-$jumlah_potongan;
					
					//Total
					$jum_nilai=$jum_nilai+$nilai;
					$jumlah_sp2d=number_format($jum_nilai,"2",",",".");
					
					$jum_ppn=$jum_ppn+$ppn;
					$jumlah_ppn=number_format($jum_ppn,"2",",",".");
					
					$jum_pph21=$jum_pph21+$pph21;
					$jumlah_pph21=number_format($jum_pph21,"2",",",".");
					
					$jum_pph22=$jum_pph22+$pph22;
					$jumlah_pph22=number_format($jum_pph22,"2",",",".");
					
					$jum_pph23=$jum_pph23+$pph23;
					$jumlah_pph23=number_format($jum_pph23,"2",",",".");
					
					$jum_psl4_a2=$jum_psl4_a2+$psl4_a2;
					$jumlah_psl4_a2=number_format($jum_psl4_a2,"2",",",".");
					
					$jum_iwppnpn=$jum_iwppnpn+$iwppnpn;
					$jumlah_iwppnpn=number_format($jum_iwppnpn,"2",",",".");
					
					$jum_pot_lain=$jum_pot_lain+$pot_lain;
					$jumlah_pot_lain=number_format($jum_pot_lain,"2",",",".");
					
					$jum_jumlah_potongan=$jum_jumlah_potongan+$jumlah_potongan;
					$jumlah_jumlah_potongan=number_format($jum_jumlah_potongan,"2",",",".");
					
					$jum_nilai_bersih=$jum_nilai_bersih+$nilai_bersih;
					$jumlah_nilai_bersih=number_format($jum_nilai_bersih,"2",",",".");
					
					$nomor=$nomor+1;
					
					$nilai=number_format($nilai,"2",",",".");
					$ppn=number_format($ppn,"2",",",".");
					$pph21=number_format($pph21,"2",",",".");
					$pph22=number_format($pph22,"2",",",".");
					$pph23=number_format($pph23,"2",",",".");
					$psl4_a2=number_format($psl4_a2,"2",",",".");
					$iwppnpn=number_format($iwppnpn,"2",",",".");
					$pot_lain=number_format($pot_lain,"2",",",".");
					$jumlah_potongan=number_format($jumlah_potongan,"2",",",".");
					$nilai_bersih=number_format($nilai_bersih,"2",",",".");
					
					
					
					
					$cRet .="<tr>
								<td align=\"center\">$nomor</td>
								<td align=\"left\">$nm_skpd</td>
								<td align=\"left\">$no_kas_bud $tgl_kas_bud</td>
								<td align=\"left\">$no_sp2d $tgl_sp2d</td>
								<td align=\"right\">$nilai</td>
								<td align=\"right\">$ppn</td>
								<td align=\"right\">$pph21</td>
								<td align=\"right\">$pph22</td>
								<td align=\"right\">$pph23</td>
								<td align=\"right\">$psl4_a2</td>
								<td align=\"right\">$iwppnpn</td>
								<td align=\"right\">$pot_lain</td>
								<td align=\"right\">$jumlah_potongan</td>
								<td align=\"right\">$nilai_bersih</td>
							</tr>";
				}	
			
				$cRet .="<tr>
							<td colspan=\"2\" align=\"right\"><b>Jumlah</b></td>
							<td align=\"center\"><b></b></td>
							<td align=\"center\"><b></b></td>
							<td align=\"center\"><b>$jumlah_sp2d</b></td>
							<td align=\"center\"><b>$jumlah_ppn</b></td>
							<td align=\"right\"><b>$jumlah_pph21</b></td>
							<td align=\"center\"><b>$jumlah_pph22</b></td>
							<td align=\"center\"><b>$jumlah_pph23</b></td>
							<td align=\"right\"><b>$jumlah_psl4_a2</b></td>
							<td align=\"right\"><b>$jumlah_iwppnpn</b></td>
							<td align=\"center\"><b>$jumlah_pot_lain</b></td>
							<td align=\"center\"><b>$jumlah_jumlah_potongan</b></td>
							<td align=\"right\"><b>$jumlah_nilai_bersih</b></td>
						</tr>";
			}else if($cetk=='2'){
			  //Rekap Per Unit
			  $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>DARI TANGGAL : $tanggal S/D $tanggal2</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:11px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"3%\" style=\"font-weight:bold\">NO</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NAMA INSTANSI</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">NO. KAS/TGL. KAS</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">NO. SP2D/TGL. SP2D</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NILAI SP2D</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">PPN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 21</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 22</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 23</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">Pasal 4 ayat 2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">Iuran Wajib PPNPN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">Pot Lian-lain</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">JUMLAH POTONGAN &nbsp; (Kol.6 s.d 12)</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NILAI BERSIH &nbsp; (Kol.5 - 13)</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">11</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">12</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">13</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">14</td>
				</tr>
				</thead>"; 
				
				//isi
				$sql = "SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, 
				    ISNULL(a.nilai,0) as nilai,
					ISNULL(ppn,0) ppn,
					ISNULL(pph21,0) pph21,
					ISNULL(pph22,0) pph22,
					ISNULL(pph23,0) pph23,
					ISNULL(psl4_a2,0) psl4_a2,
					ISNULL(iwppnpn,0) iwppnpn,
					ISNULL(pot_lain,0) pot_lain,
					ppn+pph21+pph22+pph23+psl4_a2+iwppnpn+pot_lain as jumlah_potongan
					FROM
					(SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, SUM(d.nilai) as nilai FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
					INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
					WHERE (a.jns_spp!='4' AND a.jenis_beban!='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1' AND a.kd_skpd='$skpd'
					GROUP BY a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d
					)a LEFT JOIN
					(SELECT a.kd_skpd, a.nm_skpd, a.no_sp2d
					,SUM(CASE WHEN kd_rek5 ='2130301' THEN c.nilai ELSE 0 END) AS ppn 
					,SUM(CASE WHEN kd_rek5 ='2130101' THEN c.nilai ELSE 0 END) AS pph21 
					,SUM(CASE WHEN kd_rek5 ='2130201' THEN c.nilai ELSE 0 END) AS pph22 
					,SUM(CASE WHEN kd_rek5 ='2130401' THEN c.nilai ELSE 0 END) AS pph23
					,SUM(CASE WHEN kd_rek5 ='2130501' THEN c.nilai ELSE 0 END) AS psl4_a2
					,SUM(CASE WHEN kd_rek5 ='2110901' THEN c.nilai ELSE 0 END) AS iwppnpn
					,SUM(CASE WHEN kd_rek5 not in ('2130301','2130101','2130201','2130401','2130501','2110901') THEN c.nilai ELSE 0 END) AS pot_lain
					FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trspmpot c ON b.no_spm = c.no_spm AND b.kd_skpd = c.kd_skpd
					WHERE (a.jns_spp!='4' AND a.jenis_beban!='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1' AND a.kd_skpd='$skpd'
					GROUP BY a.kd_skpd, a.nm_skpd,a.no_sp2d
					) b ON a.kd_skpd=b.kd_skpd AND a.no_sp2d=b.no_sp2d
					ORDER BY cast(no_kas_bud as int)";
			
				$hasil = $this->db->query($sql);
				
				$nomor              ='0';
				$jum_nilai          =0;
				$jum_ppn            =0;
				$jum_pph21          =0;
				$jum_pph22          =0;
				$jum_pph23          =0;
				$jum_psl4_a2        =0;
				$jum_iwppnpn        =0;
				$jum_pot_lain       =0;
				$jum_jumlah_potongan=0;
				$jum_nilai_bersih   =0;
				$jumlah_sp2d            =0;
				$jumlah_ppn             =0;
				$jumlah_pph21           =0;
				$jumlah_pph22           =0;
				$jumlah_pph23           =0;
				$jumlah_psl4_a2         =0;
				$jumlah_iwppnpn         =0;
				$jumlah_pot_lain        =0;
				$jumlah_jumlah_potongan =0;
				$jumlah_nilai_bersih    =0;
				
				foreach ($hasil->result() as $row){
					$kd_skpd         = $row->kd_skpd;
					$nm_skpd         = $row->nm_skpd;
					$no_kas_bud      = $row->no_kas_bud;
					$tgl_kas_bud     = $row->tgl_kas_bud;
					$no_sp2d         = $row->no_sp2d;
					$tgl_sp2d        = $row->tgl_sp2d;
					$nilai           = $row->nilai;
					$ppn             = $row->ppn;
					$pph21           = $row->pph21;
					$pph22           = $row->pph22;
					$pph23           = $row->pph23;
					$psl4_a2         = $row->psl4_a2;
					$iwppnpn         = $row->iwppnpn;
					$pot_lain        = $row->pot_lain;
					$jumlah_potongan = $row->jumlah_potongan;
					$nilai_bersih    = $nilai-$jumlah_potongan;
					
					//Total
					$jum_nilai=$jum_nilai+$nilai;
					$jumlah_sp2d=number_format($jum_nilai,"2",",",".");
					
					$jum_ppn=$jum_ppn+$ppn;
					$jumlah_ppn=number_format($jum_ppn,"2",",",".");
					
					$jum_pph21=$jum_pph21+$pph21;
					$jumlah_pph21=number_format($jum_pph21,"2",",",".");
					
					$jum_pph22=$jum_pph22+$pph22;
					$jumlah_pph22=number_format($jum_pph22,"2",",",".");
					
					$jum_pph23=$jum_pph23+$pph23;
					$jumlah_pph23=number_format($jum_pph23,"2",",",".");
					
					$jum_psl4_a2=$jum_psl4_a2+$psl4_a2;
					$jumlah_psl4_a2=number_format($jum_psl4_a2,"2",",",".");
					
					$jum_iwppnpn=$jum_iwppnpn+$iwppnpn;
					$jumlah_iwppnpn=number_format($jum_iwppnpn,"2",",",".");
					
					$jum_pot_lain=$jum_pot_lain+$pot_lain;
					$jumlah_pot_lain=number_format($jum_pot_lain,"2",",",".");
					
					$jum_jumlah_potongan=$jum_jumlah_potongan+$jumlah_potongan;
					$jumlah_jumlah_potongan=number_format($jum_jumlah_potongan,"2",",",".");
					
					$jum_nilai_bersih=$jum_nilai_bersih+$nilai_bersih;
					$jumlah_nilai_bersih=number_format($jum_nilai_bersih,"2",",",".");
					
					$nomor=$nomor+1;
					
					$nilai=number_format($nilai,"2",",",".");
					$ppn=number_format($ppn,"2",",",".");
					$pph21=number_format($pph21,"2",",",".");
					$pph22=number_format($pph22,"2",",",".");
					$pph23=number_format($pph23,"2",",",".");
					$psl4_a2=number_format($psl4_a2,"2",",",".");
					$iwppnpn=number_format($iwppnpn,"2",",",".");
					$pot_lain=number_format($pot_lain,"2",",",".");
					$jumlah_potongan=number_format($jumlah_potongan,"2",",",".");
					$nilai_bersih=number_format($nilai_bersih,"2",",",".");
					
					
					
					
					$cRet .="<tr>
								<td align=\"center\">$nomor</td>
								<td align=\"left\">$nm_skpd</td>
								<td align=\"left\">$no_kas_bud $tgl_kas_bud</td>
								<td align=\"left\">$no_sp2d $tgl_sp2d</td>
								<td align=\"right\">$nilai</td>
								<td align=\"right\">$ppn</td>
								<td align=\"right\">$pph21</td>
								<td align=\"right\">$pph22</td>
								<td align=\"right\">$pph23</td>
								<td align=\"right\">$psl4_a2</td>
								<td align=\"right\">$iwppnpn</td>
								<td align=\"right\">$pot_lain</td>
								<td align=\"right\">$jumlah_potongan</td>
								<td align=\"right\">$nilai_bersih</td>
							</tr>";
				}	
			
				$cRet .="<tr>
							<td colspan=\"2\" align=\"right\"><b>Jumlah</b></td>
							<td align=\"center\"><b></b></td>
							<td align=\"center\"><b></b></td>
							<td align=\"center\"><b>$jumlah_sp2d</b></td>
							<td align=\"center\"><b>$jumlah_ppn</b></td>
							<td align=\"right\"><b>$jumlah_pph21</b></td>
							<td align=\"center\"><b>$jumlah_pph22</b></td>
							<td align=\"center\"><b>$jumlah_pph23</b></td>
							<td align=\"right\"><b>$jumlah_psl4_a2</b></td>
							<td align=\"right\"><b>$jumlah_iwppnpn</b></td>
							<td align=\"center\"><b>$jumlah_pot_lain</b></td>
							<td align=\"center\"><b>$jumlah_jumlah_potongan</b></td>
							<td align=\"right\"><b>$jumlah_nilai_bersih</b></td>
						</tr>";
			}else{
			  //Rekap Keseluruhan
			  $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul</b></td>
				</tr>
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>DARI TANGGAL : $tanggal S/D $tanggal2</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:11px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"3%\" style=\"font-weight:bold\">NO</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NAMA INSTANSI</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">NO. KAS/TGL. KAS</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">NO. SP2D/TGL. SP2D</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NILAI SP2D</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">PPN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 21</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 22</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">PPH 23</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"8%\" style=\"font-weight:bold\">Pasal 4 ayat 2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold\">Iuran Wajib PPNPN</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"7%\" style=\"font-weight:bold\">Pot Lian-lain</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">JUMLAH POTONGAN &nbsp; (Kol.6 s.d 12)</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-weight:bold\">NILAI BERSIH &nbsp; (Kol.5 - 13)</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">5</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">6</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">7</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">8</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">9</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">10</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">11</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">12</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">13</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">14</td>
				</tr>
				</thead>"; 
				
				//isi
				$sql = "SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, 
				    ISNULL(a.nilai,0) as nilai,
					ISNULL(ppn,0) ppn,
					ISNULL(pph21,0) pph21,
					ISNULL(pph22,0) pph22,
					ISNULL(pph23,0) pph23,
					ISNULL(psl4_a2,0) psl4_a2,
					ISNULL(iwppnpn,0) iwppnpn,
					ISNULL(pot_lain,0) pot_lain,
					ppn+pph21+pph22+pph23+psl4_a2+iwppnpn+pot_lain as jumlah_potongan
					FROM
					(SELECT a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d, SUM(d.nilai) as nilai FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trhspp c ON b.no_spp = c.no_spp AND b.kd_skpd = c.kd_skpd
					INNER JOIN trdspp d ON c.no_spp = d.no_spp AND c.kd_skpd = d.kd_skpd
					WHERE (a.jns_spp!='4' AND a.jenis_beban!='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd, a.no_kas_bud, a.tgl_kas_bud, a.no_sp2d, a.tgl_sp2d
					)a LEFT JOIN
					(SELECT a.kd_skpd, a.nm_skpd, a.no_sp2d
					,SUM(CASE WHEN kd_rek5 ='2130301' THEN c.nilai ELSE 0 END) AS ppn 
					,SUM(CASE WHEN kd_rek5 ='2130101' THEN c.nilai ELSE 0 END) AS pph21 
					,SUM(CASE WHEN kd_rek5 ='2130201' THEN c.nilai ELSE 0 END) AS pph22 
					,SUM(CASE WHEN kd_rek5 ='2130401' THEN c.nilai ELSE 0 END) AS pph23
					,SUM(CASE WHEN kd_rek5 ='2130501' THEN c.nilai ELSE 0 END) AS psl4_a2
					,SUM(CASE WHEN kd_rek5 ='2110901' THEN c.nilai ELSE 0 END) AS iwppnpn
					,SUM(CASE WHEN kd_rek5 not in ('2130301','2130101','2130201','2130401','2130501','2110901') THEN c.nilai ELSE 0 END) AS pot_lain
					FROM trhsp2d a
					INNER JOIN trhspm b ON a.no_spm = b.no_spm AND a.kd_skpd = b.kd_skpd
					INNER JOIN trspmpot c ON b.no_spm = c.no_spm AND b.kd_skpd = c.kd_skpd
					WHERE (a.jns_spp!='4' AND a.jenis_beban!='1') AND (a.tgl_kas_bud >= '$tgl' AND  a.tgl_kas_bud <= '$tgl2') AND a.status_bud='1'
					GROUP BY a.kd_skpd, a.nm_skpd,a.no_sp2d
					) b ON a.kd_skpd=b.kd_skpd AND a.no_sp2d=b.no_sp2d
					ORDER BY cast(no_kas_bud as int)";
			
				$hasil = $this->db->query($sql);
				
				$nomor              ='0';
				$jum_nilai          =0;
				$jum_ppn            =0;
				$jum_pph21          =0;
				$jum_pph22          =0;
				$jum_pph23          =0;
				$jum_psl4_a2        =0;
				$jum_iwppnpn        =0;
				$jum_pot_lain       =0;
				$jum_jumlah_potongan=0;
				$jum_nilai_bersih   =0;
				$jumlah_sp2d            =0;
				$jumlah_ppn             =0;
				$jumlah_pph21           =0;
				$jumlah_pph22           =0;
				$jumlah_pph23           =0;
				$jumlah_psl4_a2         =0;
				$jumlah_iwppnpn         =0;
				$jumlah_pot_lain        =0;
				$jumlah_jumlah_potongan =0;
				$jumlah_nilai_bersih    =0;
				
				foreach ($hasil->result() as $row){
					$kd_skpd         = $row->kd_skpd;
					$nm_skpd         = $row->nm_skpd;
					$no_kas_bud      = $row->no_kas_bud;
					$tgl_kas_bud     = $row->tgl_kas_bud;
					$no_sp2d         = $row->no_sp2d;
					$tgl_sp2d        = $row->tgl_sp2d;
					$nilai           = $row->nilai;
					$ppn             = $row->ppn;
					$pph21           = $row->pph21;
					$pph22           = $row->pph22;
					$pph23           = $row->pph23;
					$psl4_a2         = $row->psl4_a2;
					$iwppnpn         = $row->iwppnpn;
					$pot_lain        = $row->pot_lain;
					$jumlah_potongan = $row->jumlah_potongan;
					$nilai_bersih    = $nilai-$jumlah_potongan;
					
					//Total
					$jum_nilai=$jum_nilai+$nilai;
					$jumlah_sp2d=number_format($jum_nilai,"2",",",".");
					
					$jum_ppn=$jum_ppn+$ppn;
					$jumlah_ppn=number_format($jum_ppn,"2",",",".");
					
					$jum_pph21=$jum_pph21+$pph21;
					$jumlah_pph21=number_format($jum_pph21,"2",",",".");
					
					$jum_pph22=$jum_pph22+$pph22;
					$jumlah_pph22=number_format($jum_pph22,"2",",",".");
					
					$jum_pph23=$jum_pph23+$pph23;
					$jumlah_pph23=number_format($jum_pph23,"2",",",".");
					
					$jum_psl4_a2=$jum_psl4_a2+$psl4_a2;
					$jumlah_psl4_a2=number_format($jum_psl4_a2,"2",",",".");
					
					$jum_iwppnpn=$jum_iwppnpn+$iwppnpn;
					$jumlah_iwppnpn=number_format($jum_iwppnpn,"2",",",".");
					
					$jum_pot_lain=$jum_pot_lain+$pot_lain;
					$jumlah_pot_lain=number_format($jum_pot_lain,"2",",",".");
					
					$jum_jumlah_potongan=$jum_jumlah_potongan+$jumlah_potongan;
					$jumlah_jumlah_potongan=number_format($jum_jumlah_potongan,"2",",",".");
					
					$jum_nilai_bersih=$jum_nilai_bersih+$nilai_bersih;
					$jumlah_nilai_bersih=number_format($jum_nilai_bersih,"2",",",".");
					
					$nomor=$nomor+1;
					
					$nilai=number_format($nilai,"2",",",".");
					$ppn=number_format($ppn,"2",",",".");
					$pph21=number_format($pph21,"2",",",".");
					$pph22=number_format($pph22,"2",",",".");
					$pph23=number_format($pph23,"2",",",".");
					$psl4_a2=number_format($psl4_a2,"2",",",".");
					$iwppnpn=number_format($iwppnpn,"2",",",".");
					$pot_lain=number_format($pot_lain,"2",",",".");
					$jumlah_potongan=number_format($jumlah_potongan,"2",",",".");
					$nilai_bersih=number_format($nilai_bersih,"2",",",".");
					
					
					
					
					$cRet .="<tr>
								<td align=\"center\">$nomor</td>
								<td align=\"left\">$nm_skpd</td>
								<td align=\"left\">$no_kas_bud $tgl_kas_bud</td>
								<td align=\"left\">$no_sp2d $tgl_sp2d</td>
								<td align=\"right\">$nilai</td>
								<td align=\"right\">$ppn</td>
								<td align=\"right\">$pph21</td>
								<td align=\"right\">$pph22</td>
								<td align=\"right\">$pph23</td>
								<td align=\"right\">$psl4_a2</td>
								<td align=\"right\">$iwppnpn</td>
								<td align=\"right\">$pot_lain</td>
								<td align=\"right\">$jumlah_potongan</td>
								<td align=\"right\">$nilai_bersih</td>
							</tr>";
				}	
			
				$cRet .="<tr>
							<td colspan=\"2\" align=\"right\"><b>Jumlah</b></td>
							<td align=\"center\"><b></b></td>
							<td align=\"center\"><b></b></td>
							<td align=\"center\"><b>$jumlah_sp2d</b></td>
							<td align=\"center\"><b>$jumlah_ppn</b></td>
							<td align=\"right\"><b>$jumlah_pph21</b></td>
							<td align=\"center\"><b>$jumlah_pph22</b></td>
							<td align=\"center\"><b>$jumlah_pph23</b></td>
							<td align=\"right\"><b>$jumlah_psl4_a2</b></td>
							<td align=\"right\"><b>$jumlah_iwppnpn</b></td>
							<td align=\"center\"><b>$jumlah_pot_lain</b></td>
							<td align=\"center\"><b>$jumlah_jumlah_potongan</b></td>
							<td align=\"right\"><b>$jumlah_nilai_bersih</b></td>
						</tr>";
			}
		}
				
		$cRet .= '</table>';
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $ctak;
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title></title>");
			 echo $cRet;
		}else{
			
			$this->_mpdf2('',$cRet,10,10,10,'1',$no_halaman,'');
			
		}

	}
	
	
	function cetak_spjterima2(){
        $thn_ang = $this->session->userdata('pcThang');
         $lcskpd = $_REQUEST['kd_skpd'];
         $lcskpd2 = $lcskpd;
         $pilih = $_REQUEST['cpilih'];
         $jnsctk = $_REQUEST['jnsctk'];
         
         if($jnsctk=='1'){
                $lcskpd = substr($lcskpd, 0, 7);
         }

		 if ($pilih==1){
            $lctgl1 = $_REQUEST['tgl1'];
            $lctgl2 = $_REQUEST['tgl2'];   
            $lcperiode = $this->tukd_model->tanggal_format_indonesia($lctgl1)."  S.D. ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            $lcperiode1 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl1);
            $lcperiode2 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
			
			$sqlang="select case when statu=1 and status_sempurna=1 and status_ubah=1 and month('$lctgl2')>=month(tgl_dpa_ubah) then 'nilai_ubah' 
					   when statu=1 and status_sempurna=1 and status_ubah=1 and month('$lctgl2')>=month(tgl_dpa_sempurna) and month('$lctgl2')<month(tgl_dpa_ubah) then 'nilai_sempurna'
					   when statu=1 and status_sempurna=1 and status_ubah=1 and month('$lctgl2')<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=1 and status_ubah=0 and month('$lctgl2')>=month(tgl_dpa_sempurna) then 'nilai_sempurna' 
					   when statu=1 and status_sempurna=1 and status_ubah=0 and month('$lctgl2')<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=0 and status_ubah=0 and month('$lctgl2')>=month(tgl_dpa) then 'nilai'
					   else 'nilai' end as anggaran from trhrka where kd_skpd ='$lcskpd2'";
			
            
         }else{
            $bulan = $_REQUEST['bulan'];
            $lcperiode = $this->tukd_model->getBulan($bulan);
            if($bulan==1){
                $lcperiode1 = "Bulan Sebelumnya";    
				}else{
				$lcperiode1 = "Bulan ".$this->tukd_model->getBulan($bulan-1);
				}  
            $lcperiode2 = "Bulan ".$this->tukd_model->getBulan($bulan);
			$sqlang="select case when statu=1 and status_sempurna=1 and status_ubah=1 and $bulan>=month(tgl_dpa_ubah) then 'nilai_ubah' 
					   when statu=1 and status_sempurna=1 and status_ubah=1 and $bulan>=month(tgl_dpa_sempurna) and $bulan<month(tgl_dpa_ubah) then 'nilai_sempurna'
					   when statu=1 and status_sempurna=1 and status_ubah=1 and $bulan<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=1 and status_ubah=0 and $bulan>=month(tgl_dpa_sempurna) then 'nilai_sempurna' 
					   when statu=1 and status_sempurna=1 and status_ubah=0 and $bulan<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=0 and status_ubah=0 and $bulan>=month(tgl_dpa) then 'nilai'
					   else 'nilai' end as anggaran from trhrka where kd_skpd ='$lcskpd2'";
			
         }
         
		 
		
        $hasilang = $this->db->query($sqlang);
        $hasil_ang = $hasilang->row();          
        $anggaran_ = $hasil_ang->anggaran;
		 
		 
		 
		 
         $tgl_ttd= $_REQUEST['tgl_ttd'];
		 $nippa = str_replace('123456789',' ',$_REQUEST['ttd']);		     
         if($nippa==''){
                     $lcNmPA = '';
    				 $lcNipPA = '';
    				 $lcJabatanPA = '';
    				 $lcPangkatPA = '';
            
         }else{   		 
             $csql="SELECT nip as nip,nama,jabatan,pangkat  FROM ms_ttd WHERE nip = '$nippa' AND kd_skpd = '$lcskpd2' AND kode='PA'";
    				 $hasil = $this->db->query($csql);
    				 $trh2 = $hasil->row(); 
    				 
                     $lcNmPA = $trh2->nama;
    				 $lcNipPA = $trh2->nip;
    				 $lcJabatanPA = $trh2->jabatan;
    				 $lcPangkatPA = $trh2->pangkat;
		 }
         $nipbp = str_replace('123456789',' ',$_REQUEST['ttd2']);		     
		 if($nipbp==''){
             $lcNmBP = '';
             $lcNipBP = '';
             $lcPangkatBP = '';
             $lcJabatanBP = '';		  
		 }else{
             $csql="SELECT nip,nama,jabatan,pangkat FROM ms_ttd WHERE nip = '$nipbp' AND kd_skpd = '$lcskpd2' AND kode='BP'";
             $hasil3 = $this->db->query($csql);
             $trh3 = $hasil3->row(); 	
             $lcNmBP = $trh3->nama;
             $lcNipBP = $trh3->nip;
             $lcPangkatBP = $trh3->pangkat;
             $lcJabatanBP = $trh3->jabatan;
         }
		 $prv = $this->db->query("SELECT provinsi,daerah from sclient WHERE kd_skpd='$lcskpd2'");
			$prvn = $prv->row();          
			$prov = $prvn->provinsi;         
			$daerah = $prvn->daerah;

        $csql="SELECT a.nm_skpd FROM ms_skpd a WHERE left(a.kd_skpd,len('$lcskpd')) = '$lcskpd'";
        $hasil = $this->db->query($csql);
        $trh2 = $hasil->row();          
        $lcNmskpd = $trh2->nm_skpd;
        

        
		
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"13\" style=\"font-size:14px;border: solid 1px white;\"><b>".$prov."<br>
                    LAPORAN PERTANGGUNGJAWABAN BENDAHARA PENERIMAAN<BR>SPJ PENDAPATAN PERIODE ".strtoupper($lcperiode)."</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">SKPD</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmskpd</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
            </tr>
            
            </table>
			
			<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <thead>
            <tr>
                <td align=\"center\" rowspan=\"2\" width=\"10%\" style=\"font-size:12px\">Kode<br>Rekening</td>
                <td align=\"center\" rowspan=\"2\" width=\"24%\" style=\"font-size:12px\">Uraian</td>
                <td align=\"center\" rowspan=\"2\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran</td>
                <td align=\"center\" colspan=\"3\" width=\"18%\" style=\"font-size:12px\">Sampai dengan Bulan Lalu</td>
                <td align=\"center\" colspan=\"3\" width=\"18%\" style=\"font-size:12px\">Bulan Ini</td>
                <td align=\"center\" colspan=\"4\" width=\"24%\" style=\"font-size:12px\">Sampai dengan Bulan Ini</td>
            </tr>
            <tr>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penerimaan</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penyetoran</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penerimaan</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penyetoran</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran<br>yang<br>Terealisasi</td>                
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran<br>yang telah<br>Disetor</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa yang<br>Belum<br>Disetor</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa Anggaran yang<br>Belum<br>Terealisasi/Pelam-<br>pauan Anggaran</td>                                
            </tr>            
            <tr>
                <td align=\"center\" style=\"font-size:12px\">1</td>
                <td align=\"center\" style=\"font-size:12px\">2</td>
                <td align=\"center\" style=\"font-size:12px\">3</td>
                <td align=\"center\" style=\"font-size:12px\">4</td>
                <td align=\"center\" style=\"font-size:12px\">5</td>
                <td align=\"center\" style=\"font-size:12px\">6=(5-4)</td>
                <td align=\"center\" style=\"font-size:12px\">7</td>
                <td align=\"center\" style=\"font-size:12px\">8</td>
                <td align=\"center\" style=\"font-size:12px\">9=(8-7)</td>
                <td align=\"center\" style=\"font-size:12px\">10=(4+7)</td>
                <td align=\"center\" style=\"font-size:12px\">11=(5+8)</td>
                <td align=\"center\" style=\"font-size:12px\">12=(11-10)</td>
                <td align=\"center\" style=\"font-size:12px\">13=(3-10)</td>                
            </tr>
			</thead>";
           

            if ($pilih==1   ){
                $kon_terimaini = " (a.tgl_terima >= '$lctgl1' AND a.tgl_terima <= '$lctgl2')";
                $kon_keluarini = " (a.tgl_sts >= '$lctgl1' AND a.tgl_sts <= '$lctgl2')";          
                $kon_terimalalu = " (a.tgl_terima < '$lctgl1')";
                $kon_keluarlalu = " (a.tgl_sts < '$lctgl1')";
           }else{
                $kon_terimaini = " (month(a.tgl_terima)= '$bulan' AND year(a.tgl_terima) = '$thn_ang')";
                $kon_keluarini = " (month(a.tgl_sts)= '$bulan' AND year(a.tgl_sts) = '$thn_ang')";
                $kon_terimalalu = " (month(a.tgl_terima)< '$bulan' AND year(a.tgl_terima) = '$thn_ang')";
                $kon_keluarlalu = " (month(a.tgl_sts)< '$bulan' AND year(a.tgl_sts) = '$thn_ang')";
           }

            $n_trdrka = 'trdrka_pend';
            
            $kon_skpd="a.kd_skpd = ";
            $sql  = "SELECT z.kd_skpd, z.kd_kegiatan, z.kd_rek5, z.nm_rek5, SUM(z.nilai) AS ang, SUM(z.$anggaran_) AS ang_ubah,
                    (SELECT SUM(a.nilai) FROM tr_terima a WHERE a.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_terimaini) AS terima_ini,
                    (SELECT SUM(a.nilai) FROM tr_terima a WHERE a.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_terimalalu) AS terima_lalu,
                    (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_keluarini) AS keluar_ini,
                    (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_keluarlalu) AS keluar_lalu                    
                    FROM $n_trdrka z WHERE left(z.kd_skpd,len('$lcskpd'))='$lcskpd' and left(z.kd_rek5,1)='4' and right(z.kd_kegiatan,5)='00.04'
                    GROUP BY z.kd_skpd, z.kd_kegiatan, z.kd_rek5,z.nm_rek5
                    ORDER BY z.kd_rek5"     ;
                                       
                    $hasil = $this->db->query($sql);                                                      
                    $lcterima_ini=0;
                    $lckeluar_ini=0;
                    $lcprog_lama="";
                    $lckeg_lama="";
                    $ln_jlh1 =0;
                    $ln_jlh2 =0;
                    $ln_jlh3 =0;
                    $ln_jlh4 =0;
                    $ln_jlh5 =0;
                    $ln_jlh6 =0;
                    $ln_jlh7 =0;
                    $ln_jlh8 =0;
                    $ln_jlh9 =0;
                    $ln_jlh10 =0;
                    $ln_jlh11 =0;
                    
                    foreach ($hasil->result() as $row)
                    {
                        $lcprog=substr($row->kd_kegiatan,0,18);
                        $lckeg=$row->kd_kegiatan;
                        $lcrek=$row->kd_rek5;
                        
                        if($lcprog<>$lcprog_lama){//cek program
                             $sql="select z.kd_program, z.nm_program,
                                (SELECT SUM(a.$anggaran_) FROM $n_trdrka a WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and left(a.kd_rek5,1)='4' and right(a.kd_kegiatan,5)='00.04') AS ang_ubah,
                                (SELECT SUM(a.nilai) FROM tr_terima a WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_terimaini) AS terima_ini,
                                (SELECT SUM(a.nilai) FROM tr_terima a WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_terimalalu) AS terima_lalu,
								(SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and right(b.kd_kegiatan,5)='00.04' and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarini) AS keluar_ini,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and right(b.kd_kegiatan,5)='00.04' and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarlalu) AS keluar_lalu 
                                    from trskpd z where z.kd_kegiatan='$lckeg' and left(z.kd_skpd,len('$lcskpd'))='$lcskpd'
                                    group by z.kd_program, z.nm_program ";
                             $hasil_prog = $this->db->query($sql);
                             foreach ($hasil_prog->result() as $row_prog)
                             {
                             $cRet .="<tr>
                                    <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>$lcprog</b></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>$row_prog->nm_program</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->ang_ubah)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->terima_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->keluar_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu)-($row_prog->terima_lalu))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->terima_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->keluar_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_ini)-($row_prog->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->terima_lalu)+($row_prog->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu)+($row_prog->keluar_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu+$row_prog->keluar_ini)-($row_prog->terima_lalu+$row_prog->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->ang_ubah-($row_prog->terima_lalu+$row_prog->terima_ini))."</b></td>
                                  </tr>";
                                    
                                
                             }
                                                                                                                                                                 
                        }
                        
                        if($lckeg<>$lckeg_lama){ //cek kegiatan
                            $sql="select z.kd_kegiatan, z.nm_kegiatan,
                                (SELECT SUM(a.$anggaran_) FROM $n_trdrka a WHERE a.kd_kegiatan=z.kd_kegiatan and left(a.kd_skpd,len('$lcskpd'))='$lcskpd') AS ang_ubah,
                                (SELECT SUM(a.nilai) FROM tr_terima a WHERE a.kd_kegiatan=z.kd_kegiatan and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_terimaini) AS terima_ini,
                                (SELECT SUM(a.nilai) FROM tr_terima a WHERE a.kd_kegiatan=z.kd_kegiatan and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_terimalalu) AS terima_lalu,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd WHERE a.kd_kegiatan=z.kd_kegiatan and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarini) AS keluar_ini,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) and a.kd_skpd=b.kd_skpd WHERE a.kd_kegiatan=z.kd_kegiatan and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarlalu) AS keluar_lalu 
                                    from trskpd z where z.kd_kegiatan='$lckeg' and z.kd_skpd='$lcskpd' 
                                    group by z.kd_kegiatan, z.nm_kegiatan";
                             $hasil_keg = $this->db->query($sql);
                             foreach ($hasil_keg->result() as $row_keg)
                             {
                                $cRet .="<tr>
                                    <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>$lckeg</b></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:11px;border-bottom:none;border-top:none\"><b>$row_keg->nm_kegiatan</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->ang_ubah)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->terima_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->keluar_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu)-($row_keg->terima_lalu))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->terima_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->keluar_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_ini)-($row_keg->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->terima_lalu)+($row_keg->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu)+($row_keg->keluar_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu+$row_keg->keluar_ini)-($row_keg->terima_lalu+$row_keg->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->ang_ubah-($row_keg->terima_lalu+$row_keg->terima_ini))."</b></td>
                                  </tr>";
                                
                                
                             }
                                                                                                                                                                 
                        }                                                                                                                        
                                                                                                                                
                       $cRet .="<tr>
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$lckeg.".$this->tukd_model->dotrek($lcrek)."</td>
                              <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->nm_rek5</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->ang_ubah)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->terima_lalu)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->keluar_lalu)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu)-($row->terima_lalu))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->terima_ini)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->keluar_ini)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->keluar_ini)-($row->terima_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->terima_lalu)+($row->terima_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu)+($row->keluar_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu+$row->keluar_ini)-($row->terima_lalu+$row->terima_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->ang_ubah-($row->terima_lalu+$row->terima_ini))."</td>
                              </tr>";    
                                                              
                        $ln_jlh1=$ln_jlh1+ $row->ang_ubah;
                        $ln_jlh2=$ln_jlh2+ $row->terima_lalu;
                        $ln_jlh3=$ln_jlh3+ $row->keluar_lalu;
                        $ln_jlh4=$ln_jlh4+ ($row->keluar_lalu)-($row->terima_lalu);
                        $ln_jlh5=$ln_jlh5+ $row->terima_ini;
                        $ln_jlh6=$ln_jlh6+ $row->keluar_ini;
                        $ln_jlh7=$ln_jlh7+ ($row->keluar_ini-$row->terima_ini);
                        $ln_jlh8=$ln_jlh8+ ($row->terima_lalu+$row->terima_ini);
                        $ln_jlh9=$ln_jlh9+ ($row->keluar_lalu+$row->keluar_ini);
                        $ln_jlh10=$ln_jlh10+ (($row->keluar_lalu+$row->keluar_ini)-($row->terima_lalu+$row->terima_ini));
                        $ln_jlh11=$ln_jlh11+ ($row->ang_ubah-($row->terima_lalu+$row->terima_ini));
                                                                             
                        $lcprog_lama=$lcprog;
                        $lckeg_lama=$lckeg;           
                    }
                    


         $cRet .="<tr>
                    <td valign=\"top\" align=\"center\" colspan=\"2\" style=\"font-size:12px\"><b>Jumlah</b></td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh1)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh2)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh3)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh4)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh5)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh6)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh7)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh8)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh9)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh10)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh11)."</td>
                </tr>
                ";
                /* <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Mengetahui</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">".$daerah.", tanggal ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">$lcJabatanPA</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">$lcJabatanBP</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmPA</u></b><br>$lcPangkatPA</td>
                    <td align=\"center\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmBP</u></b><br>$lcPangkatBP</td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipPA</td>
                    <td align=\"center\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipBP</td>
                </tr>"; */
                
                                  
                
        $cRet .='</table>';
          $print = $this->uri->segment(3);
		if($print==0){
         $data['prev']= $cRet;    
		 echo ("<title>SPJ Pendapatan</title>");
		 echo $cRet;}
		 else{

	    $this->_mpdf('',$cRet,10,10,10,'L',0,'');
		}
    }
    
	
	function cetak_spjterimappkd(){
        $thn_ang = $this->session->userdata('pcThang');
         $lcskpd = $_REQUEST['kd_skpd'];
         $lcskpd2 = $lcskpd;
         $pilih = $_REQUEST['cpilih'];
         $jnsctk = $_REQUEST['jnsctk'];
         
         if($jnsctk=='1'){
                $lcskpd = substr($lcskpd, 0, 7);
         }

		 if ($pilih==1){
            $lctgl1 = $_REQUEST['tgl1'];
            $lctgl2 = $_REQUEST['tgl2'];   
            $lcperiode = $this->tukd_model->tanggal_format_indonesia($lctgl1)."  S.D. ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            $lcperiode1 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl1);
            $lcperiode2 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
			
			$sqlang="select case when statu=1 and status_sempurna=1 and status_ubah=1 and month('$lctgl2')>=month(tgl_dpa_ubah) then 'nilai_ubah' 
					   when statu=1 and status_sempurna=1 and status_ubah=1 and month('$lctgl2')>=month(tgl_dpa_sempurna) and month('$lctgl2')<month(tgl_dpa_ubah) then 'nilai_sempurna'
					   when statu=1 and status_sempurna=1 and status_ubah=1 and month('$lctgl2')<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=1 and status_ubah=0 and month('$lctgl2')>=month(tgl_dpa_sempurna) then 'nilai_sempurna' 
					   when statu=1 and status_sempurna=1 and status_ubah=0 and month('$lctgl2')<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=0 and status_ubah=0 and month('$lctgl2')>=month(tgl_dpa) then 'nilai'
					   else 'nilai' end as anggaran from trhrka where kd_skpd ='$lcskpd2'";
			
            
         }else{
            $bulan = $_REQUEST['bulan'];
            $lcperiode = $this->tukd_model->getBulan($bulan);
            if($bulan==1){
                $lcperiode1 = "Bulan Sebelumnya";    
				}else{
				$lcperiode1 = "Bulan ".$this->tukd_model->getBulan($bulan-1);
				}  
            $lcperiode2 = "Bulan ".$this->tukd_model->getBulan($bulan);
			$sqlang="select case when statu=1 and status_sempurna=1 and status_ubah=1 and $bulan>=month(tgl_dpa_ubah) then 'nilai_ubah' 
					   when statu=1 and status_sempurna=1 and status_ubah=1 and $bulan>=month(tgl_dpa_sempurna) and $bulan<month(tgl_dpa_ubah) then 'nilai_sempurna'
					   when statu=1 and status_sempurna=1 and status_ubah=1 and $bulan<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=1 and status_ubah=0 and $bulan>=month(tgl_dpa_sempurna) then 'nilai_sempurna' 
					   when statu=1 and status_sempurna=1 and status_ubah=0 and $bulan<month(tgl_dpa_sempurna) then 'nilai'
					   when statu=1 and status_sempurna=0 and status_ubah=0 and $bulan>=month(tgl_dpa) then 'nilai'
					   else 'nilai' end as anggaran from trhrka where kd_skpd ='$lcskpd2'";
			
         }
         
		 
		
        $hasilang = $this->db->query($sqlang);
        $hasil_ang = $hasilang->row();          
        $anggaran_ = $hasil_ang->anggaran;
		 
		 
		 
		 
         $tgl_ttd= $_REQUEST['tgl_ttd'];
		 $nippa = str_replace('123456789',' ',$_REQUEST['ttd']);		     
         if($nippa==''){
                     $lcNmPA = '';
    				 $lcNipPA = '';
    				 $lcJabatanPA = '';
    				 $lcPangkatPA = '';
            
         }else{   		 
             $csql="SELECT nip as nip,nama,jabatan,pangkat  FROM ms_ttd WHERE nip = '$nippa' AND kd_skpd = '$lcskpd2' AND kode='PA'";
    				 $hasil = $this->db->query($csql);
    				 $trh2 = $hasil->row(); 
    				 
                     $lcNmPA = $trh2->nama;
    				 $lcNipPA = $trh2->nip;
    				 $lcJabatanPA = $trh2->jabatan;
    				 $lcPangkatPA = $trh2->pangkat;
		 }
         $nipbp = str_replace('123456789',' ',$_REQUEST['ttd2']);		     
		 if($nipbp==''){
             $lcNmBP = '';
             $lcNipBP = '';
             $lcPangkatBP = '';
             $lcJabatanBP = '';		  
		 }else{
             $csql="SELECT nip,nama,jabatan,pangkat FROM ms_ttd WHERE nip = '$nipbp' AND kd_skpd = '$lcskpd2' AND kode='BP'";
             $hasil3 = $this->db->query($csql);
             $trh3 = $hasil3->row(); 	
             $lcNmBP = $trh3->nama;
             $lcNipBP = $trh3->nip;
             $lcPangkatBP = $trh3->pangkat;
             $lcJabatanBP = $trh3->jabatan;
         }
		 $prv = $this->db->query("SELECT provinsi,daerah from sclient WHERE kd_skpd='$lcskpd2'");
			$prvn = $prv->row();          
			$prov = $prvn->provinsi;         
			$daerah = $prvn->daerah;

        $csql="SELECT a.nm_skpd FROM ms_skpd a WHERE left(a.kd_skpd,len('$lcskpd')) = '$lcskpd'";
        $hasil = $this->db->query($csql);
        $trh2 = $hasil->row();          
        $lcNmskpd = $trh2->nm_skpd;
        

        
		
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"13\" style=\"font-size:14px;border: solid 1px white;\"><b>".$prov."<br>
                    LAPORAN PERTANGGUNGJAWABAN BENDAHARA PENERIMAAN<BR>SPJ PENDAPATAN PERIODE ".strtoupper($lcperiode)."</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">SKPD</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmskpd</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
            </tr>
            
            </table>
			
			<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <thead>
            <tr>
                <td align=\"center\" rowspan=\"2\" width=\"10%\" style=\"font-size:12px\">Kode<br>Rekening</td>
                <td align=\"center\" rowspan=\"2\" width=\"24%\" style=\"font-size:12px\">Uraian</td>
                <td align=\"center\" rowspan=\"2\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran</td>
                <td align=\"center\" colspan=\"3\" width=\"18%\" style=\"font-size:12px\">Sampai dengan Bulan Lalu</td>
                <td align=\"center\" colspan=\"3\" width=\"18%\" style=\"font-size:12px\">Bulan Ini</td>
                <td align=\"center\" colspan=\"4\" width=\"24%\" style=\"font-size:12px\">Sampai dengan Bulan Ini</td>
            </tr>
            <tr>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penerimaan</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penyetoran</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penerimaan</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penyetoran</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran<br>yang<br>Terealisasi</td>                
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran<br>yang telah<br>Disetor</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa yang<br>Belum<br>Disetor</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa Anggaran yang<br>Belum<br>Terealisasi/Pelam-<br>pauan Anggaran</td>                                
            </tr>            
            <tr>
                <td align=\"center\" style=\"font-size:12px\">1</td>
                <td align=\"center\" style=\"font-size:12px\">2</td>
                <td align=\"center\" style=\"font-size:12px\">3</td>
                <td align=\"center\" style=\"font-size:12px\">4</td>
                <td align=\"center\" style=\"font-size:12px\">5</td>
                <td align=\"center\" style=\"font-size:12px\">6=(5-4)</td>
                <td align=\"center\" style=\"font-size:12px\">7</td>
                <td align=\"center\" style=\"font-size:12px\">8</td>
                <td align=\"center\" style=\"font-size:12px\">9=(8-7)</td>
                <td align=\"center\" style=\"font-size:12px\">10=(4+7)</td>
                <td align=\"center\" style=\"font-size:12px\">11=(5+8)</td>
                <td align=\"center\" style=\"font-size:12px\">12=(11-10)</td>
                <td align=\"center\" style=\"font-size:12px\">13=(3-10)</td>                
            </tr>
			</thead>";
           

            if ($pilih==1   ){
                $kon_terimaini = " (a.tgl_kas >= '$lctgl1' AND a.tgl_kas <= '$lctgl2')";
                $kon_keluarini = " (a.tgl_kas >= '$lctgl1' AND a.tgl_kas <= '$lctgl2')";          
                $kon_terimalalu = " (a.tgl_kas < '$lctgl1')";
                $kon_keluarlalu = " (a.tgl_kas < '$lctgl1')";
           }else{
                $kon_terimaini = " (month(a.tgl_kas)= '$bulan' AND year(a.tgl_kas) = '$thn_ang')";
                $kon_keluarini = " (month(a.tgl_kas)= '$bulan' AND year(a.tgl_kas) = '$thn_ang')";
                $kon_terimalalu = " (month(a.tgl_kas)< '$bulan' AND year(a.tgl_kas) = '$thn_ang')";
                $kon_keluarlalu = " (month(a.tgl_kas)< '$bulan' AND year(a.tgl_kas) = '$thn_ang')";
           }

            $n_trdrka = 'trdrka';
            
            $kon_skpd="a.kd_skpd = ";
            $sql  = "SELECT z.kd_skpd, z.kd_kegiatan, z.kd_rek5, z.nm_rek5, SUM(z.nilai) AS ang, SUM(z.$anggaran_) AS ang_ubah,
                    0 AS keluar_ini,
                    0 AS keluar_lalu,
                    (SELECT SUM(b.rupiah) FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON RTRIM(a.no_kas)=RTRIM(b.no_kas) WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_keluarini) AS terima_ini,
                    (SELECT SUM(b.rupiah) FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON RTRIM(a.no_kas)=RTRIM(b.no_kas) WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_keluarlalu) AS terima_lalu                    
                    FROM $n_trdrka z WHERE left(z.kd_skpd,len('$lcskpd'))='$lcskpd' and left(z.kd_rek5,1)='4' and right(z.kd_kegiatan,5)='00.04'
                    GROUP BY z.kd_skpd, z.kd_kegiatan, z.kd_rek5,z.nm_rek5
                    ORDER BY z.kd_rek5"     ;
                                       
                    $hasil = $this->db->query($sql);                                                      
                    $lcterima_ini=0;
                    $lckeluar_ini=0;
                    $lcprog_lama="";
                    $lckeg_lama="";
                    $ln_jlh1 =0;
                    $ln_jlh2 =0;
                    $ln_jlh3 =0;
                    $ln_jlh4 =0;
                    $ln_jlh5 =0;
                    $ln_jlh6 =0;
                    $ln_jlh7 =0;
                    $ln_jlh8 =0;
                    $ln_jlh9 =0;
                    $ln_jlh10 =0;
                    $ln_jlh11 =0;
                    
                    foreach ($hasil->result() as $row)
                    {
                        $lcprog=substr($row->kd_kegiatan,0,18);
                        $lckeg=$row->kd_kegiatan;
                        $lcrek=$row->kd_rek5;
                        
                        if($lcprog<>$lcprog_lama){//cek program
                             $sql="select z.kd_program, z.nm_program,
                                (SELECT SUM(a.$anggaran_) FROM $n_trdrka a WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and left(a.kd_rek5,1)='4' and right(a.kd_kegiatan,5)='00.04') AS ang_ubah,
                                0 AS keluar_ini,
                               00 AS keluar_lalu,
								(SELECT SUM(b.rupiah) FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON RTRIM(a.no_kas)=RTRIM(b.no_kas) WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and right(b.kd_kegiatan,5)='00.04' and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarini) AS terima_ini,
                                (SELECT SUM(b.rupiah) FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON RTRIM(a.no_kas)=RTRIM(b.no_kas) WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and right(b.kd_kegiatan,5)='00.04' and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarlalu) AS terima_lalu 
                                    from trskpd z where z.kd_kegiatan='$lckeg' and left(z.kd_skpd,len('$lcskpd'))='$lcskpd'
                                    group by z.kd_program, z.nm_program ";
                             $hasil_prog = $this->db->query($sql);
                             foreach ($hasil_prog->result() as $row_prog)
                             {
                             $cRet .="<tr>
                                    <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>$lcprog</b></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>$row_prog->nm_program</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->ang_ubah)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->terima_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->keluar_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu)-($row_prog->terima_lalu))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->terima_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->keluar_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_ini)-($row_prog->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->terima_lalu)+($row_prog->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu)+($row_prog->keluar_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu+$row_prog->keluar_ini)-($row_prog->terima_lalu+$row_prog->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->ang_ubah-($row_prog->terima_lalu+$row_prog->terima_ini))."</b></td>
                                  </tr>";
                                    
                                
                             }
                                                                                                                                                                 
                        }
                        
                        if($lckeg<>$lckeg_lama){ //cek kegiatan
                            $sql="select z.kd_kegiatan, z.nm_kegiatan,
                                (SELECT SUM(a.$anggaran_) FROM $n_trdrka a WHERE a.kd_kegiatan=z.kd_kegiatan and left(a.kd_skpd,len('$lcskpd'))='$lcskpd') AS ang_ubah,
                                0 AS keluar_ini,
                                0 AS keluar_lalu,
                                (SELECT SUM(b.rupiah) FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON RTRIM(a.no_kas)=RTRIM(b.no_kas) WHERE a.kd_kegiatan=z.kd_kegiatan and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarini) AS terima_ini,
                                (SELECT SUM(b.rupiah) FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON RTRIM(a.no_kas)=RTRIM(b.no_kas) WHERE a.kd_kegiatan=z.kd_kegiatan and left(a.kd_skpd,len('$lcskpd'))='$lcskpd' and $kon_keluarlalu) AS terima_lalu 
                                    from trskpd z where z.kd_kegiatan='$lckeg' and z.kd_skpd='$lcskpd' 
                                    group by z.kd_kegiatan, z.nm_kegiatan";
                             $hasil_keg = $this->db->query($sql);
                             foreach ($hasil_keg->result() as $row_keg)
                             {
                                $cRet .="<tr>
                                    <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>$lckeg</b></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:11px;border-bottom:none;border-top:none\"><b>$row_keg->nm_kegiatan</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->ang_ubah)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->terima_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->keluar_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu)-($row_keg->terima_lalu))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->terima_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->keluar_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_ini)-($row_keg->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->terima_lalu)+($row_keg->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu)+($row_keg->keluar_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu+$row_keg->keluar_ini)-($row_keg->terima_lalu+$row_keg->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->ang_ubah-($row_keg->terima_lalu+$row_keg->terima_ini))."</b></td>
                                  </tr>";
                                
                                
                             }
                                                                                                                                                                 
                        }                                                                                                                        
                                                                                                                                
                       $cRet .="<tr>
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$lckeg.".$this->tukd_model->dotrek($lcrek)."</td>
                              <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->nm_rek5</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->ang_ubah)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->terima_lalu)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->keluar_lalu)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu)-($row->terima_lalu))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->terima_ini)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->keluar_ini)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->keluar_ini)-($row->terima_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->terima_lalu)+($row->terima_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu)+($row->keluar_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu+$row->keluar_ini)-($row->terima_lalu+$row->terima_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->ang_ubah-($row->terima_lalu+$row->terima_ini))."</td>
                              </tr>";    
                                                              
                        $ln_jlh1=$ln_jlh1+ $row->ang_ubah;
                        $ln_jlh2=$ln_jlh2+ $row->terima_lalu;
                        $ln_jlh3=$ln_jlh3+ $row->keluar_lalu;
                        $ln_jlh4=$ln_jlh4+ ($row->keluar_lalu)-($row->terima_lalu);
                        $ln_jlh5=$ln_jlh5+ $row->terima_ini;
                        $ln_jlh6=$ln_jlh6+ $row->keluar_ini;
                        $ln_jlh7=$ln_jlh7+ ($row->keluar_ini-$row->terima_ini);
                        $ln_jlh8=$ln_jlh8+ ($row->terima_lalu+$row->terima_ini);
                        $ln_jlh9=$ln_jlh9+ ($row->keluar_lalu+$row->keluar_ini);
                        $ln_jlh10=$ln_jlh10+ (($row->keluar_lalu+$row->keluar_ini)-($row->terima_lalu+$row->terima_ini));
                        $ln_jlh11=$ln_jlh11+ ($row->ang_ubah-($row->terima_lalu+$row->terima_ini));
                                                                             
                        $lcprog_lama=$lcprog;
                        $lckeg_lama=$lckeg;           
                    }
                    


         $cRet .="<tr>
                    <td valign=\"top\" align=\"center\" colspan=\"2\" style=\"font-size:12px\"><b>Jumlah</b></td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh1)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh2)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh3)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh4)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh5)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh6)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh7)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh8)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh9)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh10)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ln_jlh11)."</td>
                </tr>
                ";
                /* <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Mengetahui</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">".$daerah.", tanggal ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">$lcJabatanPA</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">$lcJabatanBP</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmPA</u></b><br>$lcPangkatPA</td>
                    <td align=\"center\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmBP</u></b><br>$lcPangkatBP</td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipPA</td>
                    <td align=\"center\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipBP</td>
                </tr>"; */
                
                                  
                
        $cRet .='</table>';
          $print = $this->uri->segment(3);
		if($print==0){
         $data['prev']= $cRet;    
		 echo ("<title>SPJ Pendapatan</title>");
		 echo $cRet;}
		 else{

	    $this->_mpdf('',$cRet,10,10,10,'L',0,'');
		}
    }
    
	
	
	
	function update_bkp2(){
        
		$query = $this->input->post('st_query');
       
        $asg = $this->db->query($query);
        if($asg){
            echo '1';
        }else{
            echo '0';
        }
        

    }	

	function pengeluaran_non_sp2d()
    {
        $data['page_title']= 'BUKU KAS PENERIMAAN';
        $this->template->set('title', 'BUKU KAS PENERIMAAN');   
        $this->template->load('template','tukd/sp2d/pengeluaran_non_sp2d',$data) ; 
    }
	
	function load_pengeluaran_nonsp2d(){
        
        $sql = "SELECT * from pengeluaran_non_sp2d order by nomor";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nomor' => $resulte['nomor'],
                        'tanggal' => $resulte['tanggal'],
						'keterangan' => $resulte['keterangan'],
                        'nilai' => number_format($resulte['nilai'],"2",".",",")                                                                                         
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
	
	function hapus_pengeluaran_non_sp2d() {    	
		$nomor = $this->input->post('no');
		$tgl   = $this->input->post('tanggal');
		//$nilai = $this->input->post('nilai');
        $query = "delete from pengeluaran_non_sp2d where nomor='$nomor' and tanggal='$tgl'";
		$asg = $this->db->query($query);
            if($asg){
                echo '1';
            }else{
                echo '0';
            }
    }  
	
	
	function ctk_pengeluaran_non_sp2d($ctk='',$ttd='',$tgl='',$no_halaman=''){
		
		$lcttd = str_replace('123456789',' ',$this->uri->segment(4));
		$tanggal1 = $this->tanggal_format_indonesia($tgl);
		$z = strtotime("-1 day", strtotime($tgl));
		$n = date("Y-m-d", $z);
		$tanggalsbl = $this->tanggal_format_indonesia($n);
		$thn_ang = $this->session->userdata('pcThang');
		$prv = $this->db->query("SELECT provinsi,daerah from sclient where kd_skpd='1.20.00.00'");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		$cRet = '';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>BUKU KAS PEMBANTU PENGELUARAN NON SP2D TAHUN ANGGARAN $thn_ang</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
			</table>
			<table style=\"border-collapse:collapse; border-color: black;font-size:13px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
            <thead> 
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"3%\" style=\"font-weight:bold;\">No. Urut</td>  
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"27%\" style=\"font-weight:bold\">Uraian</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"25%\" style=\"font-weight:bold\">Kode Rekening</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-weight:bold\">Pengeluaran (Rp)</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
            </tr>
			<tr>
                <td align=\"center\"></td>
                <td align=\"left\">Tanggal : $tanggal1</td>
				<td align=\"center\"></td>
                <td align=\"center\"></td>
            </tr>
			</thead>";
		$nilai3=0; 
		$sql = "SELECT * from pengeluaran_non_sp2d where tanggal = '$tgl'";
		$hasil = $this->db->query($sql);
		
		foreach ($hasil->result() as $row){
		$nomor     = $row->nomor;	
		$tanggal    = $row->tanggal;	
		$keterangan  = $row->keterangan;	
		$nilai       = $row->nilai;
        $nilaix = empty($nilai) || $nilai == 0 ? '' :number_format($nilai,"2",",",".");                     
		$nilai3=$nilai3+$nilai;

			$cRet .= '<tr>
			<td>'.$nomor.'</td>
			<td>'.$keterangan.'</td>
			<TD></TD>
			<TD align="right">'.$nilaix.'</TD>
			</tr>';
			 
		} 
		
		$sql2 = "select sum(d.nilai) as nilai 
				from pengeluaran_non_sp2d d where d.tanggal <'$tgl'";
				
		$hasil2 = $this->db->query($sql2);
		foreach ($hasil2->result() as $row){
		$nilai2 = $row->nilai;
		$nilai2x      = number_format($nilai2,"2",",",".");
		}		
		
		$total  = $nilai3+$nilai2;
		$totalx = number_format($total,"2",",","."); 
		$nilai3x = number_format($nilai3,"2",",",".");
		
		
		$cRet .= '
		<tr>
			<TD></TD>
			<TD align="left" colspan="2" style="border-left:hidden;">Jumlah Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal1.' </TD>
			<TD align="right" >'.$nilai3x.'</TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;"></TD>
			<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah Sampai Tanggal : '.$tanggalsbl.' </TD>
			<TD style="border-top:hidden;" align="right" >'.$nilai2x.'</TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;"></TD>
			<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah s.d Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal1.' </TD>
			<TD align="right" >'.$totalx.'</TD>
		</tr>';
		
		 $cRet .='</table>';
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">Bendahara Umum Daerah</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(4);
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>Buku Kas Pengeluaran Non SP2D</title>");
			 echo $cRet;
		}else{
			$this->_mpdf3('',$cRet,5,5,5,'0',$no_halaman,'');
		}
		
	}

	
	
	function update_pengeluaran_nonsp2d(){
        $query = $this->input->post('st_query');
        $asg = $this->db->query($query);
		if($asg){
			echo '2';
		}else{
			echo '0';
		}
    }
	
	function cetak_pengeluaran_non_sp2d()
    {
        $data['page_title']= 'BUKU KAS PENGELUARAN NON SP2D';
        $this->template->set('title', 'BUKU KAS PENGELUARAN NON SP2D');   
        $this->template->load('template','tukd/sp2d/ctk_pengeluaran_non_sp2d',$data) ; 
    }
	
	function buku_kas_penerimaan_pengeluaran($ctk='',$ttd='',$tgl='',$number='',$no_halaman=''){
		
		$lcttd = str_replace('123456789',' ',$this->uri->segment(4));
		$tanggal = $this->tanggal_format_indonesia($tgl);
		$z = strtotime("-1 day", strtotime($tgl));
		$n = date("Y-m-d", $z);
		$tanggalsbl = $this->tanggal_format_indonesia($n);
		$thn_ang = $this->session->userdata('pcThang');
		$prv = $this->db->query("SELECT provinsi,daerah from sclient where kd_skpd='1.20.00.00'");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
	
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
			
		$sqlx="SELECT * from buku_kas where nomor='0'";	
		$sqlx1=$this->db->query($sqlx);
		 foreach ($sqlx1->result() as $rowttd)
			{
				$nomor=$rowttd->nomor;
				$uraian=$rowttd->uraian;
				$nilaiu= $rowttd->nilai;
				$nilaiu_x = number_format($nilaiu,"2",",",".");
			}
		if ($tgl=='2016-1-1'){	
		$cRet="";
		$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>BUKU KAS PENERIMAAN DAN PENGELUARAN</b><br> <b>TAHUN ANGGARAN $thn_ang</b></td>
            </tr>
            
			</table>
			<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
            <thead> 
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">NOMOR</td>  
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"50%\" style=\"font-weight:bold\">URAIAN</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">PENERIMAAN</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">PENGELUARAN</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
            </tr>
			<tr>
				<td></td>
                <td>Tanggal : $tanggal</td>
				<td></td>
                <td></td>
			</tr>
			<tr>
				<td align=\"center\">1</td>
                <td>$uraian</td>
				<td align=\"right\">$nilaiu_x</td>
                <td align=\"right\">0,00</td>
			</tr>
			</thead>";
		}else{
		$cRet="";
		$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>BUKU KAS PENERIMAAN DAN PENGELUARAN</b><br> <b>TAHUN ANGGARAN $thn_ang</b></td>
            </tr>
            
			</table>
			<table style=\"border-collapse:collapse; border-color: black;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\" >
            <thead> 
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">NOMOR</td>  
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"50%\" style=\"font-weight:bold\">URAIAN</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">PENERIMAAN</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">PENGELUARAN</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
				<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
            </tr>
			<tr>
				<td></td>
                <td>Tanggal : $tanggal</td>
				<td></td>
                <td></td>
			</tr>
			</thead>";
		}
		$tot_trm=0; 
		$tot_klr=0; 
		/* $sql="SELECT a.nomor, a.uraian,ISNULL(SUM(b.nilai),0) as nilai from 
				buku_kas a LEFT JOIN 
				(
				select jenis, sum(nilai) as nilai from buku_kas_penerimaan_pengeluaran
				where tanggal='$tgl' group by jenis
				UNION ALL
				select 10 as jenis
				, isnull(sum(d.nilai),0) as nilai
								from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
														INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
														INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd
								where a.status_bud='1' and  a.jns_spp !='4' and a.tgl_kas_bud='$tgl'
				UNION ALL
				select 11 as jenis
				, isnull(sum(d.nilai),0) as nilai
								from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
														INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
														INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd
								where a.status_bud='1' and  a.jns_spp ='4' and a.tgl_kas_bud='$tgl'
				UNION ALL
			SELECT
				12 AS jenis,
				isnull(SUM(x.nilai), 0) AS nilai
			FROM
				pengeluaran_non_sp2d x
			where x.tanggal = '$tgl') b
				on a.nomor=b.jenis 
				where nomor != '0' AND b.nilai !='0'
				GROUP BY a.nomor,a.uraian
				ORDER BY nomor"; */
				
		$sql="SELECT  a.tgl_kas,LEFT(b.kd_rek5,3) as kd_rek, UPPER(c.nm_rek3) as nama
				,SUM(rupiah) as nilai, 1 jenis
				FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON a.no_kas=b.no_kas AND a.kd_skpd=b.kd_skpd
				LEFT JOIN ms_rek3 c ON LEFT(b.kd_rek5,3)=c.kd_rek3
				WHERE LEFT(b.kd_rek5,1) IN ('4') AND a.tgl_kas='$tgl'
				 GROUP BY a.tgl_kas,LEFT(b.kd_rek5,3),c.nm_rek3 
				UNION ALL
				SELECT  a.tgl_kas,LEFT(b.kd_rek5,1) as kd_rek, 'CONTRA POST' as nama
				,SUM(rupiah) as nilai, 1 jenis
				FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON a.no_kas=b.no_kas AND a.kd_skpd=b.kd_skpd
				WHERE LEFT(b.kd_rek5,1) IN ('5') AND a.tgl_kas='$tgl'
				 GROUP BY a.tgl_kas,LEFT(b.kd_rek5,1) 
				UNION ALL
				SELECT
				a.tgl_kas_bud, '' kd_rek, 'PENGELUARAN BELANJA NON GAJI' nama,
							isnull(SUM(d.nilai), 0) AS nilai, 2 jenis
						FROM
							trhsp2d a
						INNER JOIN trhspm b ON a.no_spm = b.no_spm
						AND a.kd_skpd = b.kd_skpd
						INNER JOIN trhspp c ON b.no_spp = c.no_spp
						AND b.kd_skpd = c.kd_skpd
						INNER JOIN trdspp d ON c.no_spp = d.no_spp
						AND c.kd_skpd = d.kd_skpd
						WHERE
							a.status_bud = '1'
						AND a.jns_spp != '4'
						AND a.tgl_kas_bud='$tgl'
				GROUP BY a.tgl_kas_bud
				UNION ALL
				SELECT
				a.tgl_kas_bud, '' kd_rek, 'PENGELUARAN BELANJA GAJI' nama,
							isnull(SUM(d.nilai), 0) AS nilai, 2 jenis
						FROM
							trhsp2d a
						INNER JOIN trhspm b ON a.no_spm = b.no_spm
						AND a.kd_skpd = b.kd_skpd
						INNER JOIN trhspp c ON b.no_spp = c.no_spp
						AND b.kd_skpd = c.kd_skpd
						INNER JOIN trdspp d ON c.no_spp = d.no_spp
						AND c.kd_skpd = d.kd_skpd
						WHERE
							a.status_bud = '1'
						AND a.jns_spp = '4'
						AND a.tgl_kas_bud='$tgl'
				GROUP BY a.tgl_kas_bud
				UNION ALL
				SELECT
									x.tanggal,'' kd_rek, 'PENGELUARAN NON SP2D' nama,
									isnull(SUM(x.nilai), 0) AS nilai, 2 jenis
								FROM
									pengeluaran_non_sp2d x
								WHERE
									x.tanggal='$tgl'
				GROUP BY x.tanggal";
		
		if ($tgl=='2016-1-1'){	
		$no=1;
		}else{
		$no=$number-1;	
		}
		$hasil = $this->db->query($sql);
		foreach ($hasil->result() as $row){
			$kd_rek  = $row->kd_rek;                    
			$uraian= $row->nama;
			$nilai  = $row->nilai;
			$jenis  = $row->jenis;                    
			
		/* if(($nomor==1) or ($nomor==2) or ($nomor==3) or ($nomor==4) or ($nomor==0) or ($nomor==5) or ($nomor==6) or ($nomor==7) or ($nomor==8) or ($nomor==9)){
			$terima=$nilai;
			$keluar=0;
			
		} else {
			$terima=0;
			$keluar=$nilai;
		} */
		
		if($jenis=='1'){
			$terima=$nilai;
			$keluar=0;
		} else {
			$terima=0;
			$keluar=$nilai;
		}
		
		$tot_trm=$tot_trm+$terima;
		$tot_klr=$tot_klr+$keluar;
		$no=$no+1;
		$cRet .= '<tr>
		<TD align="center" >'.$no.'</TD>
		<td valign="top">'.$uraian.'</td>
		<td valign="top" align="right">'.number_format($terima,"2",",",".").'</td>
		<td valign="top" align="right">'.number_format($keluar,"2",",",".").'</td>
		</tr>';
		
		}
		
		$sql3 = "select nilai from buku_kas where nomor ='0'";
			$hasil3 = $this->db->query($sql3);
			foreach ($hasil3->result() as $row){
			$nilai_ax = $row->nilai;
			$nilai_x = number_format($nilai_ax,"2",",",".");
		}
		
		$sql2 = "SELECT SUM(CASE WHEN jenis IN('1') THEN nilai ELSE 0 END) as trm_sbl,
						SUM(CASE WHEN jenis IN('2') THEN nilai ELSE 0 END) as klr_sbl
			FROM(
				SELECT  a.tgl_kas,LEFT(b.kd_rek5,3) as kd_rek, UPPER(c.nm_rek3) as nama
				,SUM(rupiah) as nilai, 1 jenis
				FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON a.no_kas=b.no_kas AND a.kd_skpd=b.kd_skpd
				LEFT JOIN ms_rek3 c ON LEFT(b.kd_rek5,3)=c.kd_rek3
				WHERE LEFT(b.kd_rek5,1) IN ('4') AND a.tgl_kas<'$tgl'
				 GROUP BY a.tgl_kas,LEFT(b.kd_rek5,3),c.nm_rek3 
				UNION ALL
				SELECT  a.tgl_kas,LEFT(b.kd_rek5,1) as kd_rek, 'CONTRA POST' as nama
				,SUM(rupiah) as nilai, 1 jenis
				FROM trhkasin_ppkd a INNER JOIN trdkasin_ppkd b ON a.no_kas=b.no_kas AND a.kd_skpd=b.kd_skpd
				WHERE LEFT(b.kd_rek5,1) IN ('5') AND a.tgl_kas<'$tgl'
				 GROUP BY a.tgl_kas,LEFT(b.kd_rek5,1) 
				UNION ALL
				SELECT
				a.tgl_kas_bud, '' kd_rek, 'PENGELUARAN BELANJA NON GAJI' nama,
							isnull(SUM(d.nilai), 0) AS nilai, 2 jenis
						FROM
							trhsp2d a
						INNER JOIN trhspm b ON a.no_spm = b.no_spm
						AND a.kd_skpd = b.kd_skpd
						INNER JOIN trhspp c ON b.no_spp = c.no_spp
						AND b.kd_skpd = c.kd_skpd
						INNER JOIN trdspp d ON c.no_spp = d.no_spp
						AND c.kd_skpd = d.kd_skpd
						WHERE
							a.status_bud = '1'
						AND a.jns_spp != '4'
						AND a.tgl_kas_bud<'$tgl'
				GROUP BY a.tgl_kas_bud
				UNION ALL
				SELECT
				a.tgl_kas_bud, '' kd_rek, 'PENGELUARAN BELANJA GAJI' nama,
							isnull(SUM(d.nilai), 0) AS nilai, 2 jenis
						FROM
							trhsp2d a
						INNER JOIN trhspm b ON a.no_spm = b.no_spm
						AND a.kd_skpd = b.kd_skpd
						INNER JOIN trhspp c ON b.no_spp = c.no_spp
						AND b.kd_skpd = c.kd_skpd
						INNER JOIN trdspp d ON c.no_spp = d.no_spp
						AND c.kd_skpd = d.kd_skpd
						WHERE
							a.status_bud = '1'
						AND a.jns_spp = '4'
						AND a.tgl_kas_bud<'$tgl'
				GROUP BY a.tgl_kas_bud
				UNION ALL
				SELECT
									x.tanggal,'' kd_rek, 'PENGELUARAN NON SP2D' nama,
									isnull(SUM(x.nilai), 0) AS nilai, 2 jenis
								FROM
									pengeluaran_non_sp2d x
								WHERE
									x.tanggal<'$tgl'
				GROUP BY x.tanggal) a";
		$hasil2 = $this->db->query($sql2);
		
		foreach ($hasil2->result() as $row){
			$trm_sbl = $row->trm_sbl+$nilai_ax;
			$klr_sbl = $row->klr_sbl;
			$nilai_2x = number_format($trm_sbl,"2",",",".");
			$nilai_3x = number_format($klr_sbl,"2",",",".");		
		}	
		
			
		
		//$kas = ($tot_trm+$trm_sbl)-($tot_klr+$klr_sbl);
		//$kasnom = number_format($kas,"2",",",".");
		$total_terima = $tot_trm+$trm_sbl;
		$total_keluar = $tot_klr+$klr_sbl;
		$tot_saldo = $total_terima-$total_keluar;
		$totsaldo = number_format($tot_saldo,"2",",",".");
		
		if ($tgl=='2016-1-1'){
			$cRet .= '
			<tr>
				
				<TD align="left" colspan="2">Jumlah Tanggal &nbsp; '.$tanggal.'   </TD>
				
				<td align="right">'.$nilaiu_x.'</td>
				<TD align="right">0,00</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;" align="left" colspan="2">Jumlah Sampai Dengan Tanggal &nbsp; '.$tanggalsbl.'</TD>
				<td style="border-top:hidden;" align="right">0,00</td>
				<TD style="border-top:hidden;" align="right" >'.$nilai_3x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;" align="left" colspan="2">Jumlah Sampai Dengan Tanggal &nbsp; '.$tanggal.'</TD>
				<td style="border-top:hidden;" align="right">'.number_format($total_terima,"2",",",".").'</td>
				<TD style="border-top:hidden;" align="right">'.number_format($total_keluar,"2",",",".").'</TD>
			</tr>';
			
			$cRet .='</table>';
		}else{
			$cRet .= '
			<tr>
				
				<TD align="left" colspan="2">Jumlah Tanggal &nbsp; '.$tanggal.'   </TD>
				
				<td align="right">'.number_format($tot_trm,"2",",",".").'</td>
				<TD align="right">'.number_format($tot_klr,"2",",",".").'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;" align="left" colspan="2">Jumlah Sampai Dengan Tanggal &nbsp; '.$tanggalsbl.'</TD>
				<td style="border-top:hidden;" align="right">'.$nilai_2x.'</td>
				<TD style="border-top:hidden;" align="right" >'.$nilai_3x.'</TD>
			</tr>
			
			<tr>
				<TD style="border-top:hidden;" align="left" colspan="2">Jumlah Sampai Dengan Tanggal &nbsp; '.$tanggal.'</TD>
				<td style="border-top:hidden;" align="right">'.number_format($total_terima,"2",",",".").'</td>
				<TD style="border-top:hidden;" align="right">'.number_format($total_keluar,"2",",",".").'</TD>
			</tr>';
			
			$cRet .='</table>';	
		}
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
						<td width=\"50%\"></td>
						<td width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td width=\"50%\">Pada hari ini, tanggal $tanggal</td>
						<td width=\"50%\"></td>
					</tr>
					<tr>
						<td width=\"50%\">Oleh kami didapat dalam kas Rp. $totsaldo</td>
						<td width=\"50%\"></td>
					</tr>
					<tr>
						<td><i>(".$this->tukd_model->terbilang($tot_saldo).")</i></td>
						<td width=\"50%\"></td>
					</tr>
                    
                  </table>";
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">$jabatan</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(3);
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>Buku Kas Penerimaan dan Pengeluaran</title>");
			 echo $cRet;
		}else{
			//$this->_mpdf2('',$cRet,10,10,10,'0',$no_halaman,'');
			$this->_mpdf3('',$cRet,0,5,5,'0',$no_halaman,'');
		}	
	}
	
	function bkp2_gaji()
    {
        $data['page_title']= 'CETAK BKP2 GAJI';
        $this->template->set('title', 'CETAK BKP2 GAJI');   
        $this->template->load('template','tukd/sp2d/sp2d_bkp2_gj',$data) ; 
    }
	
	function ctk_bkp2_gaji($jns='', $ctk='',$ttd1='',$tgl=''){
		
		$lcttd = str_replace('123456789',' ',$this->uri->segment(5));
		$tanggal = $this->tanggal_format_indonesia($tgl);
		$z = strtotime("-1 day", strtotime($tgl));
		$n = date("Y-m-d", $z);
		$tanggalsbl = $this->tanggal_format_indonesia($n);
		$thn_ang = $this->session->userdata('pcThang');
		$prv = $this->db->query("SELECT provinsi,daerah from sclient where kd_skpd='1.20.00.00'");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
		$no_halaman = $this->uri->segment(7);
		$spasi = $this->uri->segment(8);
		
		$sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
		$sqlttd=$this->db->query($sqlttd1);
		 foreach ($sqlttd->result() as $rowttd)
			{
				$nip=$rowttd->nip;                    
				$nama= $rowttd->nm;
				$jabatan  = $rowttd->jab;
				$pangkat=$rowttd->pangkat;
			}
		
		
		switch ($jns){
                        case '0': //GAJI
						$where2="and a.jns_spp='4'";
						$judul="BUKU KAS PEMBANTU PENGELUARAN GAJI";
                            break;
                        case '1': //NON GAJI
						$where2="and a.jns_spp!='4'";
						$judul="BUKU KAS PEMBANTU PENGELUARAN NON GAJI";
                            break;
                                               
                    }
		$cRet = '';
		
			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>
					<td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>$judul TAHUN ANGGARAN $thn_ang</b></td>
				</tr>
				<tr>
					<td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
					<td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
				</tr>
				</table>
				<table style=\"border-collapse:collapse; border-color: black;font-size:13px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"$spasi\" >
				<thead> 
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-weight:bold;\">No. Urut</td>  
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"45%\" style=\"font-weight:bold\">Uraian</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"30%\" style=\"font-weight:bold\">Kode Rekening</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" width=\"20%\" style=\"font-weight:bold\">Pengeluaran (Rp)</td>
				</tr>
				<tr>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">1</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">2</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">3</td>
					<td align=\"center\" bgcolor=\"#CCCCCC\" style=\"border-top:solid 1px black\">4</td>
				</tr>
				<tr>
					<td align=\"center\"></td>
					<td align=\"left\">Tanggal : $tanggal</td>
					<td align=\"center\"></td>
					<td align=\"center\"></td>
				</tr>
				</thead>";
		
		$nilai3=0; 
		
		$sql = "SELECT * FROM (select 1 as urut, a.no_kas_bud as urut2,a.no_kas_bud, a.no_sp2d ,a.tgl_sp2d, a.kd_skpd,a.keperluan, 
a.jns_spp,a.jenis_beban,a.nmrekan,c.pimpinan,
'' kd_kegiatan,''kd_rek5,0 nilai, 0 no_bukti,
				count(a.no_sp2d) as jumlah from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
										INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
										INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd
				where a.status_bud='1' and a.tgl_kas_bud='$tgl' $where2
				GROUP BY a.no_kas_bud, a.no_sp2d ,a.tgl_sp2d, a.kd_skpd,a.keperluan,a.jns_spp,a.jenis_beban,a.nmrekan,c.pimpinan
				UNION ALL
				select 2 urut,'' no_kas_bud,a.no_kas_bud as urut2 , '' ,'', a.kd_skpd,'' keperluan,
			'','','','',d.kd_kegiatan, d.kd_rek5,d.nilai,d.no_bukti, 
				0 as jumlah from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
										INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
										INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd
				where a.status_bud='1' and a.tgl_kas_bud='$tgl' $where2
				GROUP BY a.no_kas_bud, a.no_sp2d ,a.tgl_sp2d, a.kd_skpd,a.keperluan, d.kd_kegiatan, d.kd_rek5,d.nilai,d.no_bukti) a
				order by cast(no_kas_bud as int),urut, kd_kegiatan,kd_rek5
				";
		$hasil = $this->db->query($sql);
		
		foreach ($hasil->result() as $row){
			
			$no_urut     = $row->urut;	
			$no_urut2    = $row->urut2;	
			$no_kas_bud  = $row->no_kas_bud;	
			$no_sp2d     = $row->no_sp2d;
			$tgl_sp2d    = $row->tgl_sp2d;
			$jns_spp    = $row->jns_spp;
			$jenis_beban  = $row->jenis_beban;
			$nmrekan    = $row->nmrekan;
			$pimpinan    = $row->pimpinan;
			$kd_skpd    = $row->kd_skpd;
			$tglsp2d     = $this->tukd_model->tanggal_format_indonesia($tgl_sp2d);
			$keperluan   = $row->keperluan;
			$nilai       = $row->nilai;
			$nilaix = empty($nilai) || $nilai == 0 ? '' :number_format($nilai,"2",",",".");                     
			$kd_kegiatan = $row->kd_kegiatan;
			$kd_rek5      = $this->dotrek($row->kd_rek5);
			$jumlah      = ($row->jumlah)+1;
			$nilai3=$nilai3+$nilai;
												
			if ($kd_kegiatan==''){
				$kode="";
			} else {
				$kode="$kd_kegiatan.$kd_rek5";
			}
		
			if($no_urut=='1'){
				 if(($jns_spp=='6') && ($jenis_beban=='3')){
						$cRet .= '<tr>
						<td valign="top" rowspan="0">'.$no_urut2.'</td>
						<td valign="top" rowspan="0">'.$pimpinan.', '.$nmrekan.'<br> SP2D Tanggal : '.$tglsp2d.'
										  <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nomor &nbsp;&nbsp;: '.$no_sp2d.'
										  
						</td>
						<TD align="right" ></TD>
						<TD align="right" ></TD>
						</tr>';
				} else {
						$sqlnam="SELECT TOP 1 * FROM ms_ttd WHERE kd_skpd = '$kd_skpd' AND kode='BK' ";
							 $sqlnam=$this->db->query($sqlnam);
							 foreach ($sqlnam->result() as $rownam)
							{
								$nama_ben=$rownam->nama;                    
								$jabat_ben=$rownam->jabatan;                    
							}
							
						$nama_ben = empty($nama_ben) ? 'Belum Ada data Bendahara' :$nama_ben;
						$jabat_ben = empty($jabat_ben) ? ' ' :$jabat_ben;
						
						$cRet .= '<tr>
						<td valign="top" rowspan="0">'.$no_urut2.'</td>
						<td valign="top" rowspan="0">'.$nama_ben.', '.$jabat_ben.', '.$this->rka_model->get_nama($kd_skpd,'nm_skpd','ms_skpd','kd_skpd').'<br>'.$keperluan.'
						   <br>SP2D Tanggal : '.$tglsp2d.'
						   <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nomor &nbsp;&nbsp;: '.$no_sp2d.'
						   
						</td>
						<TD align="right" ></TD>
						<TD align="right" ></TD>
						</tr>';	 
				 }
			} else{
					$cRet .= '<tr>
					<td style="border-top:hidden;"></td>
					<td style="border-top:hidden;"></td>
					<td valign="top" style="border-top:hidden;">'.$kode.'</td>
					<td valign="top" align="right" style="border-top:hidden;">'.$nilaix.'</td>
					</tr>';
			  }
		}
		if($jns=='0'){
		$sql2 = "select sum(d.nilai) as nilai 
				from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
										INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
										INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd
				where a.status_bud='1' and a.tgl_kas_bud<'$tgl' and a.jns_spp='4'";
		}else{
		$sql2 = "select sum(d.nilai) as nilai 
				from trhsp2d a INNER JOIN trhspm b on a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd 
										INNER JOIN trhspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
										INNER JOIN trdspp d on c.no_spp=d.no_spp and c.kd_skpd=d.kd_skpd
				where a.status_bud='1' and a.tgl_kas_bud<'$tgl' and a.jns_spp!='4'";	
		}
		$hasil2 = $this->db->query($sql2);
		foreach ($hasil2->result() as $row){
		$nilai2 = $row->nilai;
		$nilai2x      = number_format($nilai2,"2",",",".");
		}		
		
		
		
		$total  = $nilai3+$nilai2;
		$totalx = number_format($total,"2",",","."); 
		$nilai3x = number_format($nilai3,"2",",","."); 
		
		$cRet .= '
		<tr>
			<TD></TD>
			<TD align="left" colspan="2" style="border-left:hidden;">Jumlah Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal.' </TD>
			<TD align="right" >'.$nilai3x.'</TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;"></TD>
			<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah Sampai Tanggal : '.$tanggalsbl.' </TD>
			<TD style="border-top:hidden;" align="right" >'.$nilai2x.'</TD>
		</tr>
		
		<tr>
			<TD style="border-top:hidden;"></TD>
			<TD style="border-top:hidden;border-left:hidden;" align="left" colspan="2">Jumlah s.d Tanggal &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: '.$tanggal.' </TD>
			<TD align="right" >'.$totalx.'</TD>
		</tr>';
		
		 $cRet .='</table>';
		
		$cRet .="<table style=\"font-size:12px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					    <td align=\"center\" width=\"50%\">$jabatan</td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                              
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
					</tr>                                       
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\"><u>$nama</u></td>
					</tr>
                    <tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">$pangkat</td>
					</tr>
					<tr>
						<td align=\"center\" width=\"50%\">&nbsp;</td>
						<td align=\"center\" width=\"50%\">NIP. $nip</td>
					</tr>
                    
                  </table>";
		
		$print = $this->uri->segment(4);
		
		if($print==0){
			 $data['prev']= $cRet;    
			 echo ("<title>Buku Kas Pembantu Pengeluaran</title>");
			 echo $cRet;
		}else{
			//$this->_mpdf2('',$cRet,10,10,10,'0',$no_halaman,'');
			$this->_mpdf3('',$cRet,0,5,5,'0',$no_halaman,'');
		}
		
	}
	

	function cetak_buku_kas_pembantu()
    {
        $data['page_title']= 'BUKU KAS PENERIMAAN';
        $this->template->set('title', 'BUKU KAS PENERIMAAN');   
        $this->template->load('template','tukd/sp2d/ctk_bkp2',$data) ; 
    }
	
    function cari_spp()
	{
		
	$lccr =  $this->input->post('pencarian');
        $this->index('0','trhspp','no_spp','kd_skpd','SPP','spp',$lccr);
	}
    
	function index($offset=0,$lctabel,$field,$field1,$judul,$list,$lccari)
	{
		$data['page_title'] = " $judul";
		
		//$total_rows = $this->master_model->get_count($lctabel);
        if(empty($lccari)){
            $total_rows = $this->tukd_model->get_count($lctabel);
            $lc = "/.$lccari";
        }else{
            $total_rows = $this->tukd_model->get_count_teang($lctabel,$field,$field1,$lccari);
            $lc = "";
        }
		// pagination        
        if(empty($lccari)){
		$config['base_url']		= site_url("tukd/".$list);
        }else{
        $config['base_url']		= site_url("tukd/cari_".$list);    
        }
		$config['total_rows'] 	= $total_rows;
		$config['per_page'] 	= '10';
		$config['uri_segment'] 	= 3;
		$config['num_links'] 	= 5;
		$config['full_tag_open'] = '<ul class="page-navi">';
		$config['full_tag_close'] = '</ul>';
		$config['num_tag_open'] = '<li>';
		$config['num_tag_close'] = '</li>';
		$config['cur_tag_open'] = '<li class="current">';
		$config['cur_tag_close'] = '</li>';
		$config['prev_link'] = '&lt;';
		$config['prev_tag_open'] = '<li>';
		$config['prev_tag_close'] = '</li>';
		$config['next_link'] = '&gt;';
		$config['next_tag_open'] = '<li>';
		$config['next_tag_close'] = '</li>';
		$config['last_link'] = 'Last';
		$config['last_tag_open'] = '<li>';
		$config['last_tag_close'] = '</li>';
		$config['first_link'] = 'First';
		$config['first_tag_open'] = '<li>';
		$config['first_tag_close'] = '</li>';
		$limit            		= $config['per_page'];  
		$offset         		= $this->uri->segment(3);  
		$offset         		= ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
		  
		if(empty($offset))  
		{  
			$offset=0;  
		}
	    //$data['isi']=$this->aktif_menu();
        //$data['isi']=$this->aktif_menu(); 
        //$data['isi']= $this->session->userdata('lcisi');         
		//$data['list'] 		= $this->master_model->getAll($lctabel,$field,$limit, $offset);
         if(empty($lccari)){     
		$data['list'] 		= $this->master_model->getAll($lctabel,$field,$limit, $offset);
        }else {
            $data['list'] 		= $this->master_model->getCari($lctabel,$field,$field1,$limit,$offset,$lccari);
        }
		$data['num']		= $offset;
		$data['total_rows'] = $total_rows;
		
				$this->pagination->initialize($config);
		$a=$judul;
		$this->template->set('title', 'PENATAUSAHAAN ');
		$this->template->load('template', "tukd/".$list."/list", $data);
	}
    
    function backup()
    {
   	    $data['status_upload']= 'Backup Restore';
        $data['page_title']= 'Backup';
        $this->template->set('title', 'Backup');   
        $this->template->load('template','backup/backup',$data) ; 
    }
    
	function lamp_aset()
    {
        $data['page_title']= 'INPUT LAMP NERACA';
        $this->template->set('title', 'INPUT LAMP NERACA');   
        $this->template->load('template','tukd/transaksi/tambah_lamp_aset',$data) ; 
    }
	
	function cetak_lamp_aset()
    {
        $data['page_title']= 'CETAK LAMP NERACA';
        $this->template->set('title', 'CETAK LAMP NERACA');   
        $this->template->load('template','tukd/transaksi/cetak_lamp_aset',$data) ; 
    }
	
	function cetak_penyu_lamp_aset()
    {
        $data['page_title']= 'CETAK LAMP NERACA';
        $this->template->set('title', 'CETAK LAMP NERACA');   
        $this->template->load('template','tukd/transaksi/cetak_penyu_lamp_aset',$data) ; 
    }
	
	function cetak_umur_piutang()
    {
        $data['page_title']= 'CETAK ANALISIS UMUR PIUTANG';
        $this->template->set('title', 'CETAK ANALISIS UMUR PIUTANG');   
        $this->template->load('template','tukd/transaksi/cetak_umur_piutang',$data) ; 
    }
	
	
	function transfer(){
   	    $data['page_title']= 'Restore Transfer';
        $this->template->set('title', 'Restore Transfer');   
        $this->template->load('template','backup/transfer',$data) ; 
    }
    
	
    function sppls()
    {
        $data['page_title']= 'INPUT S P P';
        $this->template->set('title', 'INPUT S P P');   
        $this->template->load('template','tukd/spp/tambah_spp_ls',$data) ; 
    }
    
    function daftar_penguji()
    {
        $data['page_title']= 'INPUT DAFTAR PENGUJI';
        $this->template->set('title', 'INPUT DAFTAR PENGUJI');   
        $this->template->load('template','tukd/sp2d/daftar_penguji',$data) ; 
    }
    
    function register_pajak()
    {
        $data['page_title']= 'REGISTER POTONGAN PAJAK';
        $this->template->set('title', 'REGISTER POTONGAN PAJAK');   
        $this->template->load('template','tukd/register/register_pajak',$data) ; 
    }


    function sppup()
    {
        $data['page_title']= 'INPUT S P P U P';
        $this->template->set('title', 'INPUT S P P U P');   
        $this->template->load('template','tukd/spp/tambah_spp_up',$data) ; 
    }
    
	function terima_sp2d()
    {
        $data['page_title']= 'PENERIMAAN S P 2 D';
        $this->template->set('title', 'PENERIMAAN S P 2 D');   
        $this->template->load('template','tukd/sp2d/terima_sp2d',$data) ; 
    }
	
    function sppgu()
    {
        $data['page_title']= 'INPUT S P P G U';
        $this->template->set('title', 'INPUT S P P G U');   
        $this->template->load('template','tukd/spp/tambah_spp_gu',$data) ; 
    }
    
	function ctk_umur_piutang($skpd='', $tahun='', $ctk=''){
    
		$lntahunang = $tahun;       
		$bulan = 12+1;
		$sql =  " select nm_skpd from ms_skpd where kd_skpd='$skpd'";
			$hasil = $this->db->query($sql);
            foreach ($hasil->result() as $row)
				{
					$nama_skpd = $row->nm_skpd;
				}
					
		$cRet = '';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td colspan=\"5\" style=\"border-top:none;border-right:none;border-left:none;font-size:14px\" align=\"center\">
                    <b>PEMERINTAH KABUPATEN SANGGAU</b> <br>
					<b>".strtoupper($nama_skpd)."</b> <br>
                    <b>ANALISIS UMUR PIUTANG</b><BR>
                    <b>PER 31 DESEMBER $lntahunang </b>
                    <BR>&nbsp;                                        
                    </td>           
                </tr>
				</table>
				";
		 $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td width=\"5%\"  align=\"left\">
                    SKPD </td> 
					<td> :</td>
					<td> $skpd - $nama_skpd <br></td>
                </tr>
				<tr>
                    <td width=\"5%\"  align=\"left\">
                    &nbsp;</td> 
                </tr>
				</table>
				";
		
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun<br>Penetapan</td>
					<td width=\"10%\" align=\"center\" style=\"font-size:12px\">Bulan<br>Penetapan</td>
					<td width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
					<td width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Piutang</td>
					<td width=\"10%\" align=\"center\" style=\"font-size:12px\">Umur<br>Piutang</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">Kualitas<br>Piutang</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">Taksiran<br>Piutang Tak<br>Tertagih</td>
					<td width=\"10%\" align=\"center\" style=\"font-size:12px\">Penyisihan<br>Piutang</td>
					<td width=\"10%\" align=\"center\" style=\"font-size:12px\">Nilai Buku<br>Piutang Tahun<br>$lntahunang</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                </tr>
				</thead>";
				
				$sql = "select kd_rek3 kode1, kd_rek3 kode, UPPER(nm_rek3) nama, '' lokasi, 0 tahun, 0 bulan, 0 jumlah, 0 sal_awal, 
						0 kurang, 0 tambah, 0 tahun_n, '' keterangan, 0 umur_t, 0 umur_b, '' kualitas, 0 penyi_piu from lamp_aset 
						where kd_skpd='$skpd' and kd_rek3 in (113,114) and tahun<= $lntahunang
						union
						select LEFT(kd_rek5,5) kode1, LEFT(kd_rek5,5) kode, (SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64 = LEFT(kd_rek5,5)) nama, 
						'' lokasi, 0 tahun, 0 bulan, 0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' keterangan, 0 umur_t, 
						0 umur_b, '' kualitas, 0 penyi_piu from lamp_aset 
						where kd_skpd='$skpd' and kd_rek3 in (113,114) and tahun<= $lntahunang
						union all
						select kode1, kode, nama, lokasi, tahun, bulan, jumlah,  sal_awal,  kurang,  
						tambah, tahun_n, keterangan, umur_t, isnull(umur_b,1) umur_b, case when left(kode1,5)=11301 and umur_t<=1 then 'Lancar'
						when left(kode1,5)=11301 and umur_t>1 and umur_t<=2 then 'Kurang Lancar'
						when left(kode1,5)=11301 and umur_t>2 and umur_t<=5 then 'Diragukan'
						when left(kode1,5)=11301 and umur_t>5 then 'Macet'
						when left(kode1,5)=11302 and umur_t<1 and isnull(umur_b,1)<=1 then 'Lancar'
						when left(kode1,5)=11302 and umur_t<1 and isnull(umur_b,1)>1 and isnull(umur_b,1)<=3 then 'Kurang Lancar'
						when left(kode1,5)=11302 and umur_t<1 and isnull(umur_b,1)>3 and isnull(umur_b,1)<=12 then 'Diragukan'
						when left(kode1,5)=11302 and umur_t>=1 then 'Macet'
						when left(kode1,5) not in (11301,11302) and umur_t<1 and isnull(umur_b,1)<1 then 'Lancar'
						when left(kode1,5) not in (11301,11302) and umur_t<1 and isnull(umur_b,1)>1 and isnull(umur_b,1)<=1 then 'Kurang Lancar'
						when left(kode1,5) not in (11301,11302) and umur_t<1 and isnull(umur_b,1)>2 and isnull(umur_b,1)<=2 then 'Diragukan'
						when left(kode1,5) not in (11301,11302) and umur_t>=0 and isnull(umur_b,1)>3 and isnull(umur_b,1)<=3 then 'Macet'
						else 'Tidak Diketahui' end as kualitas,
						case when left(kode1,5)=11301 and umur_t<=1 then 
						cast((sal_awal-kurang+tambah+tahun_n) * 0.005 as decimal(20,2))
						when left(kode1,5)=11301 and umur_t>1 and umur_t<=2 then 
						cast((sal_awal-kurang+tambah+tahun_n) * 0.1 as decimal(20,2))
						when left(kode1,5)=11301 and umur_t>2 and umur_t<=5 then
						cast((sal_awal-kurang+tambah+tahun_n)* 0.5 as decimal(20,2))
						when left(kode1,5)=11301 and umur_t>5 then
						cast((sal_awal-kurang+tambah+tahun_n) * 1 as decimal(20,2))
						when left(kode1,5)=11302 and umur_t<1 and isnull(umur_b,1)<=1 then
						cast((sal_awal-kurang+tambah+tahun_n) * 0.005 as decimal(20,2))
						when left(kode1,5)=11302 and umur_t<1 and isnull(umur_b,1)>1 and isnull(umur_b,1)<=3 then 
						cast((sal_awal-kurang+tambah+tahun_n) * 0.1 as decimal(20,2))
						when left(kode1,5)=11302 and umur_t<1 and isnull(umur_b,1)>3 and isnull(umur_b,1)<=12 then 
						cast((sal_awal-kurang+tambah+tahun_n)* 0.5 as decimal(20,2))
						when left(kode1,5)=11302 and umur_t>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n) * 1 as decimal(20,2))
						when left(kode1,5) not in (11301,11302) and umur_t<1 and isnull(umur_b,1)<1 then 
						cast((sal_awal-kurang+tambah+tahun_n) * 0.005 as decimal(20,2))
						when left(kode1,5) not in (11301,11302) and umur_t<1 and isnull(umur_b,1)>1 and isnull(umur_b,1)<=1 then 
						cast((sal_awal-kurang+tambah+tahun_n) * 0.1 as decimal(20,2))
						when left(kode1,5) not in (11301,11302) and umur_t<1 and isnull(umur_b,1)>2 and isnull(umur_b,1)<=2 then 
						cast((sal_awal-kurang+tambah+tahun_n)* 0.5 as decimal(20,2))
						when left(kode1,5) not in (11301,11302) and umur_t>=0 and isnull(umur_b,1)>3 and isnull(umur_b,1)<=3 then 
						cast((sal_awal-kurang+tambah+tahun_n) * 1 as decimal(20,2))
						else 'Tidak Diketahui' end as penyi_piu 
						from
						(SELECT kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, lokasi, tahun, isnull(bulan,1) bulan, jumlah,   
						sal_awal,  kurang,  tambah, tahun_n, keterangan, case when $bulan-isnull(bulan,1)=12 then $lntahunang-tahun+1 else $lntahunang-tahun end 
						as umur_t, case when $bulan-isnull(bulan,1)=12 then 0 else $bulan-isnull(bulan,1) end as umur_b FROM lamp_aset where kd_rek3 
						in (113,114) and kd_skpd ='$skpd' and tahun<= $lntahunang) a
						union all
						select LEFT(kode1,5)+'988' kode1, '' kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64 = LEFT(kode1,5)) nama, 
						'' lokasi, 0 tahun, 0 bulan, 0 jumlah, sum(sal_awal) sal_awal, sum(kurang) kurang, 
						sum(tambah) tambah, sum(tahun_n) tahun_n, '' keterangan, 0 umur_t, 
						0 umur_b, '' kualitas, sum(penyi_piu) penyi_piu
						from (select kode1, kode, nama, lokasi, tahun, bulan, jumlah,  sal_awal,  kurang,  
						tambah, tahun_n, keterangan, umur_t, isnull(umur_b,1) umur_b, case when left(kode1,5)=11301 and umur_t<=1 then 'Lancar'
						when left(kode1,5)=11301 and umur_t>1 and umur_t<=2 then 'Kurang Lancar'
						when left(kode1,5)=11301 and umur_t>2 and umur_t<=5 then 'Diragukan'
						when left(kode1,5)=11301 and umur_t>5 then 'Macet'
						when left(kode1,5)=11302 and umur_t<1 and isnull(umur_b,1)<=1 then 'Lancar'
						when left(kode1,5)=11302 and umur_t<1 and isnull(umur_b,1)>1 and isnull(umur_b,1)<=3 then 'Kurang Lancar'
						when left(kode1,5)=11302 and umur_t<1 and isnull(umur_b,1)>3 and isnull(umur_b,1)<=12 then 'Diragukan'
						when left(kode1,5)=11302 and umur_t>=1 then 'Macet'
						when left(kode1,5) not in (11301,11302) and umur_t<1 and isnull(umur_b,1)<1 then 'Lancar'
						when left(kode1,5) not in (11301,11302) and umur_t<1 and isnull(umur_b,1)>1 and isnull(umur_b,1)<=1 then 'Kurang Lancar'
						when left(kode1,5) not in (11301,11302) and umur_t<1 and isnull(umur_b,1)>2 and isnull(umur_b,1)<=2 then 'Diragukan'
						when left(kode1,5) not in (11301,11302) and umur_t>=0 and isnull(umur_b,1)>3 and isnull(umur_b,1)<=3 then 'Macet'
						else 'Tidak Diketahui' end as kualitas,
						case when left(kode1,5)=11301 and umur_t<=1 then 
						cast((sal_awal-kurang+tambah+tahun_n) * 0.005 as decimal(20,2))
						when left(kode1,5)=11301 and umur_t>1 and umur_t<=2 then 
						cast((sal_awal-kurang+tambah+tahun_n) * 0.1 as decimal(20,2))
						when left(kode1,5)=11301 and umur_t>2 and umur_t<=5 then
						cast((sal_awal-kurang+tambah+tahun_n)* 0.5 as decimal(20,2))
						when left(kode1,5)=11301 and umur_t>5 then
						cast((sal_awal-kurang+tambah+tahun_n) * 1 as decimal(20,2))
						when left(kode1,5)=11302 and umur_t<1 and isnull(umur_b,1)<=1 then
						cast((sal_awal-kurang+tambah+tahun_n) * 0.005 as decimal(20,2))
						when left(kode1,5)=11302 and umur_t<1 and isnull(umur_b,1)>1 and isnull(umur_b,1)<=3 then 
						cast((sal_awal-kurang+tambah+tahun_n) * 0.1 as decimal(20,2))
						when left(kode1,5)=11302 and umur_t<1 and isnull(umur_b,1)>3 and isnull(umur_b,1)<=12 then 
						cast((sal_awal-kurang+tambah+tahun_n)* 0.5 as decimal(20,2))
						when left(kode1,5)=11302 and umur_t>=1 then 
						cast((sal_awal-kurang+tambah+tahun_n) * 1 as decimal(20,2))
						when left(kode1,5) not in (11301,11302) and umur_t<1 and isnull(umur_b,1)<1 then 
						cast((sal_awal-kurang+tambah+tahun_n) * 0.005 as decimal(20,2))
						when left(kode1,5) not in (11301,11302) and umur_t<1 and isnull(umur_b,1)>1 and isnull(umur_b,1)<=1 then 
						cast((sal_awal-kurang+tambah+tahun_n) * 0.1 as decimal(20,2))
						when left(kode1,5) not in (11301,11302) and umur_t<1 and isnull(umur_b,1)>2 and isnull(umur_b,1)<=2 then 
						cast((sal_awal-kurang+tambah+tahun_n)* 0.5 as decimal(20,2))
						when left(kode1,5) not in (11301,11302) and umur_t>=0 and isnull(umur_b,1)>3 and isnull(umur_b,1)<=3 then 
						cast((sal_awal-kurang+tambah+tahun_n) * 1 as decimal(20,2))
						else 'Tidak Diketahui' end as penyi_piu 
						from
						(SELECT kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, lokasi, tahun, isnull(bulan,1) bulan, jumlah,   
						sal_awal,  kurang,  tambah, tahun_n, keterangan, case when $bulan-isnull(bulan,1)=12 then $lntahunang-tahun+1 else $lntahunang-tahun end 
						as umur_t, case when $bulan-isnull(bulan,1)=12 then 0 else $bulan-isnull(bulan,1) end as umur_b FROM lamp_aset where kd_rek3 
						in (113,114) and kd_skpd ='$skpd' and tahun<= $lntahunang) a) a group by left(kode1,5)
						union
						select LEFT(kd_rek5,5)+'9999' kode1, '' kode, '' nama, '' lokasi, 0 tahun, 0 bulan, 0 jumlah, 0 sal_awal, 
						0 kurang, 0 tambah, 0 tahun_n, '' keterangan, 0 umur_t, 0 umur_b, '' kualitas, 0 penyi_piu from lamp_aset 
						where kd_skpd='$skpd' and kd_rek3 in (113,114) and tahun<= $lntahunang
						order by kode1, tahun, bulan  
";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode1 = $row->kode1;
                       $kode = $row->kode;
					   $nama = $row->nama;
					   $bln = $row->bulan;
                       $tahun = $row->tahun;
                       $lokasi = $row->lokasi;
                       $jumlah = $row->jumlah;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $keterangan = $row->keterangan;
					   $umur_t = $row->umur_t;
					   $umur_b = $row->umur_b;
					   $kualitas = $row->kualitas;
					   $penyi_piu = $row->penyi_piu;
					   $nilai_piu = $akhir-$penyi_piu;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $bln==0 ? $bln = '' : $bln=number_format($bln,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $umur_t==0 ? $umur_t = '' : $umur_t=number_format($umur_t,"0",",",".");
					   $umur_b==0 ? $umur_b = '' : $umur_b=number_format($umur_b,"0",",",".");
					   
					   if ($umur_b==0 && strlen($kode1)==7){$umur_piu=$umur_t." Tahun";}
					   elseif (strlen($kode1)!=7){$umur_piu = '';}
					   else {$umur_piu=$umur_t." Tahun " .$umur_b. "Bulan";}
					   
					   if($kualitas=='Lancar'){
					   $taksiran="0,5%";}
					   elseif($kualitas=='Kurang Lancar'){
					   $taksiran="10%";}
					   elseif($kualitas=='Diragukan'){
					   $taksiran="50%";}
					   else{
					   $taksiran="100%";}
						
					   if (strlen($kode1)==7){$tahun=$tahun;}
					   else {$tahun = '';}
					   
					   if (strlen($kode1)==7 || strlen($kode1)==8){$akhir=number_format($akhir,"2",",",".");}
					   else {$akhir = '';}
					   
					   if (strlen($kode1)==7){$taksiran=$taksiran;}
					   else {$taksiran = '';}
					   
					   if (strlen($kode1)==7 || strlen($kode1)==8){$penyi_piu=number_format($penyi_piu,"2",",",".");}
					   else {$penyi_piu = '';}
					   
					   if (strlen($kode1)==7 || strlen($kode1)==8){$nilai_piu=number_format($nilai_piu,"2",",",".");}
					   else {$nilai_piu = '';}
					   $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$bln</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$umur_piu</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kualitas</td> 
							   <td align=\"center\" style=\"font-size:12px\">$taksiran</td> 
							   <td align=\"center\" style=\"font-size:12px\">$penyi_piu</td>
							   <td align=\"center\" style=\"font-size:12px\">$nilai_piu</td> 
							</tr>";    
                    }
				
				/* if($ctk==0){
 
         $data['prev']= $cRet;    
		 echo ("<title>Rincian Neraca $nama_rek</title>");
		 echo $cRet;}
		 else{

	    $this->_mpdf('',$cRet,10,10,10,0,1,'');
} */

		$data['prev']= $cRet;
		$judul  = "Analisis_Umur_Piutang_$skpd";
        $this->template->set('title', 'UMUR PIUTANG $tahun');        
        switch($ctk) {
		case 0;
              $data['prev']= $cRet;    
		 echo ("<title>UMUR PIUTANG $tahun</title>");
		 echo $cRet;
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,0,1,'');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        } 
		
		
	}
    
	function ctk_lamp_aset($skpd='',$rek3='',$ctk=''){
        $lntahunang = $this->session->userdata('pcThang');       
        if($rek3==15){
			$nama_rek='Aset Lainnya';
		}else{
			$nama_rek=$this->tukd_model->get_nama($rek3,'nm_rek3','ms_rek3_64','kd_rek3');
		}
		$nm_skpd =  $this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');  
		$cRet = '';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td colspan=\"5\" style=\"border-top:none;border-right:none;border-left:none;font-size:14px\" align=\"center\">
                    <b>PEMERINTAH KABUPATEN SANGGAU</b> <br>
                    <b>RINCIAN NERACA ".strtoupper($nama_rek)."</b><BR>
                    <b>PER 31 DESEMBER $lntahunang </b>
                    <BR>&nbsp;                                        
                    </td>           
                </tr>
				</table>
				";
		 $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td width=\"5%\"  align=\"left\">
                    SKPD </td> 
					<td> :</td>
					<td> $skpd - $nm_skpd <br></td>
                </tr>
				<tr>
                    <td width=\"5%\"  align=\"left\">
                    &nbsp;</td> 
                </tr>
				</table>
				";
		if ($rek3==131){
		$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Lokasi<br>Kota/Kab.</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Alamat</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No. Sertifikat</td>
					<td rowspan=\"2\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Luas</td>
					<td rowspan=\"2\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
				</tr>
				</thead>";
				
				$sql = "SELECT kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' lokasi,'' alamat, '' sert, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '131' and kd_skpd = '$skpd'
						UNION
						SELECT LEFT(kd_rek5,5) AS kode1, LEFT(kd_rek5,5) AS kode,(SELECT UPPER(nm_rek4_64) FROM ms_rek4_64 WHERE kd_rek4_64 = LEFT(kd_rek5,5)) AS nama, ''  tahun,  '' lokasi,'' alamat, '' sert, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset  where kd_rek3 = '131' and kd_skpd = '$skpd'
						UNION
						SELECT kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' lokasi,'' alamat, '' sert, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '131' and kd_skpd = '$skpd'
						UNION ALL
						SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (kd_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  lokasi, alamat,  sert, luas,  satuan, sal_awal,  kurang,  tambah, tahun_n, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where kd_rek3 = '131' and kd_skpd = '$skpd'
						UNION ALL
						SELECT LEFT(kd_rek5,5)+'99' AS kode1, '' AS kode,(SELECT 'TOTAL '+UPPER(nm_rek4_64) FROM ms_rek4_64 WHERE kd_rek4_64 = LEFT(kd_rek5,5)) AS nama, ''  tahun,  '' lokasi,'' alamat, '' sert, 0 luas, '' satuan,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '131' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, lokasi, alamat, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $lokasi = $row->lokasi;
                       $alamat = $row->alamat;
                       $sert = $row->sert;
                       $luas = $row->luas;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $luas==0 ? $luas = '' : $luas=number_format($luas,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$alamat</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sert</td> 
							   <td align=\"center\" style=\"font-size:12px\">$luas</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
                    }
					
				$sql = "SELECT   SUM(sal_awal) as sal_awal,  sum(kurang) as kurang,  SUM(tambah) as tambah, sum(tahun_n) as tahun_n FROM lamp_aset where kd_rek3 = '131' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL TANAH</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
                    }	
					
					
				$cRet .="</table>";
				} else if (($rek3==133) or ($rek3==136) or ($rek3==134)){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Fungsi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Lokasi<br>Kota/Kab.</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Alamat</td>
					<td rowspan=\"2\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Luas</td>
					<td rowspan=\"2\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode, (SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64 = LEFT(kd_rek5,5)) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  lokasi, alamat,  fungsi, luas,  satuan, sal_awal,  kurang,  tambah, tahun_n, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64 = LEFT(kd_rek5,5)) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, lokasi, alamat, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $lokasi = $row->lokasi;
                       $alamat = $row->alamat;
                       $fungsi = $row->fungsi;
                       $luas = $row->luas;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $luas==0 ? $luas = '' : $luas=number_format($luas,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$fungsi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$alamat</td> 
							   <td align=\"center\" style=\"font-size:12px\">$luas</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                    }
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal,  SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
					   $nama = $row->nama;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
                    }
				$cRet .="</table>";
				}else if ($rek3==132){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No Polisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' merk,'' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT kd_rek5 as kode1,kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' merk, '' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, jumlah,  satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $merk = $row->merk;
                       $no_polisi = $row->no_polisi;
                       $jumlah = $row->jumlah;
                       $harga_satuan = $row->harga_satuan;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$no_polisi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}  
				$sql = "SELECT SUM(sal_awal) sal_awal,SUM(kurang) kurang,SUM(tambah) tambah,SUM(tahun_n) tahun_n FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL PERALATAN DAN MESIN</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}
				$cRet .="</table>";
				}else if (($rek3==135) or ($rek3==117)){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' merk,0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk,0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' merk,0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, jumlah,  satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk,0 jumlah, '' satuan, 0 harga_satuan,   SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $merk = $row->merk;
                       $jumlah = $row->jumlah;
                       $harga_satuan = $row->harga_satuan;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
					}
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
					   $nama = $row->nama;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
					}	
				$cRet .="</table>";
				}else if ($rek3==116){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Nama & No. Polisi<br>Asuransi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Rincian Beban</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 

                </tr>
				</thead>";
				
				$sql = "SELECT kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' no_polis,0 jumlah, '' rincian_beban,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' no_polis,0 jumlah, '' rincian_beban,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  no_polis, jumlah,  rincian_beban, sal_awal,  kurang,  tambah, tahun_n, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' no_polis,0 jumlah, '' rincian_beban,   SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $no_polis = $row->no_polis;
                       $jumlah = $row->jumlah;
                       $rincian_beban = $row->rincian_beban;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$no_polis</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$rincian_beban</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
					} 
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah,SUM(tahun_n) tahun_n FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
					}			
				$cRet .="</table>";
				}else if ($rek3==114){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian Akun</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Piutang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Piutang<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
					<td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Awal</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Koreksi</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">Sudah</td>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 

                </tr>
				</thead>";
				
				$sql = "SELECT kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun, 0 jumlah, 0 piutang_awal, 0 piutang_koreksi, 0 piutang_sudah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun, 0 jumlah, 0 piutang_awal, 0 piutang_koreksi, 0 piutang_sudah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun, 0 jumlah, 0 piutang_awal, 0 piutang_koreksi, 0 piutang_sudah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun, jumlah,  piutang_awal, piutang_koreksi, piutang_sudah, sal_awal,  kurang,  tambah, tahun_n, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun, 0 jumlah, 0 piutang_awal, 0 piutang_koreksi, 0 piutang_sudah, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $jumlah = $row->jumlah;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $piutang_awal = $row->piutang_awal;
                       $piutang_koreksi = $row->piutang_koreksi;
                       $piutang_sudah = $row->piutang_sudah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $keterangan = $row->keterangan;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $piutang_awal==0 ? $piutang_awal = '' : $piutang_awal=number_format($piutang_awal,"2",",",".");
					   $piutang_koreksi==0 ? $piutang_koreksi = '' : $piutang_koreksi=number_format($piutang_koreksi,"2",",",".");
					   $piutang_sudah==0 ? $piutang_sudah = '' : $piutang_sudah=number_format($piutang_sudah,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$piutang_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$piutang_koreksi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$piutang_sudah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}
				$cRet .="</table>";
				}else if ($rek3==113){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian Akun</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Lokasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Piutang<br>Awal</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Piutang<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 

                </tr>
				</thead>";
				
				$sql = "SELECT kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, '' lokasi, ''  tahun, 0 jumlah, 0 piutang_awal, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, '' lokasi, ''  tahun, 0 jumlah, 0 piutang_awal,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, '' lokasi, ''  tahun, 0 jumlah, 0 piutang_awal, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, lokasi, tahun, jumlah,  piutang_awal, sal_awal,  kurang,  tambah, tahun_n, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, '' lokasi, ''  tahun, 0 jumlah, 0 piutang_awal,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $lokasi = $row->lokasi;
                       $jumlah = $row->jumlah;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $piutang_awal = $row->piutang_awal;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $keterangan = $row->keterangan;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $piutang_awal==0 ? $piutang_awal = '' : $piutang_awal=number_format($piutang_awal,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"left\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$piutang_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
					}
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}		
				$cRet .="</table>";
				}else if ($rek3==112){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian Akun</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Dasar<br>Hukum</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kepemilikan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Investasi<br>Awal</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Investasi<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 

                </tr>
				</thead>";
				
				$sql = "SELECT kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, '' hukum, ''  tahun, '' kepemilikan, 0 jumlah, 0 investasi_awal, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, '' hukum, ''  tahun, '' kepemilikan, 0 jumlah, 0 investasi_awal,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, hukum, tahun, kepemilikan, jumlah,  investasi_awal, sal_awal,  kurang,  tambah, tahun_n, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, '' hukum, ''  tahun, '' kepemilikan, 0 jumlah, 0 investasi_awal, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $hukum = $row->hukum;
                       $jumlah = $row->jumlah;
                       $kepemilikan = $row->kepemilikan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $investasi_awal = $row->investasi_awal;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $keterangan = $row->keterangan;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $investasi_awal==0 ? $investasi_awal = '' : $investasi_awal=number_format($investasi_awal,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"left\" style=\"font-size:12px\">$hukum</td> 
							   <td align=\"left\" style=\"font-size:12px\">$kepemilikan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$investasi_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}
					
					$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td>
							   <td align=\"center\" style=\"font-size:12px\"></td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}
				$cRet .="</table>";
				}else if ($rek3==111){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian Akun</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Setoran<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td>

                </tr>
				</thead>";
				
				$sql = "SELECT kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun, 0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama,  ''  tahun,  0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun, 0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun, jumlah, sal_awal,  kurang,  tambah, tahun_n, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama,  ''  tahun,  0 jumlah, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $jumlah = $row->jumlah;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $keterangan = $row->keterangan;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}   
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
					";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}	
				
				$cRet .="</table>";
				}else if ($rek3==141){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian Akun</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Dasar<br>Hukum</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td>
                </tr>
				</thead>";
				
				$sql = "SELECT kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' hukum,0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' hukum,0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' hukum,0 jumlah, 0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  hukum, jumlah, sal_awal,  kurang,  tambah, tahun_n, keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' hukum,0 jumlah, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $hukum = $row->hukum;
                       $jumlah = $row->jumlah;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $keterangan = $row->keterangan;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$hukum</td>
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td>
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}

					$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
					";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}	
									
				$cRet .="</table>";
					
					
				} else if (($rek3==151) or ($rek3==152) or ($rek3==153) or ($rek3==154)){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No. Polisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Fungsi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Lokasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Alamat</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah/Luas</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' merk, '' no_polisi,'' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, '' fungsi,'' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' merk, '' no_polisi, '' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, fungsi, lokasi, alamat, jumlah,  satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, '' fungsi,'' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $merk = $row->merk;
                       $no_polisi = $row->no_polisi;
                       $lokasi = $row->lokasi;
                       $fungsi = $row->fungsi;
                       $alamat = $row->alamat;
                       $jumlah = $row->jumlah;
                       $harga_satuan = $row->harga_satuan;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$no_polisi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$fungsi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$alamat</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                    
					
					}
					
					$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal,SUM(kurang) kurang,SUM(tambah) tambah,SUM(tahun_n) tahun_n FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       
					   $nama = $row->nama;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   

                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}    
                        
										
				$cRet .="</table>";
				}else if ($rek3==15){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No. Polisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Fungsi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Lokasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Alamat</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah/Luas</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
                </tr>
				<tr>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 
                </tr>
				</thead>";
				
				$sql = "SELECT kd_rek2 as kode1, kd_rek2 as kode, nm_rek2 as nama, ''  tahun,  '' merk, '' no_polisi,'' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM ms_rek2_64 where kd_rek2='$rek3'
						UNION
						SELECT kd_rek3 as kode1, kd_rek3 as kode, nm_rek3 as nama, ''  tahun,  '' merk, '' no_polisi,'' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT nm_rek4_64 from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, '' fungsi,'' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT case when (kd_rek6<>'') then kd_rek5 end as kode1, case when (kd_rek6<>'') then kd_rek5 end as kode, case when (kd_rek6<>'') then nm_rek5 end as nama, case when (kd_rek6<>'') then '' end tahun,  case when (kd_rek6<>'') then '' end merk, case when (kd_rek6<>'') then '' end no_polisi, case when (kd_rek6<>'') then '' end fungsi, case when (kd_rek6<>'') then '' end lokasi, case when (kd_rek6<>'') then '' end alamat, case when (kd_rek6<>'') then 0 end jumlah, case when (kd_rek6<>'') then '' end satuan, case when (kd_rek6<>'') then 0 end harga_satuan,  case when (kd_rek6<>'') then 0 end sal_awal, case when (kd_rek6<>'') then 0 end kurang, case when (kd_rek6<>'') then 0 end tambah, case when (kd_rek6<>'') then 0 end tahun_n, case when (kd_rek6<>'') then '' end kondisi_b, case when (kd_rek6<>'') then '' end kondisi_rr, case when (kd_rek6<>'') then '' end kondisi_rb, case when (kd_rek6<>'') then '' end keterangan FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, fungsi, lokasi, alamat, jumlah,  satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						SELECT LEFT(kd_rek5,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, '' fungsi,'' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd' group by left(kd_rek5,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
					$total_sal_awal=0;
                    foreach ($hasil->result() as $row)
                    {
					   $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $merk = $row->merk;
                       $no_polisi = $row->no_polisi;
                       $lokasi = $row->lokasi;
                       $fungsi = $row->fungsi;
                       $alamat = $row->alamat;
                       $jumlah = $row->jumlah;
                       $harga_satuan = $row->harga_satuan;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   $total_sal_awal=$total_sal_awal + $sal_awal;
					   //$total_sal_awal=number_format($total_sal_awal,"2",",",".");

                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$no_polisi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$fungsi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$alamat</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							</tr>";    
                        
					}
				$sql = "SELECT (SELECT UPPER(nm_rek2) from ms_rek2_64 where kd_rek2 = '$rek3') as nama, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah)  tambah, SUM(tahun_n) tahun_n FROM lamp_aset where left(kd_rek3,2) = '$rek3' and kd_skpd = '$skpd'
						";
                    $hasil = $this->db->query($sql);
					$total_sal_awal=0;
                    foreach ($hasil->result() as $row)
                    {
					  
                       $nama = $row->nama;
					   $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
					   $total_sal_awal=$total_sal_awal + $sal_awal;
					   //$total_sal_awal=number_format($total_sal_awal,"2",",",".");

                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							</tr>";    
                        
					}
				$cRet .="</table>";
				}else{
			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td colspan=\"5\" style=\"border-top:none;border-right:none;border-left:none;font-size:12px\" align=\"center\">
                    BELUM ADA CETAKAN                                        
                    </td>           
                </tr>
				</table>";
					
				}
				

		$data['prev']= $cRet;
		$judul  = "Laporan_Lampiran_Aset_$skpd";
        $this->template->set('title', 'Rincian Neraca $nama_rek');        
        switch($ctk) {
		case 0;
              $data['prev']= $cRet;    
		 echo ("<title>Rincian Neraca $nama_rek</title>");
		 echo $cRet;
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,0,1,'');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        } 
		
		
	}
	
	function ctk_amortisasi($skpd='',$ctk=''){
        $lntahunang = $this->session->userdata('pcThang');       
        
		$nm_skpd =  $this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
		$rek3 = 153;
		
		$cRet = '';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td colspan=\"5\" style=\"border-top:none;border-right:none;border-left:none;font-size:14px\" align=\"center\">
                    <b>PEMERINTAH KABUPATEN SANGGAU</b> <br>
                    <b>AMORTISASI ASET TIDAK BERWUJUD</b><BR>
                    <b>PER 31 DESEMBER $lntahunang </b>
                    <BR>&nbsp;                                        
                    </td>           
                </tr>
				</table>
				";
		 $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td width=\"5%\"  align=\"left\">
                    SKPD </td> 
					<td> :</td>
					<td> $skpd - $nm_skpd <br></td>
                </tr>
				<tr>
                    <td width=\"5%\"  align=\"left\">
                    &nbsp;</td> 
                </tr>
				</table>
				";
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No. Polisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Fungsi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Lokasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Alamat</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah/Luas</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Masa Manfaaat</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Usia s/d 01<br>Januari $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Akumulasi Amortisasi Per<br>01 Januari $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Amortisasi <br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Nilai Buku Per<br>31 Desember $lntahunang</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td>
				   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">21</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">22</td>
				   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">23</td>
				   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">24</td>
				   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">25</td>
                </tr>
				</thead>";
				
				$sql = "SELECT kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' merk, '' no_polisi,'' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan, 0 masa, 0 usia, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode, (SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64 = LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi,'' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan, 0 masa, 0 usia, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n as decimal(20,0)) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0)) end as akum_penyu, case when a.usia>=a.masa then 0 when a.masa-a.usia=1 then (a.sal_awal-a.kurang+a.tambah+tahun_n)-(cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0))) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa as decimal(20,0)) end as akum_penyu_n
						from (SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, fungsi, lokasi, alamat, jumlah, satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, (select masa from ms_amortisasi where kd_rek4=LEFT(kd_rek5,5)) masa, 
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a
						UNION ALL
						SELECT LEFT(kode1,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kode1,5)) as nama, ''  tahun,  '' merk, '' no_polisi,'' fungsi, '' lokasi, '' alamat, 0 jumlah, '' satuan, 0 harga_satuan, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan, '' masa, '' usia, sum(akum_penyu) akum_penyu, sum(akum_penyu_n) akum_penyu_n, sum(nilai_buku) nilai_buku  
						FROM (select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n as decimal(20,0)) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0)) end as akum_penyu, case when a.usia>=a.masa then 0 when a.masa-a.usia=1 then (a.sal_awal-a.kurang+a.tambah+tahun_n)-(cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0))) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa as decimal(20,0)) end as akum_penyu_n
						from (SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, fungsi, lokasi, alamat, jumlah,  satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, (select masa from ms_amortisasi where kd_rek4=LEFT(kd_rek5,5)) masa, 
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a) a group by left(kode1,5)
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode1 = $row->kode1;
					   $kode = $row->kode;
                       $nama = $row->nama;
					   $merk = $row->merk;
                       $tahun = $row->tahun;
                       $no_polisi = $row->no_polisi;
                       $lokasi = $row->lokasi;
                       $alamat = $row->alamat;
                       $fungsi = $row->fungsi;
                       $jumlah = $row->jumlah;
                       $harga_satuan = $row->harga_satuan;
					   $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $masa = $row->masa;
					   $usia = $row->usia;
					   $akum_penyu = $row->akum_penyu;
					   $akum_penyu_n = $row->akum_penyu_n;
					   $nilai_buku = $row->nilai_buku;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $masa==0 ? $masa = '' : $masa=number_format($masa,"0",",",".");
					   $usia==0 ? $usia = '' : $usia=number_format($usia,"0",",",".");
					   if (strlen($kode1)>7){$akhir=number_format($akhir,"2",",",".");}
					   elseif(strlen($kode1)<7 && $akhir==0) {$akhir = '';}
					   else{$akhir=number_format($akhir,"2",",",".");}
					   if (strlen($kode1)>7){$akum_penyu=number_format($akum_penyu,"2",",",".");}
					   elseif(strlen($kode1)<7 && $akum_penyu==0) {$akum_penyu = '';}
					   else{$akum_penyu=number_format($akum_penyu,"2",",",".");}
					   if (strlen($kode1)>7){$akum_penyu_n=number_format($akum_penyu_n,"2",",",".");}
					   elseif(strlen($kode1)<7 && $akum_penyu_n==0) {$akum_penyu_n = '';}
					   else{$akum_penyu_n=number_format($akum_penyu_n,"2",",",".");}
					   if (strlen($kode1)>7){$nilai_buku=number_format($nilai_buku,"2",",",".");}
					   elseif(strlen($kode1)<7 && $nilai_buku==0) {$nilai_buku = '';}
					   else{$nilai_buku=number_format($nilai_buku,"2",",",".");}
					   $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$no_polisi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$fungsi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$alamat</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td>
							   <td align=\"center\" style=\"font-size:12px\">$masa</td> 
							   <td align=\"center\" style=\"font-size:12px\">$usia</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$nilai_buku</td> 
							</tr>";    
                    }
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal,  SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, SUM(akum_penyu) akum_penyu, SUM(akum_penyu_n) as akum_penyu_n, SUM(nilai_buku) nilai_buku  
						FROM (select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n as decimal(20,0)) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0)) end as akum_penyu, case when a.usia>=a.masa then 0 when a.masa-a.usia=1 then (a.sal_awal-a.kurang+a.tambah+tahun_n)-(cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0))) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa as decimal(20,0)) end as akum_penyu_n
						from (SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, fungsi, lokasi, alamat, jumlah, satuan, harga_satuan, sal_awal,  kurang,  tambah, tahun_n, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, (select masa from ms_amortisasi where kd_rek4=LEFT(kd_rek5,5)) masa, 
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a) a";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
					   $nama = $row->nama;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
					   $akum_penyu = $row->akum_penyu;
					   $akum_penyu_n = $row->akum_penyu_n;
					   $nilai_buku = $row->nilai_buku;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   
					   $akhir=number_format($akhir,"2",",",".");
					   $akum_penyu=number_format($akum_penyu,"2",",",".");
					   $akum_penyu_n=number_format($akum_penyu_n,"2",",",".");
					   $nilai_buku=number_format($nilai_buku,"2",",",".");
					   $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$nilai_buku</td>
							</tr>";    
                        
                    }
				$cRet .="</table>";

		$data['prev']= $cRet;
		$judul  = "Laporan_Amortisasi_$skpd";
        $this->template->set('title', 'Amortisasi $skpd');        
        switch($ctk) {
		case 0;
              $data['prev']= $cRet;    
		 echo ("<title>Amortisasi $skpd</title>");
		 echo $cRet;
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,0,1,'');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        } 
		
		
	}
    
	
	function ctk_penyu_lamp_aset($skpd='',$rek3='',$ctk=''){
        $lntahunang = $this->session->userdata('pcThang');       
        if($rek3==15){
			$nama_rek='Aset Lainnya';
		}else{
			$nama_rek=$this->tukd_model->get_nama($rek3,'nm_rek3','ms_rek3_64','kd_rek3');
		}
		$nm_skpd =  $this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');  
		$cRet = '';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td colspan=\"5\" style=\"border-top:none;border-right:none;border-left:none;font-size:14px\" align=\"center\">
                    <b>PEMERINTAH KABUPATEN SANGGAU</b> <br>
                    <b>RINCIAN NERACA ".strtoupper($nama_rek)."</b><BR>
                    <b>PER 31 DESEMBER $lntahunang </b>
                    <BR>&nbsp;                                        
                    </td>           
                </tr>
				</table>
				";
		 $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td width=\"5%\"  align=\"left\">
                    SKPD </td> 
					<td> :</td>
					<td> $skpd - $nm_skpd <br></td>
                </tr>
				<tr>
                    <td width=\"5%\"  align=\"left\">
                    &nbsp;</td> 
                </tr>
				</table>
				";
		if (($rek3==133) or ($rek3==134)){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Fungsi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Lokasi<br>Kota/Kab.</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Alamat</td>
					<td rowspan=\"2\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Luas</td>
					<td rowspan=\"2\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Masa Manfaaat</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Usia s/d 01<br>Januari $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Akumulasi Penyusutan Per<br>01 Januari $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Penyusutan <br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Nilai Buku Per<br>31 Desember $lntahunang</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td>
				   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">21</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">22</td>
                </tr>
				</thead>";
				
				$sql = "SELECT kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan, 0 masa, 0 usia, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode, (SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64 = LEFT(kd_rek5,5)) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan, 0 masa, 0 usia, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT kd_rek5 as kode1, kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan, 0 masa, 0 usia, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n as decimal(20,0)) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0)) end as akum_penyu, case when a.usia>=a.masa then 0 when a.masa-a.usia=1 then (a.sal_awal-a.kurang+a.tambah+tahun_n)-(cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0))) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa as decimal(20,0)) end as akum_penyu_n
						from (SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  lokasi, alamat,  fungsi, luas,  satuan, sal_awal,  kurang,  tambah, tahun_n, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, (select masa from ms_penyu where kd_rek4=LEFT(kd_rek5,5)) masa, 
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a
						UNION ALL
						SELECT LEFT(kode1,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kode1,5)) as nama, ''  tahun,  '' lokasi,'' alamat, '' fungsi, 0 luas, '' satuan,  SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan, '' masa, '' usia, sum(akum_penyu) akum_penyu, sum(akum_penyu_n) akum_penyu_n, sum(nilai_buku) nilai_buku  
						FROM (select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n as decimal(20,0)) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0)) end as akum_penyu, case when a.usia>=a.masa then 0 when a.masa-a.usia=1 then (a.sal_awal-a.kurang+a.tambah+tahun_n)-(cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0))) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa as decimal(20,0)) end as akum_penyu_n
						from (SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  lokasi, alamat,  fungsi, luas,  satuan, sal_awal,  kurang,  tambah, tahun_n, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, (select masa from ms_penyu where kd_rek4=LEFT(kd_rek5,5)) masa, 
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a) a group by left(kode1,5)
						ORDER BY kode1, lokasi, alamat, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $lokasi = $row->lokasi;
                       $alamat = $row->alamat;
                       $fungsi = $row->fungsi;
                       $luas = $row->luas;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $masa = $row->masa;
					   $usia = $row->usia;
					   $akum_penyu = $row->akum_penyu;
					   $akum_penyu_n = $row->akum_penyu_n;
					   $nilai_buku = $row->nilai_buku;
					   $luas==0 ? $luas = '' : $luas=number_format($luas,"0",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $masa==0 ? $masa = '' : $masa=number_format($masa,"0",",",".");
					   $usia==0 ? $usia = '' : $usia=number_format($usia,"0",",",".");
					   if (strlen($kode)>8){$akhir=number_format($akhir,"2",",",".");}
					   elseif(strlen($kode)<8 && $akhir==0) {$akhir = '';}
					   else{$akhir=number_format($akhir,"2",",",".");}
					   if (strlen($kode)>8){$akum_penyu=number_format($akum_penyu,"2",",",".");}
					   elseif(strlen($kode)<8 && $akum_penyu==0) {$akum_penyu = '';}
					   else{$akum_penyu=number_format($akum_penyu,"2",",",".");}
					   if (strlen($kode)>8){$akum_penyu_n=number_format($akum_penyu_n,"2",",",".");}
					   elseif(strlen($kode)<8 && $akum_penyu_n==0) {$akum_penyu_n = '';}
					   else{$akum_penyu_n=number_format($akum_penyu_n,"2",",",".");}
					   if (strlen($kode)>8){$nilai_buku=number_format($nilai_buku,"2",",",".");}
					   elseif(strlen($kode)<8 && $nilai_buku==0) {$nilai_buku = '';}
					   else{$nilai_buku=number_format($nilai_buku,"2",",",".");}
					   $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$fungsi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$lokasi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$alamat</td> 
							   <td align=\"center\" style=\"font-size:12px\">$luas</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td>
							   <td align=\"center\" style=\"font-size:12px\">$masa</td> 
							   <td align=\"center\" style=\"font-size:12px\">$usia</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$nilai_buku</td> 
							</tr>";    
                    }
				$sql = "SELECT (SELECT UPPER(nm_rek3) from ms_rek3_64 where kd_rek3 = '$rek3') as nama, SUM(sal_awal) sal_awal,  SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, SUM(akum_penyu) akum_penyu, SUM(akum_penyu_n) as akum_penyu_n, SUM(nilai_buku) nilai_buku  
						FROM (select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n as decimal(20,0)) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0)) end as akum_penyu, case when a.usia>=a.masa then 0 when a.masa-a.usia=1 then (a.sal_awal-a.kurang+a.tambah+tahun_n)-(cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0))) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa as decimal(20,0)) end as akum_penyu_n
						from (SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  lokasi, alamat,  fungsi, luas,  satuan, sal_awal,  kurang,  tambah, tahun_n, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, (select masa from ms_penyu where kd_rek4=LEFT(kd_rek5,5)) masa, 
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a) a";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
					   $nama = $row->nama;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
					   $akum_penyu = $row->akum_penyu;
					   $akum_penyu_n = $row->akum_penyu_n;
					   $nilai_buku = $row->nilai_buku;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $akum_penyu==0 ? $akum_penyu = '' : $akum_penyu=number_format($akum_penyu,"2",",",".");
					   $akum_penyu_n==0 ? $akum_penyu_n = '' : $akum_penyu_n=number_format($akum_penyu_n,"2",",",".");
					   $nilai_buku==0 ? $nilai_buku = '' : $nilai_buku=number_format($nilai_buku,"2",",",".");
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL $nama</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$nilai_buku</td>
							</tr>";    
                        
                    }
				$cRet .="</table>";
				}else if ($rek3==132){
					$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <thead>
				<tr>
                    <td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kode Rekening </td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Uraian</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Tahun <br>Perolehan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Merk/Type</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">No Polisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Jumlah</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Satuan</td>
					<td rowspan=\"2\" width=\"5%\" align=\"center\" style=\"font-size:12px\">Harga<br>Satuan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Awal</td>
                    <td colspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Mutasi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Pengadaan<br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Saldo<br>Akhir</td>
					<td colspan=\"3\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Kondisi</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Keterangan</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Masa Manfaaat</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Usia s/d 01<br>Januari $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Akumulasi Penyusutan Per<br>01 Januari $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Penyusutan <br>Tahun $lntahunang</td>
					<td rowspan=\"2\" width=\"10%\" align=\"center\" style=\"font-size:12px\">Nilai Buku Per<br>31 Desember $lntahunang</td>
                </tr>
				<tr>
                    <td  width=\"5%\" align=\"center\" style=\"font-size:12px\">Berkurang</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">Bertambah</td>
					<td  width=\"5%\" align=\"center\" style=\"font-size:12px\">B</td>
                    <td width=\"5%\" align=\"center\" style=\"font-size:12px\">RR</td>
					<td width=\"5%\" align=\"center\" style=\"font-size:12px\">RB</td>
                </tr>
				<tr>
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">1</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">2</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">3</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">4</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">5</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">6</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">7</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">8</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">9</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">10</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">11</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">12</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">13</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">14</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">15</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">16</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">17</td>
				   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">18</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">19</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">20</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">21</td> 
                   <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px\">22</td>
                </tr>
				</thead>";
				
				$sql = "SELECT kd_rek3 as kode1, kd_rek3 as kode, UPPER(nm_rek3) as nama, ''  tahun,  '' merk,'' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan, 0 masa, 0 usia, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT LEFT(kd_rek5,5) as kode1, LEFT(kd_rek5,5) as kode,(SELECT UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kd_rek5,5)) as nama, ''  tahun,  '' merk, '' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan, 0 masa, 0 usia, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION
						SELECT kd_rek5 as kode1,kd_rek5 as kode, nm_rek5 as nama, ''  tahun,  '' merk, '' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan,   0 sal_awal, 0 kurang, 0 tambah, 0 tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan, 0 masa, 0 usia, 0 akum_penyu, 0 akum_penyu_n, 0 nilai_buku FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd'
						UNION ALL
						select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n as decimal(20,0)) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0)) end as akum_penyu, case when a.usia>=a.masa then 0 when a.masa-a.usia=1 then (a.sal_awal-a.kurang+a.tambah+tahun_n)-(cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0))) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa as decimal(20,0)) end as akum_penyu_n
						from(SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, jumlah,  satuan, harga_satuan, sal_awal, kurang,  tambah, tahun_n, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, (select masa from ms_penyu where kd_rek4=LEFT(kd_rek5,5)) masa, 
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a
						UNION ALL
						SELECT LEFT(kode1,5)+'99' as kode1, '' as kode, (SELECT 'TOTAL '+UPPER(nm_rek4_64) from ms_rek4_64 where kd_rek4_64=LEFT(kode1,5)) as nama, ''  tahun,  '' merk, '' no_polisi, 0 jumlah, '' satuan, 0 harga_satuan, SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, '' kondisi_b, '' kondisi_rr, '' kondisi_rb, '' keterangan, '' masa, '' usia, sum(akum_penyu), sum(akum_penyu_n), sum(nilai_buku) FROM (
						select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n as decimal(20,0)) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0)) end as akum_penyu, case when a.usia>=a.masa then 0 when a.masa-a.usia=1 then (a.sal_awal-a.kurang+a.tambah+tahun_n)-(cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0))) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa as decimal(20,0)) end as akum_penyu_n
						from(SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, jumlah,  satuan, harga_satuan, sal_awal, kurang,  tambah, tahun_n, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, (select masa from ms_penyu where kd_rek4=LEFT(kd_rek5,5)) masa, 
						case when len(tahun)<>4 then 0 else $lntahunang-tahun end as usia FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a) a group by left(kode1,5)	
						ORDER BY kode1, tahun";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       $kode = $row->kode;
                       $nama = $row->nama;
                       $tahun = $row->tahun;
                       $merk = $row->merk;
                       $no_polisi = $row->no_polisi;
                       $jumlah = $row->jumlah;
                       $harga_satuan = $row->harga_satuan;
                       $satuan = $row->satuan;
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $kondisi_b = $row->kondisi_b;
                       $kondisi_rr = $row->kondisi_rr;
                       $kondisi_rb = $row->kondisi_rb;
                       $keterangan = $row->keterangan;
					   $masa = $row->masa;
					   $usia = $row->usia;
					   $akum_penyu = $row->akum_penyu;
					   $akum_penyu_n = $row->akum_penyu_n;
					   $nilai_buku = $row->nilai_buku;
					   $jumlah==0 ? $jumlah = '' : $jumlah=number_format($jumlah,"0",",",".");
					   $harga_satuan==0 ? $harga_satuan = '' : $harga_satuan=number_format($harga_satuan,"2",",",".");
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $masa==0 ? $masa = '' : $masa=number_format($masa,"0",",",".");
					   $usia==0 ? $usia = '' : $usia=number_format($usia,"0",",",".");
					   if (strlen($kode)>8){$akhir=number_format($akhir,"2",",",".");}
					   elseif(strlen($kode)<8 && $akhir==0) {$akhir = '';}
					   else{$akhir=number_format($akhir,"2",",",".");}
					   if (strlen($kode)>8){$akum_penyu=number_format($akum_penyu,"2",",",".");}
					   elseif(strlen($kode)<8 && $akum_penyu==0) {$akum_penyu = '';}
					   else{$akum_penyu=number_format($akum_penyu,"2",",",".");}
					   if (strlen($kode)>8){$akum_penyu_n=number_format($akum_penyu_n,"2",",",".");}
					   elseif(strlen($kode)<8 && $akum_penyu_n==0) {$akum_penyu_n = '';}
					   else{$akum_penyu_n=number_format($akum_penyu_n,"2",",",".");}
					   if (strlen($kode)>8){$nilai_buku=number_format($nilai_buku,"2",",",".");}
					   elseif(strlen($kode)<8 && $nilai_buku==0) {$nilai_buku = '';}
					   else{$nilai_buku=number_format($nilai_buku,"2",",",".");}
                       $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\">$kode</td> 
							   <td align=\"left\" style=\"font-size:12px\">$nama</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun</td> 
							   <td align=\"center\" style=\"font-size:12px\">$merk</td> 
							   <td align=\"center\" style=\"font-size:12px\">$no_polisi</td> 
							   <td align=\"center\" style=\"font-size:12px\">$jumlah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$harga_satuan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_b</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rr</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kondisi_rb</td> 
							   <td align=\"center\" style=\"font-size:12px\">$keterangan</td> 
							   <td align=\"center\" style=\"font-size:12px\">$masa</td> 
							   <td align=\"center\" style=\"font-size:12px\">$usia</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$nilai_buku</td> 
							</tr>";    
                        
					}  
				$sql = "SELECT SUM(sal_awal) sal_awal, SUM(kurang) kurang, SUM(tambah) tambah, SUM(tahun_n) tahun_n, SUM(akum_penyu) akum_penyu, SUM(akum_penyu_n) akum_penyu_n, SUM(nilai_buku) nilai_buku FROM (
						select a.*, (a.sal_awal-a.kurang+a.tambah+tahun_n)-a.akum_penyu-a.akum_penyu_n as nilai_buku from (select a.*, case when a.usia>=a.masa then cast(a.sal_awal-a.kurang+a.tambah+tahun_n as decimal(20,0)) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0)) end as akum_penyu, case when a.usia>=a.masa then 0 when a.masa-a.usia=1 then (a.sal_awal-a.kurang+a.tambah+tahun_n)-(cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa*a.usia as decimal(20,0))) else cast((a.sal_awal-a.kurang+a.tambah+tahun_n)/a.masa as decimal(20,0)) end as akum_penyu_n
						from(SELECT case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode1, case when (kd_rek6='') then kd_rek5 else kd_rek6 end as kode, case when (nm_rek6='') then nm_rek5 else nm_rek6 end as nama, tahun,  merk, no_polisi, jumlah,  satuan, harga_satuan, sal_awal, kurang,  tambah, tahun_n, kondisi_b,  kondisi_rr,  kondisi_rb,  keterangan, (select masa from ms_penyu where kd_rek4=LEFT(kd_rek5,5)) masa, 
						case when len(tahun)<>4 then 0 else 2015-tahun end as usia FROM lamp_aset where kd_rek3 = '$rek3' and kd_skpd = '$skpd') a) a) a";
                    $hasil = $this->db->query($sql);
                    foreach ($hasil->result() as $row)
                    {
                       
                       $sal_awal = $row->sal_awal;
                       $kurang = $row->kurang;
                       $tambah = $row->tambah;
                       $tahun_n = $row->tahun_n;
                       $akhir = $sal_awal-$kurang+$tambah;
                       $akum_penyu = $row->akum_penyu;
					   $akum_penyu_n = $row->akum_penyu_n;
					   $nilai_buku = $row->nilai_buku;
					   $sal_awal==0 ? $sal_awal = '' : $sal_awal=number_format($sal_awal,"2",",",".");
					   $kurang==0 ? $kurang = '' : $kurang=number_format($kurang,"2",",",".");
					   $tambah==0 ? $tambah = '' : $tambah=number_format($tambah,"2",",",".");
					   $tahun_n==0 ? $tahun_n = '' : $tahun_n=number_format($tahun_n,"2",",",".");
					   $akhir==0 ? $akhir = '' : $akhir=number_format($akhir,"2",",",".");
                       $akum_penyu==0 ? $akum_penyu = '' : $akum_penyu=number_format($akum_penyu,"2",",",".");
					   $akum_penyu_n==0 ? $akum_penyu_n = '' : $akum_penyu_n=number_format($akum_penyu_n,"2",",",".");
					   $nilai_buku==0 ? $nilai_buku = '' : $nilai_buku=number_format($nilai_buku,"2",",",".");
					   $cRet .="<tr>
							   <td align=\"left\" style=\"font-size:12px\"></td> 
							   <td align=\"left\" style=\"font-size:12px\">TOTAL PERALATAN DAN MESIN</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$sal_awal</td> 
							   <td align=\"center\" style=\"font-size:12px\">$kurang</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tambah</td> 
							   <td align=\"center\" style=\"font-size:12px\">$tahun_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akhir</td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td>
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\"></td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu</td> 
							   <td align=\"center\" style=\"font-size:12px\">$akum_penyu_n</td> 
							   <td align=\"center\" style=\"font-size:12px\">$nilai_buku</td>
							</tr>";    
                        
					}
				$cRet .="</table>";
				}else{
			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td colspan=\"5\" style=\"border-top:none;border-right:none;border-left:none;font-size:12px\" align=\"center\">
                    BELUM ADA CETAKAN                                        
                    </td>           
                </tr>
				</table>";
					
				}
				/* if($ctk==0){
 
         $data['prev']= $cRet;    
		 echo ("<title>Rincian Neraca $nama_rek</title>");
		 echo $cRet;}
		 else{

	    $this->_mpdf('',$cRet,10,10,10,0,1,'');
} */

		$data['prev']= $cRet;
		$judul  = "Laporan_Lampiran_Aset_Penyusutan_$skpd";
        $this->template->set('title', 'Rincian Neraca $nama_rek');        
        switch($ctk) {
		case 0;
              $data['prev']= $cRet;    
		 echo ("<title>Rincian Neraca $nama_rek</title>");
		 echo $cRet;
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,0,1,'');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        } 
		
		
	}
    
	function load_rek3_lamp_aset(){
		$sql = "select kd_rek3,nm_rek3 FROM ms_rek3_64 WHERE left(kd_rek3,1)='1' UNION 
				select '15' as kd_rek3, 'Aset Lainnya' as ms_rek3 ORDER BY kd_rek3";

        $mas = $this->db->query($sql);
        $result = array();
        $ii = 0;        
        foreach($mas->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek3' => $resulte['kd_rek3'],  
                        'nm_rek3' => $resulte['nm_rek3']
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $mas->free_result();
    	   
	}	
	
	function load_rek3_penyu_lamp_aset(){
		$sql = "select kd_rek3,nm_rek3 FROM ms_rek3_64 WHERE kd_rek3 in ('132','133','134')";

        $mas = $this->db->query($sql);
        $result = array();
        $ii = 0;        
        foreach($mas->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek3' => $resulte['kd_rek3'],  
                        'nm_rek3' => $resulte['nm_rek3']
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $mas->free_result();
    	   
	}		 
	
	
     function load_spp() {
		$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
		$rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
		$offset = ($page-1)*$rows;
		$kd_skpd  = $this->session->userdata('kdskpd');
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where    = " AND jns_spp <> '1' AND jns_spp <> '2' ";
        if ($kriteria <> ''){                               
            $where="where (upper(no_spp) like upper('%$kriteria%') or tgl_spp like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from trhspp WHERE kd_skpd = '$kd_skpd' $where ";
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
		//alert('aaa');
		
        $sql = "SELECT TOP $rows * from trhspp WHERE kd_skpd = '$kd_skpd' $where and no_spp not in (SELECT TOP $offset no_spp from trhspp WHERE kd_skpd = '$kd_skpd' $where) order by no_spp,kd_skpd";
       // $sql = "SELECT * from trhspp WHERE kd_skpd = '$kd_skpd' $where order by no_spp,kd_skpd";
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'jns_beban' => $resulte['jns_beban'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status'],
                        'kd_kegiatan'=>$resulte['kd_kegiatan'],
                        'nm_kegiatan'=>$resulte['nm_kegiatan'],
                        'kd_program'=>$resulte['kd_program'],
                        'nm_program'=>$resulte['nm_program'],
                        'dir'=>$resulte['pimpinan'],
                        'no_tagih'=>$resulte['no_tagih'],
                        'tgl_tagih'=>$resulte['tgl_tagih'],
                        'alamat'=>$resulte['alamat'],
                        'lanjut'=>$resulte['lanjut'],
                        'kontrak'=>$resulte['kontrak'],
                        'tgl_mulai'=>$resulte['tgl_mulai'],
                        'tgl_akhir'=>$resulte['tgl_akhir'],
                        'sts_tagih'=>$resulte['sts_tagih']     
                        );
                        $ii++;
        }
		$result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
	}
    
    function spd1_up() {
        $result   = array();
        { 
            $result[] = array(
                        'id'       => '0',        
                        'kdrek5'   => '1110302',
                        'nmrek5'   => 'Uang Persediaan'
                        );
        }
        echo json_encode($result);
    }
    
    function load_spp_up() {

		$kd_skpd  = $this->session->userdata('kdskpd');
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ="and jns_spp='1'";
        if ($kriteria <> ''){                               
            $where="where (upper(no_spp) like upper('%$kriteria%') or tgl_spp like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT * from trhspp WHERE kd_skpd = '$kd_skpd' $where order by no_spp,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status']                                                                                   
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	$query1->free_result();   
	}
    
     function bank() {

            //$lcskpd  = $this->session->userdata('kdskpd');
            
            $sql = "select * from ms_bank order by kode" ;    
            //echo $sql;    
            $query1 = $this->db->query($sql);  
            $result = array();
            $ii = 0;
            foreach($query1->result_array() as $resulte)
            { 
               
                $result[] = array(
                            'id' => $ii,        
                            'kode' => $resulte['kode'],  
                            'nama' => $resulte['nama']
                            );
                            $ii++;
            }
               
            echo json_encode($result);
        	   
    	}
    
    function load_spp_gu() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ="where jns_spp='2'";
        if ($kriteria <> ''){                               
            $where="where (upper(no_spp) like upper('%$kriteria%') or tgl_spp like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT * from trhspp $where order by no_spp,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status'],
                        'no_bukti' =>$resulte['no_bukti']                                                                                   
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	$query1->free_result();    
	}
    
   function tambah_spp()
	{
		
		$config = array(
               array(
                     'field'   => 'no_spp',
                     'label'   => 'no spp',
                     'rules'   => 'trim|required'
                    ),
                
               array(
                     'field'   => 'kd_skpd',
                     'label'   => 'Kd skpd',
                     'rules'   => 'trim|required'
                  ),
               array(
                     'field'   => 'keperluan',
                     'label'   => 'keperluan',
                     'rules'   => 'trim|required'
                  ),
               array(
                     'field'   => 'jns_spp',
                     'label'   => 'Jns spp',
                     'rules'   => 'trim|required'
               )
                  
            );
			
		$this->form_validation->set_message('required', '%s harus diisi !');
		$this->form_validation->set_rules($config);
		$this->form_validation->set_error_delimiters('<div class="single_error">', '</div>');

		if ($this->form_validation->run() == FALSE)
		{
			$data['page_title'] = "Master Data Kegiatan &raquo; Tambah";
            //$lc = "select kd_program,nm_program from m_prog order by kd_program";
//            $query = $this->db->query($lc);
//            $data["program"]=$query->result();
            //$data["jumrow"]=$this->db->get('m_prog')->num_rows();
		}
		else
		{		
						$no_spp = $this->input->post('no_spp');
						$kd_skpd = $this->input->post('skpd');
                        $tgl_spp = $this->input->post('dd');
                        $jns_kegiatan = $this->input->post('jns_beban');
                        $bulan = $this->input->post('kebutuhan_bulan');
                        $keperluan = $this->input->post('ketentuan');
						
						
			//$this->tukd_model->save('trhspp',$data);
            $query = $this->db->query(" insert into trhspp(no_spp,kd_skpd,tgl_spp,jns_kegiatan,bulan,keperluan) values('$no_spp','$kd_skpd','$tgl_spp','$jns_kegiatan','$bulan','$keperluan') ");
            echo"$query";						
			$this->session->set_flashdata('notify', 'Data Berita berhasil disimpan !');
			
			redirect('tukd/spp');

		}
		
		$this->template->set('title', 'Master Data Kegiatan &raquo; Tambah Data');
		$this->template->load('template', 'tukd/spp/tambah_spp_v2', $data);
	}
   
   
   function load_sum_lpj(){
		$xlpj = $this->input->post('lpj');
		$kd_skpd = $this->input->post('kode');
        //$query1 = $this->db->query("SELECT SUM(b.nilai)AS jml FROM trhtransout a INNER JOIN trdtransout b ON a.no_bukti=b.no_bukti 
        //          INNER JOIN trlpj c ON b.no_bukti=c.no_bukti WHERE no_lpj='$xlpj' ");  
		
		$query1 = $this->db->query("SELECT SUM(a.nilai)AS jml FROM trlpj a INNER JOIN trhlpj b ON a.no_lpj=b.no_lpj 
					AND a.kd_skpd=b.kd_skpd
                  WHERE b.no_lpj='$xlpj' AND a.kd_skpd='$kd_skpd' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'cjumlah'  =>  $resulte['jml']                       
                        );
                        $ii++;
        }
		echo json_encode($result);
        $query1->free_result();	
	}

   
   function tambah()
	{
		
		$config = array(
               array(
                     'field'   => 'no_spp',
                     'label'   => 'no spp',
                     'rules'   => 'trim|required'
                    ),
                
               array(
                     'field'   => 'kd_skpd',
                     'label'   => 'Kd skpd',
                     'rules'   => 'trim|required'
                  ),
               array(
                     'field'   => 'keperluan',
                     'label'   => 'keperluan',
                     'rules'   => 'trim|required'
                  ),
               array(
                     'field'   => 'jns_spp',
                     'label'   => 'Jns spp',
                     'rules'   => 'trim|required'
               )
                  
            );
			
		$this->form_validation->set_message('required', '%s harus diisi !');
		$this->form_validation->set_rules($config);
		$this->form_validation->set_error_delimiters('<div class="single_error">', '</div>');

		if ($this->form_validation->run() == FALSE)
		{
			$data['page_title'] = "Master Data Kegiatan &raquo; Tambah";
            //$lc = "select kd_program,nm_program from m_prog order by kd_program";
//            $query = $this->db->query($lc);
//            $data["program"]=$query->result();
            //$data["jumrow"]=$this->db->get('m_prog')->num_rows();
		}
		else
		{		
						$no_spp = $this->input->post('no_spp');
						$kd_skpd = $this->input->post('skpd');
                        $tgl_spp = $this->input->post('dd');
                        $jns_kegiatan = $this->input->post('jns_beban');
                        $bulan = $this->input->post('kebutuhan_bulan');
                        $keperluan = $this->input->post('ketentuan');
						
						
			//$this->tukd_model->save('trhspp',$data);
            $query = $this->db->query(" insert into trhspp(no_spp,kd_skpd,tgl_spp,jns_kegiatan,bulan,keperluan) values('$no_spp','$kd_skpd','$tgl_spp','$jns_kegiatan','$bulan','$keperluan') ");
            echo"$query";						
			$this->session->set_flashdata('notify', 'Data Berita berhasil disimpan !');
			
			redirect('tukd/spp');

		}
		
		$this->template->set('title', 'Master Data Kegiatan &raquo; Tambah Data');
		$this->template->load('template', 'tukd/spp/tambah_spp', $data);
	}
    
    function simpan()
	{
			
						$no_spp = $this->input->post('no_spp');
						$kd_skpd = $this->input->post('cskpd');
                        $keperluan = $this->input->post('keperluan');
                        $jns_spp = $this->input->post('jns_spp');
                        $tgl_spp = $this->input->post('tgl_spp');//                        
                        $bulan = $this->input->post('bulan');                        
                        $spd = $this->input->post('cspd');
                        $bank= $this->input->post('bank');
                        $nmrekan= $this->input->post('rekanan');
                        $no_rek= $this->input->post('rekening');
                        $npwp= $this->input->post('npwp');
                        $nm_skpd= $this->input->post('nmskpd');
                        $nilai= $this->input->post('nilai');
                        $no_bukti= $this->input->post('bukti');
                        $giat = $this->input->post('kegi');
                        $nmgiat = $this->input->post('nmkegi');
                        $prog = $this->input->post('prog');
                        $nmprog = $this->input->post('nmprog');
                        $dir = $this->input->post('dir');
                        $usernm= $this->session->userdata('pcNama');
                        $no_tagih=$this->input->post('notagih');
                        $tgl_tagih=$this->input->post('tgltagih');
                        $sts_tagih=$this->input->post('sttagih');
                        //date_default_timezone_set('Asia/Bangkok');
                        $last_update=  date('Y-m-d H:i:s');
                        
           $sql = "delete from trhspp where kd_skpd='$kd_skpd' and no_spp='$no_spp' and status='0'";
           $asg = $this->db->query($sql);
           	
                    $query ="insert into trhspp(no_spp,kd_skpd,keperluan,bulan,no_spd,jns_spp,bank,nmrekan,no_rek,npwp,nm_skpd,tgl_spp,status,username,last_update,nilai,no_bukti,kd_kegiatan,nm_kegiatan,kd_program,nm_program,pimpinan,no_tagih,tgl_tagih,sts_tagih) 
                    values('$no_spp','$kd_skpd','$keperluan','$bulan','$spd','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nm_skpd','$tgl_spp','0','$usernm','$last_update','$nilai','$no_bukti','$giat','$nmgiat','$prog','$nmprog','$dir','$no_tagih','$tgl_tagih','$sts_tagih') ";
                    $asg = $this->db->query($query);                    				
			
        echo '1';
      // $asg->free_result(); 
	} 
    
    function simpan_tukd(){
        
        $tabel   = $this->input->post('tabel');
        $lckolom = $this->input->post('kolom');
        $lcnilai = $this->input->post('nilai');
        $cid     = $this->input->post('cid');
        $lcid    = $this->input->post('lcid');
        $lcnotagih = $this->input->post('tagih');
        
        $sql = "select $cid from $tabel where $cid='$lcid'";
        $res = $this->db->query($sql);
        if($res->num_rows()>0){
            echo '1';
        }else{
            $sql = "insert into $tabel $lckolom values $lcnilai";
            $asg = $this->db->query($sql);
            if($asg){
                echo '2';
            }else{
                echo '0';
            }
        }
        if($tabel=='trhspp'){
            $sql1 = " UPDATE trhtagih SET sts_tagih='1' where no_bukti='$lcnotagih'";
            $asg1 = $this->db->query($sql1);
        }
        if($tabel=='trhspm'){
            $sql1 = " UPDATE trhspp SET status='1' where no_spp='$lcnotagih'";
            $asg1 = $this->db->query($sql1);
        }
    }
    
	
	
    function update_tukd(){
        
        $tabel   = $this->input->post('tabel');
        $cid     = $this->input->post('cid');
        $lcid    = $this->input->post('lcid');
        $lcid_h  = $this->input->post('lcid_h');
        
        if (  $lcid <> $lcid_h ) {
            
           $sql     = "select $cid from $tabel where $cid='$lcid'";
           $res     = $this->db->query($sql);
           if ( $res->num_rows()>0 ) {
                echo '1';
                exit();
           } 
        }
        
        $query   = $this->input->post('st_query');
        $asg     = $this->db->query($query);
        if ( $asg > 0 ){
           echo '2';
        } else {
           echo '0';
        }
    
    }
	
	
    function update_sp2d_tukd(){
        
        $tabel   = $this->input->post('tabel');
        $cid     = $this->input->post('cid');
        $lcid    = $this->input->post('lcid');
        $lcid_h  = $this->input->post('lcid_h');

        $tabel2   = $this->input->post('tabel2');
        $cid_spm     = $this->input->post('cid_spm');
        $lcid_spm    = $this->input->post('lcid_spm');
        $lcid_h_spm  = $this->input->post('lcid_h_spm');

        $tabel3   = $this->input->post('tabel3');
        $cid_sp2d     = $this->input->post('cid_sp2d');
        $lcid_sp2d    = $this->input->post('lcid_sp2d');
        $lcid_h_sp2d  = $this->input->post('lcid_h_sp2d');
        if (  $lcid <> $lcid_h ) {
            
           $sql     = "select $cid from $tabel where $cid='$lcid'";
           $res     = $this->db->query($sql);
           if ( $res->num_rows()>0 ) {
                echo '1';
                exit();
           } 
        }
//cek spm
        if (  $lcid_spm <> $lcid_h_spm ) {
            
           $sql     = "select $cid_spm from $tabel2 where $cid_spm='$lcid_spm'";
           $res     = $this->db->query($sql);
           if ( $res->num_rows()>0 ) {
                echo '4';
                exit();
           } 
        }
// cek sp2d
        if (  $lcid_sp2d <> $lcid_h_sp2d ) {
            
           $sql     = "select $cid_sp2d from $tabel3 where $cid_sp2d='$lcid_sp2d'";
           $res     = $this->db->query($sql);
           if ( $res->num_rows()>0 ) {
                echo '5';
                exit();
           } 
        }
		
        $query   = $this->input->post('st_query');
        $asg     = $this->db->query($query);
        if ( $asg < 1 ){
			echo '0';
			exit();
	   }
    
	    $query   = $this->input->post('st_query_spm');
        $asg     = $this->db->query($query);
        if ( $asg < 1 ){
           echo '0';
		   exit();
        }
		
        $query   = $this->input->post('st_query_sp2d');
        $asg     = $this->db->query($query);
        if ( $asg < 1 ){
			echo '0';
			exit();
        }
		echo '2';
		
		// sp2d ini sementara manual dulu by tox
		/* 
		$hasil=$this->db->query(" select nomor FROM  nomor_sp2d where no_sp2d='$no_sementara' ");
		foreach ($hasil->result_array() as $row){
		$nomor_urut=$row['nomor'];	
		}
		$real_no_sp2d =strval($nomor_urut).$sp2d_blk;
		
            $sql = "update nomor_sp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sementara'";
            $asg = $this->db->query($sql);
            if($asg){
                echo '2';
            }else{
                echo '0';
            } */

	}
    
    function simpan_spp()
	{
                        $no_spp = $this->input->post('no_spp');
                        $no_spm = $this->input->post('no_spm');
						$no_sp2d = $this->input->post('no_sp2d');
						$kd_skpd = $this->input->post('cskpd');
                        $keperluan = $this->input->post('keperluan');
                        $jns_spp = $this->input->post('jns_spp');
                        $tgl_spp = $this->input->post('tgl_spp');
                        $tgl_spm = $this->input->post('tgl_spm');
                        $tgl_sp2d = $this->input->post('tgl_sp2d');                        
                        $bulan = $this->input->post('bulan');                        
                        $spd = $this->input->post('cspd');
                        $bank= $this->input->post('bank');
                        $nmrekan= $this->input->post('rekanan');
                        $no_rek= $this->input->post('rekening');
                        $npwp= $this->input->post('npwp');
                        $nm_skpd= $this->input->post('nmskpd');
                        $nilai= $this->input->post('nilai');
                        $no_bukti= $this->input->post('bukti');
                        $giat = $this->input->post('kegi');
                        $nmgiat = $this->input->post('nmkegi');
                        $prog = $this->input->post('prog');
                        $nmprog = $this->input->post('nmprog');
                        $dir = $this->input->post('dir');
                        $usernm= $this->session->userdata('pcNama');
                        //date_default_timezone_set('Asia/Bangkok');
                        $last_update=  date('Y-m-d H:i:s');
                        
                        
                    $sql = "delete from trhspp where kd_skpd='$kd_skpd' and no_spp='$no_spp' ";
                    $asg = $this->db->query($sql);
                    $sql1 = "delete from trhspm where kd_skpd='$kd_skpd' and no_spm='$no_spm' ";
                    $asg1 = $this->db->query($sql1);
                    $sql2 = "delete from trhsp2d where kd_skpd='$kd_skpd' and no_sp2d='$no_sp2d'";
                    $asg2 = $this->db->query($sql2);
                    
           	
                    $query ="insert into trhspp(no_spp,kd_skpd,keperluan,bulan,no_spd,jns_spp,bank,nmrekan,no_rek,npwp,nm_skpd,tgl_spp,status,username,last_update,nilai,no_bukti,kd_kegiatan,nm_kegiatan,kd_program,nm_program,pimpinan) 
                    values('$no_spp','$kd_skpd','$keperluan','$bulan','$spd','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nm_skpd','$tgl_spp','0','$usernm','$last_update','$nilai','$no_bukti','$giat','$nmgiat','$prog','$nmprog','$dir') ";
                    $asg1 = $this->db->query($query);                    				
			
                    $query1 ="insert into trhspm(no_spm,tgl_spm,no_spp,kd_skpd,keperluan,bulan,no_spd,jns_spp,bank,nmrekan,no_rek,npwp,nm_skpd,tgl_spp,status,username,last_update,nilai) 
                    values('$no_spm','$tgl_spm','$no_spp','$kd_skpd','$keperluan','$bulan','$spd','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nm_skpd','$tgl_spp','0','$usernm','$last_update','$nilai') ";
                    $asg2 = $this->db->query($query1);                    				
		
                    $query2 ="insert into trhsp2d(no_sp2d,tgl_sp2d,no_spm,tgl_spm,no_spp,kd_skpd,nm_skpd,tgl_spp,bulan,no_spd,keperluan,username,last_update,status,jns_spp,bank,nmrekan,no_rek,npwp,nilai) 
                    values('$no_sp2d','$tgl_sp2d','$no_spm','$tgl_spm','$no_spp','$kd_skpd','$nm_skpd','$tgl_spp','$bulan','$spd','$keperluan','$usernm','$last_update','0','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nilai') ";
                    $asg3 = $this->db->query($query2);                     				
		
       
        echo '1';
       //$asg->free_result(); 
	}     
    
    function dsimpan()
	{
						$no_spp      = trim($this->input->post('cno_spp'));
						$kd_skpd     = $this->input->post('cskpd');
                        $kd_kegiatan = $this->input->post('cgiat');
                        $kd_rek5     = $this->input->post('crek');
                        $nm_kegiatan = $this->input->post('ngiat');
                        $nm_rek5     = $this->input->post('nrek');
                        $nilai       = $this->input->post('nilai');
                        $sis         = $this->input->post('sis');
                        $kd          = $this->input->post('kd');
                        $vno_bukti   = $this->input->post('no_bukti1');
                        
           $sql = "delete from trdspp where no_spp='$no_spp' and kd_kegiatan='$kd_kegiatan' and kd_rek5='$kd_rek5' and no_bukti='$vno_bukti' ";
           
           $asg = $this->db->query($sql);
            if ($asg > 0){  	
                    $query ="insert into trdspp(no_spp,kd_skpd,kd_kegiatan,kd_rek5,nm_kegiatan,nm_rek5,nilai,sisa,kd,no_bukti) values('$no_spp','$kd_skpd','$kd_kegiatan','$kd_rek5','$nm_kegiatan','$nm_rek5','$nilai','$sis','$kd','$vno_bukti') ";                    
                    $asg = $this->db->query($query);
					
                    					
			} else {
            echo '0';
            exit();
        }
        echo '1';
	}
    
	
    function dsimpan_hapus_pajak()
	{
           $no_spm  = trim($this->input->post('cno_spm'));
           $kd_skpd    = $this->input->post('kode');

               $sql     = " delete from trspmpot where no_spm='$no_spm' and kd_skpd='$kd_skpd' ";
               $asg     = $this->db->query($sql);
               if ($asg > 0){  	
                    echo '1';
                    exit();
               } else {
                    echo '0';
                    exit();
               }
   
	}
	
    function dsimpan_pajak()
	{
		
		   $skpd    = $this->input->post('cskpd');
           $spm     = $this->input->post('spm');
           $kd_rek5 = $this->input->post('kd_rek5');
           $nm_rek5 = $this->input->post('nmrek');
           $nilai   = $this->input->post('nilai');
           $pot     = $this->input->post('pot');                            
  
           $sql = "delete from trspmpot where kd_skpd='$skpd' and no_spm='$spm' and kd_rek5='$kd_rek5'";
           $asg = $this->db->query($sql);
            if ($asg > 0){  	
                $query = " insert into trspmpot(no_spm,kd_skpd,kd_rek5,nm_rek5,nilai,pot) values('$spm','$skpd','$kd_rek5','$nm_rek5','$nilai','$pot') ";                    
                $asg   = $this->db->query($query) ;
			} else {
                echo '0';
                exit();
            }
        echo '1';
	}
	
    function hapus_tukd(){

        $ctabel = $this->input->post('tabel');
        $cid    = $this->input->post('cid');
        $cnid   = $this->input->post('cnid');
        $csql   = "delete from $ctabel where $cid = '$cnid'";
                
        $asg = $this->db->query($csql);
        if ( $asg > 0 ) {
            echo '1'; 
        } else {
            echo '0';
        }
                       
    }
    
    
    function dsimpan_hapus()
	{
           $no_spp  = trim($this->input->post('cno_spp'));
           $lcid    = $this->input->post('lcid');
           $lcid_h  = $this->input->post('lcid_h');
           
           if (  $lcid <> $lcid_h ) {
               $sql     = " delete from trdspp where no_spp='$no_spp' ";
               $asg     = $this->db->query($sql);
               if ($asg > 0){  	
                    echo '1';
                    exit();
               } else {
                    echo '0';
                    exit();
               }
          }     
	}
    
    function dsimpan_trmpot()
	{
			
						$no_bukti = $this->input->post('no_bukti');						
                        $kd_rek5 = $this->input->post('crek');                       
                        $nm_rek5 = $this->input->post('nrek');
                        $nilai = $this->input->post('nilai');      

           
             	
           $query ="insert into trdtrmpot(no_bukti,kd_rek5,nm_rek5,nilai) values('$no_bukti','$kd_rek5','$nm_rek5','$nilai') ";                    
           $asg1 = $this->db->query($query);
                    					
			
        echo '1';
        
     
       //$asg->free_result();  
	}
    
    function psimpan() {
	
        $bukti=$this->input->post('bukti');
        $kd_rek5=$this->input->post('kd_rek5');        
        $nm_rek5=$this->input->post('nm_rek5');        
        $nilai=$this->input->post('nilai');
                                        
		$query1 = $this->db->query(" delete from trdtrmpot where no_bukti='$bukti' and kd_rek5='$kd_rek5'");
		$query = $this->db->query(" insert into trdtrmpot(no_bukti,kd_rek5,nm_rek5,nilai) values('$bukti','$kd_rek5','$nm_rek5','$nilai') ");	

		//$this->select_data($spd);
        
    }
    
    function psimpan_str() {
	
        $bukti=$this->input->post('bukti');
        $kd_rek5=$this->input->post('kd_rek5');        
        $nm_rek5=$this->input->post('nm_rek5');        
        $nilai=$this->input->post('nilai');
                                        
		$query1 = $this->db->query(" delete from trdstrpot where no_bukti='$bukti' and kd_rek5='$kd_rek5'");
		$query = $this->db->query(" insert into trdstrpot(no_bukti,kd_rek5,nm_rek5,nilai) values('$bukti','$kd_rek5','$nm_rek5','$nilai') ");	

		//$this->select_data($spd);
        
    }
    
	function skpd_2() {
		//$kd_skpd = $this->session->userdata('kdskpd');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd order by kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result(); 	  
	}
	
	
	
    function skpd() {
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where upper(kd_skpd) like upper('%$lccr%') or upper(nm_skpd) like upper('%$lccr%') ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result(); 	   
	}
    
     function list_skpd() {
        $page = isset($_POST['page']) ? intval($_POST['page']) : 1;
        $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
	
	    $result = array();	
	    $rs = mysql_query("select count(*) from ms_skpd");
	    $row = mysql_fetch_row($rs);
	    $result["total"] = $row[0];
	
	    $rs = mysql_query("select * from ms_skpd limit $offset,$rows");
 
	    $rows = array();
	    while($row = mysql_fetch_object($rs)){
		  array_push($rows, $row);
	    }
	    $result["rows"] = $rows;
	
	    echo json_encode($result);
      
	}
    
    function kegiatan($cskpd='') {
        $lccr = $this->input->post('q');
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan FROM trskpd a inner join m_giat b on a.kd_kegiatan1=b.kd_kegiatan where a.kd_skpd='$cskpd' and 
        (upper(a.kd_kegiatan) like upper('%$lccr%') or upper(b.nm_kegiatan) like upper('%$lccr%'))";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan']  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function spd($cgiat='') {        
        $sql = "select no_spd,kd_kegiatan from trdspd where kd_kegiatan='$cgiat'";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],  
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	

    function spd1() {

        $skpd  = $this->input->post('kode');
        $v_ats_beban  = $this->input->post('v_ats_beban');
        $sql   = " select no_spd, tgl_spd from trhspd where kd_skpd='$skpd' and jns_beban='$v_ats_beban'";
       // $sql   = " select no_spd, tgl_spd from trhspd ";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],  
                        'tgl_spd' => $resulte['tgl_spd']  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
        
	function spd_ppkd() {

        $skpd  = $this->session->userdata('kdskpd');
        $sql   = " select no_spd, tgl_spd from trhspd where kd_skpd='$skpd'";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],  
                        'tgl_spd' => $resulte['tgl_spd']  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	
 function kegi() {
        $spd=$this->input->post('spd');
        $lccr = $this->input->post('q');
        $sql  = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,c.nm_program,a.nilai FROM trdspd a INNER JOIN m_giat b ON 
                a.kd_kegiatan=b.kd_kegiatan INNER JOIN m_prog c ON a.kd_program = c.kd_program where a.no_spd='$spd' and 
                (upper(a.kd_kegiatan) like upper('%$lccr%') or upper(b.nm_kegiatan) like upper('%$lccr%')) order by  a.kd_kegiatan ";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],  
                        'kd_program' => $resulte['kd_program'], 
                        'nm_program' => $resulte['nm_program'], 
                        'nilai_spd' => $resulte['nilai']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();	   
	}
	
    function trans($cskpd='') {
        //$cskpd = $this->input->post('dns');
        $sql = "select no_bukti,tgl_bukti from trhtransout where kd_skpd='$cskpd'";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_bukti' => $resulte['no_bukti'],  
                        'tgl_bukti' => $resulte['tgl_bukti'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function select_rka($kegiatan='') {
    //$kegiatan = $this->uri->segment(3);
        $sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai as total from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 where kd_kegiatan='$kegiatan' order by a.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                         'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai']),
                        'total' => $resulte['total']  
                           
                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
    
    function select_data($spd='') {
    $spd=$this->input->post('spd');
        $sql = "SELECT a.kd_kegiatan,c.nm_kegiatan,a.kd_rek5,b.nm_rek5,a.nilai,(SELECT SUM(nilai) FROM trdspp WHERE kd_kegiatan =a.kd_kegiatan AND kd_rek5=a.kd_rek5)AS total 
                FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 INNER JOIN trskpd d ON a.kd_kegiatan=d.kd_kegiatan INNER JOIN m_giat c ON d.kd_kegiatan1=c.kd_kegiatan
                WHERE a.kd_kegiatan IN(SELECT kd_kegiatan FROM trdspd WHERE no_spd='$spd') ORDER BY a.kd_kegiatan";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                         'id' => $ii,
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],       
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai']),
                        'total' => number_format($resulte['total']),
                        'a' => $resulte['nilai'],
                        'b' => $resulte['total']
                       
                           
                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
    
    function select_data1($spp='') {
    //$kegiatan = $this->uri->segment(3);
		
		$spp=$this->input->post('spp');
        $sql = "SELECT kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,sisa FROM trdspp WHERE no_spp='$spp' ORDER BY kd_kegiatan,kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                         'idx' => $ii,
                        'kdkegiatan' => $resulte['kd_kegiatan'],
                        'nmkegiatan' => $resulte['nm_kegiatan'],       
                        'kdrek5' => $resulte['kd_rek5'],  
                        'nmrek5' => $resulte['nm_rek5'],  
                        'nilai1' => $resulte['nilai'],
                        'nilai' => number_format($resulte['nilai'],"2",",","."),
                        'sisa' => number_format($resulte['sisa'],"2",",","."),                        
                        'sis' => $resulte['sisa'] 
                           
                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
    
    function select_data2() {
    $kegi=$this->input->post('giat');
        $sql = "SELECT a.kd_kegiatan,c.nm_kegiatan,a.kd_rek5,b.nm_rek5,a.nilai,(SELECT SUM(nilai) FROM trdspp WHERE kd_kegiatan =a.kd_kegiatan AND kd_rek5=a.kd_rek5)AS total 
                FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 INNER JOIN trskpd d ON a.kd_kegiatan=d.kd_kegiatan INNER JOIN m_giat c ON d.kd_kegiatan1=c.kd_kegiatan
                WHERE a.kd_kegiatan ='$kegi' ORDER BY a.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                         'id' => $ii,
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],       
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai'],"2",",","."),
                        'total' => number_format($resulte['total'],"2",",","."),
                        'a' => $resulte['nilai'],
                        'b' => $resulte['total']                        
                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
    
    function select_data_tran($no_bukti='') {
    //$kegiatan = $this->uri->segment(3);
    $no_bukti=$this->input->post('no_bukti');
        $sql = "SELECT kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai FROM trdtransout WHERE no_bukti='$no_bukti' ORDER BY kd_kegiatan,kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                         'idx' => $ii,
                        'kdkegiatan' => $resulte['kd_kegiatan'],
                        'nmkegiatan' => $resulte['nm_kegiatan'],       
                        'kdrek5' => $resulte['kd_rek5'],  
                        'nmrek5' => $resulte['nm_rek5'],  
                        'nilai1' => $resulte['nilai']
                        
                           
                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
    
   
    function ld_rek($giat='') {
    
        $sql = " SELECT a.kd_rek5 as kd_rek5,b.nm_rek5 as nm_rek5 FROM trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 where a.kd_kegiatan='$giat' order by a.kd_rek5 ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function lds_rek($giat='') {
    
        $sql = " SELECT a.kd_rek5 as kd_rek5,b.nm_rek5 as nm_rek5 FROM trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 where a.kd_subkegiatan='$giat' order by a.kd_rek5 ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function tsimpan() {
		$skpd=$this->input->post('cskpd');
        $spp=$this->input->post('cspp');
        $rek=$this->input->post('crek');
        $giat=$this->input->post('cgiat');
        $nmrek=$this->input->post('cnmrek');
        $nmgiat=$this->input->post('cnmgiat');
        $sisa=$this->input->post('sspp');
                                        
		//$query = $this->db->query(" delete from trdspp where kd_skpd='$skpd' and no_spp='$spp' and kd_rek5='$rek' and kd_kegiatan='$giat' ");
		$query = $this->db->query(" insert into trdspp(no_spp,kd_skpd,kd_kegiatan,kd_rek5,nm_kegiatan,nm_rek5,nilai,sisa) values('$spp','$skpd','$giat','$rek','$nmgiat','$nmrek',0,'$sisa') ");	

		$this->select_data($spd);
        
    }
   
function cek_simpan(){
	    $nomor    = $this->input->post('no');
	    $tabel   = $this->input->post('tabel');
	    $field    = $this->input->post('field');

		$hasil=$this->db->query(" select count(*) as jumlah FROM $tabel where $field='$nomor' ");
		foreach ($hasil->result_array() as $row){
		$jumlah=$row['jumlah'];	
		}
		if($jumlah>0){
		$msg = array('pesan'=>'1');
        echo json_encode($msg);
		} else{
		$msg = array('pesan'=>'0');
        echo json_encode($msg);
		}
		
	}
	 
   
  function hhapus() {    	
		$nomor = $this->input->post('no');        
        $query = $this->db->query("delete from trhspp where no_spp='$nomor'");
		$query = $this->db->query("delete from trdspp where no_spp='$nomor'");
         $query->free_result();
    }
   function hhapus_pkd() {    	
		$spp = $this->input->post('spp');
        $spm = $this->input->post('spm');
        $sp2d = $this->input->post('sp2d');        
        $this->db->query("delete from trhspp where no_spp='$spp'");
		$this->db->query("delete from trdspp where no_spp='$spp'");
        $this->db->query("delete from trhspm where no_spm='$spm'");
		$this->db->query("delete from trhsp2d where no_sp2d='$sp2d'");
        
         //$query->free_result();
    }
  function thapus($spp='',$kegiatan='',$rek='') {
    	
		$id=str_replace('123456789','/',$spp);
		$query = $this->db->query(" delete from trdspp where no_spp='$id' and kd_kegiatan='$kegiatan' and kd_rek5='$rek' ");			
		$this->select_data1($id);
        // $query->free_result();
    }
  
  function hapus_spp($spp='')
	{		
		$id=str_replace('123456789','/',$spp);
		$query = $this->db->query("delete from trhspp where no_spp='$id'");
		$query = $this->db->query("delete from trdspp where no_spp='$id'");
			
		$this->spp();
         $query->free_result();
	}
    
    function cetak_spp() {
        $this->template->set('title', 'SPP &raquo; Ubah Data');
		$this->template->load('template', 'tukd/spp/cetak_spp');    	   
	}
    
    function pilih_spp() {
        $lccr = $this->input->post('q');
        $sql = "SELECT no_spp,kd_skpd,tgl_spp,jns_spp FROM trhspp where upper(no_spp) like upper('%$lccr%') or upper(kd_skpd) like upper('%$lccr%') ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spp' => $resulte['no_spp'],  
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'tgl_spp' => $resulte['tgl_spp'],
                        'jns_spp' => $resulte['jns_spp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	
    function pilih_ttd($dns='') {
        $lccr = $this->input->post('q');
        $sql = "SELECT nip,nama,jabatan,kd_skpd FROM ms_ttd where kd_skpd ='$dns' ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],  
                        'jabatan' => $resulte['jabatan'],
                        'kd_skpd' => $resulte['kd_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	
	
    function pilih_ttd_bud() {
        $sql = "SELECT nip,nama,jabatan,kd_skpd FROM ms_ttd where kd_skpd='1.20.00.00' ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],  
                        'jabatan' => $resulte['jabatan'],
                        'kd_skpd' => $resulte['kd_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	
	function pilih_ttd_tox($dns='') {
        $kd = $this->input->post('kd');
        $sql = "SELECT nip,nama,jabatan,kd_skpd,npwp FROM ms_ttd where kd_skpd='$dns' and kode='$kd' ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],  
                        'jabatan' => $resulte['jabatan'],
                        'kd_skpd' => $resulte['kd_skpd'],
						'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }	
           
        echo json_encode($result);
     $query1->free_result();	   
	}

	
    
    function load_sum_spp(){

		$spp = $this->input->post('spp');
        $id=str_replace('123456789','/',$spp);
        $query1 = $this->db->query("select sum(nilai) as rektotal from trdspp where no_spp='$id'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal']),
                        'rektotal1' => $resulte['rektotal']                       
                        );
                        $ii++;
        }           
           //return $result;
		   echo json_encode($result);
         $query1->free_result();	
	}

    function load_sum_tran(){

		$id = $this->input->post('no_bukti');
        
        $query1 = $this->db->query("select sum(nilai) as rektotal from trdtransout where no_bukti='$id'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal']),
                        'rektotal1' => $resulte['rektotal']                       
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);
            $query1->free_result();	
	}
    
 ///////////akhir dari spp
 
 //////////SPM milai
 
    function spm()
    {
        $data['page_title']= 'INPUT S P M';
        $this->template->set('title', 'INPUT S P M');   
        $this->template->load('template','tukd/spm/spm',$data) ; 
    }
    
    function load_spm() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ="where kd_skpd='1.20.05.01'";
        if ($kriteria <> ''){                               
            $where="where  kd_skpd='1.20.05.01' and ((upper(no_spm) like upper('%$kriteria%') or tgl_spm like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%'))) ";            
        }
        
        $sql = "SELECT count(*) as tot from trhspm $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        $sql = "SELECT * from trhspm $where order by no_spm,kd_skpd limit $offset,$rows";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status']                                                                                   
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();	   
	}
    
    function nospp_2() {
		$kd_skpd ='1.20.05.01';
        //$lccr = $this->input->post('q');
        $sql = "SELECT * FROM trhspp WHERE status <> '1' and kd_skpd = '$kd_skpd' ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function nospp() {
        $lccr = $this->input->post('q');
        $sql = "SELECT * FROM trhspp where kd_skpd='1.20.05.01' and (upper(no_spp) like upper('%$lccr%') or upper(kd_skpd) like upper('%$lccr%')) ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function pilih_spm() {
        $lccr = $this->input->post('q');
        $sql = "SELECT no_spm,kd_skpd,no_spp FROM trhspm where upper(no_spm) like upper('%$lccr%') or upper(kd_skpd) like upper('%$lccr%') ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spm' => $resulte['no_spm'],  
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'no_spp' => $resulte['no_spp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function simpan_spm()
	{
                        $no_spm = $this->input->post('no_spm');
                        $tgl_spm = $this->input->post('tgl_spm');
						$no_spp = $this->input->post('no_spp');
						$kd_skpd = $this->input->post('cskpd');
                        $keperluan = $this->input->post('keperluan');
                        $jns_spp = $this->input->post('jns_spp');
                        $tgl_spp = $this->input->post('tgl_spp');//                        
                        $bulan = $this->input->post('bulan');                        
                        $spd = $this->input->post('cspd');
                        $bank= $this->input->post('bank');
                        $nmrekan= $this->input->post('rekanan');
                        $no_rek= $this->input->post('rekening');
                        $npwp= $this->input->post('npwp');
                        $nm_skpd= $this->input->post('nmskpd');
                        $nilai= $this->input->post('nilai');
                        $usernm= $this->session->userdata('pcNama');
                        //date_default_timezone_set('Asia/Bangkok');
                        $last_update=  date('Y-m-d H:i:s');
                        
           $sql = "delete from trhspm where kd_skpd='$kd_skpd' and no_spm='$no_spm'";
           $asg = $this->db->query($sql);
            if ($asg > 0){  	
                    $query ="insert into trhspm(no_spm,tgl_spm,no_spp,kd_skpd,keperluan,bulan,no_spd,jns_spp,bank,nmrekan,no_rek,npwp,nm_skpd,tgl_spp,status,username,last_update,nilai) 
                    values('$no_spm','$tgl_spm','$no_spp','$kd_skpd','$keperluan','$bulan','$spd','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nm_skpd','$tgl_spp','0','$usernm','$last_update','$nilai') ";
                    $asg = $this->db->query($query);                    				
			} else {
            echo '0';
            exit();
        }
        echo '1';
     $query1="update trhspp set status='1' where no_spp='$no_spp'";
     $asg1 = $this->db->query($query1);
      //  $asg->free_result();
//       $query1->free_result();  
	}
     function hapus_spm() {    	
		$nom = $this->input->post('no');
        $spp = $this->input->post('spp');        
        $query = $this->db->query("delete from trhspm where no_spm='$nom'");
        $query = $this->db->query("delete from trspmpot where no_spm='$nom'");
		$query = $this->db->query("update trhspp set status='0' where no_spp='$spp'");
        $query->free_result();
    }    
       
    function rek_pot() {
        
        $sql = "SELECT kd_rek5,nm_rek5 FROM ms_rek5 where left(kd_rek5,1)='2'";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function pot_simpan() {
		$skpd=$this->input->post('cskpd');
        $spm=$this->input->post('spm');
        $kd_rek5=$this->input->post('kd_rek5');
        $nm_rek5=$this->input->post('nmrek');                                     
		$query = $this->db->query("delete from trspmpot where kd_skpd='$skpd' and no_spm='$spm' and kd_rek5='$kd_rek5'");
		$query = $this->db->query(" insert into trspmpot(no_spm,kd_skpd,kd_rek5,nm_rek5,nilai,pot) values('$spm','$skpd','$kd_rek5','$nm_rek5','0','0') ");	

		$this->select_data($spd);
        // $query->free_result();
    }
    
	
    function dsimpan_pot_delete_ar()
	{
		   $skpd    = $this->input->post('cskpd');
           $spm     = $this->input->post('spm');
           $kd_rek5 = $this->input->post('kd_rek5');
   
           $sql = "delete from trspmpot where kd_skpd='$skpd' and no_spm='$spm' and kd_rek5='$kd_rek5'";
           $asg = $this->db->query($sql);
            if ($asg > 0) { 
                 echo '1' ;
                 exit();
			} else {
                 echo '0' ;
                 exit();
            }
	}
	
    function pot() {
        $spm=$this->input->post('spm');
        $sql = "SELECT * FROM trspmpot where no_spm='$spm' order by kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'pot' => $resulte['pot'],
                        'nilai' => $resulte['nilai']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 //$query1->free_result();   
	}
    
    function pot_in() {
        $bukti=$this->input->post('bukti');
        $sql = "SELECT * FROM trdtrmpot where no_bukti='$bukti'";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
                        'nilai' => $resulte['nilai']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 //$query1->free_result();   
	}
    
    function pot1() {
        $bukti=$this->input->post('bukti');
        $sql = "SELECT * FROM trdtrmpot where no_bukti='$bukti'";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
                        'nilai' => $resulte['nilai']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	// $query1->free_result();   
	}
    
    function pot_out() {
        $bukti=$this->input->post('bukti');
        $sql = "SELECT * FROM trdstrpot where no_bukti='$bukti'";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
                        'nilai' => $resulte['nilai']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	// $query1->free_result();   
	}
    
    function potsimpan() {
		$skpd=$this->input->post('cskpd');
        $spm=$this->input->post('spm');
        $kd_rek5=$this->input->post('kd_rek5');
        $nm_rek5=$this->input->post('nmrek');
        $nilai=$this->input->post('nilai');
        $pot=$this->input->post('ket');                                     
		$query = $this->db->query("delete from trspmpot where kd_skpd='$skpd' and no_spm='$spm' and kd_rek5='$kd_rek5'");
		$query = $this->db->query(" insert into trspmpot(no_spm,kd_skpd,kd_rek5,nm_rek5,nilai,pot) values('$spm','$skpd','$kd_rek5','$nm_rek5','$nilai','$pot') ");	

		$this->pot();
        $query->free_result();
    }
    
     function hapus_pot() {    	
		$sp = $this->input->post('no');
        $r = $this->input->post('rek');        
        $query = $this->db->query("delete from trspmpot where no_spm='$sp' and kd_rek5='$r'");
        $query->free_result();
    }
    
    function load_sum_spm(){

		$spp = $this->input->post('spp');
        //$id=str_replace('123456789','/',$spp);
        $query1 = $this->db->query("select sum(nilai) as rekspm from trdspp where no_spp='$spp'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rekspm' => number_format($resulte['rekspm']),
                        'rekspm1' => $resulte['rekspm']                       
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);
            $query1->free_result();	
	}
    
    function load_sum_pot(){

		$spm = $this->input->post('spm');
        //$id=str_replace('123456789','/',$spp);
        $query1 = $this->db->query("select sum(nilai) as rektotal from trspmpot where no_spm='$spm'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal']),
                        'rektotal1' => $resulte['rektotal']                       
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);
           $query1->free_result();	
	}
     function load_trm_pot(){

		$bukti = $this->input->post('bukti');
        //$id=str_replace('123456789','/',$spp);
        $query1 = $this->db->query("select sum(nilai) as rektotal from trdtrmpot where no_bukti='$bukti'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal']),
                        'rektotal1' => $resulte['rektotal']                       
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);
           $query1->free_result();	
	}
    
    function load_str_pot(){

		$bukti = $this->input->post('bukti');
        //$id=str_replace('123456789','/',$spp);
        $query1 = $this->db->query("select sum(nilai) as rektotal from trdstrpot where no_bukti='$bukti'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal']),
                        'rektotal1' => $resulte['rektotal']                       
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);
           $query1->free_result();	
	}
    
    function ld_giat($skpd='') { 
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_kegiatan,nm_kegiatan FROM trskpd where kd_skpd='$skpd' and (upper(kd_kegiatan) like upper('%$lccr%') or upper(nm_kegiatan) like upper('%$lccr%')) order by kd_kegiatan ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan']                                         
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}    
    
//////---------------Akhir SPM
//////------- Awal SP2D  

    function sp2d()
    {
        $data['page_title']= 'INPUT S P 2 D';
        $this->template->set('title', 'INPUT S P 2 D');   
        $this->template->load('template','tukd/sp2d/sp2d',$data) ; 
    }

	function sp2d_up(){
        $data['page_title']= 'INPUT SP2D';
        $this->template->set('title', 'INPUT SP2D UP');   
        $this->template->load('template','tukd/sp2d/sp2d_up',$data) ; 
    }

	function sp2d_ls(){
        $data['page_title']= 'INPUT SP2D';
        $this->template->set('title', 'INPUT SP2D LS');   
        $this->template->load('template','tukd/sp2d/sp2d_ls',$data) ; 
    }
	
	function sp2d_gu(){
        $data['page_title']= 'INPUT SP2D';
        $this->template->set('title', 'INPUT SP2D GU');   
        $this->template->load('template','tukd/sp2d/sp2d_gu',$data) ; 
    }

	function sp2d_gj()
    {
        $data['page_title']= 'INPUT SP2D';
        $this->template->set('title', 'INPUT SP2D Gaji');   
        $this->template->load('template','tukd/sp2d/sp2d_gj',$data) ; 
    }	
	
	function sp2d_tu(){
        $data['page_title']= 'INPUT SP2D';
        $this->template->set('title', 'INPUT SP2D TU');   
        $this->template->load('template','tukd/sp2d/sp2d_tu',$data) ; 
    }
	
	 function sp2d_manual()
    {
        $data['page_title']= 'INPUT S P 2 D MANUAL';
        $this->template->set('title', 'INPUT S P 2 D MANUAL');   
        $this->template->load('template','tukd/sp2d_manual/sp2d_manual',$data) ; 
    }
    
	 function sp2d_manual_gj()
    {
        $data['page_title']= 'INPUT S P 2 D MANUAL GAJI';
        $this->template->set('title', 'INPUT S P 2 D MANUAL GAJI');   
        $this->template->load('template','tukd/sp2d_manual/sp2d_manual_gj',$data) ; 
    }
	 function sp2d_manual_up()
    {
        $data['page_title']= 'INPUT S P 2 D MANUAL UP';
        $this->template->set('title', 'INPUT S P 2 D MANUAL UP');   
        $this->template->load('template','tukd/sp2d_manual/sp2d_manual_up',$data) ; 
    }
	 function sp2d_manual_gu()
    {
        $data['page_title']= 'INPUT S P 2 D MANUAL GU';
        $this->template->set('title', 'INPUT S P 2 D MANUAL GU');   
        $this->template->load('template','tukd/sp2d_manual/sp2d_manual_gu',$data) ; 
    }

	 function lpj_tu()
    {
        $data['page_title']= 'INPUT LPJ TU';
        $this->template->set('title', 'INPUT LPJ TU');   
        $this->template->load('template','tukd/sp2d/lpj_tu',$data) ; 
    }

	 function lpj_up()
    {
        $data['page_title']= 'PENGESAHAN LPJ UP';
        $this->template->set('title', 'PENGESAHAN LPJ UP/GU');   
        $this->template->load('template','tukd/sp2d/lpj_up',$data) ; 
    }
    
     function sp2d_ppkd()
    {
        $data['page_title']= 'INPUT S P 2 D - P P K D';
        $this->template->set('title', 'INPUT S P 2 D - P P K D');   
        $this->template->load('template','tukd/sp2d/sp2d_ppkd',$data) ; 
    }
    
    function sp2d_pkd()
    {
        $data['page_title']= 'INPUT S P 2 D';
        $this->template->set('title', 'INPUT S P 2 D');   
        $this->template->load('template','tukd/sp2d/sp2d_pkd',$data) ; 
    }
    
    function sp2d_gu_pkd()
    {
        $data['page_title']= 'INPUT S P 2 D - G U';
        $this->template->set('title', 'INPUT S P 2 D - GU');   
        $this->template->load('template','tukd/sp2d/sp2d_gu_pkd',$data) ; 
    }
    
    function sp2d_up_pkd()
    {
        $data['page_title']= 'INPUT S P 2 D - U P';
        $this->template->set('title', 'INPUT S P 2 D - UP');   
        $this->template->load('template','tukd/sp2d/sp2d_up_pkd',$data) ; 
    }
    
    function load_sp2d() {
        
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd<>'' ";
        if ($kriteria <> ''){                               
            $where=" (upper(no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd) z where $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
		
        
        /*$sql = "SELECT TOP $rows *
		from (select a.* , (case when c.jns_beban='51' then 'BTL' else 'BL' end)jns_spd
		from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where and no_sp2d not in 
		(SELECT TOP $offset no_sp2d from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where) order by no_sp2d,kd_skpd";*/
        
        $sql = "SELECT TOP $rows *
		from (select a.* 
		from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd ) z where $where and no_sp2d not in 
		(SELECT TOP $offset no_sp2d from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd) z where $where) order by no_sp2d,kd_skpd";
        
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {             
           if ($resulte['status_terima']=='1'){
				$s='Sudah Diterima';
			}else{
				$s='Belum Diterima';			
			}

			if ($resulte['status']=='1'){
				$s_bud='Sudah Cair';
			}else{
				$s_bud='Belum Cair';			
			}
            
            $spdd  = $resulte['no_spd'];
            $cekk = $this->db->query("select jns_beban from trhspd where no_spd='$spdd'")->row();
            $jns_bbn = $cekk->jns_beban;
            
            if($jns_bbn=="51"){
                $jns_spd = "BTL";
            }else{
                $jns_spd = "BL";
            }
            
                
            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $spdd,
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'sp2d_batal' => $resulte['sp2d_batal'],
                        'jenis_beban' => $jns_bbn,
                        'status' =>$s,                                                                           
                        'status_bud' =>$s_bud,
						'nokasbud' =>$resulte['no_kas_bud'],						
						'dkasbud' =>$resulte['tgl_kas_bud'],							
						'jns_spd' =>$jns_spd,				                        		
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();	   
	}

	function load_sp2d_up() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
		$id  = $this->session->userdata('pcUser');        
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ";
        
        if ($kriteria <> ''){                               
            $where=" (upper(no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where AND jns_spp='1'" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
		
        
        $sql = "SELECT TOP $rows *
		from (select a.* , (case when c.jns_beban='51' then 'BTL' else 'BL' end)jns_spd
		from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where  AND jns_spp='1' and no_sp2d not in 
		(SELECT TOP $offset no_sp2d from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where  AND jns_spp='1' order by no_sp2d,kd_skpd) order by no_sp2d,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           if ($resulte['status_terima']=='1'){
				$s='Sudah Diterima';
			}else{
				$s='Belum Diterima';			
			}

			if ($resulte['status_bud']=='1'){
				$s_bud='Sudah Cair';
			}else{
				$s_bud='Belum Cair';			
			}

            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'sp2d_batal' => $resulte['sp2d_batal'],
                        'jenis_beban' => $resulte['jenis_beban'],
                        'status' =>$s,                                                                           
                        'status_bud' =>$s_bud,
						'nokasbud' =>$resulte['no_kas_bud'],						
						'dkasbud' =>$resulte['tgl_kas_bud'],							
						'jns_spd' =>$resulte['jns_spd']							
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();	   
	}
	
    function load_sp2d_gu() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
		$id  = $this->session->userdata('pcUser');        
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ";
        
        if ($kriteria <> ''){                               
            $where=" (upper(no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where AND jns_spp='2'" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
		
        
        $sql = "SELECT TOP $rows *
		from (select a.* , (case when c.jns_beban='51' then 'BTL' else 'BL' end)jns_spd
		from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where  AND jns_spp='2' and no_sp2d not in 
		(SELECT TOP $offset no_sp2d from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where  AND jns_spp='2' order by no_sp2d,kd_skpd) order by no_sp2d,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           if ($resulte['status_terima']=='1'){
				$s='Sudah Diterima';
			}else{
				$s='Belum Diterima';			
			}

			if ($resulte['status_bud']=='1'){
				$s_bud='Sudah Cair';
			}else{
				$s_bud='Belum Cair';			
			}

            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'sp2d_batal' => $resulte['sp2d_batal'],
                        'jenis_beban' => $resulte['jenis_beban'],
                        'status' =>$s,                                                                           
                        'status_bud' =>$s_bud,
						'nokasbud' =>$resulte['no_kas_bud'],						
						'dkasbud' =>$resulte['tgl_kas_bud'],							
						'jns_spd' =>$resulte['jns_spd']							
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();	   
	}

	 function load_sp2d_tu() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
		$id  = $this->session->userdata('pcUser');        
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ";
        
        if ($kriteria <> ''){                               
            $where=" (upper(no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where AND jns_spp='3'" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
		
        
        $sql = "SELECT TOP $rows *
		from (select a.* , (case when c.jns_beban='51' then 'BTL' else 'BL' end)jns_spd
		from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where  AND jns_spp='3' and no_sp2d not in 
		(SELECT TOP $offset no_sp2d from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where  AND jns_spp='3' 
		order by no_sp2d,kd_skpd) order by no_sp2d,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           if ($resulte['status_terima']=='1'){
				$s='Sudah Diterima';
			}else{
				$s='Belum Diterima';			
			}

			if ($resulte['status_bud']=='1'){
				$s_bud='Sudah Cair';
			}else{
				$s_bud='Belum Cair';			
			}

            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'sp2d_batal' => $resulte['sp2d_batal'],
                        'jenis_beban' => $resulte['jenis_beban'],
                        'status' =>$s,                                                                           
                        'status_bud' =>$s_bud,
						'nokasbud' =>$resulte['no_kas_bud'],						
						'dkasbud' =>$resulte['tgl_kas_bud'],							
						'jns_spd' =>$resulte['jns_spd']							
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();	   
	}

	 function load_sp2d_gj() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
		//$id  = $this->session->userdata('pcUser');        
        $kriteria = $this->input->post('cari');
       // $where =" kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ";
        $where =" kd_skpd <>'' ";
        if ($kriteria <> ''){                               
            $where=" (upper(no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where AND jns_spp = '4'" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        $sql = "SELECT TOP $rows *
		from (select a.* , (case when c.jns_beban='51' then 'BTL' else 'BL' end) jns_spd FROM trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where  AND jns_spp = '4' AND no_sp2d not in 
		(SELECT TOP $offset no_sp2d from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where AND jns_spp = '4' order by no_sp2d,kd_skpd) order by no_sp2d,kd_skpd ";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           if ($resulte['status_terima']=='1'){
				$s='Sudah Diterima';
			}else{
				$s='Belum Diterima';			
			}

			if ($resulte['status_bud']=='1'){
				$s_bud='Sudah Cair';
			}else{
				$s_bud='Belum Cair';			
			}

            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'sp2d_batal' => $resulte['sp2d_batal'],
                        'jenis_beban' => $resulte['jenis_beban'],
                        'status' =>$s,                                                                           
                        'status_bud' =>$s_bud,
						'nokasbud' =>$resulte['no_kas_bud'],						
						'dkasbud' =>$resulte['tgl_kas_bud'],							
						'jns_spd' =>$resulte['jns_spd']							
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();	   
	}
	
	
	
	function load_sp2d_ls() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
		$id  = $this->session->userdata('pcUser');        
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ";
        if ($kriteria <> ''){                               
            $where=" (upper(no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where AND jns_spp IN ('4','5','6') AND no_sp2d NOT LIKE '%GJ%'" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        $sql = "SELECT TOP $rows *
		from (select a.* , (case when c.jns_beban='51' then 'BTL' else 'BL' end) jns_spd FROM trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where  AND jns_spp IN ('4','5','6') AND no_sp2d NOT LIKE '%GJ%' and no_sp2d not in 
		(SELECT TOP $offset no_sp2d from (select a.* from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp and a.kd_skpd=b.kd_skpd inner join trhspd c on a.no_spd=c.no_spd) z where $where AND jns_spp IN ('4','5','6') AND no_sp2d NOT LIKE '%GJ%' order by no_sp2d,kd_skpd) order by no_sp2d,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           if ($resulte['status_terima']=='1'){
				$s='Sudah Diterima';
			}else{
				$s='Belum Diterima';			
			}

			if ($resulte['status_bud']=='1'){
				$s_bud='Sudah Cair';
			}else{
				$s_bud='Belum Cair';			
			}

            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'sp2d_batal' => $resulte['sp2d_batal'],
                        'jenis_beban' => $resulte['jenis_beban'],
                        'status' =>$s,                                                                           
                        'status_bud' =>$s_bud,
						'nokasbud' =>$resulte['no_kas_bud'],						
						'dkasbud' =>$resulte['tgl_kas_bud'],							
						'jns_spd' =>$resulte['jns_spd']							
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();	   
	}
	
	
function perusahaan() {                 
        $lccr = $this->input->post('q');
		$kd_skpd  = $this->session->userdata('kdskpd');        
        $sql = "SELECT nmrekan, pimpinan, npwp, alamat FROM trhspp WHERE kd_skpd = '$kd_skpd' AND LEN(nmrekan)>1 AND UPPER(nmrekan) LIKE UPPER('%$lccr%') ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,        
                        'nmrekan' => $resulte['nmrekan'],  
                        'pimpinan' => $resulte['pimpinan'],      
                        'npwp' => $resulte['npwp'],
                        'alamat' => $resulte['alamat'],
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();
    }
	
	
    function load_sp2d_manual() {
		
        $page = isset($_POST['page']) ? intval($_POST['page']) : 1;
		$rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
		$offset = ($page-1)*$rows;
//		$kd_skpd  = $this->session->userdata('kdskpd');
        $tanda_m='1';
		$tanda_m=$this->input->post('tanda_m');
		$kriteria = '';
        $kriteria = $this->input->post('cari');
		
		switch ($tanda_m) {
			case '1':
			//LS TU
				
         $where =" jns_spp in ('3','5','6') ";
				break;
			case '2':
			// LS GAJI
			
         $where =" jns_spp in ('4') ";
				break;
			case '3':
			//UP
				
         $where =" jns_spp in ('1') ";
				break;
			case '4':
			//GU
				
         $where =" jns_spp in ('2') ";
				break;
				}
		
		
        if ($kriteria <> ''){                               
            $where=" (upper(no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
         $sql = "SELECT count(*) as tot from (select a.*,pimpinan,no_tagih,tgl_tagih,alamat,lanjut,kontrak,tgl_mulai,tgl_akhir,sts_tagih from trhsp2d a inner join trhspm b on a.no_spm=b.no_spm  inner join trhspp c on a.no_spp=c.no_spp) x where $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
		//alert('aaa');
		
        $sql = "SELECT TOP $rows * from (select a.*,pimpinan,no_tagih,tgl_tagih,alamat,lanjut,kontrak,tgl_mulai,tgl_akhir,sts_tagih,kd_kegiatan,nm_kegiatan from trhsp2d a inner join trhspm b on a.no_spm=b.no_spm  inner join trhspp c on a.no_spp=c.no_spp) x where $where and no_sp2d not in 
		(SELECT TOP $offset no_sp2d from (select a.*,pimpinan,no_tagih,tgl_tagih,alamat,lanjut,kontrak,tgl_mulai,tgl_akhir,sts_tagih,kd_kegiatan,nm_kegiatan from trhsp2d a inner join trhspm b on a.no_spm=b.no_spm  inner join trhspp c on a.no_spp=c.no_spp) x where $where) order by no_sp2d,kd_skpd";
       // $sql = "SELECT * from trhspp WHERE kd_skpd = '$kd_skpd' $where order by no_spp,kd_skpd";
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
		
		 /*
'kd_kegiatan'=>$resulte['kd_kegiatan'],
                        'nm_kegiatan'=>$resulte['nm_kegiatan'],
                        'kd_program'=>$resulte['kd_program'],
                        'nm_program'=>$resulte['nm_program'],
						*/
           
            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],						
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status_bud'],                       
                        'dir'=>$resulte['pimpinan'],
                        'no_tagih'=>$resulte['no_tagih'],
                        'tgl_tagih'=>$resulte['tgl_tagih'],
                        'alamat'=>$resulte['alamat'],
                        'lanjut'=>$resulte['lanjut'],
                        'kontrak'=>$resulte['kontrak'],
                        'kd_kegiatan'=>$resulte['kd_kegiatan'],
                        'nm_kegiatan'=>$resulte['nm_kegiatan'],
                        'tgl_mulai'=>$resulte['tgl_mulai'],
                        'tgl_akhir'=>$resulte['tgl_akhir'],
                        'sts_tagih'=>$resulte['sts_tagih']     
                        );
                        $ii++;
        }
		$result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
	}
	
	
function total_spd() {  
        
        $ckdkegi  = $this->input->post('kegiatan');
        $ckdskpd  = $this->input->post('kd_skpd');
        $tglspd   = $this->input->post('tglspd');
        
        $query1   = $this->db->query(" SELECT  a.kd_kegiatan, SUM(a.nilai) as nilai FROM trdspd a INNER JOIN trhspd b ON a.no_spd=b.no_spd 
			where kd_skpd = '$ckdskpd' and  a.kd_kegiatan = '$ckdkegi' and b.status='1' GROUP BY a.kd_kegiatan ");   
        
        $result   = array();
        $ii       = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id'             => $ii,        
                        'nilai'          => number_format($resulte['nilai'],2,'.',','),
                       // 'nilai_spp_lalu' => number_format($resulte['rektotal_spp_lalu'],2,'.',',')
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();	
	
    }

	
function pakai_spd() {  
        
        $ckdkegi  = $this->input->post('kegiatan');
        $ckdskpd  = $this->input->post('kd_skpd');
       // $tglspd   = $this->input->post('tglspd');
        
        $query1   = $this->db->query(" Select SUM(nilai) as nilai from (SELECT a.nilai FROM  trdspp a INNER JOIN trhspp b ON a.no_spp=b.no_spp
					inner join trhspm  c on c.no_spp=b.no_spp
					inner join trhsp2d d on d.no_spm=c.no_spm   
					WHERE b.jns_spp IN ('3','4','5','6') AND a.kd_skpd = '$ckdskpd' AND a.kd_kegiatan = '$ckdkegi' and d.status='1'					
					UNION
					SELECT a.nilai FROM  trdtransout a INNER JOIN trhtransout b ON a.no_bukti=b.no_bukti 
					WHERE jns_spp IN ('1','2') AND b.kd_skpd = '$ckdskpd' AND a.kd_kegiatan = '$ckdkegi') z
			");   
        
        $result   = array();
        $ii       = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id'             => $ii,        
                        'nilai'          => number_format($resulte['nilai'],2,'.',','),
                       // 'nilai_spp_lalu' => number_format($resulte['rektotal_spp_lalu'],2,'.',',')
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();	
	
    }	
	
	
    function load_sp2d_ppkd() {
        
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ="where kd_skpd='1.20.05.01'";
        if ($kriteria <> ''){                               
            $where="where kd_skpd='1.20.05.01' and (upper(no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as tot from trhsp2d $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        $sql = "SELECT * from trhsp2d $where order by no_sp2d,kd_skpd limit $offset,$rows";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status']                                                                                   
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();	   
	}
    
    function load_pot_in() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_bukti) like upper('%$kriteria%') or tgl_bukti like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT * from trhtrmpot $where order by no_bukti,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_bukti' => $resulte['no_bukti'],
                        'tgl_bukti' => $resulte['tgl_bukti'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],        
                        'ket' => $resulte['ket'],
                        'no_sp2d' => $resulte['no_sp2d'],
                        'nilai' => $resulte['nilai'],
                        'npwp' => $resulte['npwp'],
                        'status' => $resulte['status']
                                                                                                     
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function load_pot_out() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_bukti) like upper('%$kriteria%') or tgl_bukti like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT * from trhstrpot $where order by no_bukti,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_bukti' => $resulte['no_bukti'],
                        'tgl_bukti' => $resulte['tgl_bukti'],
                        'no_terima' => $resulte['no_terima'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],        
                        'ket' => $resulte['ket'],                       
                        'nilai' => $resulte['nilai'],
                        'npwp' => $resulte['npwp']
                        
                                                                                                     
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	} 
     
     
    function load_sp2d_pkd($jns='') {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ="where a.jns_spp='$jns'";
        if ($kriteria <> ''){                               
            $where="where a.jns_spp='$jns' and (upper(a.no_sp2d) like upper('%$kriteria%') or a.tgl_sp2d like '%$kriteria%' or upper(a.kd_skpd) like 
                    upper('%$kriteria%') or upper(a.jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT a.*,b.kd_kegiatan,b.nm_kegiatan,b.kd_program,b.nm_program,b.pimpinan FROM trhsp2d a INNER JOIN trhspp b ON a.no_spp=b.no_spp $where order by no_sp2d,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status'],
                        'kd_kegiatan'=>$resulte['kd_kegiatan'],
                        'nm_kegiatan'=>$resulte['nm_kegiatan'],
                        'kd_program'=>$resulte['kd_program'],
                        'nm_program'=>$resulte['nm_program'],
                        'dir'=>$resulte['pimpinan']                                                                                                    
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function load_sp2d_ls_tu_pkd() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ="where a.jns_spp not in('1','2')";
        if ($kriteria <> ''){                               
            $where="where a.jns_spp not in('1','2') and (upper(a.no_sp2d) like upper('%$kriteria%') or a.tgl_sp2d like '%$kriteria%' or upper(a.kd_skpd) like 
                    upper('%$kriteria%') or upper(a.jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT a.*,b.kd_kegiatan,b.nm_kegiatan,b.kd_program,b.nm_program,b.pimpinan FROM trhsp2d a INNER JOIN trhspp b ON a.no_spp=b.no_spp $where order by no_sp2d,kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'status' =>$resulte['status'],
                        'kd_kegiatan'=>$resulte['kd_kegiatan'],
                        'nm_kegiatan'=>$resulte['nm_kegiatan'],
                        'kd_program'=>$resulte['kd_program'],
                        'nm_program'=>$resulte['nm_program'],
                        'dir'=>$resulte['pimpinan']                                                                                                    
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
     function nospm() {
        $lccr = $this->input->post('q');
//        $sql = "SELECT * FROM trhspm where status = '0' AND (upper(no_spm) like upper('%$lccr%') or upper(kd_skpd) like upper('%$lccr%')) ";		
		$tanggal=date("d");
		$bulan=date("m");
		if($bulan<10){
			$bulan = str_replace("0","",$bulan);
			//$bulan = "oke";
		}
		//if($tanggal<11){
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
		where a.status = '0' and a.jns_spp ='4' and a.jenis_beban in ('1','2','9')
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))
		order by a.no_spm,a.tgl_spm,a.kd_skpd
		";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
		/*}else{
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
		where a.status = '0' 
		AND a.kd_skpd IN (select kd_skpd from trhspj_ppkd WHERE bulan='$bulan' AND cek='1')
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
		}
		*/
		$query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
						'jns_spd' => $resulte['jns_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	}
	
	function nospm_gj() {
		$id  = $this->session->userdata('pcUser'); 
       // $lccr = $this->input->post('q');
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
		where a.status = '0' AND a.jns_spp='4' 
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%')) order by a.kd_skpd,a.no_spm";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
						'jns_spd' => $resulte['jns_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	}
	
	function nospm_up() {
		$id  = $this->session->userdata('pcUser'); 
        $lccr = $this->input->post('q');
		$tanggal=date("d");
		$bulan=date("m");
		if($bulan<10){
			$bulan = str_replace("0","",$bulan);
			$bulan = $bulan-1;
		}
		//echo $bulan;
		//if($tanggal<11){
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
		where a.status = '0' AND a.jns_spp='1' AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%')) order by a.kd_skpd,a.no_spm";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
		/*}else{
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
		where a.status = '0' AND a.jns_spp='1' AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND a.kd_skpd IN (select kd_skpd from trhspj_ppkd WHERE bulan='$bulan' AND cek='1')
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
		//}
		*/
		$query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
						'jns_spd' => $resulte['jns_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	}

	function nospm_gu() {
		$id  = $this->session->userdata('pcUser'); 
        $lccr = $this->input->post('q');
		$tanggal=date("d");
		$bulan=date("m");
		if($bulan<10){
			$bulan = str_replace("0","",$bulan);
			$bulan = $bulan-1;
		}
		//if($tanggal<11){
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
		where a.status = '0' AND a.jns_spp='2' AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%')) order by a.kd_skpd,a.no_spm";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
		/*}else{
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
		where a.status = '0' AND a.jns_spp='2' AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND a.kd_skpd IN (select kd_skpd from trhspj_ppkd WHERE bulan='$bulan' AND cek='1')
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
		//}*/
		
		
		$query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
						'jns_spd' => $resulte['jns_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	}
	
	
	function nospm_tu() {
		$id  = $this->session->userdata('pcUser'); 
        $lccr = $this->input->post('q');
		$tanggal=date("d");
		$bulan=date("m");
		if($bulan<10){
			$bulan = str_replace("0","",$bulan);
			$bulan = $bulan-1;
		}
		//if($tanggal<11){
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
		where a.status = '0' AND a.jns_spp='3' AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%')) order by a.kd_skpd,a.no_spm";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
		/*}else{
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
		where a.status = '0' AND a.jns_spp='3' AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND a.kd_skpd IN (select kd_skpd from trhspj_ppkd WHERE bulan='$bulan' AND cek='1')
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
		//}
		*/
		
		$query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
						'jns_spd' => $resulte['jns_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	}
	
	function nospm_ls(){
		$id  = $this->session->userdata('pcUser');        
        $lccr = $this->input->post('q');
		$tanggal=date("d");
		$bulan=date("m");
		if($bulan<10){
			$bulan = str_replace("0","",$bulan);
			$bulan = $bulan-1;
		}
		//if($tanggal<11){
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
		where a.status = '0' AND a.jns_spp IN ('4','5','6') AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%')) order by a.kd_skpd,a.no_spm";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
		/*}else{
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
		where a.status = '0' AND a.jns_spp IN ('4','5','6') AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND a.kd_skpd IN (select kd_skpd from trhspj_ppkd WHERE bulan='$bulan' AND cek='1')
		AND (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%'))";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
		//}
		*/
		$query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte){ 
            $result[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
						'jns_spd' => $resulte['jns_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	}
	
	
	function nospm_ls2($skkpd=''){
		$id  = $this->session->userdata('pcUser');        
        $lccr = $this->input->post('q');
		$tanggal=date("d");
		$bulan=date("m");
		if($bulan<10){
			$bulan = str_replace("0","",$bulan);
			$bulan = $bulan-1;
		}
		$sql = "SELECT a.no_spm, a.tgl_spm, a.no_spp, a.tgl_spp, a.kd_skpd,a.nm_skpd,a.jns_spp,
	   a.keperluan, a.bulan, a.no_spd, a.bank, a.nmrekan, a.no_rek, a.npwp,
	   (case when jns_beban='51' then 'BTL' else 'BL' end)jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd 
		where a.status = '0' AND a.jns_spp IN ('4','5','6') AND a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')
		AND a.kd_skpd='$skkpd' and (upper(no_spm) like upper('%$lccr%') or upper(a.kd_skpd) like upper('%$lccr%')) order by a.kd_skpd,a.no_spm";//no_spm not in (select no_spm from trhsp2d where no_spm<>'$lccr') and
	
		$query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte){ 
            $result[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
						'jns_spd' => $resulte['jns_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	}
	
	function nospm1() {
        $lccr = $this->input->post('q');
//		$sql = "SELECT * FROM trhspm ";       
	   $sql = "SELECT a.*,(case when jns_beban='51' then 'BTL'
     when jns_beban='52' then 'BL'
	 else 'UP' END) jns_spd  FROM trhspm a inner join trhspd b on a.no_spd =b.no_spd ";
//
	   $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'jns_beban' => $resulte['jenis_beban'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
						'jns_spd' => $resulte['jns_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	}
    function nosp2d() {
        $lccr = $this->input->post('q');
        $sql = "SELECT * FROM trhsp2d where upper(no_sp2d) like upper('%$lccr%')  ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'], 
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],
                        'npwp' => $resulte['npwp'],
                        'jns_spp' => $resulte['jns_spp'],
                        'npwp' => $resulte['npwp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	} 
    
    function trmpot_() {
        $lccr = $this->input->post('q');
        $sql = "SELECT * FROM trhtrmpot where upper(no_bukti) like upper('%$lccr%')  ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'no_bukti' => $resulte['no_bukti'],
                        'tgl_bukti' => $resulte['tgl_bukti'], 
                        'ket' => $resulte['ket'],
                        'no_sp2d' => $resulte['no_sp2d'],
                        'npwp' => $resulte['npwp'],
                        'jns_spp' => $resulte['jns_spp'],
                        'npwp' => $resulte['npwp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	 $query1->free_result();   
	} 
    
     function hapus_sp2d() {    	
		$nom = $this->input->post('no');
        $spm = $this->input->post('spm');        
        $query = $this->db->query("delete from trhsp2d where no_sp2d='$nom'");        
		$query = $this->db->query("update trhspm set status='0' where no_spm='$spm'");
		$query = $this->db->query("delete from nomor_sp2d where no_sp2d='$nom'");
        $query->free_result();

		 }
		 
	function batal_sp2d() {    	
        $sp2d = $this->input->post('sp2d');
        $spp = $this->input->post('no');
        $ket = $this->input->post('ket');
		$usernm= $this->session->userdata('pcNama');		
		$query = $this->db->query("update trhspp set sp2d_batal='1',ket_batal='$ket',user_batal='$usernm' where no_spp='$spp'");
		$query = $this->db->query("update trhsp2d set sp2d_batal='1' where no_sp2d='$sp2d'");
        //$query->free_result();

		 }
    
	
     function hapus_trmpot() {    	
		$nom = $this->input->post('no');            
        $query = $this->db->query("delete from trhtrmpot where no_bukti='$nom'");
        $query1 = $this->db->query("delete from trdtrmpot where no_bukti='$nom'");        
	
    }
    
    function hapus_strpot() {    	
		$nom = $this->input->post('no');            
        $query = $this->db->query("delete from trhstrpot where no_bukti='$nom'");
        $query1 = $this->db->query("delete from trdstrpot where no_bukti='$nom'");        
	
    }    
    
    
    function simpan_trmpot()
	{
                       
                        $no_bukti = $this->input->post('no_bukti');
                        $tgl_bukti = $this->input->post('tgl_bukti');
						$no_sp2d = $this->input->post('no_sp2d');
						$jns_spp = $this->input->post('jns_spp');
                        $ket = $this->input->post('ket');
                        $kd_skpd = $this->input->post('kd_skpd');
                        $nm_skpd = $this->input->post('nm_skpd');
                        $npwp = $this->input->post('npwp');
                        $nilai= $this->input->post('nilai');                         
                        $usernm= $this->session->userdata('pcNama');
                        //date_default_timezone_set('Asia/Bangkok');
                        $last_update=  date('Y-m-d H:i:s');
                       
                        
           $sql = "delete from trhtrmpot where no_bukti='$no_bukti' ";
           $asg = $this->db->query($sql);       
           $query2 ="insert into trhtrmpot(no_bukti,tgl_bukti,ket,username,tgl_update,kd_skpd,nm_skpd,no_sp2d,npwp,jns_spp,status,nilai) 
                    values('$no_bukti','$tgl_bukti','$ket','$usernm','$last_update','$kd_skpd','$nm_skpd','$no_sp2d','$npwp','$jns_spp','0','$nilai') ";
                    $asg2 = $this->db->query($query2);           
         
          echo '1';
          //$asg->free_result();
//          $query1->free_result();  
	}
    
    function simpan_strpot()
	{
                       
                        $no_bukti = $this->input->post('no_bukti');
                        $tgl_bukti = $this->input->post('tgl_bukti');
						$no_terima = $this->input->post('no_terima');
						$jns_spp = $this->input->post('jns_spp');
                        $ket = $this->input->post('ket');
                        $kd_skpd = $this->input->post('kd_skpd');
                        $nm_skpd = $this->input->post('nm_skpd');
                        $npwp = $this->input->post('npwp');
                        $nilai= $this->input->post('nilai');                         
                        $usernm= $this->session->userdata('pcNama');
                        //date_default_timezone_set('Asia/Bangkok');
                        $last_update=  date('Y-m-d H:i:s');
                       
                        
           $sql = "delete from trhstrpot where no_bukti='$no_bukti' ";
           $asg = $this->db->query($sql);       
           $query2 ="insert into trhstrpot(no_bukti,tgl_bukti,ket,username,tgl_update,kd_skpd,nm_skpd,no_terima,npwp,jns_spp,nilai) 
                    values('$no_bukti','$tgl_bukti','$ket','$usernm','$last_update','$kd_skpd','$nm_skpd','$no_terima','$npwp','$jns_spp','$nilai') ";
                    $asg2 = $this->db->query($query2);           
         
          echo '1';
          //$asg->free_result();
//          $query1->free_result();  
	}
    
    function pilih_sp2d() {
        $lccr = $this->input->post('q');
        $sql = "SELECT no_sp2d,kd_skpd,no_spm FROM trhsp2d where upper(no_sp2d) like upper('%$lccr%') or upper(kd_skpd) like upper('%$lccr%') ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],  
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'no_spm' => $resulte['no_spm']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
         $query1->free_result();	   
	}
	
	
	 function pilih_sp2d_ls() {
        $lccr = $this->input->post('q');
        $sql = "SELECT TOP 10 no_sp2d,kd_skpd,no_spm FROM trhsp2d where jns_spp IN ('4','6') AND no_sp2d NOT LIKE '%GJ%' AND (upper(no_sp2d) like upper('%$lccr%') or upper(kd_skpd) like upper('%$lccr%')) ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],  
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'no_spm' => $resulte['no_spm']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
	}
	
	 function pilih_sp2d_gajo() {
        $lccr = $this->input->post('q');
        $sql = "SELECT TOP 10 no_sp2d,kd_skpd,no_spm FROM trhsp2d where jns_spp IN ('4') AND (upper(no_sp2d) like upper('%$lccr%') or upper(kd_skpd) like upper('%$lccr%')) ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],  
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'no_spm' => $resulte['no_spm']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
	}
	
    function pilih_trmpot() {
        $lccr = $this->input->post('q');
        $sql = "SELECT no_bukti,kd_skpd,tgl_bukti,no_sp2d FROM trhtrmpot where upper(no_bukti) like upper('%$lccr%') or upper(kd_skpd) like upper('%$lccr%') ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_bukti' => $resulte['no_bukti'],  
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'tgl_bukti' => $resulte['tgl_bukti'],
                        'no_sp2d' => $resulte['no_sp2d']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
         $query1->free_result();	   
	}
    
    
    /////Pencairan SP2D wahyu-------------------------------------------------------
	function manreal(){
		 $jk=$this->rka_model->combo_skpd();
         $ry=$this->rka_model->combo_giat();
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" >
                   <tr >                       
                        <td>MANAGEMENT REALISASI$jk</td>
                        <td>$ry</td>
                        </tr>
                  ";
         
         $cRet .="</table>";
        $data['prev']= $cRet;
        $data['page_title']= 'MANAGEMENT REALISASI';
        $this->template->set('title', 'MANAGEMENT REALISASI');   
         $sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai as total from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $results = array();
        $i = 1;
        foreach($query1->result_array() as $resulte)
        { 
            $results[] = array(
                       'id' => $i,
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => $resulte['nilai'] ,
                        'total' => $resulte['total']                            
                        );
                        $i++;
        }
        $this->template->load('template','tukd/realisasi/manreal',$data) ;	
	}

   function select_real($kegiatan='',$skpd='') {

		$sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai_ubah,a.sumber from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 where kd_kegiatan='$kegiatan' order by a.kd_rek5";                   


        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
				$rk=$resulte['kd_rek5'];

				$query = $this->db->query(" SELECT SUM(a.nilai) AS nilai FROM trdspp a 
											LEFT JOIN trhspp b ON a.no_spp=b.no_spp
											LEFT JOIN trhspm c ON c.no_spp=b.no_spp
											LEFT JOIN trhsp2d d ON d.no_spm=c.no_spm
											WHERE a.kd_skpd='$skpd' AND a.kd_kegiatan='$kegiatan' AND a.kd_rek5='$rk' ");  
				foreach($query->result_array() as $res){
					$sp2d=$res['nilai'];
				}

				$query = $this->db->query("SELECT SUM(a.rupiah) AS nilai FROM trdkasin_pkd a LEFT JOIN trhkasin_pkd b ON a.no_sts=b.no_sts WHERE a.kd_skpd='$skpd' AND b.kd_kegiatan='$kegiatan' AND a.kd_rek5='$rk' ");  
				foreach($query->result_array() as $res){
					$cp=$res['nilai'];
				}
				

				$result[] = array(
							'id' => $ii,        
							'kd_rek5' => $resulte['kd_rek5'],  
							'nm_rek5' => $resulte['nm_rek5'],  
							'nilai' => number_format($resulte['nilai']),
							'nilai_ubah' => number_format($resulte['nilai_ubah']),                             
							'real' => number_format($sp2d-$cp),                             
							'sisa' => number_format($resulte['nilai_ubah']-($sp2d-$cp))                             
							);
							$ii++;
        }
           
           echo json_encode($result);
    }	

	function ctk_manreal($skpd='',$giat='',$rek=''){

			$cRet ='<TABLE width="100%">
					<TR>
						<TD align="center" >MANAGEMENT REALISASI</TD>
					</TR>
					</TABLE>';
			//$kg=trim(substr($giat,5,strlen($giat)-4));
			$nmrek5=$this->tukd_model->get_nama($rek,'nm_rek5','ms_rek5','kd_rek5');			
			$nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');			
			$nmgiat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');			

			$cRet .='<center><TABLE >
					 <TR>
						<TD width="80" align="left" >SKPD</TD>
						<TD width="5" align="center" >:</TD>
						<TD width="120" align="left" >'.$skpd.'</TD>
						<TD width="300" align="left" >'.$nmskpd.'</TD>
					 </TR>
					 <TR>
						<TD width="80" align="left" >KEGIATAN</TD>
						<TD width="5" align="center" >:</TD>
						<TD width="120" align="left" >'.$giat.'</TD>
						<TD width="300" align="left" >'.$nmgiat.'</TD>
					 </TR>					 
					 <TR>
						<TD width="80" align="left" >REKENING</TD>
						<TD width="5" align="center" >:</TD>
						<TD width="120" align="left" >'.$rek.'</TD>
						<TD width="500" align="left" >'.$nmrek5.'</TD>
					 </TR>					 
					 </TABLE>';
			$cRet .='<TABLE border="1" cellspacing="0" cellpadding="0" >
					 <TR>
						<TD width="40" align="center" >NO</TD>
						<TD width="250" align="center" >NO SP2D / NO STS / NO KAS</TD>
						<TD width="100" align="center" >TANGGAL</TD>
						<TD width="140" align="center" >DEBET</TD>
						<TD width="140" align="center" >KREDIT</TD>
						<TD width="140" align="center" >SALDO</TD>
					 </TR>';
			
				$idx=1;
              
					

				$query = $this->db->query(" SELECT d.no_sp2d,d.tgl_sp2d,a.nilai FROM trdspp a 
											LEFT JOIN trhspp b ON a.no_spp=b.no_spp
											LEFT JOIN trhspm c ON c.no_spp=b.no_spp
											LEFT JOIN trhsp2d d ON d.no_spm=c.no_spm
											WHERE a.kd_skpd='$skpd' AND a.kd_kegiatan='$giat' AND a.kd_rek5='$rek' ");  
				foreach($query->result_array() as $res){
										
					$cetak[$idx][1]=$res['tgl_sp2d'];
					$cetak[$idx][2]=$res['no_sp2d'];
					$cetak[$idx][3]=$res['nilai'];
                    $cetak[$idx][4]=0;
					$idx++;

				}

				$query = $this->db->query(" SELECT a.no_sts,b.tgl_sts,a.rupiah AS nilai FROM trdkasin_pkd a LEFT JOIN trhkasin_pkd b ON a.no_sts=b.no_sts 
											WHERE b.kd_skpd='$skpd' AND b.kd_kegiatan='$giat' AND a.kd_rek5='$rek' ");  
				foreach($query->result_array() as $res){

					$cetak[$idx][1]=$res['tgl_sts'];
					$cetak[$idx][2]=$res['no_sts'];
                    $cetak[$idx][3]=0;
					$cetak[$idx][4]=$res['nilai'];
					$idx++;


				}
                
                $query = $this->db->query(" SELECT a.no_bukti,b.tgl_bukti,a.nilai  FROM trdtransout a LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti 
											WHERE b.kd_skpd='$skpd' AND a.kd_kegiatan='$giat' AND a.kd_rek5='$rek' and b.jns_spp='1' ");  
				foreach($query->result_array() as $res){

					$cetak[$idx][1]=$res['tgl_bukti'];
					$cetak[$idx][2]=$res['no_bukti'];
                    $cetak[$idx][3]=$res['nilai'];
					$cetak[$idx][4]=0;
					$idx++;


				}

				asort($cetak);
				$i=0;
				$saldo=0;
				foreach ($cetak as $key => $val) {
					$i++;
					$saldo=$saldo+$cetak[$key][3]-$cetak[$key][4];
					$cRet .='<TR>
								<TD width="40" align="left" >'.$i.'</TD>
								<TD width="250" align="left" >'.$cetak[$key][2].'</TD>
								<TD width="100" align="center" >'.$this->tukd_model->rev_date($cetak[$key][1]).'</TD>
								<TD width="140" align="right" >'.number_format($cetak[$key][3]).'</TD>
								<TD width="140" align="right" >'.number_format($cetak[$key][4]).'</TD>
								<TD width="140" align="right" >'.number_format($saldo).'</TD>
							 </TR>';					
				}
			
			$cRet .='</TABLE></center>';

			$data['prev']= 'MANAGEMENT REALISASI';
            $this->tukd_model->_mpdf('',$cRet,5,5,10,'0');	
	
	}
	
    function cetakb9($dcetak='',$ttd='') {
            $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
				
            $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kode='BUD'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
			 $cRet='
					<TABLE width="100%" cellpadding="0" cellspacing="0" border="0" >
					<TR>
						<TD align="right" >B - IX</TD>
					</TR>
					<TR>
						<TD align="center">'.$this->tukd_model->get_sclient('kab_kota','sclient').'</TD>
					</TR>
					<TR>
						<TD align="center" >BUKU KAS PENERIMAAN DAN PENGELUARAN</TD>
					</TR>
					<TR>
						<TD align="center" >TAHUN ANGGARAN'.$this->session->userdata('pcThang').'</TD>
					</TR>
					<TR>
						<TD align="left" style="font-size:12px;border: solid 1px white;border-bottomolid 1px black;" >Tanggal : '.$this->tukd_model->tanggal_format_indonesia($dcetak).'</TD>
					</TR>
					</TABLE>
			       ';
			 $cRet.='
					<TABLE width="100%" cellpadding="0" cellspacing="0" border="1" >
					<TR>
						<TD align="center" width="7%" style="font-size:12px;border: solid 1px black;border-bottom:solid 1px black;" >NO KAS</TD>
						<TD align="center" width="23%" style="font-size:12px;border: solid 1px black;border-bottom:solid 1px black;" >Uraian Penerimaan Dan Pengeluaran</TD>
						<TD align="center" width="15%" style="font-size:12px;border: solid 1px black;border-bottom:solid 1px black;" >Kode Rekening</TD>
						<TD align="center" width="25%" style="font-size:12px;border: solid 1px black;border-bottom:solid 1px black;" >Rincian Objek Penerimaan Dan Pengeluaran</TD>
						<TD align="center" width="15%" style="font-size:12px;border: solid 1px black;border-bottom:solid 1px black;" >Penerimaan</TD>
						<TD align="center" width="15%" style="font-size:12px;border: solid 1px black;border-bottom:solid 1px black;" >Pengeluaran</TD>
					</TR>
			       ';			 

			$query1 = $this->db->query(" SELECT a.no_sts,b.keterangan,b.kd_kegiatan,a.kd_rek5,c.nm_rek5,a.rupiah FROM trdkasin_pkd a LEFT JOIN trhkasin_pkd b ON a.no_sts=b.no_sts LEFT JOIN ms_rek5 c ON a.kd_rek5=c.kd_rek5 WHERE b.tgl_sts='$dcetak' ");  
			$result = array();
			$ii = 0;
			$tnokas='';
			$tket='';
			$tot_in=0;
			foreach($query1->result_array() as $resulte){
				$nokas=$resulte['no_sts'];
				$ket=$resulte['keterangan'];
				$kdrek=$resulte['kd_kegiatan'].'.'.$resulte['kd_rek5'];
				$nmrek=$resulte['nm_rek5'];
				$nilai=$resulte['rupiah'];
				$a=$nokas;
				$b=$ket;

				if ($tnokas==$nokas){
					$a='';
				}
				if ($tket==$ket){
					$b='';
				}
				$cRet.='
					<TR>
						<TD valign="top" align="left" width="7%"  style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.$a.'</TD>
						<TD valign="top" align="left" width="25%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.$b.'</TD>
						<TD valign="top" align="center" width="20%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.$kdrek.'</TD>
						<TD valign="top" align="left" width="28%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.$nmrek.'</TD>
						<TD valign="top" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.number_format($nilai).'</TD>
						<TD valign="top" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" ></TD>
					</TR>
			       ';			 			
				$tnokas=$nokas;
				$tket=$ket;
				$tot_in=$tot_in+$nilai;
			} 



			$query1 = $this->db->query(" SELECT a.no_kas,b.ket,a.kd_kegiatan,a.kd_rek5,c.nm_rek5,a.nilai,b.no_sp2d FROM trdkasout_pkd a LEFT JOIN trhkasout_pkd b ON a.no_kas=b.no_kas LEFT JOIN ms_rek5 c ON a.kd_rek5=c.kd_rek5 WHERE b.tgl_kas='$dcetak' ");  
			$result = array();
			$ii = 0;
			$tnokas='';
			$tket='';
			$tot_out=0;
			foreach($query1->result_array() as $resulte){
				$nokas=$resulte['no_kas'];
				$ket='SP2D No : '.$resulte['no_sp2d'].'<br>'.$resulte['ket'];
				$kdrek=$resulte['kd_kegiatan'].'.'.$resulte['kd_rek5'];
				$nmrek=$resulte['nm_rek5'];
				$nilai=$resulte['nilai'];
				$a=$nokas;
				$b=$ket;

				if ($tnokas==$nokas){
					$a='';
				}
				if ($tket==$ket){
					$b='';
				}
				$cRet.='
					<TR>
						<TD valign="top" align="left" width="7%"  style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.$a.'</TD>
						<TD valign="top" align="left" width="25%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.$b.'</TD>
						<TD valign="top" align="center" width="20%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.$kdrek.'</TD>
						<TD valign="top" align="left" width="28%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.$nmrek.'</TD>
						<TD valign="top" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" ></TD>
						<TD valign="top" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:none;" >'.number_format($nilai).'</TD>
					</TR>
			       ';			 			
				$tnokas=$nokas;
				$tket=$ket;
				$tot_out=$tot_out+$nilai;
			}

				$cRet.='
					<TR  >
						<TD height="20" colspan="4" valign="midle" align="left" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >Jumlah Tanggal : '.$this->tukd_model->tanggal_format_indonesia($dcetak).' </TD>
						<TD valign="midle" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >'.number_format($tot_in).'</TD>
						<TD valign="midle" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >'.number_format($tot_out).'</TD>
					</TR>
			       ';			 			

				$query1 = $this->db->query(" SELECT sum(a.rupiah) as nilai FROM trdkasin_pkd a LEFT JOIN trhkasin_pkd b ON a.no_sts=b.no_sts LEFT JOIN ms_rek5 c ON a.kd_rek5=c.kd_rek5 WHERE b.tgl_sts<'$dcetak' ");  
				foreach($query1->result_array() as $resulte){
					$nilai_in=$resulte['nilai'];
				}
				$query1 = $this->db->query(" SELECT sum(a.nilai) as nilai FROM trdkasout_pkd a LEFT JOIN trhkasout_pkd b ON a.no_kas=b.no_kas LEFT JOIN ms_rek5 c ON a.kd_rek5=c.kd_rek5 WHERE b.tgl_kas<'$dcetak' ");  
				foreach($query1->result_array() as $resulte){
					$nilai_out=$resulte['nilai'];
				}
				$cRet.='
					<TR  >
						<TD height="20" colspan="4" valign="midle" align="left" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >Jumlah Sampai Tanggal Kemaren </TD>
						<TD valign="midle" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >'.number_format($nilai_in).'</TD>
						<TD valign="midle" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >'.number_format($nilai_out).'</TD>
					</TR>
			       ';
				$cRet.='
					<TR  >
						<TD height="20" colspan="4" valign="midle" align="left" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >Jumlah Sampai Tanggal : '.$this->tukd_model->tanggal_format_indonesia($dcetak).' </TD>
						<TD valign="midle" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >'.number_format($tot_in+$nilai_in).'</TD>
						<TD valign="midle" align="right" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >'.number_format($tot_out+$nilai_out).'</TD>
					</TR>
			       ';
				$cRet.='
					<TR  >
						<TD height="25" colspan="5" valign="midle" align="left" width="10%" style="font-size:10px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" >Sisa KAS</TD>
						<TD valign="midle" align="right" width="10%" style="font-size:12px;border: solid 1px black;border-bottom:none;border-top:solid 1px black;" ><b>'.number_format(($tot_in+$nilai_in)-($tot_out+$nilai_out)).'</b></TD>
					</TR>
			       ';

			$cRet.='</TABLE><br>';

			$cRet.='<TABLE border="0" >
					<TR>
						<TD style="font-size:11px;" >Pada hari ini,tanggal '.$this->tukd_model->tanggal_format_indonesia($dcetak).'</TD>
					</TR>					
					<TR>
						<TD style="font-size:11px;" >Oleh kami didapat dalam kas Rp. '.number_format(($tot_in+$nilai_in)-($tot_out+$nilai_out)).'</TD>
					</TR>					
					<TR>
						<TD style="font-size:11px;" ><i>'.$this->tukd_model->terbilang(($tot_in+$nilai_in)-($tot_out+$nilai_out)).'</i></TD>
					</TR>					
					</TABLE><br>
					';

			$cRet.='<TABLE border="0" width="100%" >
					<TR>
						<TD style="font-size:11px;" width="50%" align="center" ></TD>
						<TD style="font-size:11px;" width="50%" align="center" >'.$this->tukd_model->get_sclient('daerah','sclient').', '.$this->tukd_model->tanggal_format_indonesia($dcetak).'</TD>
					</TR>					
					<TR>
						<TD style="font-size:11px;" width="50%" align="center" ></TD>
						<TD style="font-size:11px;" width="50%" align="center" >'.$jabatan.'</TD> 
					</TR>					
					<TR>
						<TD style="font-size:11px;" width="50%" align="center" >&nbsp;</TD>
						<TD style="font-size:11px;" width="50%" align="center" >&nbsp;</TD> 
					</TR>					
					<TR>
						<TD style="font-size:11px;" width="50%" align="center" >&nbsp;</TD>
						<TD style="font-size:11px;" width="50%" align="center" >&nbsp;</TD> 
					</TR>					
					<TR>
						<TD style="font-size:11px;" width="50%" align="center" >&nbsp;</TD>
						<TD style="font-size:11px;" width="50%" align="center" >&nbsp;</TD> 
					</TR>					
					<TR>
						<TD style="font-size:11px;" width="50%" align="center" ></TD>
						<TD style="font-size:11px;" width="50%" align="center" >'.$nama.'</TD> 
					</TR>					
					<TR>
						<TD style="font-size:11px;" width="50%" align="center" ></TD>
						<TD style="font-size:11px;" width="50%" align="center" >NIP: '.$nip.'</TD> 
					</TR>					
					</TABLE>
					';


			$data['prev']= $cRet;
            echo $cRet;
            //$this->tukd_model->_mpdf('',$cRet,5,7,10,'0');
	}

    function list_ttd() {
        $sql = "SELECT nip,nama,jabatan,kd_skpd FROM ms_ttd where kode='PA' order by nama";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],  
                        'jabatan' => $resulte['jabatan'],
                        'kd_skpd' => $resulte['kd_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}

	function buku_b9(){
	
        $data['page_title']= 'CETAK BUKU KAS B-IX';
        $this->template->set('title', 'BUKU KAS B-IX');   
        $this->template->load('template','tukd/sp2d_cair/buku_b9',$data) ; 	
	
	}

    function sp2d_cair()
    {
        $data['page_title']= 'PENCAIRAN S P 2 D';
        $this->template->set('title', 'PENCAIRAN S P 2 D');   
        $this->template->load('template','tukd/sp2d_cair/sp2d_cair',$data) ; 
    }
    
    function sp2d_cair_ppkd()
    {
        $data['page_title']= 'PENCAIRAN S P 2 D';
        $this->template->set('title', 'PENCAIRAN S P 2 D PPKD');   
        $this->template->load('template','tukd/sp2d_cair/terima_sp2d',$data) ; 
    }
    
    function trmpot()
    {
        $data['page_title']= 'P O T O N G A N';
        $this->template->set('title', 'PENERIMAAN POTONGAN');   
        $this->template->load('template','tukd/transaksi/trmpot',$data) ; 
    }
    
    function strpot()
    {
        $data['page_title']= 'P O T O N G A N';
        $this->template->set('title', 'PENERIMAAN POTONGAN');   
        $this->template->load('template','tukd/transaksi/strpot',$data) ; 
    }

  function load_sp2d_cair() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd <> ''";
        if ($kriteria <> ''){                               
            $where=" (upper(a.no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(a.no_sp2d) as tot from trhsp2d a where $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
         $sql = "SELECT TOP $rows a.no_sp2d,tgl_sp2d, no_spm, tgl_spm,no_spp, tgl_spp, kd_skpd,nm_skpd,jns_spp, keperluan, bulan,
				no_spd, bank, nmrekan, no_rek, npwp, no_kas, no_kas_bud, tgl_kas, tgl_kas_bud,
				nocek, status_bud,jenis_beban,no_spd FROM trhsp2d a where $where and  a.no_sp2d not in 
		(SELECT TOP $offset a.no_sp2d from trhsp2d a where $where order by a.no_sp2d,kd_skpd) order by a.no_sp2d,kd_skpd";
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
			if ($resulte['status_bud']=='1'){
				$s='Sudah Cair';
			}else{
				$s='Belum Cair';			
			}

            $row[] = array(
                        'id' => $ii,
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $this->tukd_model->rev_date($resulte['tgl_sp2d']),
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],        
                        'no_spp' => $resulte['no_spp'],
                        'tgl_spp' => $resulte['tgl_spp'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],    
                        'jns_spp' => $resulte['jns_spp'],
                        'keperluan' => $resulte['keperluan'],
                        'bulan' => $resulte['bulan'],
                        'no_spd' => $resulte['no_spd'],
                        'bank' => $resulte['bank'],
                        'nmrekan' => $resulte['nmrekan'],
                        'no_rek' => $resulte['no_rek'],
                        'npwp' => $resulte['npwp'],
                        'nokas' => $resulte['no_kas'],
                        'nokasbud' => $resulte['no_kas_bud'],
                        'dkas' => $resulte['tgl_kas'],
                        'dkasbud' => $resulte['tgl_kas_bud'],
                        'nocek' => $resulte['nocek'],
                        'jenis_beban' => $resulte['jenis_beban'],
                        'no_spd' => $resulte['no_spd'],
                        'status' => $s                                                                                   
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();
    	   
	} 

	
    function simpan_cair(){
		$no_sp2d = $this->input->post('nsp2d');
		$nokas = $this->input->post('nkas');
		$tglkas = $this->input->post('tcair');
		$nocek = $this->input->post('ncek');
		$total = $this->input->post('tot');
		//$cskpd = $this->input->post('skpd');
		$cket = $this->input->post('ket');
		$beban = $this->input->post('beban');
        $usernm= $this->session->userdata('pcNama');
        $cskpd= $this->session->userdata('kdskpd');
		$last_update=  "";
		//$last_update=  date('Y-m-d H:i:s');


		$total = str_replace(",","",$total);
		
		$nmskpd=$this->tukd_model->get_nama($cskpd,'nm_skpd','ms_skpd','kd_skpd');
        
        $sqql = "select COUNT(*) as jum from trhsp2d where no_kas_bud ='$nokas'";
            $asg7 = $this->db->query($sqql)->row(); 
            
            if($asg7->jum>0){
                echo '3';
            }else{
            
        
        $sql = " update trhsp2d set status_bud='1', no_kas_bud='$nokas', tgl_kas_bud='$tglkas' where no_sp2d='$no_sp2d' ";
        $asg = $this->db->query($sql);


        $sql3 = " insert into trhju_pkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,kd_unit,total_d,total_k,tabel) 
                  values('$nokas','$tglkas','$no_sp2d','$usernm','$last_update','$cskpd','$nmskpd','$cskpd','$total','$total','0')";
        $asg3 = $this->db->query($sql3);        

        $sql = " SELECT a.no_spp,a.kd_skpd,a.kd_kegiatan,a.kd_rek5,a.nilai,b.bulan,c.no_spm,d.no_sp2d,b.sts_tagih FROM trdspp a 
				 LEFT JOIN trhspp b ON a.no_spp=b.no_spp
				 LEFT JOIN trhspm c ON c.no_spp=b.no_spp
				 LEFT JOIN trhsp2d d ON d.no_spm=c.no_spm
				 WHERE d.no_sp2d='$no_sp2d' ";
        $query1 = $this->db->query($sql);  
        $ii = 0;
        $jum=0;
        foreach($query1->result_array() as $resulte){

			$sp2d=$no_sp2d;
            $jns=$beban;
			$skpd=$resulte['kd_skpd'];
			$giat=$resulte['kd_kegiatan'];
			$rek5=$resulte['kd_rek5'];
            
			//$rek9='9'.substr($rek5,1,7);//$resulte['kd_rek5'];
			
			$rek9=$this->tukd_model->get_nama($rek5,'map_lo','ms_rek5','kd_rek5');
			$nmrek9=$this->tukd_model->get_nama($rek9,'nm_rek5','ms_rek5','kd_rek5');
            
            $rek64=$this->tukd_model->get_nama($rek5,'kd_rek64','ms_rek5','kd_rek5');
			$nmrek64=$this->tukd_model->get_nama($rek64,'nm_rek64','ms_rek5','kd_rek64');

			$nilai=$resulte['nilai'];
			$tagih=$resulte['sts_tagih'];
			
			if ($beban=='1'){
				$rek3=$rek5;			
			}else{
				$rek3=substr($rek5,0,3);
			}

			$jum=$jum+$nilai;

			$rekutang=$this->tukd_model->get_nama($rek64,'piutang_utang','ms_rek5','kd_rek64');

			$nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
			$nmgiat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');
			$nmrek5=$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek5');
			$nmrekutang=$this->tukd_model->get_nama($rekutang,'nm_rek5','ms_rek5','kd_rek5');
			


		} 


		if ($tagih=='1'){
			     $this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos,kd_unit) 
								  values('$nokas','','','1180101','RK SKPD','$jum','0','D','','1','1','$cskpd') ");		
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos,kd_unit) 
								  values('$nokas','','','1110101','KAS DI KAS DAERAH','0','$jum','K','','2','1','$cskpd') ");
            
            
		}else{
			if (($jns=='1') or ($jns=='2') or ($jns=='3')){
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos,kd_unit) 
								  values('$nokas','','','1180101','RK SKPD','$jum','0','D','','1','1','$cskpd') ");		
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos,kd_unit) 
								  values('$nokas','','','1110101','KAS DI KAS DAERAH','0','$jum','K','','2','1','$cskpd') ");
                                  
			
			}else{
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos,kd_unit) 
								  values('$nokas','','','1180101','RK SKPD','$jum','0','D','','1','1','$cskpd') ");		
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos,kd_unit) 
								  values('$nokas','','','1110101','KAS DI KAS DAERAH','0','$jum','K','','2','1','$cskpd') ");
                
               			
			}
		}
		
		echo '1';		
	   }
    }

    function simpan_cair_ppkd(){
       
        
		$no_sp2d = $this->input->post('nsp2d');
		$nokas = $this->input->post('nkas');
		$tglkas = $this->input->post('tcair');
		$nocek = $this->input->post('ncek');
		$total = $this->input->post('tot');
		$cskpd = $this->input->post('skpd');
		$cket = $this->input->post('ket');
		$beban = $this->input->post('beban');
        $usernm= $this->session->userdata('pcNama');
		$last_update=  date('Y-m-d H:i:s');


		$total = str_replace(",","",$total);

		$nmskpd=$this->tukd_model->get_nama($cskpd,'nm_skpd','ms_skpd','kd_skpd');

        $sql = " update trhsp2d set status='1',no_kas='$nokas',tgl_kas='$tglkas',nocek='$nocek' where no_sp2d='$no_sp2d' ";
        $asg = $this->db->query($sql);

 	    $sql1 = " insert into trhkasout_pkd(no_kas,tgl_kas,no_sp2d,no_cek,kd_skpd,nilai,ket,nm_skpd,jns_beban,username,tgl_update) 
				  values('$nokas','$tglkas','$no_sp2d','$nocek','$cskpd',$total,'$cket','$nmskpd','$beban','$usernm','$last_update') ";
        $asg1 = $this->db->query($sql1);
        if (($beban=='4') or ($beban=='5') or ($beban=='6')){
        $sql2 = " insert into trhtransout(no_bukti,tgl_bukti,no_sp2d,kd_skpd,nm_skpd,total,ket,jns_spp,username,tgl_update)
                  values('$nokas','$tglkas','$no_sp2d','$cskpd','$nmskpd',$total,'$cket','$beban','$usernm','$last_update') ";
        $asg2 = $this->db->query($sql2);
        }
        $sql3 = " insert into trhju_pkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
                  values('$nokas','$tglkas','$no_sp2d','$usernm','$last_update','$cskpd','$nmskpd','$total','$total','0')";
        $asg3 = $this->db->query($sql3);
        
        $sql31 = " insert into trhju_ppkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
                  values('$nokas','$tglkas','$no_sp2d','$usernm','$last_update','$cskpd','$nmskpd','$total','$total','0')";
        $asg31 = $this->db->query($sql31);
        
        $sql4 = " insert into trhju(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
                  values('$nokas','$tglkas','$no_sp2d','$usernm','$last_update','$cskpd','$nmskpd','$total','$total','0')";
        $asg4 = $this->db->query($sql4);

        $sql = " SELECT a.no_spp,a.kd_skpd,a.kd_kegiatan,a.kd_rek5,a.nilai,b.bulan,c.no_spm,d.no_sp2d,b.sts_tagih FROM trdspp a 
				 LEFT JOIN trhspp b ON a.no_spp=b.no_spp
				 LEFT JOIN trhspm c ON c.no_spp=b.no_spp
				 LEFT JOIN trhsp2d d ON d.no_spm=c.no_spm
				 WHERE d.no_sp2d='$no_sp2d' ";
        $query1 = $this->db->query($sql);  
        $ii = 0;
        $jum=0;
        foreach($query1->result_array() as $resulte){

			$sp2d=$no_sp2d;
            $jns=$beban;
			$skpd=$resulte['kd_skpd'];
			$giat=$resulte['kd_kegiatan'];
			$rek5=$resulte['kd_rek5'];
            
			//$rek9='9'.substr($rek5,1,7);//$resulte['kd_rek5'];
			$kdrek4=$this->tukd_model->get_nama($kdrek5,'kd_rek4','ms_rek5','kd_rek5');
			$rek9=$this->tukd_model->get_nama($rek5,'map_lo','ms_rek5','kd_rek5');
			$nmrek9=$this->tukd_model->get_nama($rek9,'nm_rek5','ms_rek5','kd_rek5');
            
            $rek64=$this->tukd_model->get_nama($rek5,'kd_rek64','ms_rek5','kd_rek5');
			$nmrek64=$this->tukd_model->get_nama($rek64,'nm_rek64','ms_rek5','kd_rek64');

			$nilai=$resulte['nilai'];
			$tagih=$resulte['sts_tagih'];
			
			if ($beban=='1'){
				$rek3=$rek5;			
			}else{
				$rek3=substr($rek5,0,3);
			}

			$jum=$jum+$nilai;

			$rekutang=$this->tukd_model->get_nama($rek64,'piutang_utang','ms_rek5','kd_rek64');

			$nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
			$nmgiat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');
			$nmrek5=$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek5');
			$nmrekutang=$this->tukd_model->get_nama($rekutang,'nm_rek5','ms_rek5','kd_rek5');
			
            if($kdrek4=='52201' || $kdrek4=='52201' ){
                $kdrek_p=$this->tukd_model->get_nama($kdrek5,'persed_kdp','ms_rek5','kd_rek5');
                $nmrek_p=$this->tukd_model->get_nama($kdrek_p,'nm_rek5','ms_rek5','kd_rek5');    
            }

			$this->db->query("insert trdkasout_pkd(no_kas,kd_skpd,kd_kegiatan,kd_rek5,nilai,nm_skpd,nm_kegiatan,nm_rek5) 
                              values('$nokas','$skpd','$giat','$rek5',$nilai,'$nmskpd','$nmgiat','$nmrek5') ");
            if (($jns=='4') or ($jns=='5') or ($jns=='6')){
            $this->db->query("insert trdtransout(no_bukti,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,no_sp2d) 
                              values('$nokas','$giat','$nmgiat','$rek5','$nmrek5',$nilai,'$sp2d') ");
            }
            if (($jns=='4') or ($jns=='5') or ($jns=='6')){
    
    			if ($tagih=='1'){
    
    			     	
    				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    								  values('$nokas','$giat','$nmgiat','$rekutang','$nmrekutang',$nilai,'0','D','$jns','3','1') ");  				
    				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    								  values('$nokas','$giat','$nmgiat','$rek64','$nmrek64',$nilai,'0','D','$jns','5','1') "); 
                                                  
                    $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    								  values('$nokas','$giat','$nmgiat','$rekutang','$nmrekutang',$nilai,'0','D','$jns','3','1') ");  				
    				$this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    								  values('$nokas','$giat','$nmgiat','$rek64','$nmrek64',$nilai,'0','D','$jns','5','1') ");
                    
                    $this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    								  values('$nokas','$giat','$nmgiat','$rekutang','$nmrekutang',$nilai,'0','D','$jns','3','1') ");  				
    				$this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    								  values('$nokas','$giat','$nmgiat','$rek5','$nmrek5',$nilai,'0','D','$jns','5','1') ");
                    
                    
    			}else{
    				if ($jns!='1') {
                
    					$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    									  values('$nokas','$giat','$nmgiat','$rek64','$nmrek64',$nilai,'0','D','$jns','3','1') ");             
    					$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    									  values('$nokas','$giat','$nmgiat','$rek9','$nmrek9',$nilai,'0','D','$jns','5','1') ");
                        
                        $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    									  values('$nokas','$giat','$nmgiat','$rek64','$nmrek64',$nilai,'0','D','$jns','3','1') ");             
    					$this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    									  values('$nokas','$giat','$nmgiat','$rek9','$nmrek9',$nilai,'0','D','$jns','5','1') ");
                                          
                        $this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    									  values('$nokas','$giat','$nmgiat','$rek5','$nmrek5',$nilai,'0','D','$jns','3','1') ");             
    					$this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
    									  values('$nokas','$giat','$nmgiat','$rek9','$nmrek9',$nilai,'0','D','$jns','5','1') "); 
                               				
    				}
    			}
            }
		} 


		if ($tagih=='1'){
			$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nokas','','','1110301','Kas di Bendahara Pengeluaran','0','$jum','K','','4','1') ");
			$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nokas','','','3120501','Estimasi Perubahan SAL','0','$jum','K','','6','0') ");
                              
            $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nokas','','','1110301','Kas di Bendahara Pengeluaran','0','$jum','K','','4','1') ");
			$this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nokas','','','3120501','Estimasi Perubahan SAL','0','$jum','K','','6','0') ");
            
            $this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nokas','','','1110301','Kas di Bendahara Pengeluaran','0','$jum','K','','4','1') ");
			$this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nokas','','','3120501','Estimasi Perubahan SAL','0','$jum','K','','6','0') ");
		}else{
			if (($jns=='1') or ($jns=='2') or ($jns=='3')){
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110301','Kas di Bendahara Pengeluaran','$jum','0','D','','1','1') ");		
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110101','Kas di kas Daerah','0','$jum','K','','2','1') ");
                                  
                $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110301','Kas di Bendahara Pengeluaran','$jum','0','D','','1','1') ");		
				$this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110101','Kas di kas Daerah','0','$jum','K','','2','1') ");
                                  
                $this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110301','Kas di Bendahara Pengeluaran','$jum','0','D','','1','1') ");		
				$this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110101','Kas di kas Daerah','0','$jum','K','','2','1') ");			
			}else{
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','3120501','Estimasi Perubahan SAL','0','$jum','K','','4','0') ");
				$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110101','Kas di kas Daerah','0','$jum','K','','6','1') ");
                
               	$this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','3120501','Estimasi Perubahan SAL','0','$jum','K','','4','0') ");
				$this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110101','Kas di kas Daerah','0','$jum','K','','6','1') ");
                
                $this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','3120501','Estimasi Perubahan SAL','0','$jum','K','','4','0') ");
				$this->db->query("insert trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
								  values('$nokas','','','1110101','Kas di kas Daerah','0','$jum','K','','6','1') ");			
			}
		}
		echo '1';
 	}


    function batal_cair(){
		$no_sp2d = $this->input->post('nsp2d');
		$nokas = $this->input->post('nkas');
		$tglkas = $this->input->post('tcair');
		$nocek = $this->input->post('ncek');
		$total = $this->input->post('tot');
        $cskpd= $this->session->userdata('kdskpd');
        $sql = " update trhsp2d set status_bud='0',no_kas_bud='',tgl_kas_bud='',nocek='' where no_sp2d='$no_sp2d' ";
        $asg = $this->db->query($sql);
		$sql = " DELETE FROM trhju_pkd WHERE no_voucher='$nokas' AND kd_skpd='$cskpd' ";
        $asg = $this->db->query($sql);
		$sql = " DELETE FROM trdju_pkd WHERE no_voucher='$nokas' AND kd_unit='$cskpd' ";
        $asg = $this->db->query($sql);
		if (($asg>0)and($asg1>0)){ 
			echo '1';
		}
	}
    
    function batal_cair_ppkd()
	{
		$no_sp2d = $this->input->post('nsp2d');

		$nokas = $this->input->post('nkas');
		$tglkas = $this->input->post('tcair');
		$nocek = $this->input->post('ncek');
		$total = $this->input->post('tot');

        $sql = " update trhsp2d set status='0',no_kas='',tgl_kas='',nocek='' where no_sp2d='$no_sp2d' ";
        $asg = $this->db->query($sql);

        $sql1 = " delete from trhkasout_pkd where no_kas='$nokas' ";
        $asg1 = $this->db->query($sql1);

		$sql1 = " delete from trdkasout_pkd where no_kas='$nokas' ";
        $asg1 = $this->db->query($sql1);
        
        $sql1 = " delete from trhtransout where no_bukti='$nokas' ";
        $asg1 = $this->db->query($sql1);

		$sql1 = " delete from trdtransout where no_bukti='$nokas' ";
        $asg1 = $this->db->query($sql1);

        $sql1 = " delete from trhju_pkd where no_voucher='$nokas' ";
        $asg1 = $this->db->query($sql1);

		$sql1 = " delete from trdju_pkd where no_voucher='$nokas' ";
        $asg1 = $this->db->query($sql1);
        
         $sql1 = " delete from trhju_ppkd where no_voucher='$nokas' ";
        $asg1 = $this->db->query($sql1);

		$sql1 = " delete from trdju_ppkd where no_voucher='$nokas' ";
        $asg1 = $this->db->query($sql1);
        
        $sql1 = " delete from trhju where no_voucher='$nokas' ";
        $asg1 = $this->db->query($sql1);

		$sql1 = " delete from trdju where no_voucher='$nokas' ";
        $asg1 = $this->db->query($sql1);
		
		if (($asg>0)and($asg1>0)){ 
			echo '1';
		}
	}
    
   // function simpan_cair_skpd()
//	{
//	   
//		$no_sp2d = $this->input->post('nsp2d');
//
//		$nokas = $this->input->post('nkas');
//		$tglkas = $this->input->post('tcair');
//		$nocek = $this->input->post('ncek');
//		$total = $this->input->post('tot');
//		$cskpd = $this->input->post('skpd');
//		$cket = $this->input->post('ket');
//		$beban = $this->input->post('beban');
//		$usernm= $this->session->userdata('pcNama');
//        //date_default_timezone_set('Asia/Bangkok');
//        $last_update=  date('Y-m-d H:i:s');
//
//
//		$total = str_replace(",","",$total);
//
//		$nmskpd=$this->tukd_model->get_nama($cskpd,'nm_skpd','ms_skpd','kd_skpd');
//
//        $sql = " update trhsp2d set status='1',no_kas='$nokas',tgl_kas='$tglkas',nocek='$nocek' where no_sp2d='$no_sp2d' ";
//        $asg = $this->db->query($sql);
//
// 	    $sql1 = " insert into trhtransout(no_bukti,tgl_bukti,no_sp2d,kd_skpd,nm_skpd,total,ket,jns_spp,username,tgl_update)
//          values('$nokas','$tglkas','$no_sp2d','$cskpd','$nmskpd',$total,'$cket','$beban','$usernm','$last_update') ";
//        $asg1 = $this->db->query($sql1);
//
//
//        $sql = " SELECT a.no_spp,a.kd_skpd,a.kd_kegiatan,a.kd_rek5,a.nilai,b.bulan,c.no_spm,d.no_sp2d FROM trdspp a 
//				 LEFT JOIN trhspp b ON a.no_spp=b.no_spp
//				 LEFT JOIN trhspm c ON c.no_spp=b.no_spp
//				 LEFT JOIN trhsp2d d ON d.no_spm=c.no_spm
//				 WHERE d.no_sp2d='$no_sp2d' ";
//        $query1 = $this->db->query($sql);  
//        $ii = 0;
//        foreach($query1->result_array() as $resulte){
//			$sp2d=$no_sp2d;
//			$skpd=$resulte['kd_skpd'];
//			$giat=$resulte['kd_kegiatan'];
//			$rek5=$resulte['kd_rek5'];
//			$nilai=$resulte['nilai'];
//
//			$nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
//			$nmgiat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');
//			$nmrek5=$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek5');
//			
//			$this->db->query("insert trdtransout(no_bukti,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,no_sp2d) 
//            values('$nokas','$giat','$nmgiat','$rek5','$nmrek5',$nilai,'$sp2d') ");
//		} 
//
//
//		
//			echo '1';
//		
//	}
//




    function batal_cair_skpd()
	{
		$no_sp2d = $this->input->post('nsp2d');

		$nokas = $this->input->post('nkas');
		$tglkas = $this->input->post('tcair');
		$nocek = $this->input->post('ncek');
		$total = $this->input->post('tot');

        $sql = " update trhsp2d set status='0',no_kas='',tgl_kas='',nocek='' where no_sp2d='$no_sp2d' ";
        $asg = $this->db->query($sql);

        $sql1 = " delete from trhtransout where no_bukti='$nokas' ";
        $asg1 = $this->db->query($sql1);

		$sql1 = " delete from trdtransout where no_bukti='$nokas' ";
        $asg1 = $this->db->query($sql1);

		
		if (($asg>0)and($asg1>0)){ 
			echo '1';
		}
	}


/////---------------------------------------------------------------------------
    
////////--Akhir dr SP2D
///////smua cetakan di bawah sini
        function  tanggal_format_indonesia($tgl){
        $tanggal  = explode('-',$tgl); 
        $bulan  = $this-> getBulan($tanggal[1]);
        $tahun  =  $tanggal[0];
        return  $tanggal[2].' '.$bulan.' '.$tahun;

        }
         
		function  tanggal_format_indonesia_kasda($tgl){
			$tanggal  = explode('-',$tgl); 
			$bulan  = $this-> getBulan_kasda($tanggal[1]);
			$tahun  =  $tanggal[0];
			return  $tanggal[2].' '.$bulan.' '.$tahun;
        } 
		
		function  tanggal_format_indonesia_kasda2($tgl){
			$tanggal  = explode('-',$tgl); 
			$bulan  = $this-> getBulan_kasda($tanggal[1]);
			$tahun  =  $tanggal[0];
			return  $tanggal[2].' '.$bulan;
        }
		 
        function  tanggal_indonesia($tgl){
        $tanggal  =  substr($tgl,8,2);
        $bulan  = substr($tgl,5,2);
        $tahun  =  substr($tgl,0,4);
        return  $tanggal.'-'.$bulan.'-'.$tahun;

        }
           
        function  getBulan($bln){
        switch  ($bln){
        case  1:
        return  "Januari";
        break;
        case  2:
        return  "Februari";
        break;
        case  3:
        return  "Maret";
        break;
        case  4:
        return  "April";
        break;
        case  5:
        return  "Mei";
        break;
        case  6:
        return  "Juni";
        break;
        case  7:
        return  "Juli";
        break;
        case  8:
        return  "Agustus";
        break;
        case  9:
        return  "September";
        break;
        case  10:
        return  "Oktober";
        break;
        case  11:
        return  "November";
        break;
        case  12:
        return  "Desember";
        break;
    }
    }
	
		function  getBulan_kasda($bln){
        switch  ($bln){
        case  1:
        return  "JANUARI";
        break;
        case  2:
        return  "FEBRUARI";
        break;
        case  3:
        return  "MARET";
        break;
        case  4:
        return  "APRIL";
        break;
        case  5:
        return  "MEI";
        break;
        case  6:
        return  "JUNI";
        break;
        case  7:
        return  "JULI";
        break;
        case  8:
        return  "AGUSTUS";
        break;
        case  9:
        return  "SEPTEMBER";
        break;
        case  10:
        return  "OKTOBER";
        break;
        case  11:
        return  "NOVEMBER";
        break;
        case  12:
        return  "DESEMBER";
        break;
		}
    }
	
    function  dotrek($rek){
				$nrek=strlen($rek);
				switch ($nrek) {
                case 1:
				$rek = $this->left($rek,1);								
       			 break;
    			case 2:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1);								
       			 break;
    			case 3:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1).'.'.substr($rek,2,1);								
       			 break;
    			case 5:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1).'.'.substr($rek,2,1).'.'.substr($rek,3,2);								
        		break;
    			case 7:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1).'.'.substr($rek,2,1).'.'.substr($rek,3,2).'.'.substr($rek,5,2);								
        		break;
    			default:
				$rek = "";	
				}
				return $rek;
    }
    
    
    function right($value, $count){
    return substr($value, ($count*-1));
    }

    function left($string, $count){
    return substr($string, 0, $count);
    }    
	
    
    
    function cetakspp1(){
        $kd = $this->uri->segment(4);
        $jns = $this->uri->segment(5);
        $nomor=str_replace('123456789','/',$this->uri->segment(3));
        if ($jns==1){
        $sql1="SELECT a.no_spp,a.tgl_spp,a.kd_skpd,a.nm_skpd,a.bulan,b.kd_urusan,b.nm_urusan,a.no_spd,a.nilai,(SELECT SUM(nilai) FROM trdspd WHERE no_spd=a.no_spd)
                AS spd,(SELECT SUM(nilai) FROM trhspp WHERE no_spd=a.no_spd and no_spp <> a.no_spp)AS spp FROM trhspp a INNER JOIN ms_urusan b 
                ON SUBSTR(a.kd_skpd,1,4)=b.kd_urusan  where a.no_spp='$nomor'";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kd_urusan=$row->kd_urusan;
                    $nm_urusan=$row->nm_urusan;
                    $kd_skpd=$row->kd_skpd;
                    $nm_skpd=$row->nm_skpd;
                    $spd=$row->no_spd;
                    $tgl=$row->tgl_spp;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $bln = $this->getBulan($row->bulan);                    
                    $nilai=number_format($row->nilai,"2",",",".");
                    $nilai1=$row->nilai;
                    $nspd=$row->spd;
                    $spp=$row->spp;
                    $sis=$nspd-$spp;
                    $si=$nspd-$spp;
                    if ($si < 0){
                	$x1="(";
                	$si=$si*-1;
                	$y1=")";}
                    else {
                	$x1="";
	                $y1="";}
                    $sisa=number_format($si,"2",",",".");
                    $a=$this->tukd_model->terbilang($nilai1);
                    $b=$this->tukd_model->terbilang($sis);                    
                    //echo($a);
                }
                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-UP)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PENGANTAR</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Kepada Yth.</td></tr>
                    <tr><td align=\"left\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td></tr>
                    <tr><td align=\"left\">SKPD : </td></tr>
                    <tr><td align=\"left\">Di Tempat</td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Dengan memperhatikan Peraturan/Gubernur/Bupati/Walikota Nomer ......
                    Tahun ...... tentang Penjabarab APBD, bersama ini kami mengajukan Surat Permintaan Pembayaran ..... sebagai berikut:</td></tr>
                    <tr><td align=\"center\"></td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                     
                        ";
                            
                                  
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">a.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Urusan Pemerintahan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_urusan - $nm_urusan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">b.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">SKPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_skpd - $nm_skpd</td>
                                     
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">c.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Tahun Anggaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$thn_ang</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">d.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Dasar Pengeluaran SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$spd</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">e.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Sisa Dana SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$x1$sisa$y1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"><i>($b)</i></td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">f.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Untuk Keperluan Bulan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$bln</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">g.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama Bendahara Pengeluaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">h.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Pembayaran yang Diminta</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">Rp. $nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\" ><i>($a)</i> </td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">i.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama dan Nomer Rekening Bank</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";
                      $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,$tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
        $data['prev']= $cRet;
            $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
      }
      if ($jns==2){
        $sql1="SELECT a.no_spp,a.tgl_spp,a.kd_skpd,a.nm_skpd,a.bulan,b.kd_urusan,b.nm_urusan,a.no_spd,a.nilai,(SELECT SUM(nilai) FROM trdspd WHERE no_spd=a.no_spd)
                AS spd,(SELECT SUM(nilai) FROM trhspp WHERE no_spd=a.no_spd and no_spp <> a.no_spp)AS spp FROM trhspp a INNER JOIN ms_urusan b 
                ON SUBSTR(a.kd_skpd,1,4)=b.kd_urusan  where a.no_spp='$nomor'";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kd_urusan=$row->kd_urusan;
                    $nm_urusan=$row->nm_urusan;
                    $kd_skpd=$row->kd_skpd;
                    $nm_skpd=$row->nm_skpd;
                    $spd=$row->no_spd;
                    $tgl=$row->tgl_spp;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $bln = $this->getBulan($row->bulan);                    
                    $nilai=number_format($row->nilai,"2",",",".");
                    $nilai1=$row->nilai;
                    $nspd=$row->spd;
                    $spp=$row->spp;
                    $sis=$nspd-$spp;
                    $si=$nspd-$spp;
                    if ($si < 0){
                	$x1="(";
                	$si=$si*-1;
                	$y1=")";}
                    else {
                	$x1="";
	                $y1="";}
                    $sisa=number_format($si,"2",",",".");
                    $a=$this->tukd_model->terbilang($nilai1);
                    $b=$this->tukd_model->terbilang($sis);                    
                    //echo($a);
                }
                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN GANTI UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-GU)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PENGANTAR</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Kepada Yth.</td></tr>
                    <tr><td align=\"left\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td></tr>
                    <tr><td align=\"left\">SKPD : $nm_skpd</td></tr>
                    <tr><td align=\"left\">Di Tempat</td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Dengan memperhatikan Peraturan/Gubernur/Bupati/Walikota Nomor ......
                    Tahun ...... tentang Penjabarab APBD, bersama ini kami mengajukan Surat Permintaan Pembayaran ..... sebagai berikut:</td></tr>
                    <tr><td align=\"center\"></td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                     
                        ";
                            
                                  
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">a.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Urusan Pemerintahan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_urusan - $nm_urusan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">b.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">SKPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_skpd - $nm_skpd</td>
                                     
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">c.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Tahun Anggaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$thn_ang</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">d.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Dasar Pengeluaran SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$spd</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">e.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Sisa Dana SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$x1$sisa$y1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"><i>($b)</i></td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">f.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Untuk Keperluan Bulan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$bln</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">g.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama Bendahara Pengeluaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">h.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Pembayaran yang Diminta</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">Rp. $nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\" ><i>($a)</i> </td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">i.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama dan Nomer Rekening Bank</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";
                      $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,$tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
        $data['prev']= $cRet;
            $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
      }
      
      if ($jns==3){
        $sql1="SELECT a.no_spp,a.tgl_spp,a.kd_skpd,a.nm_skpd,a.bulan,b.kd_urusan,b.nm_urusan,a.no_spd,a.nilai,(SELECT SUM(nilai) FROM trdspd WHERE no_spd=a.no_spd)
                AS spd,(SELECT SUM(nilai) FROM trhspp WHERE no_spd=a.no_spd and no_spp <> a.no_spp)AS spp FROM trhspp a INNER JOIN ms_urusan b 
                ON SUBSTR(a.kd_skpd,1,4)=b.kd_urusan  where a.no_spp='$nomor'";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kd_urusan=$row->kd_urusan;
                    $nm_urusan=$row->nm_urusan;
                    $kd_skpd=$row->kd_skpd;
                    $nm_skpd=$row->nm_skpd;
                    $spd=$row->no_spd;
                    $tgl=$row->tgl_spp;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $bln = $this->getBulan($row->bulan);                    
                    $nilai=number_format($row->nilai,"2",",",".");
                    $nilai1=$row->nilai;
                    $nspd=$row->spd;
                    $spp=$row->spp;
                    $sis=$nspd-$spp;
                    $si=$nspd-$spp;
                    if ($si < 0){
                	$x1="(";
                	$si=$si*-1;
                	$y1=")";}
                    else {
                	$x1="";
	                $y1="";}
                    $sisa=number_format($si,"2",",",".");
                    $a=$this->tukd_model->terbilang($nilai1);
                    $b=$this->tukd_model->terbilang($sis);                    
                    //echo($a);
                }
                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN TAMBAHAN UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-TU)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PENGANTAR</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Kepada Yth.</td></tr>
                    <tr><td align=\"left\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td></tr>
                    <tr><td align=\"left\">SKPD : $nm_skpd</td></tr>
                    <tr><td align=\"left\">Di Tempat</td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Dengan memperhatikan Peraturan/Gubernur/Bupati/Walikota Nomor ......
                    Tahun ...... tentang Penjabarab APBD, bersama ini kami mengajukan Surat Permintaan Pembayaran ..... sebagai berikut:</td></tr>
                    <tr><td align=\"center\"></td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                     
                        ";
                            
                                  
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">a.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Urusan Pemerintahan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_urusan - $nm_urusan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">b.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">SKPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_skpd - $nm_skpd</td>
                                     
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">c.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Tahun Anggaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$thn_ang</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">d.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Dasar Pengeluaran SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$spd</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">e.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Sisa Dana SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$x1$sisa$y1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"><i>($b)</i></td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">f.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Untuk Keperluan Bulan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$bln</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">g.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama Bendahara Pengeluaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">h.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Pembayaran yang Diminta</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">Rp. $nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\" ><i>($a)</i> </td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">i.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama dan Nomer Rekening Bank</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";
                      $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,$tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
        $data['prev']= $cRet;
            $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
      }
      
        if ($jns==4){
        $sql1="SELECT a.no_spp,a.tgl_spp,a.kd_skpd,a.nm_skpd,a.bulan,b.kd_urusan,b.nm_urusan,a.no_spd,a.nilai,(SELECT SUM(nilai) FROM trdspd WHERE no_spd=a.no_spd)
                AS spd,(SELECT SUM(nilai) FROM trhspp WHERE no_spd=a.no_spd and no_spp <> a.no_spp)AS spp FROM trhspp a INNER JOIN ms_urusan b 
                ON SUBSTR(a.kd_skpd,1,4)=b.kd_urusan  where a.no_spp='$nomor'";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kd_urusan=$row->kd_urusan;
                    $nm_urusan=$row->nm_urusan;
                    $kd_skpd=$row->kd_skpd;
                    $nm_skpd=$row->nm_skpd;
                    $spd=$row->no_spd;
                    $tgl=$row->tgl_spp;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $bln = $this->getBulan($row->bulan);                    
                    $nilai=number_format($row->nilai,"2",",",".");
                    $nilai1=$row->nilai;
                    $nspd=$row->spd;
                    $spp=$row->spp;
                    $sis=$nspd-$spp;
                    $si=$nspd-$spp;
                    if ($si < 0){
                	$x1="(";
                	$si=$si*-1;
                	$y1=")";}
                    else {
                	$x1="";
	                $y1="";}
                    $sisa=number_format($si,"2",",",".");
                    $a=$this->tukd_model->terbilang($nilai1);
                    $b=$this->tukd_model->terbilang($sis);                    
                    //echo($a);
                }
                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN LANGSUNG GAJI DAN TUNJANGAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-LS GAJI DAN TUNJANGAN)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PENGANTAR</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Kepada Yth.</td></tr>
                    <tr><td align=\"left\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td></tr>
                    <tr><td align=\"left\">SKPD : $nm_skpd</td></tr>
                    <tr><td align=\"left\">Di Tempat</td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Dengan memperhatikan Peraturan/Gubernur/Bupati/Walikota Nomer ......
                    Tahun ...... tentang Penjabarab APBD, bersama ini kami mengajukan Surat Permintaan Pembayaran ..... sebagai berikut:</td></tr>
                    <tr><td align=\"center\"></td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                     
                        ";
                            
                                  
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">a.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Urusan Pemerintahan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_urusan - $nm_urusan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">b.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">SKPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_skpd - $nm_skpd</td>
                                     
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">c.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Tahun Anggaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$thn_ang</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">d.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Dasar Pengeluaran SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$spd</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">e.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Sisa Dana SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$x1$sisa$y1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"><i>($b)</i></td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">f.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Untuk Keperluan Bulan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$bln</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">g.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama Bendahara Pengeluaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">h.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Pembayaran yang Diminta</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">Rp. $nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\" ><i>($a)</i> </td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">i.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama dan Nomer Rekening Bank</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";
                      $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,$tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
            $data['prev']= $cRet;
            $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
      }
      if ($jns==6){
        $sql1="SELECT a.no_spp,a.tgl_spp,a.kd_skpd,a.nm_skpd,a.bulan,b.kd_urusan,b.nm_urusan,a.no_spd,a.nilai,(SELECT SUM(nilai) FROM trdspd WHERE no_spd=a.no_spd)
                AS spd,(SELECT SUM(nilai) FROM trhspp WHERE no_spd=a.no_spd and no_spp <> a.no_spp)AS spp FROM trhspp a INNER JOIN ms_urusan b 
                ON SUBSTR(a.kd_skpd,1,4)=b.kd_urusan  where a.no_spp='$nomor'";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kd_urusan=$row->kd_urusan;
                    $nm_urusan=$row->nm_urusan;
                    $kd_skpd=$row->kd_skpd;
                    $nm_skpd=$row->nm_skpd;
                    $spd=$row->no_spd;
                    $tgl=$row->tgl_spp;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $bln = $this->getBulan($row->bulan);                    
                    $nilai=number_format($row->nilai,"2",",",".");
                    $nilai1=$row->nilai;
                    $nspd=$row->spd;
                    $spp=$row->spp;
                    $sis=$nspd-$spp;
                    $si=$nspd-$spp;
                    if ($si < 0){
                	$x1="(";
                	$si=$si*-1;
                	$y1=")";}
                    else {
                	$x1="";
	                $y1="";}
                    $sisa=number_format($si,"2",",",".");
                    $a=$this->tukd_model->terbilang($nilai1);
                    $b=$this->tukd_model->terbilang($sis);                    
                    //echo($a);
                }
                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN LANGSUNG BARANG DAN JASA </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-LS BARANG DAN JASA)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PENGANTAR</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Kepada Yth.</td></tr>
                    <tr><td align=\"left\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td></tr>
                    <tr><td align=\"left\">SKPD : $nm_skpd</td></tr>
                    <tr><td align=\"left\">Di Tempat</td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Dengan memperhatikan Peraturan/Gubernur/Bupati/Walikota Nomer ......
                    Tahun ...... tentang Penjabarab APBD, bersama ini kami mengajukan Surat Permintaan Pembayaran ..... sebagai berikut:</td></tr>
                    <tr><td align=\"center\"></td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                     
                        ";
                            
                                  
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">a.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Urusan Pemerintahan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_urusan - $nm_urusan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">b.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">SKPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$kd_skpd - $nm_skpd</td>
                                     
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">c.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Tahun Anggaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$thn_ang</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">d.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Dasar Pengeluaran SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$spd</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">e.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Sisa Dana SPD</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$x1$sisa$y1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"><i>($b)</i></td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";                 
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">f.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Nama Bendahara Pengeluaran</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">g.</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">Jumlah Pembayaran yang Diminta</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">:</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">Rp. $nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\"></td>
                                     </tr>
                                     ";                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                    <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\" ><i>($a)</i> </td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\"></td> 
                                     </tr>
                                     ";                    
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";
                      $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">&nbsp;</td>
                                     </tr>
                                     ";

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,$tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
        $data['prev']= $cRet;
             $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
      }            
    }
    
    function cetakspp2(){
        $kd = $this->uri->segment(4);
        $jns = $this->uri->segment(5);
        $nomor=str_replace('123456789','/',$this->uri->segment(3));
        if ($jns==1){
        $sql1="SELECT a.no_spp,a.tgl_spp,a.kd_skpd,a.nm_skpd,a.bulan,b.kd_urusan,b.nm_urusan,a.no_spd,a.nilai FROM trhspp a INNER JOIN ms_urusan b 
                ON SUBSTR(a.kd_skpd,1,4)=b.kd_urusan  where a.no_spp='$nomor'";
                 
                $query = $this->db->query($sql1);                                                 
                foreach ($query->result() as $row)
                {
                   
                    $kd_skpd=$row->kd_skpd;
                    $nm_skpd=$row->nm_skpd;                   
                    $nilai=number_format($row->nilai,"0",",",".");
                    $nilai1=$row->nilai;                    
                    $a=$this->tukd_model->terbilang($nilai1);
                    $tgl=$row->tgl_spp;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                                  
                    //echo($a);
                }    
        
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-UP)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RINGKASAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Berdasarkan Keputusan Gubernur/Bupati/Walikota Nomer ...... Tanggal
                    ...... tentang penetapan jumlah uang persediaan untuk SKPD   $nm_skpd sejumlah Rp $nilai</td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\">Terbilang:  $a</td></tr>                    
                  </table>";

       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,$tanggal</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
       
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
           }
           
         if ($jns==2){                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlang="SELECT sum(nilai) as nilai,sum(nilai_ubah) as nilai_ubah FROM trdrka where substr(kd_rek5,1,2)='52' and kd_skpd='$kd'";
                 $sqlangg=$this->db->query($sqlang);
                 foreach ($sqlangg->result() as $rows)
                {
                    $nilai_ang    = number_format($rows->nilai,"2",".",",");
                    $nilai_angg    = $rows->nilai;
                    $nilai_u_ang    = number_format($rows->nilai_ubah,"2",".",",");                    
                    $nilai_u_angg    = $rows->nilai_ubah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN GANTI UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-GU)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RINGKASAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>                    
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     
                        ";
                            
                                  
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN DPA/DPPA/DPPAL-SKPD</td></tr> ";                                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Jumlah dana DPA/DPPA/DPPAL-SKPD </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$nilai_ang</td></tr>";                                                                          
                    $cRet    .= "  <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN SPD</td></tr> ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"center\">No. Urut</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\" align=\"center\">Nomor SPD</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"32%\" align=\"center\">Tanggal SPD</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"center\">Jumlah Dana</td></tr>";
                                     
                    $sql1="SELECT no_spd,tgl_spd,total as nilai from trhspd where jns_beban='52' and kd_skpd='$kd'";
                    $query = $this->db->query($sql1);
                    $lcno = 0;
                    $lntotal = 0;
                    foreach ($query->result() as $row)
                    {
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    $totalspd = number_format($lntotal,"2",".",",");
                   
                    $no=$row->no_spd;
                    $tgl=$row->tgl_spd;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$no</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$tanggal</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                    }
                    $sisaspd=$nilai_angg - $lntotal;
                    $blmspd=number_format($sisaspd,"2",".",",");
                    $sqlspptls="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND a.jns_spp='6' AND a.no_spp < '$nomor'";
                    $sqlsppls=$this->db->query($sqlspptls);
                    foreach ($sqlsppls->result() as $row)
                    {
                    $jns6     = $row->nilai;
                    $jns6_    = number_format($jns6,"2",".",",");                   
                    } 
                    $sqlspptup="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND (a.jns_spp='1' or a.jns_spp='2') AND a.no_spp < '$nomor'";
                    $sqlsppup=$this->db->query($sqlspptup);
                    foreach ($sqlsppup->result() as $row)
                    {
                    $jns1     = $row->nilai;
                    $jns1_    = number_format($jns1,"2",".",",");                   
                    }
                    $sqlsppttu="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND a.jns_spp='3' AND a.no_spp < '$nomor'";
                    $sqlspptu=$this->db->query($sqlsppttu);
                    foreach ($sqlspptu->result() as $row)
                    {
                    $jns3     = $row->nilai;
                    $jns3_    = number_format($jns3,"2",".",",");                   
                    } 
                    $jmlblj = $jns6 + $jns1 + $jns3;
                    $totblj =number_format($jmlblj,"2",".",",");
                    $sisa   =$sisaspd - $jmlblj;
                    $sisaspp   =number_format($sisa,"2",".",",");
                                                                                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>JUMLAH</i> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $totalspd</td></tr>";                                                                         
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>Sisa dana yang belum di SPD-kan</i> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $blmspd</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\"></td>&nbsp;</tr>"; 
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN BELANJA</td></tr> ";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja UP/GU</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns1_</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja TU</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns3_</td></tr>";                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja LS Pengadaan Barang dan Jasa</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns6_</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>JUMLAH</i></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$totblj</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"2%\" align=\"left\"><i>Sisa SPD yang telah, belum dibelanjakan</i></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"18%\" align=\"right\">$sisaspp</td></tr>";
        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
           }
           
        if ($jns==3){                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlang="SELECT sum(nilai) as nilai,sum(nilai_ubah) as nilai_ubah FROM trdrka where substr(kd_rek5,1,2)='52' and kd_skpd='$kd'";
                 $sqlangg=$this->db->query($sqlang);
                 foreach ($sqlangg->result() as $rows)
                {
                    $nilai_ang    = number_format($rows->nilai,"2",".",",");
                    $nilai_angg    = $rows->nilai;
                    $nilai_u_ang    = number_format($rows->nilai_ubah,"2",".",",");                    
                    $nilai_u_angg    = $rows->nilai_ubah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN TAMBAHAN UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-TU)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RINGKASAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>                    
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     
                        ";
                            
                                  
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN DPA/DPPA/DPPAL-SKPD</td></tr> ";                                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Jumlah dana DPA/DPPA/DPPAL-SKPD </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"center\">$nilai_ang.</td></tr>";                                                                          
                    $cRet    .= "  <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN SPD</td></tr> ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"center\">No. Urut</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\" align=\"center\">Nomor SPD</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"32%\" align=\"center\">Tanggal SPD</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"center\">Jumlah Dana</td></tr>";
                                     
                    $sql1="SELECT no_spd,tgl_spd,total as nilai from trhspd where jns_beban='52' and kd_skpd='$kd'";
                    $query = $this->db->query($sql1);
                    $lcno = 0;
                    $lntotal = 0;
                    foreach ($query->result() as $row)
                    {
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    $totalspd = number_format($lntotal,"2",".",",");
                   
                    $no=$row->no_spd;
                    $tgl=$row->tgl_spd;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$no</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$tanggal</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                    }
                    $sisaspd=$nilai_angg - $lntotal;
                    $blmspd=number_format($sisaspd,"2",".",",");
                    $sqlspptls="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND a.jns_spp='6' AND a.no_spp < '$nomor'";
                    $sqlsppls=$this->db->query($sqlspptls);
                    foreach ($sqlsppls->result() as $row)
                    {
                    $jns6     = $row->nilai;
                    $jns6_    = number_format($jns6,"2",".",",");                   
                    } 
                    $sqlspptup="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND (a.jns_spp='1' or a.jns_spp='2') AND a.no_spp < '$nomor'";
                    $sqlsppup=$this->db->query($sqlspptup);
                    foreach ($sqlsppup->result() as $row)
                    {
                    $jns1     = $row->nilai;
                    $jns1_    = number_format($jns1,"2",".",",");                   
                    }
                    $sqlsppttu="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND a.jns_spp='3' AND a.no_spp < '$nomor'";
                    $sqlspptu=$this->db->query($sqlsppttu);
                    foreach ($sqlspptu->result() as $row)
                    {
                    $jns3     = $row->nilai;
                    $jns3_    = number_format($jns3,"2",".",",");                   
                    } 
                    $jmlblj = $jns6 + $jns1 + $jns3;
                    $totblj =number_format($jmlblj,"2",".",",");
                    $sisa   =$sisaspd - $jmlblj;
                    $sisaspp   =number_format($sisa,"2",".",",");
                                                                                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>JUMLAH</i> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $totalspd</td></tr>";                                                                         
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>Sisa dana yang belum di SPD-kan</i> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $blmspd</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\"></td>&nbsp;</tr>"; 
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN BELANJA</td></tr> ";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja UP/GU</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns1_</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja TU</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns3_</td></tr>";                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja LS Pengadaan Barang dan Jasa</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns6_</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>JUMLAH</i></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$totblj</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"2%\" align=\"left\"><i>Sisa SPD yang telah, belum dibelanjakan</i></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"18%\" align=\"right\">$sisaspp</td></tr>";
        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
           }
        if ($jns==4){                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlang="SELECT sum(nilai) as nilai,sum(nilai_ubah) as nilai_ubah FROM trdrka where substr(kd_rek5,1,2)='51' and kd_skpd='$kd'";
                 $sqlangg=$this->db->query($sqlang);
                 foreach ($sqlangg->result() as $rows)
                {
                    $nilai_ang    = number_format($rows->nilai,"2",".",",");
                    $nilai_angg    = $rows->nilai;
                    $nilai_u_ang    = number_format($rows->nilai_ubah,"2",".",",");                    
                    $nilai_u_angg    = $rows->nilai_ubah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN LANGSUNG GAJI DAN TUNJANGAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-LS GAJI DAN TUNJANGAN)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RINGKASAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>                    
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     
                        ";
                            
                                  
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN DPA/DPPA/DPPAL-SKPD</td></tr> ";                                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Jumlah dana DPA/DPPA/DPPAL-SKPD </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$nilai_ang</td></tr>";                                                                          
                    $cRet    .= "  <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN SPD</td></tr> ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"center\">No. Urut</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\" align=\"center\">Nomor SPD</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"32%\" align=\"center\">Tanggal SPD</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"center\">Jumlah Dana</td></tr>";
                                     
                    $sql1="SELECT no_spd,tgl_spd,total as nilai from trhspd where jns_beban='51' and kd_skpd='$kd'";
                    $query = $this->db->query($sql1);
                    $lcno = 0;
                    $lntotal = 0;
                    foreach ($query->result() as $row)
                    {
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    $totalspd = number_format($lntotal,"2",".",",");
                   
                    $no=$row->no_spd;
                    $tgl=$row->tgl_spd;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$no</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$tanggal</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                    }
                    $sisaspd=$nilai_angg - $lntotal;
                    $blmspd=number_format($sisaspd,"2",".",",");
                    $sqlspptls="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND a.jns_spp='4' AND a.no_spp < '$nomor'";
                    $sqlsppls=$this->db->query($sqlspptls);
                    foreach ($sqlsppls->result() as $row)
                    {
                    $jns4     = $row->nilai;
                    $jns4_    = number_format($jns4,"2",".",",");                   
                    } 
                    
                    $jmlblj = $jns4;
                    $totblj =number_format($jmlblj,"2",".",",");
                    $sisa   =$sisaspd - $jmlblj;
                    $sisaspp   =number_format($sisa,"2",".",",");
                                                                                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>JUMLAH</i> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $totalspd</td></tr>";                                                                         
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>Sisa dana yang belum di SPD-kan</i> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $blmspd</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\"></td>&nbsp;</tr>"; 
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN BELANJA</td></tr> ";                                 
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja LS Gaji dan Tunjangan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns4_</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>JUMLAH</i></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$totblj</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"2%\" align=\"left\"><i>Sisa SPD yang telah, belum dibelanjakan</i></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"18%\" align=\"right\">$sisaspp</td></tr>";
        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
           }
           if ($jns==6){
        
        $sqlhspp="select * from trhspp where no_spp='$nomor'";
                 $sqlspp=$this->db->query($sqlhspp);
                 foreach ($sqlspp->result() as $rows)
                {
                    $prog  = $rows->nm_program;
                    $kdgiat  = $rows->kd_kegiatan;
                    $giat  = $rows->nm_kegiatan;
                    $rekan = $rows->nmrekan;
                    $bentuk=substr($rekan,0,2);
                    $dir   = $rows->pimpinan;
                    $kbank = $rows->bank;
                     switch ($kbank) 
                        {
                            case '01': //UP
                            $bank = "BRI";
                             break;
                            case '02': //GU
                                $bank = "MANDIRI";
                                break;
                            case '03': //TU
                                $bank = "BNI";
                                break;
                            default:
                                $bank = "BCA";                                
                        }
                    $rek    = $rows->no_rek;
                    $ket    = $rows->keperluan;
                }
                
        //$sqlang="SELECT sum(nilai) as nilai,sum(nilai_ubah) as nilai_ubah FROM trdrka where kd_kegiatan='$kdgiat'";
        $sqlang="SELECT sum(nilai) as nilai,sum(nilai_ubah) as nilai_ubah FROM trdrka where substr(kd_rek5,1,2)='52' and kd_skpd='$kd'";
                 $sqlangg=$this->db->query($sqlang);
                 foreach ($sqlangg->result() as $rows)
                {
                    $nilai_ang    = number_format($rows->nilai,"2",".",",");
                    $nilai_angg    = $rows->nilai;
                    $nilai_u_ang    = number_format($rows->nilai_ubah,"2",".",",");                    
                    $nilai_u_angg    = $rows->nilai_ubah;
                   
                }
        
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN LANGSUNG BARANG DAN JASA </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-LS BARANG DAN JASA)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>                                       
                    <tr><td align=\"center\"><strong>RINGKASAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                                      
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\"> ";
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN KEGIATAN</td></tr> ";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >1. Program </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:$prog</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >2. Kegiatan </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:$giat.</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >3. Nomor dan Tanggal DPA/DPPA/DPPAL-SKPD </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:.</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >4. Nama Perusahaan </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:$rekan</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >5. Bentuk Perusahaan </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:$bentuk</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >6. Alamat Perusahaan </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >7. Nama Pimpinan Perusahaan </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:$dir</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >8. Nama dan Nomor Rekening Bank </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:$bank - $rek</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >9. Nomor Kontrak </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >10. Kegiatan Lanjutan </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:</td></tr>";    
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >11. Waktu Pelaksanaan Kegiatan </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:</td></tr>";
                    $cRet    .= " <tr><td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:solid 1px black;border-right: none;\" width=\"2%\" align=\"left\" >12. Deskripsi Pekerjaan </td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;horizontal-align:left;border-left:none;border-right: solid 1px black;\" width=\"18%\">:$ket</td></tr>";
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN DPA/DPPA/DPPAL-SKPD</td></tr> ";                                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Jumlah dana DPA/DPPA/DPPAL-SKPD </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $nilai_ang</td></tr>";                                                                          
                    $cRet    .= "  <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN SPD</td></tr> ";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"center\">No. Urut</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\" align=\"center\">Nomor SPD</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"32%\" align=\"center\">Tanggal SPD</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"center\">Jumlah Dana</td></tr>";
                                     
                    //$sql1="SELECT a.no_spd,a.tgl_spd,b.nilai FROM trdspd b INNER JOIN trhspd a ON b.no_spd=a.no_spd
//                           WHERE b.kd_kegiatan='$kdgiat' AND kd_skpd='$kd'";
                    $sql1="SELECT no_spd,tgl_spd,total as nilai from trhspd where jns_beban='52' and kd_skpd='$kd'";
                    $query = $this->db->query($sql1);
                    $lcno = 0;
                    $lntotal = 0;
                    foreach ($query->result() as $row)
                    {
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    $totalspd = number_format($lntotal,"2",".",",");
                   
                    $no=$row->no_spd;
                    $tgl=$row->tgl_spd;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$no</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$tanggal</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                    }
                    $sisaspd=$nilai_angg - $lntotal;
                    $blmspd=number_format($sisaspd,"2",".",",");
                    $sqlspptls="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND a.jns_spp='6' AND a.no_spp < '$nomor'";
                    $sqlsppls=$this->db->query($sqlspptls);
                    foreach ($sqlsppls->result() as $row)
                    {
                    $jns6     = $row->nilai;
                    $jns6_    = number_format($jns6,"2",".",",");                   
                    } 
                    $sqlspptup="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND (a.jns_spp='1' or a.jns_spp='2') AND a.no_spp < '$nomor'";
                    $sqlsppup=$this->db->query($sqlspptup);
                    foreach ($sqlsppup->result() as $row)
                    {
                    $jns1     = $row->nilai;
                    $jns1_    = number_format($jns1,"2",".",",");                   
                    }
                    $sqlsppttu="SELECT SUM(b.nilai)AS nilai FROM trdspp b INNER JOIN trhspp a ON b.no_spp=a.no_spp WHERE a.kd_skpd='$kd' 
                                  AND a.jns_spp='3' AND a.no_spp < '$nomor'";
                    $sqlspptu=$this->db->query($sqlsppttu);
                    foreach ($sqlspptu->result() as $row)
                    {
                    $jns3     = $row->nilai;
                    $jns3_    = number_format($jns3,"2",".",",");                   
                    } 
                    $jmlblj = $jns6 + $jns1 + $jns3;
                    $totblj =number_format($jmlblj,"2",".",",");
                    $sisa   =$sisaspd - $jmlblj;
                    $sisaspp   =number_format($sisa,"2",".",",");
                                                                                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>JUMLAH</i> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $totalspd</td></tr>";                                                                         
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>Sisa dana yang belum di SPD-kan</i> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\"> $blmspd</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\"></td>&nbsp;</tr>"; 
                    $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"center\">RINGKASAN BELANJA</td></tr> ";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja UP/GU</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns1_</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja TU</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns3_</td></tr>";                    
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">Belanja LS Pengadaan Barang dan Jasa</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$jns6_</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"right\"><i>JUMLAH</i></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\" align=\"right\">$totblj</td></tr>";
                    $cRet    .= " <tr><td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"2%\" align=\"left\"><i>Sisa SPD yang telah, belum dibelanjakan</i></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"18%\" align=\"right\">$sisaspp</td></tr>";
        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,15,5,10,'0'); 
           }            
    }
    
    function cetakspp3(){
        $kd = $this->uri->segment(4);
        $jns = $this->uri->segment(5);
        $nomor=str_replace('123456789','/',$this->uri->segment(3));
        if ($jns==1){
        
        $sqltgl="SELECT * FROM trhspp where no_spp='$nomor'";
                 $sqltgl=$this->db->query($sqltgl);
                 foreach ($sqltgl->result() as $rowtg)
                {
                   $tgl=$rowtg->tgl_spp;
                   $tanggal = $this->tanggal_format_indonesia($tgl);   
                   $bln = $this->getBulan($rowtg->bulan);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
           
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-UP)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RENCANA PENGGUNA ANGGARAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>                    
                    
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>No Urut</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Kode Rekening</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"60%\" align=\"center\"><b>Uraian</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah</b></td>                                                    
                     </thead> 
                           
                        ";
                            
                 $sql1="select kd,kd_kegiatan,kd_rek5,nm_rek5,nilai from trdspp where no_spp='$nomor' order by kd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $lcno = 0;
                $lntotal = 0;                                 
                foreach ($query->result() as $row)
                {   
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    //$no=$row->kd + 1;
                    $giat=$row->kd_kegiatan;
                    $rek=$row->kd_rek5;
                    $reke=$this->dotrek($rek);                    
                    $uraian=$row->nm_rek5;
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"center\">$reke</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                }
                   
                 $sqltp="SELECT SUM(nilai) AS tot FROM trdspp WHERE no_spp='$nomor'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->tot,"2",".",",");
                   
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"15%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"60%\" align=\"center\">Jumlah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"20%\" align=\"right\">$totp</td>                                     
                                     </tr>";
                 } 

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
       }
        if ($jns==2){
        
        $sqltgl="SELECT * FROM trhspp where no_spp='$nomor'";
                 $sqltgl=$this->db->query($sqltgl);
                 foreach ($sqltgl->result() as $rowtg)
                {
                   $tgl=$rowtg->tgl_spp;
                   $tanggal = $this->tanggal_format_indonesia($tgl);   
                   $bln = $this->getBulan($rowtg->bulan);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
           
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN GANTI UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-GU)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RINCIAN PENGGUNAAN ANGGARAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>     
                    <tr><td align=\"center\"></td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>No Urut</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Kode Rekening</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"60%\" align=\"center\"><b>Uraian</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah</b></td>                                                    
                     </thead> 
                           
                        ";
                            
                 $sql1="select kd,kd_kegiatan,kd_rek5,nm_rek5,nilai from trdspp where no_spp='$nomor' order by kd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                 $lcno = 0;
                 $lntotal = 0;                                 
                foreach ($query->result() as $row)
                {   
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    //$no=$row->kd + 1;
                    $giat=$row->kd_kegiatan;
                    $rek=$row->kd_rek5;
                    $reke=$this->dotrek($rek);                    
                    $uraian=$row->nm_rek5;
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"center\">$giat.$reke</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                }
                   
                 $sqltp="SELECT SUM(nilai) AS tot FROM trdspp WHERE no_spp='$nomor'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->tot,"2",".",",");
                   
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"15%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"60%\" align=\"center\">Jumlah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"20%\" align=\"right\">$totp</td>                                     
                                     </tr>";
                 } 

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0');  
       }
       
       if ($jns==3){
        
        $sqltgl="SELECT * FROM trhspp where no_spp='$nomor'";
                 $sqltgl=$this->db->query($sqltgl);
                 foreach ($sqltgl->result() as $rowtg)
                {
                   $tgl=$rowtg->tgl_spp;
                   $tanggal = $this->tanggal_format_indonesia($tgl);   
                   $bln = $this->getBulan($rowtg->bulan);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
           
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN TAMBAHAN UANG PERSEDIAAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-TU)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RINCIAN </strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>     
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"left\"><strong>RENCANA PENGGUNAAN </strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>No Urut</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Kode Rekening</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"60%\" align=\"center\"><b>Uraian</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah</b></td>                                                    
                     </thead> 
                           
                        ";
                            
                 $sql1="select kd,kd_kegiatan,kd_rek5,nm_rek5,nilai from trdspp where no_spp='$nomor' order by kd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $lcno = 0;
                $lntotal = 0;                                 
                foreach ($query->result() as $row)
                {   
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    //$no=$row->kd + 1;
                    $giat=$row->kd_kegiatan;
                    $rek=$row->kd_rek5;
                    $reke=$this->dotrek($rek);                    
                    $uraian=$row->nm_rek5;
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"center\">$reke</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                }
                   
                 $sqltp="SELECT SUM(nilai) AS tot FROM trdspp WHERE no_spp='$nomor'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->tot,"2",".",",");
                   
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"15%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"60%\" align=\"center\">Jumlah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"20%\" align=\"right\">$totp</td>                                     
                                     </tr>";
                 } 

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0');  
       }
        
        if ($jns==4){
        
        $sqltgl="SELECT * FROM trhspp where no_spp='$nomor'";
                 $sqltgl=$this->db->query($sqltgl);
                 foreach ($sqltgl->result() as $rowtg)
                {
                   $tgl=$rowtg->tgl_spp;
                   $tanggal = $this->tanggal_format_indonesia($tgl);   
                   $bln = $this->getBulan($rowtg->bulan);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
           
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN LANGSUNG GAJI DAN TUNJANGAN </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-LS GAJI DAN TUNJANGAN)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"><strong>RINCIAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>                    
                    <tr><td align=\"left\">RENCANA PENGGUNA ANGGARAN</td></tr>
                    <tr><td align=\"left\">BULAN :$bln </td></tr>                    
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>No Urut</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Kode Rekening</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"60%\" align=\"center\"><b>Uraian</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah</b></td>                                                    
                     </thead> 
                           
                        ";
                            
                 $sql1="select kd,kd_kegiatan,kd_rek5,nm_rek5,nilai from trdspp where no_spp='$nomor' order by kd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $lcno = 0;
                 $lntotal = 0;                                 
                foreach ($query->result() as $row)
                {   
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    //$no=$row->kd + 1;
                    $giat=$row->kd_kegiatan;
                    $rek=$row->kd_rek5;
                    $reke=$this->dotrek($rek);                    
                    $uraian=$row->nm_rek5;
                    $nilai=number_format($row->nilai,"2",".",",");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"center\">$reke</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"60%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                }
                   
                 $sqltp="SELECT SUM(nilai) AS tot FROM trdspp WHERE no_spp='$nomor'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->tot,"2",".",",");
                   
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"15%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"60%\" align=\"center\">Jumlah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"20%\" align=\"right\">$totp</td>                                     
                                     </tr>";
                 } 

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$daerah ,</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">&nbsp;</td></tr>
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">$nama</td></tr>                              
                    <tr><td align=\"center\" width=\"25%\">&nbsp;</td>                    
                    <td align=\"center\" width=\"25%\">&nbsp;</td>
                    <td align=\"center\" width=\"25%\">NIP. $nip</td></tr>
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0');  
       }
       if ($jns==6){
        
        $sqltgl="SELECT tgl_spp FROM trhspp where no_spp='$nomor'";
                 $sqltgl=$this->db->query($sqltgl);
                 foreach ($sqltgl->result() as $rowtg)
                {
                   $tgl=$rowtg->tgl_spp;
                   $tanggal = $this->tanggal_format_indonesia($tgl);   
                   
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$kd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
           
        $thn_ang	   = $this->session->userdata('pcThang');
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\"><strong>PEMERINTAH KABUPATEN $kab </strong></td></tr>
                    <tr><td align=\"center\"><strong>SURAT PERMINTAAN PEMBAYARAN LANGSUNG BARANG DAN JASA </strong></td></tr>
                    <tr><td align=\"center\"><strong>(SPP-LS BARANG DAN JASA)</strong></td></tr>                              
                    <tr><td align=\"center\"><strong>Nomor :$nomor Tahun $thn_ang</strong></td></tr>                    
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>  
                    <tr><td align=\"center\"><strong>RINCIAN</strong></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>                                        
                    <tr><td align=\"left\">RENCANA PENGGUNA ANGGARAN</td></tr>
                    <tr><td align=\"center\"></td></tr>
                    <tr><td align=\"center\"></td></tr>                      
                  </table>";

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>No Urut</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"35%\" align=\"center\"><b>Kode Rekening</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah</b></td>                                                    
                     </thead> 
                           
                        ";
                            
                 $sql1="select kd,kd_kegiatan,kd_rek5,nm_rek5,nilai from trdspp where no_spp='$nomor' order by kd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $lcno = 0;
                $lntotal = 0;                                 
                foreach ($query->result() as $row)
                {   
                    $lcno = $lcno + 1;
                    $lntotal = $lntotal + $row->nilai;
                    //$no=$row->kd + 1;
                    $giat=$row->kd_kegiatan;
                    $rek=$row->kd_rek5;
                    $reke=$this->dotrek($rek);                    
                    $uraian=$row->nm_rek5;
                    $nilai=number_format($row->nilai,"2",",",".");                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"center\">$lcno</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"35%\">$giat.$reke</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                }
                   
                 $sqltp="SELECT SUM(nilai) AS tot FROM trdspp WHERE no_spp='$nomor'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->tot,"2",",",".");
                   
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"35%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"40%\" align=\"center\">Jumlah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\">$totp</td>                                     
                                     </tr>";
                 } 

        $cRet .=       " </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td align=\"center\">&nbsp;</td>
                    <td align=\"center\">&nbsp;</td></tr>
                    <tr><td align=\"center\">Mengetahui</td>
                    <td align=\"center\">$daerah ,$tanggal</td></tr>
                    <tr><td align=\"center\">Pejabat Pelaksana Teknis Kegiatan</td>
                    <td align=\"center\">Bendahara Pengeluaran</td></tr>
                    <tr><td align=\"center\">&nbsp;</td>
                    <td align=\"center\">&nbsp;</td></tr>                              
                    <tr><td align=\"center\">&nbsp;</td>
                    <td align=\"center\">&nbsp;</td></tr>                                       
                    <tr><td align=\"center\">&nbsp;</td>
                    <td align=\"center\">$nama</td></tr>
                    <tr><td align=\"center\">&nbsp;</td>
                    <td align=\"center\">NIP. $nip</td></tr>
                    
                  </table>";
                $data['prev']= $cRet;
                $this->tukd_model->_mpdf('',$cRet,10,10,10,'0'); 
       }                  
    }
    
     function cetak_spm(){
        $lcnospm = str_replace('123456789','/',$this->uri->segment(3));
        $kd = $this->uri->segment(4);
        $jns = $this->uri->segment(5);
        
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $sqlttd1="SELECT a.nama as nm,a.nip as nip,a.jabatan as jab,a.kd_skpd,b.nm_skpd FROM ms_ttd a inner join ms_skpd b on 
                    a.kd_skpd=b.kd_skpd where a.kd_skpd='$kd' and kode='PT'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $skpd = $rowttd ->kd_skpd;
                    $nmskpd = $rowttd->nm_skpd;
                }
        //$thn_ang	   = $this->session->userdata('pcThang');
        
        
        
        $csql = "SELECT a.*,(SELECT nilai FROM trhspp WHERE no_spp = a.no_spp) AS nil_spp,
                (SELECT tgl_spd FROM trhspd WHERE no_spd=a.no_spd) AS tgl_spd,
                (SELECT IF(jns_beban='52','Belanja Langsung','Belanja Tidak Langsung')
                FROM trhspd WHERE no_spd=a.no_spd) AS jns_beban
                FROM trhspm a WHERE a.no_spm = '$lcnospm' ";
        $hasil = $this->db->query($csql);
        $trh = $hasil->row();
        
        switch ($jns) 
        {
            case '1': //UP
                $lcbeban = "UP/<strike>GU/TU/LS</strike>";
                break;
            case '2': //GU
                $lcbeban = "<strike>UP</strike>/GU/<strike>TU/LS</strike>";
                break;
            case '3': //TU
                $lcbeban = "<strike>UP/GU</strike>/TU/<strike>LS</strike>";
                break;
            default:
                $lcbeban = "<strike>UP/GU/TU</strike>/LS";
                
        }
        
        $lcpemda = "PEMERINTAH KABUPATEN $kab";
        $lcskpd = $nmskpd;
        $lcbend = '';
        $lcrekbank = $trh->no_rek;
        $lctahun = $this->session->userdata('pcThang');
        $lcnpwp = $trh->npwp;
        $lctglspd = $trh->tgl_spd;
        $lcnospd = $trh->no_spd;
        $lckeperluan = $trh->keperluan;
        $lcjnsbelanja = $trh->jns_beban;       
        $lnterbilang =$trh->nil_spp; 
        $lcterbilang = $this->tukd_model->terbilang($lnterbilang);
        $lcnospp = $trh->no_spp;
        $ldtglspp =$this->tukd_model->tanggal_format_indonesia($trh->tgl_spp);
        
        $cRet = "";
       
       
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"-1\" cellpadding=\"-1\">
                     <tr>
                         <td colspan=\"2\" align=\"center\" style=\"font-size:14px;border: solid 1px white;\">
                            <b>$lcpemda</b>
                         </td>
                     </tr>
                     <tr>
                         <td colspan=\"2\" align=\"center\" style=\"font-size:15px;border: solid 1px white;\">
                            <b>SURAT PERINTAH MEMBAYAR (SPM)</b>
                         </td>
                     </tr>
                     <tr>
                         <td colspan=\"2\" align=\"center\" style=\"font-size:14px;border: solid 1px white;\">
                            <b>TAHUN ANGGARAN $lctahun</b>
                         </td>
                     </tr>
                     <tr>
                         <td colspan=\"2\" align=\"right\" style=\"font-size:10px;border-right: none;border-top: none;border-left: none;\">
                            $lcbeban<br>Nomor SPM : $lcnospm
                         </td>
                     </tr>
                     <tr>
                         <td colspan=\"2\" align=\"center\" style=\"font-size:14px\">(disi oleh PPK-SKPD)</td>
                     </tr>
                     <tr>
                         <td width=\"50%\" style=\"font-size:14px\">
                            <table style=\"border-collapse:collapse;\" width=\"600\" align=\"left\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                        BENDAHARA UMUM DAERAH
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                        $lcpemda
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                        Supaya menerbitkan SP2D kepada:
                                    </td>
                                </tr>
                            </table>
                         </td>
                         <td width=\"50%\" style=\"font-size:14px\" valign=\"top\">Potongan-potongan :</td>
                     </tr>
                     <tr>
                         <td width=\"50%\" style=\"font-size:14px\" valign=\"top\">
                            <table style=\"border-collapse:collapse;\" width=\"600\" align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                        SKPD : <b>$lcskpd</b>
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                        Bendahara Pengeluaran/Pihak Ketiga :<b> $lcbend</b>
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                        Nomor Rekening Bank :<b> $lcrekbank</b>
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                        NPWP :<b>$lcnpwp</b>
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                        Dasar Pembayaran/No dan Tanggal SPD :<b>$lcnospd , $lctglspd</b> 
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px;border-bottom: solid 1px black;border-top: solid 1px black;\">
                                     Untuk keperluan : <b>$lckeperluan<br>
                                     $lcjnsbelanja </b>
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px\">
                                         Pembebanan pada kode rekening :
                                         <table style=\"border-collapse:collapse;\" width=\"600\" align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
                                            ";
                                        
                                        $sql = "select * from trdspp where no_spp='$lcnospp'";
                                        $hasil = $this->db->query($sql);
                                        $lcno = 0;
                                        $lntotal = 0;
                                        foreach ($hasil->result() as $row)
                                        {
                                           $lcno = $lcno + 1;
                                           $lntotal = $lntotal + $row->nilai;
                                           $cRet .="     
                                           <tr>
                                                <td style=\"font-size:12px\">
                                                    $lcno. $row->kd_kegiatan.".$this->tukd_model->dotrek($row->kd_rek5)."
                                                </td>
                                                <td style=\"font-size:12px\">
                                                    : $row->nm_rek5 
                                                </td>
                                                <td style=\"font-size:12px\">
                                                    Rp
                                                </td>
                                                <td style=\"font-size:12px\" align=\"right\">
                                                    ".number_format($row->nilai)."
                                                </td>
                                            </tr>";    
                                            
                                        }
                                            
                                            
                                    $cRet .="</table>";
                                    if($lcno<=15)
                                       {
                                         for ($i = $lcno; $i <= 15; $i++) 
                                          {
                                            $cRet .="<br>";     
                                          }                                                   
                                       }
                                         
                                                                                  
                                    $cRet .="</td>
                                </tr>
                                <tr>
                                    <td width=\"100%\" style=\"font-size:14px;border-bottom: solid 1px black;border-top: solid 1px black;\">
                                    Jumlah SPP yang diminta Rp.".number_format($lnterbilang)."<br>
                                    <i>($lcterbilang)</i><br>
                                    Nomor dan Tanggal SPP :$lcnospp dan $ldtglspp                                   
                                    </td>
                                </tr>
                                 <tr>
                                    <td width=\"100%\" style=\"font-size:14px;border-bottom: none;border-top: solid 1px black;\">
                                        *) coret yang tidak perlu<br>
                                        **)pilih yang sesuai                                                      
                                    </td>
                                </tr>
                            </table>
                         </td>
                         <td width=\"50%\" style=\"font-size:14px\" valign=\"top\">
                            <table style=\"border-collapse:collapse;\" width=\"600\" align=\"left\" border=\"1\" cellspacing=\"0\" cellpadding=\"1\">
                                <tr><thead>
                                    <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\">No.</td>
                                    <td width=\"50%\" style=\"font-size:14px\" align=\"center\">Uraian<br>(No. Rekening)</td>
                                    <td width=\"20%\" style=\"font-size:14px\" align=\"center\" valign=\"top\">Jumlah</td>
                                    <td width=\"20%\" style=\"font-size:14px\" align=\"center\" valign=\"top\">Keterangan</td>
                                    </thead>
                                </tr>";
                                 $sql = "select * from trspmpot where no_spm='$lcnospm' and pot='0'";
                                        $hasil = $this->db->query($sql);
                                        $lcno = 0;
                                        $lntotalpot = 0;
                                        foreach ($hasil->result() as $row)
                                        {
                                           $lcno = $lcno + 1;
                                           $lntotalpot = $lntotalpot + $row->nilai;
                                            $cRet .="<tr>
                                                        <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\">$lcno</td>
                                                        <td align=\"left\" style=\"font-size:14px\">$row->nm_rek5</td>
                                                        <td align=\"right\">".number_format($row->nilai)."</td>
                                                        <td></td>
                                                    </tr>";    
                                        }
                                        
                                       if($lcno<=6)
                                       {
                                         for ($i = $lcno; $i <= 6; $i++) 
                                          {
                                            $cRet .= "<tr>
                                                        <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\">&nbsp;</td>
                                                        <td align=\"left\" style=\"font-size:14px\"></td>
                                                        <td></td>
                                                        <td></td>
                                                     </tr>";    
                                          }                                                   
                                       }
                                
                              
                                $cRet .="
                                <tr>
                                    <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\"></td>
                                    <td align=\"left\" style=\"font-size:14px\">Jumlah Potongan</td>
                                    <td align=\"right\">".number_format($lntotalpot)."</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\" colspan=\"4\">
                                    Informasi :<i>(tidak mengurangi jumlah pembayaran SPM)</i>
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\">No.</td>
                                    <td align=\"center\" style=\"font-size:14px\">Uraian</td>
                                    <td align=\"center\" style=\"font-size:14px\">Jumlah</td>
                                    <td align=\"center\" style=\"font-size:14px\">Keterangan</td>
                                </tr>";
                                
                                
                                 $sql = "select * from trspmpot where no_spm='$lcnospm' and pot='1'";
                                        $hasil = $this->db->query($sql);
                                        $lcno = 0;
                                        $lntotalpot_not = 0;
                                        foreach ($hasil->result() as $row)
                                        {
                                           $lntotalpot_not = $lntotalpot_not + $row->nilai; 
                                           $lcno = $lcno + 1;
                                            $cRet .="
                                                    <tr>
                                                        <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\">$lcno</td>
                                                        <td align=\"left\" style=\"font-size:14px\">$row->nm_rek5</td>
                                                        <td align=\"right\">".number_format($row->nilai)."</td>
                                                        <td></td>
                                                    </tr>";    
                                        }
                                        
                                       if($lcno<=3)
                                       {
                                         for ($i = $lcno; $i <= 3; $i++) 
                                          {
                                            $cRet .= "<tr>
                                                        <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\">&nbsp;</td>
                                                        <td align=\"left\" style=\"font-size:14px\"></td>
                                                        <td></td>
                                                        <td></td>
                                                     </tr>";    
                                          }                                                   
                                       }
                                
                                
                                $cRet .="
                                <tr>
                                    <td width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\"></td>
                                    <td align=\"left\" style=\"font-size:14px\">Jumlah</td>
                                    <td align=\"right\">".number_format($lntotalpot_not)."</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td colspan=\"2\" width=\"10%\" style=\"font-size:14px\" align=\"center\" valign=\"top\"> Jumlah SPM</td>
                                    <td align=\"right\">".number_format($lntotal-$lntotalpot)."</td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td width=\"10%\" style=\"font-size:14px;border-bottom: none;\" align=\"left\" valign=\"top\" colspan=\"4\">
                                    Uang Sejumlah : <i>(".$this->tukd_model->terbilang($lntotal-$lntotalpot).")</i>
                                    </td>
                                </tr>
                                <tr>
                                    <td width=\"10%\" style=\"font-size:14px;border-bottom: none;border-top: none;\" align=\"Center\" valign=\"top\" colspan=\"4\">
                                    <br><br>
                                    Bandung, tanggal 20 Januari 2012 <br>
                                    Kepala SKPD <br><br><br>
                                    (nama lengkap)<br>
                                    NIP.
                                    <br>
                                    <br>                                    
                                    </td>
                                </tr>
                            </table>
                         </td>
                     </tr>
                     <tr>
                         <td colspan=\"2\" style=\"font-size:12px\" align=\"center\">
                         <i>SPM ini sah apabila telah di tandatangani dan distempel oleh Kepala SKPD</i>
                         </td>
                     </tr>
                  </table>";
                     
        $data['prev']= $cRet;    
        $this->tukd_model->_mpdf('',$cRet,'2','10',5,'1');               
        
    }
   
   function cetak_sp2d(){
		//$jns = $this->uri->segment(3);
		$lntahunang = $this->session->userdata('pcThang');
        $lcnosp2d = str_replace('123456789','/',$this->uri->segment(3));
       // $lcttd = str_replace('123456789','/',$this->uri->segment(5));
        $lcttd = str_replace('abc',' ',$this->uri->segment(5));
	    $banyak = $this->uri->segment(6);
		$jns_cetak = $this->uri->segment(7);
        $a ='*'.$lcnosp2d.'*';
        $csql = "SELECT a.*,
				(SELECT nmrekan FROM trhspp WHERE no_spp = a.no_spp AND kd_skpd=a.kd_skpd) AS nmrekan,
				(SELECT pimpinan FROM trhspp WHERE no_spp = a.no_spp AND kd_skpd=a.kd_skpd) AS pimpinan,
				(SELECT alamat FROM trhspp WHERE no_spp = a.no_spp AND kd_skpd=a.kd_skpd) AS alamat
                 FROM trhsp2d a WHERE a.no_sp2d = '$lcnosp2d'";
        $hasil = $this->db->query($csql);
        $trh = $hasil->row();
		$lckd_skpd  = $trh->kd_skpd;
        $lcnospm    = $trh->no_spm;
        $ldtglspm   = $trh->tgl_spm;
        $lcnmskpd   = $trh->nm_skpd;
        $lckdskpd   = $trh->kd_skpd;
        $alamat     = $trh->alamat;
        $lcnpwp     = $trh->npwp;
        $rekbank    = $trh->no_rek;
        $lcperlu    = $trh->keperluan;
        $lcnospp    = $trh->no_spp;
        $tgl        = $trh->tgl_sp2d;
        $n          = $trh->nilai;
		$pimpinan	= $trh->pimpinan;
        $nmrekan	=$trh->nmrekan;
		$jns_bbn	=$trh->jenis_beban;
		$jns		=$trh->jns_spp;
        $bank=$trh->bank;
		$banyak_kar = strlen($lcperlu);
        $tanggal    = $this->tanggal_format_indonesia($tgl);
		//$banyak = $banyak_kar > 400 ? 14 :23;                     

        
		$sqlrek="SELECT bank,rekening, npwp FROM ms_skpd WHERE kd_skpd = '$lckd_skpd' ";
                 $sqlrek=$this->db->query($sqlrek);
                 foreach ($sqlrek->result() as $rowrek)
                {
                    $bank_ben=$rowrek->bank;                    
                    $rekben=$rowrek->rekening;                    
                    $npwp_ben= $rowrek->npwp;
                }
			//$rek_ben = empty($rekben) || $rekben == 0 ? '' :$rekben;
			//$npwp_ben = empty($npwp_ben) || $npwp_ben == 0 ? '' :$npwp_ben;
			//$nama_bank = empty($bank) ? 'Belum Pilih Bank' :$this->rka_model->get_nama($bank,'nama','ms_bank','kode');
			//$nama_bank_ben = empty($bank_ben) ? 'Belum Pilih Bank' :$this->rka_model->get_nama($bank_ben,'nama','ms_bank','kode');			
			$sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
					$pangkat=$rowttd->pangkat;
                }
		$sqlnam="SELECT TOP 1 * FROM ms_ttd WHERE kd_skpd = '$lckdskpd' AND kode='BK' ";
                 $sqlnam=$this->db->query($sqlnam);
                 foreach ($sqlnam->result() as $rownam)
                {
                    $nama_ben=$rownam->nama;                    
                    $jabat_ben=$rownam->jabatan;                    
                }
		$nama_ben = empty($nama_ben) ? 'Belum Ada data Bendahara' :$nama_ben;
		$jabat_ben = empty($jabat_ben) ? ' ' :$jabat_ben;
        
		if (($jns == '1') or ($jns == '2')  or ($jns == '4') or ($jns == '5')){
		$kd_kegi = '';                    
		$nm_kegi = ''; 
		$kd_prog = ''; 
		$nm_prog = '';	
		}
		else {
		$sql12="SELECT kd_kegiatan FROM trdspp a INNER JOIN trhsp2d b ON a.no_spp = b.no_spp AND a.kd_skpd=b.kd_skpd 
				WHERE b.kd_skpd = '$lckdskpd' AND no_sp2d='$lcnosp2d' group by kd_kegiatan ";
                 $sqlrek12=$this->db->query($sql12);
                 foreach ($sqlrek12->result() as $rowrek)
                {
                    $kd_kegi=$rowrek->kd_kegiatan;                    
                }
		$nm_kegi = " - ".$this->rka_model->get_nama($kd_kegi,'nm_kegiatan','trskpd','kd_kegiatan') ; 
		$kd_prog = $this->left($kd_kegi,18); 
		$nm_prog = " - ".$this->rka_model->get_nama($kd_prog,'nm_program','trskpd','kd_program'); 
		}
		if($jns_cetak=='2'){
			$tinggi='150px';
			//$banyak=9;
			$banyak=10;
		} else 
		if($jns_cetak=='1'){
			$tinggi='80px';
			//$banyak=15;
			$banyak=16;
		}else{
			$tinggi='10px';
			$banyak=$banyak;
		}		
		
		$cRet = '';
        $cRet = "<br><br><br><br><br><br><br>
		<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px;\"  width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">";
        $cRet .="
		<tr>
            <td align=\"center\" width=\"50%\" style=\"border-collapse:collapse;font-weight:bold; font-size:12px\"> PEMERINTAH KABUPATEN SANGGAU
            </td>
            <td align=\"center\" width=\"50%\">
                <table style=\"border-collapse:collapse;font-size:12px; font-weight: bold;\" width=\"100%\" align=\"center\" cellspacing=\"4\" cellpadding=\"0\">
                    <tr>
                        <td align=\"right\">
                            <b>Nomor : $lcnosp2d</b>
                        </td>
                    </tr>
                    <tr>
                        <td align=\"center\">
                            SURAT PERINTAH PENCAIRAN DANA<br>(SP2D)
                        </td>
                    </tr>
                </table>
            </td>
        </tr>   
        <tr>
            <td style=\"border-left:solid 1px black;\" >
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" valign=\"top\" border=\"1\" cellspacing=\"4\" cellpadding=\"0\">
      					<tr>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" width=\"30%\" align=\"left\" valign=\"top\">&nbsp;Nomor SPM</td>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" width=\"2%\" valign=\"top\">:</td>
						<td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" width=\"69%\" valign=\"top\">$lcnospm</td>
                    </tr>
                    <tr>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" valign=\"top\">&nbsp;Tanggal</td>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" valign=\"top\" >:</td>
						<td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" valign=\"top\">".$this->tanggal_format_indonesia($ldtglspm)."</td>
                    </tr>
                    <tr>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" valign=\"top\">&nbsp;SKPD</td>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" valign=\"top\">:</td>
						<td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" valign=\"top\" height=\"60px\">$lckd_skpd $lcnmskpd</td>
                    </tr>
                </table>
            </td>
            <td>
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\"  valign=\"top\" border=\"0\" cellspacing=\"4\" cellpadding=\"0\">
                    <tr>
                        <td valign=\"top\">&nbsp;Dari &nbsp; : Bendahara Umum Daerah (BUD)</td>
                    </tr>
					 <tr>
                        <td valign=\"top\" >&nbsp;Tahun Anggaran : &nbsp;$lntahunang</td>
                    </tr>
					<tr>
                        <td valign=\"top\" >&nbsp;</td>
                    </tr>
					<tr>
                        <td valign=\"top\" >&nbsp;</td>
                    </tr>
					<tr>
                        <td valign=\"top\" >&nbsp;</td>
                    </tr>
					<tr>
                        <td valign=\"top\" >&nbsp;</td>
                    </tr>
                </table>
            </td>
        </tr>
			<tr>
		<td colspan=\"2\">
			<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"4\" cellpadding=\"0\">
			<tr>
				<td style=\"border-bottom: hidden; border-right: hidden;\" width=\"120px\">&nbsp;Bank/Pos</td>
				<td style=\"border-bottom: hidden;\" >:&nbsp;PT. Bank Kalbar Cabang Utama Pontianak</td>
			</tr>
			<tr>
				<td style=\"border-bottom: hidden;\" colspan=\"2\" >&nbsp;Hendaklah mencairkan / memindahbukukan dari baki Rekening Nomor 1001002201</td>
			</tr>
			<tr>
				<td style=\"border-bottom: hidden; border-right: hidden;\" >&nbsp;Uang sebesar Rp</td>
				<td style=\"border-bottom: hidden;\" >:&nbsp;".number_format($n,'2',',','.')."  (".$this->tukd_model->terbilang($n).") </td>
			</tr>
			</table>
        </td>
		</tr>	
        <tr>
            <td colspan=\"2\">";
		if(($jns==6) && ($jns_bbn==3)){

             $cRet .="<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"-1\" cellpadding=\"-1\">
			   <tr>
                    <td valign=\"top\" width=\"120px\">&nbsp;Kepada</td>
					<td valign=\"top\" width=\"10px\" >:</td>
                    <td valign=\"top\" >$pimpinan, $nmrekan, $alamat</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;NPWP</td>
					<td valign=\"top\" >:</td>
                    <td valign=\"top\" >$lcnpwp</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;No.Rekening Bank</td>
					<td valign=\"top\" >:</td>
                    <td valign=\"top\" >$rekbank</td>
                </tr>
                <tr>
                    <td valign=\"top\">&nbsp;Bank/Pos</td>
					<td valign=\"top\">:</td>
                    <td valign=\"top\">$nama_bank</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;Untuk Keperluan</td>
					<td valign=\"top\" >:</td>
                    <td height=\"$tinggi\" valign=\"top\" style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" >$lcperlu
					<br>".$this->right($kd_prog,2)."$nm_prog
					<br>".$this->right($kd_kegi,2)."$nm_kegi
					</td>

				</tr>
                </table> ";
		}
		else if($jns==5){

             $cRet .="<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"-1\" cellpadding=\"-1\">
			   <tr>
                    <td valign=\"top\" width=\"120px\">&nbsp;Kepada</td>
					<td valign=\"top\" width=\"10px\" >:</td>
                    <td valign=\"top\" >$nmrekan, $alamat</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;NPWP</td>
					<td valign=\"top\" >:</td>
                    <td valign=\"top\" >$lcnpwp</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;No.Rekening Bank</td>
					<td valign=\"top\" >:</td>
                    <td valign=\"top\" >$rekbank</td>
                </tr>
                <tr>
                    <td valign=\"top\">&nbsp;Bank/Pos</td>
					<td valign=\"top\">:</td>
                    <td valign=\"top\">$nama_bank</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;Untuk Keperluan</td>
					<td valign=\"top\" >:</td>
                    <td height=\"$tinggi\" valign=\"top\" style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" >$lcperlu
					<br>".$this->right($kd_prog,2)."$nm_prog
					<br>".$this->right($kd_kegi,2)."$nm_kegi
					</td>

				</tr>
                </table> ";
		}else{
			$cRet .="<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"-1\" cellpadding=\"-1\">
			   <tr>
                    <td valign=\"top\" width=\"120px\">&nbsp;Kepada </td>
					<td valign=\"top\" width=\"10px\">:&nbsp;</td>
                    <td valign=\"top\" font-family: Arial; >$nama_ben - $jabat_ben</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;NPWP</td>
					<td valign=\"top\" >:</td>
                    <td valign=\"top\" ></td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;No.Rekening Bank</td>
					<td valign=\"top\" >:</td>
                    <td valign=\"top\" ></td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;Bank/Pos</td>
					<td valign=\"top\" >:</td>
                    <td valign=\"top\" ></td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;Untuk Keperluan</td>
					<td valign=\"top\" >:</td>
                    <td height=\"$tinggi\" valign=\"top\" style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" >$lcperlu
					<br>".$this->right($kd_prog,2)."$nm_prog
					<br>".$this->right($kd_kegi,2)."$nm_kegi
					</td>
				</tr>
                </table> ";
			
		}
         $cRet	.="  </td>
        </tr>
        <tr>
            <td colspan=\"2\">
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:11px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr >
                        <td width=\"5%\" align=\"center\"><b>NO</b></td>
                        <td width=\"28%\" align=\"center\"><b>KODE REKENING</b></td>
                        <td align=\"center\"><b>URAIAN</b></td>
                        <td width=\"15%\" align=\"center\"><b>JUMLAH (Rp)</b></td>
                    </tr>
					<tr>
                        <td align=\"center\">1</td>
                        <td align=\"center\">2</td>
                        <td align=\"center\">3</td>
                        <td align=\"center\">4</td>
                    </tr>";
			$sql_total="SELECT sum(nilai)total FROM trdspp where no_spp='$lcnospp' AND kd_skpd='$lckd_skpd'";
                 $sql_x=$this->db->query($sql_total);
                 foreach ($sql_x->result() as $row_x)
                {
                    $lntotal=$row_x->total;                    
                }
				if(($jns==1) || ($jns==2)){
                                        $sql = "select SUM(nilai) nilai from trdspp where no_spp='$lcnospp' AND kd_skpd='$lckd_skpd'";
                                        $hasil = $this->db->query($sql);
                                        $lcno = 0;
                                        $lntotal = 0;
                                        foreach ($hasil->result() as $row)
                                        {
                                           $lcno = $lcno + 1;
                                           $lntotal = $lntotal + $row->nilai;
										    $cRet .="<tr>
                                                        <td style=\"border-bottom: hidden;\" align=\"center\">&nbsp;1</td>
                                                        <td style=\"border-bottom: hidden;\">&nbsp; $lckd_skpd  </td>
                                                        <td style=\"border-bottom: hidden;\">&nbsp; $lcnmskpd</td>
                                                        <td style=\"border-bottom: hidden;\" align=\"right\">".number_format($row->nilai,"2",",",".")."&nbsp;</td>
                                                    </tr>"; 
                                          
										}  
											if($lcno<=$banyak)
											   {
												 for ($i = $lcno; $i <= $banyak; $i++) 
												  {
													 $cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>";    
												  }                                                   
											   } 
										   }
				else{
				
				
				
				$sql1 = "select COUNT(*) as jumlah from 
							(select kd_kegiatan,left(kd_rek5,2)kd_rek,nm_rek2 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek2 b on left(kd_rek5,2)=kd_rek2 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd' 
							group by left(kd_rek5,2),nm_rek2,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,3)kd_rek,nm_rek3 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek3 b on left(kd_rek5,3)=kd_rek3 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,3),nm_rek3,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,5)kd_rek,nm_rek4 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek4 b on left(kd_rek5,5)=kd_rek4 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,5),nm_rek4,kd_kegiatan
							union all
							select kd_kegiatan,left(a.kd_rek5,7)kd_rek,b.nm_rek5 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek5 b on left(a.kd_rek5,7)=b.kd_rek5 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(a.kd_rek5,7),b.nm_rek5,kd_kegiatan
							) tox";
						$hasil1 = $this->db->query($sql1);
						$row1 = $hasil1->row();
						$jumlahbaris = $row1->jumlah;  
						if($jumlahbaris<=$banyak){
							$sql = "select * from (select kd_kegiatan,left(kd_rek5,2)kd_rek,nm_rek2 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek2 b on left(kd_rek5,2)=kd_rek2 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,2),nm_rek2,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,3)kd_rek,nm_rek3 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek3 b on left(kd_rek5,3)=kd_rek3 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,3),nm_rek3,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,5)kd_rek,nm_rek4 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek4 b on left(kd_rek5,5)=kd_rek4 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,5),nm_rek4,kd_kegiatan
							union all
							select kd_kegiatan,left(a.kd_rek5,7)kd_rek,b.nm_rek5 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek5 b on left(a.kd_rek5,7)=b.kd_rek5 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(a.kd_rek5,7),b.nm_rek5,kd_kegiatan
							) tox order by kd_rek";
						}else{
							$sql = "select * from (select '1' urut, kd_kegiatan,left(kd_rek5,2)kd_rek,nm_rek2 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek2 b on left(kd_rek5,2)=kd_rek2 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,2),nm_rek2,kd_kegiatan
							union all
							select '2' as urut, '' as kd_kegiatan, '' kd_rek, '(Rincian Terlampir)' as nm_rek, 0 as nilai
							) tox order by urut,kd_rek";	
						}
                                        $hasil = $this->db->query($sql);
                                        $lcno = 0;
										$lcno_baris = 0;
                                       // $lntotal = 0;
                                        foreach ($hasil->result() as $row)
                                        {	
											$lcno_baris = $lcno_baris + 1;										
											if (strlen($row->kd_rek)>=7){
											$lcno = $lcno + 1;
											$lcno_x = $lcno;
											}
											else {
												$lcno_x ='';
											}
//                                           $lntotal = $lntotal + $row->nilai;                                           
                                           $cRet .="<tr>
                                                        <td style=\"border-bottom: hidden;\" align=\"center\">&nbsp;$lcno_x</td>
                                                        <td style=\"border-bottom: hidden;\">&nbsp; $row->kd_kegiatan.".$this->tukd_model->dotrek($row->kd_rek)." </td>
                                                        <td style=\"border-bottom: hidden;\">&nbsp; $row->nm_rek</td>
                                                        <td style=\"border-bottom: hidden;\" align=\"right\">".number_format($row->nilai,"2",",",".")."&nbsp;</td>
                                                    </tr>";    
                                            
                                        }
                                        if($lcno_baris<=$banyak)
                                       {
                                         for ($i = $lcno_baris; $i <= $banyak; $i++) 
                                          {
                                            $cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>";    
                                          }                                                   
                                       }
                                       
				}     
             $cRet .="<tr>
                        <td align=\"right\" colspan=\"3\">&nbsp;<b>JUMLAH&nbsp;</b></td>
                        <td align=\"right\"><b>".number_format($lntotal,"2",",",".")."</b>&nbsp;</td>
                    </tr>
                    <tr>
                        <td colspan=\"4\">&nbsp;Potongan-potongan</td>
                    </tr>
                    <tr>
                        <td  align=\"center\"><b>NO</b></td>
                        <td  align=\"center\"><b>Uraian (No.Rekening)</b></td>
                        <td  align=\"center\"><b>Jumlah(Rp)</b></td>
                        <td  align=\"center\"><b>Keterangan</b></td>
                    </tr>";
                    
                    $sql = "select * from trspmpot where no_spm='$lcnospm' AND kd_rek5 IN('4140611','2110501','2110701','2110801','2110901','4140612')";
                            $hasil = $this->db->query($sql);
                            $lcno = 0;
                            $lntotalpot = 0;
                            foreach ($hasil->result() as $row){
                               $lcno = $lcno + 1;
                               $lntotalpot = $lntotalpot + $row->nilai;
                                $cRet .="<tr>
                                            <td align=\"center\">&nbsp;$lcno</td>
                                            <td>&nbsp; $row->nm_rek5</td>
                                            <td align=\"right\">".number_format($row->nilai,"2",",",".")."&nbsp;</td>
                                            <td>&nbsp;</td>
                                        </tr>";    
                            }
							if($lcno<=4)
                                       {
                                         for ($i = $lcno; $i < 4; $i++) 
                                          {
                                            $cRet .= "<tr>
                                                        <td>&nbsp;</td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                     </tr>";    
                                          }                                                   
                                       }
                                        
                    $cRet .="
                    <tr>
                        <td>&nbsp;</td>
                        <td align=\"right\"><b>Jumlah</b>&nbsp;</td>
                        <td align=\"right\"><b>".number_format($lntotalpot,"2",",",".")."</b>&nbsp;</td>
                        <td></td>
                    </tr>
                     <tr>
                        <td colspan=\"4\">&nbsp;Informasi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>(tidak mengurangi jumlah pembayaran SP2D)</i></td>
                    </tr>
            
                    <tr>
                        <td align=\"center\"><b>NO</b></td>
                        <td align=\"center\"><b>Uraian (No.Rekening)</b></td>
                        <td align=\"center\"><b>Jumlah(Rp)</b></td>
                        <td align=\"center\"><b>Keterangan</b></td>
                    </tr>";
                     $sql = "select 1 urut, * from trspmpot where no_spm='$lcnospm' AND kd_rek5 IN('2130301')
							UNION ALL
							select 2 urut, * from trspmpot where no_spm='$lcnospm' AND kd_rek5 NOT IN('4140611','2130301','2110501','2110701','2110801','2110901','4140612')
							ORDER BY urut,kd_rek5";
                            $hasil = $this->db->query($sql);
                            $lcno = 0;
                            $lntotalpott = 0;
                            foreach ($hasil->result() as $row)
                            {
                               $lcno = $lcno + 1;
                               $lntotalpott = $lntotalpott + $row->nilai;
                               $kode_rek=$row->kd_rek5;
							   if($kode_rek=='2130101'){
								   $nama_rek='PPh 21';
							   } else if ($kode_rek=='2130201'){
								   $nama_rek='PPh 22';
							   } else if($kode_rek=='2130301'){
								   $nama_rek='PPN';
							   } else if($kode_rek=='2130401'){
								   $nama_rek='PPh 23';
							   } else if($kode_rek=='2130501'){
								   $nama_rek='PPh Pasal 4';
							   } else{
								    $nama_rek=$row->nm_rek5;
							   }
							   $cRet .="<tr>
                                            <td align=\"center\">&nbsp;$lcno</td>
                                            <td> &nbsp; $nama_rek</td>
                                            <td align=\"right\">".number_format($row->nilai,"2",",",".")."&nbsp;</td>
                                            <td>&nbsp;</td>
                                        </tr>";    
                            }
							if($lcno<=4)
                                       {
                                         for ($i = $lcno; $i < 4; $i++) 
                                          {
                                            $cRet .= "<tr>
                                                        <td>&nbsp;</td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                     </tr>";    
                                          }                                                   
                                       }
							
							
							
							$jum_bayar=strval($lntotal-$lntotalpot);
							$bil_bayar = strval($lntotal-($lntotalpot+$lntotalpott));
                    $cRet .="
                    <tr>
                        <td>&nbsp;</td>
                        <td align=\"right\"><b>Jumlah</b>&nbsp;</td>
                        <td align=\"right\"><b>".number_format($lntotalpott,"2",",",".")."</b>&nbsp;</td>
                        <td></td>
                    </tr>
                     
                </table>  
            </td>
        </tr>
        <tr>
            <td colspan=\"2\">
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"-1\" cellpadding=\"-1\">
                   <tr>
                        <td colspan=\"4\" valign=\"bottom\" style=\"font-weight: bold;\">&nbsp;SP2D yang Dibayarkan</td>
                    </tr>
				   <tr>
				   
                        <td width=\"28%\" align=\"left\">&nbsp;Jumlah yang Diterima</td>
                        <td style=\"border-left: hidden;\" width=\"4%\" align=\"left\">&nbsp;RP</td>
                        <td style=\"border-left: hidden;\" width=\"50%\" align=\"right\">&nbsp;".number_format($lntotal,"2",",",".")."</td>
						<td style=\"border-left: hidden;\" width=\"20%\" align=\"center\">&nbsp;</td>
						</tr>
                    <tr > 
                        <td align=\"left\">&nbsp;Jumlah Potongan</td>
                        <td style=\"border-left: hidden;\" align=\"left\">&nbsp;RP</td>
                        <td style=\"border-left: hidden;\" align=\"right\" >&nbsp; ".number_format($lntotalpot+$lntotalpott,"2",",",".")."</td>
						<td style=\"border-left: hidden;\" >&nbsp;</td>
                    </tr>
                    <tr style=\"font-weight: bold;\">
                        <td align=\"left\">&nbsp;<b>Jumlah yang Dibayarkan</b></td>
                        <td style=\"border-left: hidden;\" align=\"left\"><b>&nbsp;RP</b></td>
                        <td style=\"border-left: hidden;font-size:11px;\" align=\"right\"><b>&nbsp; ".number_format($lntotal-($lntotalpot+$lntotalpott),"2",",",".")."</b></td>
						<td style=\"border-left: hidden;\" >&nbsp;</td>
                    </tr>                    
                </table>  
            </td>
        </tr>
        
        <tr>
            <td colspan=\"2\">
                <table style=\"border-collapse:collapse;font-weight: bold;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"-1\" cellpadding=\"-1\">
			<tr>
                        <td colspan=\"2\" align=\"left\" >&nbsp;Uang Sejumlah :
                        (&nbsp;".$this->tukd_model->terbilang($bil_bayar)."&nbsp;)</td>
						
	
                    </tr>
				<tr>
                        <td width=\"70%\" align=\"left\" style=\"font-size:10px\" valign=\"top\">
                        <br>&nbsp;Lembar 1 : Bank Yang Ditunjukan<br>
                        &nbsp;Lembar 2 : Pengguna Anggaran/Kuasa Pengguna Anggaran<br>
                        &nbsp;Lembar 3 : Arsip Bendahara Umum Daerah (BUD)<br>
                        &nbsp;Lembar 4 : Pihak Ketiga<br>
                               
                        </td>
                        <td width=\"30%\" align=\"center\">
                        <br>
                        Sanggau, $tanggal<br>
                        <br>Kepala Bidang Perbendaharaan
                        <br>
                        <br>
                        <br>
                        <br>
                        <u></u><br>
                        <br>
                        NIP.                 
                        </td>
                   </tr>
                </table>  
            </td>
        </tr>
        
        
        </table>";
        $data['prev']= $cRet;
        //echo "$cRet"  ;  
        $this->_mpdf_sp2d2('',$cRet,10,5,5,'0');
    }
    
	function cetak_lamp_sp2d(){
		//$jns = $this->uri->segment(3);
		$lntahunang = $this->session->userdata('pcThang');
        $lcnosp2d = str_replace('123456789','/',$this->uri->segment(3));
		
       // $lcttd = str_replace('123456789','/',$this->uri->segment(5));
        $lcttd = str_replace('abc',' ',$this->uri->segment(5));
	    $banyak = $this->uri->segment(6);
		$jns_cetak = $this->uri->segment(7);
        $a ='*'.$lcnosp2d.'*';
         $csql = "SELECT a.*,
				(SELECT nmrekan FROM trhspp WHERE no_spp = a.no_spp AND kd_skpd=a.kd_skpd) AS nmrekan,
				(SELECT pimpinan FROM trhspp WHERE no_spp = a.no_spp AND kd_skpd=a.kd_skpd) AS pimpinan,
				(SELECT alamat FROM trhspp WHERE no_spp = a.no_spp AND kd_skpd=a.kd_skpd) AS alamat
                 FROM trhsp2d a WHERE a.no_sp2d = '$lcnosp2d'";
        $hasil = $this->db->query($csql);
        $trh = $hasil->row();
		$lckd_skpd  = $trh->kd_skpd;
        $lcnospm    = $trh->no_spm;
        $ldtglspm   = $trh->tgl_spm;
        $lcnmskpd   = $trh->nm_skpd;
        $lckdskpd   = $trh->kd_skpd;
        $alamat     = $trh->alamat;
        $lcnpwp     = $trh->npwp;
        $rekbank    = $trh->no_rek;
        $lcperlu    = $trh->keperluan;
        $lcnospp    = $trh->no_spp;
        $tgl        = $trh->tgl_sp2d;
        $n          = $trh->nilai;
		$pimpinan	= $trh->pimpinan;
        $nmrekan	=$trh->nmrekan;
		$jns_bbn	=$trh->jenis_beban;
		$jns		=$trh->jns_spp;
        $bank=$trh->bank;
		$banyak_kar = strlen($lcperlu);
        $tanggal    = $this->tanggal_format_indonesia($tgl);
		//$banyak = $banyak_kar > 400 ? 14 :23;

		$sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
					$pangkat=$rowttd->pangkat;
                }
				
		 $cRet ="";
		 $cRet	.="<br><br><br><br><br><br><br>  
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:13px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr >
                        <td width=\"100%\" align=\"center\"><b>Daftar Lampiran SP2D Nomor: $lcnosp2d </b></td>
                    </tr>
					<tr>
                        <td align=\"center\"><b>Tanggal : $tanggal</b></td>
                    </tr>
					<tr>
                        <td align=\"center\">&nbsp;</td>
                    </tr>
				</table>";
         $cRet	.="  
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:11px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr >
                        <td width=\"5%\" align=\"center\"><b>NO</b></td>
                        <td width=\"28%\" align=\"center\"><b>KODE REKENING</b></td>
                        <td align=\"center\"><b>URAIAN</b></td>
                        <td width=\"15%\" align=\"center\"><b>JUMLAH (Rp)</b></td>
                    </tr>
					<tr>
                        <td align=\"center\">1</td>
                        <td align=\"center\">2</td>
                        <td align=\"center\">3</td>
                        <td align=\"center\">4</td>
                    </tr>";
		
			$sql = "select * from (select kd_subkegiatan,left(kd_rek5,2)kd_rek,nm_rek2 as nm_rek,sum(nilai)nilai from trdspp a inner join 
			ms_rek2 b on left(kd_rek5,2)=kd_rek2 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
			group by left(kd_rek5,2),nm_rek2,kd_subkegiatan
			union all
			select kd_subkegiatan,left(kd_rek5,3)kd_rek,nm_rek3 as nm_rek,sum(nilai)nilai from trdspp a inner join 
			ms_rek3 b on left(kd_rek5,3)=kd_rek3 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
			group by left(kd_rek5,3),nm_rek3,kd_subkegiatan
			union all
			select kd_subkegiatan,left(kd_rek5,5)kd_rek,nm_rek4 as nm_rek,sum(nilai)nilai from trdspp a inner join 
			ms_rek4 b on left(kd_rek5,5)=kd_rek4 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
			group by left(kd_rek5,5),nm_rek4,kd_subkegiatan
			union all
			select kd_subkegiatan,left(a.kd_rek5,7)kd_rek,b.nm_rek5 as nm_rek,sum(nilai)nilai from trdspp a inner join 
			ms_rek5 b on left(a.kd_rek5,7)=b.kd_rek5 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
			group by left(a.kd_rek5,7),b.nm_rek5,kd_subkegiatan
			) tox order by kd_rek";
		
			$hasil = $this->db->query($sql);
			$lcno = 0;
			$lcno_baris = 0;
			$lntotal = 0;
			foreach ($hasil->result() as $row)
		   {	
				$lcno_baris = $lcno_baris + 1;										
				if (strlen($row->kd_rek)>=7){
				$lcno = $lcno + 1;
				$lcno_x = $lcno;
				$lntotal = $lntotal+$row->nilai;
				}
				else {
					$lcno_x ='';
				}
//                                           $lntotal = $lntotal + $row->nilai;                                           
			   $cRet .="<tr>
							<td align=\"center\">&nbsp;$lcno_x</td>
							<td >&nbsp; $row->kd_subkegiatan.".$this->tukd_model->dotrek($row->kd_rek)." </td>
							<td >&nbsp; $row->nm_rek</td>
							<td align=\"right\">".number_format($row->nilai,"2",",",".")."&nbsp;</td>
						</tr>";    
			}
             $cRet .="<tr>
                        <td align=\"right\" colspan=\"3\">&nbsp;<b>JUMLAH&nbsp;</b></td>
                        <td align=\"right\"><b>".number_format($lntotal,"2",",",".")."</b>&nbsp;</td>
                    </tr>
        </table>";
		 $cRet .="<table style=\"border-collapse:collapse; font-family:Tahoma; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
					<td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\">&nbsp;</td>
					</tr>
                    <tr>
					<td width=\"50%\" align=\"center\"></td>
                    <td width=\"50%\" align=\"center\">Sanggau, $tanggal</td>
					</tr>
                    <tr>
					<td width=\"50%\" align=\"center\"></td>
                    <td width=\"50%\" align=\"center\">$jabatan<br>Kepala Bidang Perbendaharaan</td>
					</tr>
                    <tr>
					<td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\">&nbsp;</td>
					</tr>                              
                    <tr>
					<td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\">&nbsp;</td>
					</tr>                                       
                    <tr>
					<td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\"><b><u>$nama</u></b></td>
					</tr>
                    <tr>
					<td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\">$pangkat</td>
					</tr>

                    <tr>
					<td width=\"50%\" align=\"center\">&nbsp;</td>
                    <td width=\"50%\" align=\"center\">NIP. $nip</td>
					</tr>
                    
                  </table>";
        $data['prev']= $cRet;
        //echo "$cRet"  ;  
				//$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'0');
				$this->_mpdf_sp2d2('',$cRet,10,5,5,'0');
    }
  
      
	function cetak_sp2d_lama(){
		$prv = $this->db->query("SELECT * from sclient");
		$prvn = $prv->row();          
		$prov = $prvn->kab_kota;       
		$kab = $prvn->provinsi;       
		$daerah = $prvn->daerah;       
		//$jns = $this->uri->segment(3);
		$lntahunang = $this->session->userdata('pcThang');
        $lcnosp2d = str_replace('123456789','/',$this->uri->segment(3));
       // $lcttd = str_replace('123456789','/',$this->uri->segment(5));
        $lcttd = str_replace('abc',' ',$this->uri->segment(5));
//	    $lcttd = $this->uri->segment(5);
        $a ='*'.$lcnosp2d.'*';
        $csql = "SELECT a.*,
				(SELECT nmrekan FROM trhspp WHERE no_spp = a.no_spp) AS nmrekan,
				(SELECT pimpinan FROM trhspp WHERE no_spp = a.no_spp) AS pimpinan
                 FROM trhsp2d a WHERE a.no_sp2d = '$lcnosp2d'";
        $hasil = $this->db->query($csql);
        $trh = $hasil->row();
		
		$lckd_skpd  = $trh->kd_skpd;
        $lcnospm    = $trh->no_spm;
        $ldtglspm   = $trh->tgl_spm;
        $lcnmskpd   = $trh->nm_skpd;
        $lckdskpd   = $trh->kd_skpd;
        //$lckpd      = $trh->nmrekan;
        $lcnpwp     = $trh->npwp;
        $rekbank    = $trh->no_rek;
        $lcperlu    = $trh->keperluan;
        $lcnospp    = $trh->no_spp;
        $tgl        = $trh->tgl_sp2d;
        $n          = $trh->nilai;
		$pimpinan	= $trh->pimpinan;
        $nmrekan	=$trh->nmrekan;
		$jns_bbn	=$trh->jenis_beban;
		$jns		=$trh->jns_spp;
        $bank=$trh->bank;
		$banyak_kar = strlen($lcperlu);
        $tanggal    = $this->tanggal_format_indonesia($tgl);
		$banyak = $banyak_kar > 400 ? 14 :22;                     

        
		$sqlrek="SELECT bank,rekening, npwp FROM ms_skpd WHERE kd_skpd = '$lckdskpd' ";
                 $sqlrek=$this->db->query($sqlrek);
                 foreach ($sqlrek->result() as $rowrek)
                {
                    $bank_ben=$rowrek->bank;                    
                    $rekben=$rowrek->rekening;                    
                    $npwp_ben= $rowrek->npwp;
                }
		$rek_ben = empty($rekben) || $rekben == 0 ? '' :$rekben;
		$npwp_ben = empty($npwp_ben) || $npwp_ben == 0 ? '' :$npwp_ben;
		$nama_bank = empty($bank) || $bank == 0 ? 'Belum Pilih Bank' :$this->rka_model->get_nama($bank,'nama','ms_bank','kode');
		$nama_bank_ben = empty($bank_ben) || $bank_ben == 0 ? 'Belum Pilih Bank' :$this->rka_model->get_nama($bank_ben,'nama','ms_bank','kode');		
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
					$pangkat=$rowttd->pangkat;
                }
				
		$sqlnam="SELECT TOP 1 * FROM ms_ttd WHERE kd_skpd = '$lckdskpd' AND kode='BK' ";
                 $sqlnam=$this->db->query($sqlnam);
                 foreach ($sqlnam->result() as $rownam)
                {
                    $nama_ben=$rownam->nama;                    
                    $jabat_ben=$rownam->jabatan;                    
                }
		$nama_ben = empty($nama_ben) ? 'Belum Ada data Bendahara' :$nama_ben;
		$jabat_ben = empty($jabat_ben) || $jabat_ben == 0 ? ' ' :$jabat_ben;
        $cRet = '';
        $cRet = "<br><br><br><br><br><br><br>
		<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px;\"  width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">";
        $cRet .="
		<tr>
            <td align=\"center\" width=\"50%\" style=\"border-collapse:collapse;font-weight:bold; font-size:12px\">KABUPATEN SANGGAU
            </td>
            <td align=\"center\" width=\"50%\">
                <table style=\"border-collapse:collapse;font-size:12px; font-weight: bold;\" width=\"100%\" align=\"center\" cellspacing=\"4\" cellpadding=\"0\">
                    <tr>
                        <td align=\"right\">
                            <b>Nomor : $lcnosp2d</b>
                        </td>
                    </tr>
                    <tr>
                        <td align=\"center\">
                            SURAT PERINTAH PENCAIRAN DANA<br>(SP2D)
                        </td>
                    </tr>
                </table>
            </td>
        </tr>   
        <tr>
            <td style=\"border-left:solid 1px black;\" >
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" valign=\"top\" border=\"1\" cellspacing=\"4\" cellpadding=\"0\">
      					<tr>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" width=\"30%\" align=\"left\">&nbsp;Nomor SPM</td>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" width=\"2%\">:</td>
						<td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" width=\"69%\">$lcnospm</td>
                    </tr>
                    <tr>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" >&nbsp;Tanggal</td>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" >:</td>
						<td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" >".$this->tanggal_format_indonesia($ldtglspm)."</td>
                    </tr>
                    <tr>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" valign=\"top\">&nbsp;SKPD</td>
                        <td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" valign=\"top\">:</td>
						<td style=\"border-left:hidden;border-top: hidden;border-bottom: hidden; border-right: hidden;\" >$lckd_skpd $lcnmskpd</td>
                    </tr>
                </table>
            </td>
            <td>
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\"  valign=\"top\" border=\"0\" cellspacing=\"4\" cellpadding=\"0\">
                    <tr>
                        <td valign=\"top\">&nbsp;Dari &nbsp; : Bendahara Umum Daerah (BUD)</td>
                    </tr>
					 <tr>
                        <td valign=\"top\" >&nbsp;Tahun Anggaran : &nbsp;$lntahunang</td>
                    </tr>
					<tr>
                        <td valign=\"top\" >&nbsp;</td>
                    </tr>
					<tr>
                        <td valign=\"top\" >&nbsp;</td>
                    </tr>
					<tr>
                        <td valign=\"top\" >&nbsp;</td>
                    </tr>
                </table>
            </td>
        </tr>
			<tr>
		<td colspan=\"2\">
			<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"4\" cellpadding=\"0\">
			<tr>
				<td style=\"border-bottom: hidden; border-right: hidden;\" width=\"30%\">&nbsp;Bank/Pos</td>
				<td style=\"border-bottom: hidden;\" >:&nbsp;PT. Bank Kalbar Cabang Utama Pontiana</td>
			</tr>
			<tr>
				<td style=\"border-bottom: hidden;\" colspan=\"2\" >&nbsp;Hendaklah mencairkan / memindahbukukan dari baki Rekening Nomor 1001002201</td>
			</tr>
			<tr>
				<td style=\"border-bottom: hidden; border-right: hidden;\" >&nbsp;Uang sebesar Rp</td>
				<td style=\"border-bottom: hidden;\" >:&nbsp;".number_format($n,'2',',','.')."  </td>
			</tr>
			<tr>
				<td style=\"border-bottom: hidden; border-right: hidden;\" >&nbsp;</td>
				<td style=\"border-bottom: hidden;\" >:&nbsp;(".$this->tukd_model->terbilang($n).") </td>
			</tr>
			</table>
        </td>
</tr>	
        <tr>
            <td colspan=\"2\">";
		if(($jns==6) && ($jns_bbn==3) ){

             $cRet .="<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"-1\" cellpadding=\"-1\">
			   <tr>
                    <td width=\"30%\">&nbsp;Kepada</td>
					<td width=\"1%\">:</td>
                    <td>&nbsp;$pimpinan $nmrekan</td>
                </tr>
                <tr>
                    <td >&nbsp;NPWP</td>
					<td >:</td>
                    <td>&nbsp;$lcnpwp</td>
                </tr>
                <tr>
                    <td >&nbsp;No.Rekening Bank</td>
					<td >:</td>
                    <td>&nbsp;$rekbank</td>
                </tr>
                <tr>
                    <td >&nbsp;Bank/Pos</td>
					<td >:</td>
                    <td>&nbsp;$nama_bank</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;Untuk Keperluan</td>
					<td >:</td>
                    <td valign=\"top\" style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" >&nbsp;$lcperlu</td>

				</tr>
                </table> ";
		}else{
			$cRet .="<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"-1\" cellpadding=\"-1\">
			   <tr>
                    <td width=\"30%\">&nbsp;Kepada </td>
					<td width=\"2%\">:</td>
                    <td width=\"68%\">$nama_ben $jabat_ben</td>
                </tr>
                <tr>
                    <td >&nbsp;NPWP</td>
					<td >:</td>
                    <td>$npwp_ben</td>
                </tr>
                <tr>
                    <td >&nbsp;No.Rekening Bank</td>
					<td >:</td>
                    <td>$rek_ben</td>
                </tr>
                <tr>
                    <td >&nbsp;Bank/Pos</td>
					<td >:</td>
                    <td>$nama_bank_ben</td>
                </tr>
                <tr>
                    <td valign=\"top\" >&nbsp;Untuk Keperluan</td>
					<td valign=\"top\" >:</td>
                    <td valign=\"top\" style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" >$lcperlu</td>

				</tr>
                </table> ";
			
		}
         $cRet	.="  </td>
        </tr>
        <tr>
            <td colspan=\"2\">
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:11px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr >
                        <td width=\"5%\" align=\"center\"><b>NO</b></td>
                        <td width=\"28%\" align=\"center\"><b>KODE REKENING</b></td>
                        <td align=\"center\"><b>URAIAN</b></td>
                        <td width=\"15%\" align=\"center\"><b>JUMLAH (Rp)</b></td>
                    </tr>
					<tr>
                        <td align=\"center\">1</td>
                        <td align=\"center\">2</td>
                        <td align=\"center\">3</td>
                        <td align=\"center\">4</td>
                    </tr>";
			$sql_total="SELECT sum(nilai)total FROM trdspp where no_spp='$lcnospp' AND kd_skpd='$lckd_skpd'";
                 $sql_x=$this->db->query($sql_total);
                 foreach ($sql_x->result() as $row_x)
                {
                    $lntotal=$row_x->total;                    
                }
				if(($jns==1) || ($jns==2)){
                                        $sql = "select SUM(nilai) nilai from trdspp where no_spp='$lcnospp' AND kd_skpd='$lckd_skpd'";
                                        $hasil = $this->db->query($sql);
                                        $lcno = 0;
                                        $lntotal = 0;
                                        foreach ($hasil->result() as $row)
                                        {
                                           $lcno = $lcno + 1;
                                           $lntotal = $lntotal + $row->nilai;
										   
                                           $cRet .="   
											  <tr>
                                                <td>
                                                  1  
                                                </td>
                                                <td>
                                                    $lckd_skpd 
                                                </td>
                                                <td>
                                                    $lcnmskpd
                                                </td>
                                                <td style=\"font-size:12px\" align=\"right\">
                                                    ".number_format($row->nilai,"2",",",".")."
                                                </td>
                                            </tr>"; 
										}  
											if($lcno<=$banyak)
											   {
												 for ($i = $lcno; $i <= $banyak; $i++) 
												  {
													$cRet .="<tr>
                                                        <td align=\"center\">&nbsp;</td>
                                                        <td></td>
                                                        <td></td>
                                                        <td align=\"right\"></td>
                                                    </tr>";    
												  }                                                   
											   } 
										   }
				else{
				
				
				
				$sql1 = "select COUNT(*) as jumlah from 
							(select kd_kegiatan,left(kd_rek5,2)kd_rek,nm_rek2 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek2 b on left(kd_rek5,2)=kd_rek2 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd' 
							group by left(kd_rek5,2),nm_rek2,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,3)kd_rek,nm_rek3 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek3 b on left(kd_rek5,3)=kd_rek3 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,3),nm_rek3,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,5)kd_rek,nm_rek4 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek4 b on left(kd_rek5,5)=kd_rek4 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,5),nm_rek4,kd_kegiatan
							union all
							select kd_kegiatan,left(a.kd_rek5,7)kd_rek,b.nm_rek5 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek5 b on left(a.kd_rek5,7)=b.kd_rek5 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(a.kd_rek5,7),b.nm_rek5,kd_kegiatan
							) tox";
						$hasil1 = $this->db->query($sql1);
						$row1 = $hasil1->row();
						$jumlahbaris = $row1->jumlah;  
						if($jumlahbaris<=$banyak){
							$sql = "select * from (select kd_kegiatan,left(kd_rek5,2)kd_rek,nm_rek2 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek2 b on left(kd_rek5,2)=kd_rek2 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,2),nm_rek2,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,3)kd_rek,nm_rek3 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek3 b on left(kd_rek5,3)=kd_rek3 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,3),nm_rek3,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,5)kd_rek,nm_rek4 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek4 b on left(kd_rek5,5)=kd_rek4 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,5),nm_rek4,kd_kegiatan
							union all
							select kd_kegiatan,left(a.kd_rek5,7)kd_rek,b.nm_rek5 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek5 b on left(a.kd_rek5,7)=b.kd_rek5 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(a.kd_rek5,7),b.nm_rek5,kd_kegiatan
							) tox order by kd_rek";
						}else{
							$sql = "select * from (select kd_kegiatan,left(kd_rek5,2)kd_rek,nm_rek2 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek2 b on left(kd_rek5,2)=kd_rek2 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,2),nm_rek2,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,3)kd_rek,nm_rek3 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek3 b on left(kd_rek5,3)=kd_rek3 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,3),nm_rek3,kd_kegiatan
							union all
							select kd_kegiatan,left(kd_rek5,5)kd_rek,nm_rek4 as nm_rek,sum(nilai)nilai from trdspp a inner join 
							ms_rek4 b on left(kd_rek5,5)=kd_rek4 where no_spp='$lcnospp' AND a.kd_skpd='$lckd_skpd'
							group by left(kd_rek5,5),nm_rek4,kd_kegiatan
							) tox order by kd_rek";	
						}
                                        $hasil = $this->db->query($sql);
                                        $lcno = 0;
										$lcno_baris = 0;
                                       // $lntotal = 0;
                                        foreach ($hasil->result() as $row)
                                        {	
											$lcno_baris = $lcno_baris + 1;										
											if (strlen($row->kd_rek)>=7){
											$lcno = $lcno + 1;
											$lcno_x = $lcno;
											}
											else {
												$lcno_x ='';
											}
//                                           $lntotal = $lntotal + $row->nilai;                                           
                                           $cRet .="<tr>
                                                        <td style=\"border-bottom: hidden;\" align=\"center\">&nbsp;$lcno_x</td>
                                                        <td style=\"border-bottom: hidden;\">&nbsp; $row->kd_kegiatan.".$this->tukd_model->dotrek($row->kd_rek)." </td>
                                                        <td style=\"border-bottom: hidden;\">&nbsp; $row->nm_rek</td>
                                                        <td style=\"border-bottom: hidden;\" align=\"right\">".number_format($row->nilai,"2",",",".")."&nbsp;</td>
                                                    </tr>";    
                                            
                                        }
                                        if($lcno_baris<=3)
                                       {
                                         for ($i = $lcno_baris; $i <= $banyak; $i++) 
                                          {
                                            $cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>";    
                                          }                                                   
                                       }
                                       for ($i = 0; $i <= 10; $i++){
									    $cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>";
										}			
										 $cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>"; 
										 $cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>"; 
										 $cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>"; 
										$cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>"; 
										$cRet .="<tr>
                                                        <td style=\"border-top: hidden;\" align=\"center\">&nbsp;</td>
                                                        <td style=\"border-top: hidden;\" ></td>
                                                        <td style=\"border-top: hidden;\"></td>
                                                        <td style=\"border-top: hidden;\" align=\"right\"></td>
                                                    </tr>"; 													
				}     
             $cRet .="<tr>
                        <td align=\"right\" colspan=\"3\">&nbsp;<b>JUMLAH&nbsp;</b></td>
                        <td align=\"right\"><b>".number_format($lntotal,"2",",",".")."</b>&nbsp;</td>
                    </tr>
                    <tr>
                        <td colspan=\"4\">&nbsp;Potongan-potongan</td>
                    </tr>
                    <tr>
                        <td  align=\"center\"><b>NO</b></td>
                        <td  align=\"center\"><b>Uraian (No.Rekening)</b></td>
                        <td  align=\"center\"><b>Jumlah(Rp)</b></td>
                        <td  align=\"center\"><b>Keterangan</b></td>
                    </tr>";
                    
                    $sql = "select * from trspmpot where no_spm='$lcnospm' AND kd_rek5 IN('2110501','2110701','2110801','2110901','4140612')";
                            $hasil = $this->db->query($sql);
                            $lcno = 0;
                            $lntotalpot = 0;
                            foreach ($hasil->result() as $row){
                               $lcno = $lcno + 1;
                               $lntotalpot = $lntotalpot + $row->nilai;
							   $kode_rek=$row->kd_rek5;
							   $nama_rek=$row->nm_rek5;
							   /*if($kode_rek=='2110901'){
								   $nama_rek='IWP PPNPN';
							   } else {
								    $nama_rek=$row->nm_rek5;
							   }*/
                                $cRet .="<tr>
                                            <td align=\"center\">&nbsp;$lcno</td>
                                            <td>&nbsp; $nama_rek</td>
                                            <td align=\"right\">".number_format($row->nilai,"2",",",".")."&nbsp;</td>
                                            <td>&nbsp;</td>
                                        </tr>";    
                            }
							if($lcno<=4)
                                       {
                                         for ($i = $lcno; $i < 4; $i++) 
                                          {
                                            $cRet .= "<tr>
                                                        <td>&nbsp;</td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                     </tr>";    
                                          }                                                   
                                       }
                                        
                    $cRet .="
                    <tr>
                        <td>&nbsp;</td>
                        <td align=\"right\"><b>Jumlah</b>&nbsp;</td>
                        <td align=\"right\"><b>".number_format($lntotalpot,"2",",",".")."</b>&nbsp;</td>
                        <td></td>
                    </tr>
                     <tr>
                        <td colspan=\"4\">&nbsp;Informasi&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>(tidak mengurangi jumlah pembayaran SP2D)</i></td>
                    </tr>
            
                    <tr>
                        <td align=\"center\"><b>NO</b></td>
                        <td align=\"center\"><b>Uraian (No.Rekening)</b></td>
                        <td align=\"center\"><b>Jumlah(Rp)</b></td>
                        <td align=\"center\"><b>Keterangan</b></td>
                    </tr>";
                     $sql = "select * from trspmpot where no_spm='$lcnospm' AND kd_rek5 NOT IN('2110501','2110701','2110801','2110901','4140612') order by kd_rek5";
                            $hasil = $this->db->query($sql);
                            $lcno = 0;
                            $lntotalpott = 0;
                            foreach ($hasil->result() as $row)
                            {
                               $lcno = $lcno + 1;
                               $lntotalpott = $lntotalpott + $row->nilai;
                                $kode_rek=$row->kd_rek5;
							   if($kode_rek=='2130101'){
								   $nama_rek='PPh 21';
							   } else if ($kode_rek=='2130201'){
								   $nama_rek='PPh 22';
							   } else if($kode_rek=='2130301'){
								   $nama_rek='PPN';
							   } else if($kode_rek=='2130401'){
								   $nama_rek='PPh 23';
							   } else if($kode_rek=='2130501'){
								   $nama_rek='PPh Pasal 4';
							   } else{
								    $nama_rek=$row->nm_rek5;
							   }
							   $cRet .="<tr>
                                            <td align=\"center\">&nbsp;$lcno</td>
                                            <td> &nbsp; $nama_rek</td>
                                            <td align=\"right\">".number_format($row->nilai,"2",",",".")."&nbsp;</td>
                                            <td>&nbsp;</td>
                                        </tr>";    
                            }
							if($lcno<=4)
                                       {
                                         for ($i = $lcno; $i < 4; $i++) 
                                          {
                                            $cRet .= "<tr>
                                                        <td>&nbsp;</td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                     </tr>";    
                                          }                                                   
                                       }
							
							
							
							$jum_bayar=strval($lntotal-$lntotalpot);
                    
                    $cRet .="
                    <tr>
                        <td>&nbsp;</td>
                        <td align=\"right\"><b>Jumlah</b>&nbsp;</td>
                        <td align=\"right\"><b>".number_format($lntotalpott,"2",",",".")."</b>&nbsp;</td>
                        <td></td>
                    </tr>
                     
                </table>  
            </td>
        </tr>
        <tr>
            <td colspan=\"2\">
                <table style=\"border-collapse:collapse;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"-1\" cellpadding=\"-1\">
                   <tr>
                        <td colspan=\"4\" valign=\"bottom\" style=\"font-weight: bold;\">&nbsp;SP2D yang Dibayarkan</td>
                    </tr>
				   <tr>
				   
                        <td width=\"28%\" align=\"left\">&nbsp;Jumlah yang Diterima</td>
                        <td style=\"border-left: hidden;\" width=\"4%\" align=\"left\">&nbsp;RP</td>
                        <td style=\"border-left: hidden;\" width=\"50%\" align=\"right\">&nbsp;".number_format($lntotal,"2",",",".")."</td>
						<td style=\"border-left: hidden;\" width=\"20%\" align=\"center\">&nbsp;</td>
						</tr>
                    <tr > 
                        <td align=\"left\">&nbsp;Jumlah Potongan</td>
                        <td style=\"border-left: hidden;\" align=\"left\">&nbsp;RP</td>
                        <td style=\"border-left: hidden;\" align=\"right\" >&nbsp; ".number_format($lntotalpot+$lntotalpott,"2",",",".")."</td>
						<td style=\"border-left: hidden;\" >&nbsp;</td>
                    </tr>
                    <tr style=\"font-weight: bold;\">
                        <td align=\"left\">&nbsp;<b>Jumlah yang Dibayarkan</b></td>
                        <td style=\"border-left: hidden;\" align=\"left\"><b>&nbsp;RP</b></td>
                        <td style=\"border-left: hidden;font-size:11px;\" align=\"right\"><b>&nbsp; ".number_format($lntotal-($lntotalpot+$lntotalpott),"2",",",".")."</b></td>
						<td style=\"border-left: hidden;\" >&nbsp;</td>
                    </tr>                    
                </table>  
            </td>
        </tr>
        
        <tr>
            <td colspan=\"2\">
                <table style=\"border-collapse:collapse;font-weight: bold;font-family: Tahoma;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"-1\" cellpadding=\"-1\">
			<tr>
                        <td colspan=\"2\" align=\"left\" >&nbsp;Uang Sejumlah :
                        (&nbsp;".$this->tukd_model->terbilang($jum_bayar)."&nbsp;)</td>
						
	
                    </tr>
				<tr>
                        <td width=\"70%\" align=\"left\" style=\"font-size:10px\" valign=\"top\">
                        <br>&nbsp;Lembar 1 : Bank Yang Ditunjukan<br>
                        &nbsp;Lembar 2 : Pengguna Anggaran/Kuasa Pengguna Anggaran<br>
                        &nbsp;Lembar 3 : Arsip Bendahara Umum Daerah (BUD)<br>
                        &nbsp;Lembar 4 : Pihak Ketiga<br>
                               
                        </td>
                        <td width=\"30%\" align=\"center\">
                        <br>
                        $daerah, $tanggal<br>
                        $jabatan<br>
						Kepala Bidang Perbendaharaan
                        <br>
                        <br>
                        <br>
                        <br>
                        <u>$nama </u><br>
                        $pangkat <br>
                        NIP. $nip                
                        </td>
                   </tr>
                </table>  
            </td>
        </tr>
        
        
        </table>";
        $data['prev']= $cRet;
        //echo "$cRet"  ;  
        $this->_mpdf_sp2d2('',$cRet,10,5,5,'0');
    }
    
      
    function cetak_register_spp(){
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
        $kd = $this->uri->segment(3);
        if ($kd <> ''){
            $a ='SKPD :';
        $sqls="SELECT nm_skpd FROM ms_skpd where kd_skpd='$kd'";
                 $sqls =$this->db->query($sqls);
                 foreach ($sqls->result() as $row)
                {
                    $nama     = $row->nm_skpd;
                    
                   
                }
        }
        $cRet = '';
$cRet = "<table style=\"border-collapse:collapse;font-family: Tahoma;font-size:10px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
$cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b> $kab</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b>REGISTER SPP-UP/SPP-GU/SPP-TU/SPP-LS</b></td>
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b>$a $nama</b><br>&nbsp;</td>
        </tr>
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"3%\" rowspan=\"3\"><b>No.<br>Urut</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"3\"><b>Tanggal</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"36%\" colspan=\"6\"><b>Nomor SPP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"19%\" rowspan=\"3\"><b>Uraian</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"36%\" colspan=\"6\"><b>Jumlah SPP<br>(Rp)</b></td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>UP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>GU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>TU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"18%\" colspan=\"3\"><b>LS</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>UP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>GU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>TU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"18%\" colspan=\"3\"><b>LS</b></td>
          </tr>
          <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>Gaji</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>Barang&<br>Jasa</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>PPKD</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>Gaji</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>Barang&<br>Jasa</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>PPKD</b></td>
          </tr>
          </thead>
          <tr>
            <td style=\"font-size:10px\" align=\"center\" width=\"3%\"><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"6%\"><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"36%\" colspan=\"6\"><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"19%\"><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"36%\" colspan=\"6\"><b>5</b></td>
          </tr>";
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $this->uri->segment(3);
        $where ="";
        if ($kriteria <> ''){                               
            $where="where kd_skpd ='$kriteria' ";            
        }       
              
        $sql = "SELECT tgl_spp,no_spp,nilai,keperluan,jns_spp FROM trhspp $where ";
                $hasil = $this->db->query($sql);
                $lcno = 0;
                foreach ($hasil->result() as $row)
                {
                   $lcno = $lcno + 1;
                    switch ($row->jns_spp) 
                    {
                        case '1': //UP
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '2': //GU
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '3': //TU
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '4': //LS gaji
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '5': //LS PPKD
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                              </tr>  "; 
                            break;
                        case '6': //LS barang dan jasa
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spp)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spp</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                            
                    }
                   
                }
                  
                  
        $cRet .="</table>";
        $data['prev']= $cRet;    
        $this->tukd_model->_mpdf('',$cRet,'2','10',5,'1');   
    }
    
    function cetak_register_spm(){
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
        $kd = $this->uri->segment(3);
        if ($kd <> ''){
            $a ='SKPD :';
        $sqls="SELECT nm_skpd FROM ms_skpd where kd_skpd='$kd'";
                 $sqls =$this->db->query($sqls);
                 foreach ($sqls->result() as $row)
                {
                    $nama     = $row->nm_skpd;
                    
                   
                }
        }
        $cRet = '';
$cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
$cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b> $kab</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b>REGISTER SPM-UP/SPM-GU/SPM-TU/SPM-LS</b></td>
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b>$a $nama</b><br>&nbsp;</td>
        </tr>
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"3%\" rowspan=\"3\"><b>No.<br>Urut</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"3\"><b>Tanggal</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"36%\" colspan=\"6\"><b>Nomor SPP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"19%\" rowspan=\"3\"><b>Uraian</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"36%\" colspan=\"6\"><b>Jumlah SPP<br>(Rp)</b></td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>UP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>GU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>TU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"18%\" colspan=\"3\"><b>LS</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>UP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>GU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\" rowspan=\"2\"><b>TU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"18%\" colspan=\"3\"><b>LS</b></td>
          </tr>
          <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>Gaji</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>Barang&<br>Jasa</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>PPKD</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>Gaji</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>Barang&<br>Jasa</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"6%\"><b>PPKD</b></td>
          </tr>
          </thead>
          <tr>
            <td style=\"font-size:10px\" align=\"center\" width=\"3%\"><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"6%\"><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"36%\" colspan=\"6\"><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"19%\"><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"36%\" colspan=\"6\"><b>5</b></td>
          </tr>";
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $this->uri->segment(3);
        $where ="";
        if ($kriteria <> ''){                               
            $where="where kd_skpd ='$kriteria' ";            
        }       
              
        $sql = "SELECT tgl_spm,no_spm,nilai,keperluan,jns_spp FROM trhspm $where ";
                $hasil = $this->db->query($sql);
                $lcno = 0;
                foreach ($hasil->result() as $row)
                {
                   $lcno = $lcno + 1;
                    switch ($row->jns_spp) 
                    {
                        case '1': //UP
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spm)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spm</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '2': //GU
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spm)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spm</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '3': //TU
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spm)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spm</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '4': //LS gaji
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spm)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spm</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                        case '5': //LS PPKD
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spm)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spm</td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                              </tr>  "; 
                            break;
                        case '6': //LS barang dan jasa
                            $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:10px\">$lcno</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">".$this->tanggal_indonesia($row->tgl_spm)."</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">$row->no_spm</td>
                                <td align=\"center\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"left\" width=\"19%\" style=\"font-size:10px\">$row->keperluan</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\">".number_format($row->nilai)."</td>
                                <td align=\"right\" width=\"6%\" style=\"font-size:10px\"></td>
                              </tr>  "; 
                            break;
                            
                    }
                   
                }
                  
                  
        $cRet .="</table>";
        $data['prev']= $cRet;    
        $this->tukd_model->_mpdf('',$cRet,'2','10',5,'1');   
    }
    
    function cetak_register_sp2d(){
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
        $kd = $this->uri->segment(3);
        if ($kd <> ''){
            $a ='SKPD :';
        $sqls="SELECT nm_skpd FROM ms_skpd where kd_skpd='$kd'";
                 $sqls =$this->db->query($sqls);
                 foreach ($sqls->result() as $row)
                {
                    $nama     = $row->nm_skpd;
                    
                   
                }
        }
        $cRet = '';
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"12\"><b> $kab</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"12\"><b>REGISTER SPP/SPM/SP2D</b></td>
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"12\"><b> $a $nama</b><br>&nbsp;</td>
        </tr>
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"3%\" rowspan=\"2\"><b>No.<br>Urut</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>Jenis Belanja</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"15%\" colspan=\"2\"><b>SPP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"15%\" colspan=\"2\"><b>SPM</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"15%\" colspan=\"2\"><b>SP2D</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"25%\" rowspan=\"2\"><b>Uraian</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>Jumlah <br>(Rp)</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"7%\" rowspan=\"2\"><b>Keterangan</b></td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>TGL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>No.</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>TGL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>No.</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>TGL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>No.</b></td>
           
        </tr>
         
          </thead>
          <tr>
            <td style=\"font-size:10px\" align=\"center\" width=\"3%\"><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"7%\"><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"5%\"><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"10%\"><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"5%\"><b>5</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"10%\"><b>6</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"5%\"><b>7</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"10%\"><b>8</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"25%\"><b>9</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"10%\"><b>10</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"7%\"><b>11</b></td>
          </tr>";
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $this->uri->segment(3);
        $where ="";
        if ($kriteria <> ''){                               
            $where="where a.kd_skpd ='$kriteria' ";            
        }       
              
        $sql = "SELECT a.no_spm,a.tgl_spm,a.no_spp,a.tgl_spp,a.jns_spp,b.tgl_sp2d,b.no_sp2d,b.keperluan,
                b.nilai FROM TRHSPM a LEFT JOIN TRHSP2D b ON a.no_spm=b.no_spm $where ";
                $hasil = $this->db->query($sql);
                $lcno = 0;
                foreach ($hasil->result() as $row)
                {
                    $beban= $row->jns_spp;
                    $tgl_spp=$row->tgl_spp;
                    $spp= $row->no_spp;
                    $spm= $row->no_spm;
                    $tgl_spm=$row->tgl_spm;
                    $sp2d= $row->no_sp2d;
                    $tgl_sp2d=$row->tgl_sp2d;
                    $kkeperluan= $row->keperluan;
                    $n= $row->nilai;
                    $lcno = $lcno + 1;
                    switch ($beban) 
                    {
                        case '1': //UP
                            $jns='UP';
                            break;
                        case '2': //GU
                            $jns='GU';
                            break;
                        case '3': //TU
                            $jns='TU';
                            break;
                        case '4': //LS gaji
                           $jns='LS gaji';
                            break;
                        case '5': //LS PPKD
                            $jns='LS PPKD';
                            break;
                        case '6': //LS barang dan jasa
                            $jns='LS barang & jasa';
                            break;
                            
                    }
                    
                    $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:12px\">$lcno</td>
                                <td align=\"center\" width=\"7%\" style=\"font-size:12px\">$jns</td>
                                <td align=\"center\" width=\"5%\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_spp)."</td>
                                <td align=\"left\" width=\"10%\" style=\"font-size:12px\">$spp</td>
                                <td align=\"center\" width=\"5%\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_spm)."</td>
                                <td align=\"left\" width=\"10%\" style=\"font-size:12px\">$spm</td>
                                <td align=\"center\" width=\"5%\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_sp2d)."</td>
                                <td align=\"left\" width=\"10%\" style=\"font-size:12px\">$sp2d</td>

                                <td align=\"left\" width=\"25%\" style=\"font-size:12px\">$kkeperluan</td>
                                <td align=\"right\" width=\"10%\" style=\"font-size:12px\">".number_format($n)."</td>
                                <td align=\"right\" width=\"7%\" style=\"font-size:12 px\"></td>
                              </tr>  "; 
                   
                }
                  
                  
        $cRet .="</table>";
        $data['prev']= $cRet;    
        $this->tukd_model->_mpdf('',$cRet,'2','10',5,'1');
        //echo("$cRet");   
    }
    
  	
  // awal fungsi fungsi sts
   function panjar()
    {
        $data['page_title']= 'PANJAR';
        $this->template->set('title', 'INPUT PANJAR');   
        $this->template->load('template','tukd/transaksi/panjar',$data) ; 
    }
    
   function sts()
    {
        $data['page_title']= 'INPUT S T S';
        $this->template->set('title', 'INPUT S T S');   
        $this->template->load('template','tukd/pendapatan/sts',$data) ; 
    }
    
    function sts_ppkd()
    {
        $data['page_title']= 'INPUT S T S';
        $this->template->set('title', 'INPUT S T S');   
        $this->template->load('template','tukd/pendapatan/sts_ppkd',$data) ; 
    }
    
	function sts_ppkd2(){
        $data['page_title']= 'INPUT STS NON RETRIBUSI';
        $this->template->set('title', 'INPUT STS NON RETRIBUSI');   
        $this->template->load('template','tukd/pendapatan/sts_ppkd2',$data) ; 
    }
	
    function penetapan()
    {
        $data['page_title']= 'INPUT PENETAPAN';
        $this->template->set('title', 'INPUT PENETAPAN');   
        $this->template->load('template','tukd/pendapatan/penetapan',$data) ; 
    }
    
    function penetapan_ppkd()
    {
        $data['page_title']= 'INPUT PENETAPAN';
        $this->template->set('title', 'INPUT PENETAPAN');   
        $this->template->load('template','tukd/pendapatan/penetapan_ppkd',$data) ; 
    }
    
    function penerimaan()
    {
        $data['page_title']= 'INPUT PENERIMAAN';
        $this->template->set('title', 'INPUT PENERIMAAN');   
        $this->template->load('template','tukd/pendapatan/penerimaan',$data) ; 
    }
    
    function penerimaan_ppkd()
    {
        $data['page_title']= 'INPUT PENERIMAAN';
        $this->template->set('title', 'INPUT PENERIMAAN');   
        $this->template->load('template','tukd/pendapatan/penerimaan_ppkd',$data) ; 
    }
	
	function penerimaan_ppkd_lalu()
    {
        $data['page_title']= 'INPUT PENERIMAAN ATAS PIUTANG TAHUN LALU';
        $this->template->set('title', 'INPUT PENERIMAAN ATAS PIUTANG TAHUN LALU');   
        $this->template->load('template','tukd/pendapatan/penerimaan_ppkd_lalu',$data) ; 
    }
    
    function Penagihan()
    {
        $data['page_title']= 'INPUT PENAGIHAN';
        $this->template->set('title', 'INPUT PENAGIHAN');   
        $this->template->load('template','tukd/transaksi/penagihan',$data) ; 
    }
    
    function pemakaian()
    {
        $data['page_title']= 'PEMAKAIAN ASET';
        $this->template->set('title', 'INPUT PEMAKAIAN ASET');   
        $this->template->load('template','tukd/transaksi/pemakaian_aset',$data) ; 
    }
    
    function penyusutan()
    {
        $data['page_title']= 'PENYUSUTAN ASET';
        $this->template->set('title', 'INPUT PENYUSUTAN ASET');   
        $this->template->load('template','tukd/transaksi/penyusutan_aset',$data) ; 
    }
    
    function reklas_utang()
    {
        $data['page_title']= 'INPUT PENETAPAN';
        $this->template->set('title', 'INPUT PENETAPAN');   
        $this->template->load('template','tukd/transaksi/reklas_utang',$data) ; 
    }
  

	function load_sts_non_restibusi() {
    
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        if ($kriteria == ''){                               
             $where=" WHERE a.no_cek='1' "; 
             	 
        } else{
			$where="WHERE a.no_cek='1' AND (upper(a.no_kas) like upper('%$kriteria%') or a.tgl_kas like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%'))";
			
		}
        
       $sql = "SELECT count(*) as tot from trhkasin_ppkd " ;
			 $query1 = $this->db->query($sql);
			 $total = $query1->row();
        
        $sql = " SELECT TOP $rows a.*,(SELECT nm_skpd FROM ms_skpd WHERE kd_skpd = a.kd_skpd) AS nm_skpd,
				(SELECT ISNULL(nm_pengirim,'') FROM ms_pengirim WHERE kd_pengirim = a.sumber) AS nm_pengirim
				from trhkasin_ppkd a $where AND no_kas NOT in (SELECT TOP $offset no_kas 
				FROM trhkasin_ppkd a $where order by tgl_kas,no_kas) order by a.tgl_kas,no_kas";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,
                        'no_kas' => $resulte['no_kas'],
                        'tgl_kas' => $resulte['tgl_kas'],        
                        'no_sts' => $resulte['no_sts'],
                        'tgl_sts' => $resulte['tgl_sts'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'total' =>  number_format($resulte['total']),
                        'kd_bank' => $resulte['kd_bank'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'jns_trans' => $resulte['jns_trans'],
                        'rek_bank' => $resulte['rek_bank'],
                        'no_kas' => $resulte['no_kas'],
                        'tgl_kas' => $resulte['tgl_kas'],
                        'no_cek' => $resulte['no_cek'],
                        'status' => $resulte['status'],
                        'nm_skpd' => $resulte['nm_skpd'],                                                                                           
                        'sumber' => $resulte['sumber'],                                                                                           
                        'nm_pengirim' => $resulte['nm_pengirim']                                                                                           
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
    	   
	} 
    
	    function load_dnonretribusi() {    
       // $kriteria = '0012.a/1.20.05';
        $kriteria = $this->input->post('no');
        //$kriteria = $this->uri->segment(3);
        $sql = "SELECT LEFT(a.kd_rek5,5) AS kd_rek5, b.nm_rek4 as nm_rek5,
				SUM(a.rupiah) rupiah FROM trdkasin_ppkd a 
				LEFT JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4
				where a.no_kas = '$kriteria'
				GROUP BY no_kas,LEFT(a.kd_rek5,5), b.nm_rek4
				order by a.no_kas";
        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek' => $resulte['nm_rek5'],
                        'rupiah' =>  number_format($resulte['rupiah'])
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
	function ambil_rek_non_retribusi() {
        $lckdskpd = $this->uri->segment(3); 
		$tgl_sts = $this->uri->segment(4);
		$sql = "SELECT a.kd_rek5,a.nm_rek5,rupiah,isnull(realisasi,0) as realisasi, rupiah-isnull(realisasi,0) as sisa
				FROM (SELECT LEFT(b.kd_rek5,5) as kd_rek5,c.nm_rek4 as nm_rek5,SUM(b.rupiah) as rupiah 
				from trhkasin_pkd a 
				INNER JOIN trdkasin_pkd b ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd 
				LEFT JOIN ms_rek4 c ON LEFT(b.kd_rek5,5)=c.kd_rek4 WHERE LEFT(b.kd_rek5,3) IN ('411','431') 
				AND a.kd_skpd='$lckdskpd' 
				AND a.tgl_sts<='$tgl_sts' 
				GROUP BY LEFT(b.kd_rek5,5), nm_rek4 ) a
				LEFT JOIN(
				SELECT LEFT(b.kd_rek5,5) as kd_rek5,ISNULL(SUM(b.rupiah),0) as realisasi 
				from trhkasin_ppkd a 
				INNER JOIN trdkasin_ppkd b ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd 
				WHERE LEFT(b.kd_rek5,3) IN ('411','431') 
				AND a.kd_skpd='$lckdskpd' 
				AND a.tgl_kas<='$tgl_sts' 
				GROUP BY LEFT(b.kd_rek5,5)) b
				ON a.kd_rek5=b.kd_rek5 
				ORDER BY kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,           
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek5' => $resulte['nm_rek5'],                                                                                          
                        'rupiah' => $resulte['rupiah'],                                                                                          
                        'realisasi' => $resulte['realisasi'] ,                                                                                         
                        'sisa' => $resulte['sisa']                                                                                          
                        );
                        $ii++;
        }
        echo json_encode($result);
	}
	
	function simpan_kas_non_retribusi(){
        
        $tabel  = $this->input->post('tabel');
        $nokas  = $this->input->post('nokas');
        $jns    = $this->input->post('jns');
        $ket    = $this->input->post('ket');
        $ttd    = $this->input->post('ttd');
        $nilai  = $this->input->post('nilai');
        $pengirim  = $this->input->post('pengirim');
        $kegi  = $this->input->post('kegi');
        $skpd  = $this->input->post('skpd');
        $usernm = $this->session->userdata('pcNama');
		
		
             $sql = "insert into trhkasin_ppkd(no_sts,kd_skpd,tgl_sts,keterangan,total,kd_kegiatan,jns_trans,no_kas,tgl_kas,sumber,no_cek) 
                        values('$nokas','$skpd','$ttd','$ket','$nilai','$kegi','4','$nokas','$ttd','$pengirim','1')";
            $asg = $this->db->query($sql);
            
			 $sql = "insert into trdkasin_ppkd(kd_skpd,no_sts,kd_rek5,rupiah,no_kas,kd_kegiatan) values ('$skpd','$nokas','$jns','$nilai','$nokas','$kegi')";
            $asg = $this->db->query($sql);
			
			if($asg){
                echo '2';
            }else{
                echo '0';
            }
  
    }
	
	function update_kas_non_retribusi(){
        
		$nokas  = $this->input->post('nokas');
        $jns    = $this->input->post('jns');
        $ket    = $this->input->post('ket');
        $ttd    = $this->input->post('ttd');
        $nilai  = $this->input->post('nilai');
		$pengirim  = $this->input->post('pengirim');
        $kegi  = $this->input->post('kegi');
        $skpd  = $this->input->post('skpd');
        $usernm = $this->session->userdata('pcNama');		
		
             $sql = "update trhkasin_ppkd set tgl_sts='$ttd',keterangan='$ket',total='$nilai',tgl_kas='$ttd',kd_kegiatan='$kegi',sumber='$pengirim',kd_skpd='$skpd' WHERE no_kas='$nokas'";
            $asg = $this->db->query($sql);
            
			 $sql = "update trdkasin_ppkd set kd_rek5='$jns',rupiah='$nilai',kd_kegiatan='$kegi' WHERE no_kas='$nokas'";
            $asg = $this->db->query($sql);
			
			if($asg){
                echo '1';
            }else{
                echo '0';
            }
        }
		
	function hapus_penerimaan_non_retribusi() {    	
		$no_kas = $this->input->post('no_kas');
		$tgl = $this->input->post('tgl_kas');
		//$nilai = $this->input->post('nilai');
        $query = "delete from trhkasin_ppkd where no_kas='$no_kas'";
		$asg = $this->db->query($query);
		$query = "delete from trdkasin_ppkd where no_kas='$no_kas'";
		$asg = $this->db->query($query);
            if($asg){
                echo '1';
            }else{
                echo '0';
            }
    }


  
function load_sts_ppkd() {
    
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        if ($kriteria == ''){                               
             $where=" WHERE "; 
             $where1=" WHERE "; 
			 $sql = "SELECT count(*) as tot from trhkasin_ppkd " ;
			 $query1 = $this->db->query($sql);
			 $total = $query1->row();			 
        } else{
			$where="WHERE (upper(a.no_kas) like upper('%$kriteria%') or a.tgl_kas like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%')) AND ";
			$where1="WHERE (upper(a.no_kas) like upper('%$kriteria%') or a.tgl_kas like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%')) AND ";
			$sql = "SELECT count(*) as tot from trhkasin_ppkd a WHERE (upper(a.no_kas) like upper('%$kriteria%') or a.tgl_kas like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%')) " ;
			 $query1 = $this->db->query($sql);
			 $total = $query1->row();
		}
        
       
        
        $sql = " SELECT TOP $rows a.*,(SELECT nm_skpd FROM ms_skpd WHERE kd_skpd = a.kd_skpd) AS nm_skpd from trhkasin_ppkd a $where a.kd_skpd <> '1.20.00.00' and no_kas NOT in (SELECT TOP $offset no_kas FROM trhkasin_ppkd a $where1 a.kd_skpd <> '1.20.00.00' order by tgl_kas,no_kas) order by a.tgl_kas,no_kas";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,
                        'no_kas' => $resulte['no_kas'],
                        'tgl_kas' => $resulte['tgl_kas'],        
                        'no_sts' => $resulte['no_sts'],
                        'tgl_sts' => $resulte['tgl_sts'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'total' =>  number_format($resulte['total']),
                        'kd_bank' => $resulte['kd_bank'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'jns_trans' => $resulte['jns_trans'],
                        'rek_bank' => $resulte['rek_bank'],
                        'no_kas' => $resulte['no_kas'],
                        'tgl_kas' => $resulte['tgl_kas'],
                        'no_cek' => $resulte['no_cek'],
                        'status' => $resulte['status'],
                        'nm_skpd' => $resulte['nm_skpd']                                                                                           
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
    	   
	} 
	
	
function load_sts_ppkd_kasin() {
    
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        if ($kriteria == ''){                               
             $where=" WHERE "; 
             $where1=" WHERE "; 
			 $sql = "SELECT count(*) as tot from trhkasin_ppkd where kd_skpd = '1.20.00.00' and no_terima <> ''" ;
			 $query1 = $this->db->query($sql);
			 $total = $query1->row();			 
        } else{
			$where="WHERE (upper(a.no_kas) like upper('%$kriteria%') or a.tgl_kas like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%')) AND ";
			$where1="WHERE (upper(a.no_kas) like upper('%$kriteria%') or a.tgl_kas like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%')) AND ";
			$sql = "SELECT count(*) as tot from trhkasin_ppkd a WHERE (upper(a.no_kas) like upper('%$kriteria%') or a.tgl_kas like '%$kriteria%' or a.kd_skpd like'%$kriteria%' or
            upper(a.keterangan) like upper('%$kriteria%')) " ;
			 $query1 = $this->db->query($sql);
			 $total = $query1->row();
		}
        
       
        
        $sql = " SELECT TOP $rows a.*,(SELECT nm_skpd FROM ms_skpd WHERE kd_skpd = a.kd_skpd) AS nm_skpd from trhkasin_ppkd a $where a.kd_skpd = '1.20.00.00' and a.no_terima <> '' and no_kas NOT in (SELECT TOP $offset no_kas FROM trhkasin_ppkd a $where1 a.kd_skpd = '1.20.00.00' and a.no_terima <> '' order by tgl_kas,no_kas) order by a.tgl_kas,no_kas";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,
                        'no_kas' => $resulte['no_kas'],
                        'tgl_kas' => $resulte['tgl_kas'],        
                        'no_sts' => $resulte['no_sts'],
                        'tgl_sts' => $resulte['tgl_sts'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'total' =>  number_format($resulte['total']),
                        'kd_bank' => $resulte['kd_bank'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'jns_trans' => $resulte['jns_trans'],
                        'rek_bank' => $resulte['rek_bank'],
                        'no_kas' => $resulte['no_kas'],
                        'tgl_kas' => $resulte['tgl_kas'],
                        'no_cek' => $resulte['no_cek'],
                        'status' => $resulte['status'],
                        'nm_skpd' => $resulte['nm_skpd']                                                                                           
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
    	   
	}     
	
    
      function load_dsts_ppkd() {    
       // $kriteria = '0012.a/1.20.05';
        $kriteria = $this->input->post('no');
        //$kriteria = $this->uri->segment(3);
        $sql = "SELECT a.*, (select nm_rek5 from ms_rek5 where kd_rek5 = a.kd_rek5) as nm_rek 
        from trdkasin_ppkd a where a.no_kas = '$kriteria' order by a.no_kas";
        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sts' => $resulte['no_kas'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek' => $resulte['nm_rek'],
                        'rupiah' =>  number_format($resulte['rupiah'])
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
     function load_dsts() {    
        $kriteria = $this->input->post('no');
		$skpd = $this->input->post('kd_skpd');
        $sql = "SELECT a.*, (select nm_rek5 from ms_rek5 where kd_rek5 = a.kd_rek5) as nm_rek 
        from trdkasin_pkd a where a.no_sts = '$kriteria' and a.kd_skpd='$skpd' order by a.no_sts";
        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sts' => $resulte['no_sts'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'kd_rek5' => $resulte['kd_rek5'],
                        'nm_rek' => $resulte['nm_rek'],
                        'rupiah' => $resulte['rupiah']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function ambil_rek() {
        $lccr = $this->input->post('q');
        $lckdskpd = $this->uri->segment(3);
        $lcgiat = $this->uri->segment(4);
        $lcfilt = $this->uri->segment(5);
        $lc = '';
        if ($lcfilt!=''){
            $lcfilt = str_replace('A',"'",$lcfilt);
            $lcfilt = str_replace('B',",",$lcfilt);
            $lc = " and a.kd_rek5 not in ($lcfilt)";
        }
      // $sql = "SELECT a.kd_rek5,(SELECT nm_rek5 FROM ms_rek5 WHERE kd_rek5=a.kd_rek5) AS nm_rek FROM trdrka a";
        
        $sql = "SELECT a.kd_rek5,(SELECT nm_rek5 FROM ms_rek5 WHERE kd_rek5=a.kd_rek5) AS nm_rek FROM 
        trdrka a where a.kd_skpd = '$lckdskpd' and a.kd_kegiatan = '$lcgiat' and 
        upper(a.kd_rek5) like upper('%$lccr%') $lc";
        
        
        //echo $sql;
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek' => $resulte['nm_rek']                  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function ambil_simpanan_ar()
    {
        $data['page_title']= 'INPUT AMBIL SIMPANAN';
        $this->template->set('title', 'INPUT AMBIL SIMPANAN');   
        $this->template->load('template','tukd/transaksi/ambil_simpanan_ar',$data) ; 
    }
    
        function ambil_rek_utang() {
        $lccr = $this->input->post('q');
       
        
        $sql = "SELECT * from ms_rek5 where left(kd_rek5,1)='2'";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']                  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    
     function ambil_rek_tetap() {
        $lccr = $this->input->post('q');
        $lckdskpd = "1.20.00.00";//$this->uri->segment(3);
               
        $sql = "SELECT a.kd_subkegiatan,a.kd_rek5 as kd_rek5,b.nm_rek5 AS nm_rek,b.map_lo as kd_rek FROM 
        trdrka a left join ms_rek5 b on a.kd_rek5=b.kd_rek5 where a.kd_skpd = '$lckdskpd' and left(a.kd_rek5,1)='4' and 
        upper(a.kd_rek5) like upper('%$lccr%') order by a.kd_rek5";
        
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'kd_subkegiatan' => $resulte['kd_subkegiatan'],        
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_rek' => $resulte['kd_rek'],  
                        'nm_rek' => $resulte['nm_rek']                  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
	
	 function ambil_rek_terima() {
        $lccr = $this->input->post('q');
        $lckdskpd = $this->uri->segment(3);
               
        $sql = "SELECT a.kd_kegiatan,a.kd_rek5 as kd_rek5,b.nm_rek5 AS nm_rek,b.map_lo as kd_rek FROM 
        trdrka a left join ms_rek5 b on a.kd_rek5=b.kd_rek5 where a.kd_skpd = '$lckdskpd' and (left(a.kd_rek5,1)='4' or left(a.kd_rek5,2)='61')and 
        upper(a.kd_rek5) like upper('%$lccr%') order by kd_rek5";
        
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,
                        'kd_kegiatan' => $resulte['kd_kegiatan'],        
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_rek' => $resulte['kd_rek'],  
                        'nm_rek' => $resulte['nm_rek']                  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
     function ambil_rek_tagih($a) {
        $lccr = $this->input->post('q');
        //$lckdskpd = $this->uri->segment(3);
               
        $sql = "SELECT kd_rek5,nm_rek5,map_lo FROM ms_rek5 WHERE  LEFT(kd_rek5,1) IN ($a) and 
        (upper(kd_rek5) like upper('%$lccr%') or upper(nm_rek5) like upper('%$lccr%'))";
        
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
                        'kd_rek_lo' => $resulte['map_lo']                  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function ambil_rek_t_sts() {
        $lccr = $this->input->post('q');
        $lckdskpd = $this->uri->segment(3);
               
        $sql = "SELECT DISTINCT a.kd_rek5, (SELECT nm_rek5 FROM ms_rek5 WHERE kd_rek5 = a.kd_rek5) AS nm_rek FROM tr_terima a
                WHERE kd_skpd = '$lckdskpd' and upper(a.kd_rek5) like upper('%$lccr%')";
        
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek' => $resulte['nm_rek']                  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function get_sts(){
    $page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	$rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	$offset = ($page-1)*$rows;
	$result = array();


	$rs = mysql_query("select count(*) from trhkasin_pkd");
	$row = mysql_fetch_row($rs);
	$result["total"] = $row[0];
	$rs = mysql_query("select * from trhkasin_pkd limit $offset,$rows");
	
	$items = array();
	while($row = mysql_fetch_object($rs)){
		array_push($items, $row);
	}
	$result["rows"] = $items;

	echo json_encode($result);
    }  
  
  
function tambah_sts()
	{
		$config = array(
               array(
                     'field'   => 'no_sts',
                     'label'   => 'NO STS',
                     'rules'   => 'trim|required'
                    ),
                
               array(
                     'field'   => 'kd_skpd',
                     'label'   => 'KODE SKPD',
                     'rules'   => 'trim|required'
                  ),
               array(
                     'field'   => 'keterangan',
                     'label'   => 'KETERANGAN',
                     'rules'   => 'trim|required'
                  ),
               array(
                     'field'   => 'jns_trans',
                     'label'   => 'JNS. TRANSAKSI',
                     'rules'   => 'trim|required'
               )
                  
            );
			
		$this->form_validation->set_message('required', '%s harus diisi !');
		$this->form_validation->set_rules($config);
		$this->form_validation->set_error_delimiters('<div class="single_error">', '</div>');

		if ($this->form_validation->run() == FALSE)
		{
			$data['page_title'] = "Master Data Kegiatan &raquo; Tambah";
            //$lc = "select kd_program,nm_program from m_prog order by kd_program";
//            $query = $this->db->query($lc);
//            $data["program"]=$query->result();
            //$data["jumrow"]=$this->db->get('m_prog')->num_rows();
             $query = "select kode,nama from ms_bank";
             $data_pilih = $this->master_model->viewdata($query);
                             
             foreach($data_pilih->result()as $dt_bk){
               $data['option'][$dt_bk->kode]=$dt_bk->nama;
             }    
		}
		else
		{		
						$no_sts = $this->input->post('no_spp');
						$kd_skpd = $this->input->post('skpd');
                        $tgl_sts = $this->input->post('dd');
                        $jns_trans = $this->input->post('jns_trans');
                        $keterangan = $this->input->post('keterangan');
						
						
			//$this->tukd_model->save('trhspp',$data);
            $query = $this->db->query(" insert into trhspp(no_spp,kd_skpd,tgl_spp,jns_kegiatan,bulan,keperluan) values('$no_spp','$kd_skpd','$tgl_spp','$jns_kegiatan','$bulan','$keperluan') ");
            echo"$query";						
			$this->session->set_flashdata('notify', 'Data Berita berhasil disimpan !');
			
			redirect('tukd/spp');

		}
		
		$this->template->set('title', 'Master Data Kegiatan &raquo; Tambah Data');
		$this->template->load('template', 'tukd/sts/tambah_sts_v2', $data);
	}
    
     function load_trskpd1($cskpd='') {
            $lccr='';        
            $lccr = $this->uri->segment(3);
            if(strlen($lccr)==1){
                $lcpj = 1;
            }else{
                $lcpj = 2;
            }
            
            $lcskpd = $this->uri->segment(4);
            $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                    WHERE left(a.jns_kegiatan,$lcpj)='$lccr' and a.kd_skpd = '$lcskpd'" ;    
            //echo $sql;    
            $query1 = $this->db->query($sql);  
            $result = array();
            $ii = 0;
            foreach($query1->result_array() as $resulte)
            { 
               
                $result[] = array(
                            'id' => $ii,        
                            'kd_kegiatan' => $resulte['kd_kegiatan'],  
                            'nm_kegiatan' => $resulte['nm_kegiatan']
                            );
                            $ii++;
            }
               
            echo json_encode($result);
        	   
    	}
        
    function load_jns_rek(){
        $lccr ='[{  
        "id":"4",  
        "text":"Pendapatan"  
    },{  
        "id":"5",  
        "text":"Belanja"  
    },{  
        "id":"61",  
        "text":"Penerimaan Pembiayaan"  
    },{  
        "id":"62",  
        "text":"Pengeluaran Pembiayaan"  
    },{  
        "id":"1",  
        "text":"Rekening Kas"  
    }]';  
    echo $lccr;
    }    
    
    
    function load_jns_tetap(){
        $lccr ='[{  
        "id":"1",  
        "text":"Ya"  
    },{  
        "id":"0",  
        "text":"Tidak"  
    }]';  
    echo $lccr;
    }    
    
    
     function simpan_sts(){
        
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $bank   = $this->input->post('bank');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $jnsrek = $this->input->post('jnsrek');
        $giat   = $this->input->post('giat');
        $rekbank= $this->input->post('rekbank');
        $total  = $this->input->post('total');
        $lckdrek = $this->input->post('kdrek');
        $lnil_rek = $this->input->post('nilai');
        $lcnilaidet = $this->input->post('value_det');
        $sumber   =$this->input->post('sts');  
                      
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
       
        $usernm= $this->session->userdata('pcNama');
		$last_update=  date('Y-m-d H:i:s');
        // Simpan Header //
        $msg = array();
        if ($tabel == 'trhkasin_pkd') {
            $sql = "delete from trhkasin_pkd where kd_skpd='$skpd' and no_sts='$nomor'";
            $asg = $this->db->query($sql);
            if ($asg){
                $sql = "insert into trhkasin_pkd(no_sts,kd_skpd,tgl_sts,keterangan,total,kd_bank,kd_kegiatan,
                        jns_trans,rek_bank,sumber) 
                        values('$nomor','$skpd','$tgl','$ket','$total','$bank','$giat','$jnsrek','$rekbank','$sumber')";
                $asg = $this->db->query($sql);
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }
                if ($asg){
                    $sql = "delete from trdkasin_pkd where no_sts='$nomor'";
                    $asg = $this->db->query($sql);    
                    if(!($asg)){
                        $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }else{
                        $sql = "insert into trdkasin_pkd(kd_skpd,no_sts,kd_rek5,rupiah) values $lcnilaidet";
                        $asg = $this->db->query($sql); 
                    }                
                }            
            } 
            echo '1';
        }
        
         if ($sumber=='1'){
            $sql1 = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
            $asg1 = $this->db->query($sql1);
            $sql1 = "insert into trhju_pkd(no_voucher,tgl_voucher,kd_skpd,nm_skpd,ket,tgl_update,username,total_d,total_k,tabel) 
            values('$nomor','$tgl','$skpd','$nmskpd','$ket','$last_update','$usernm',$total,$total,'5')";
            $asg1 = $this->db->query($sql1);
            
            $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
            $asg2 = $this->db->query($sql2);
            
            $sql2 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','1610101','RK PPKD',$total,0,'D','','1','1')";
            $asg2 = $this->db->query($sql2);
            $sql3 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','1110201','Kas di Bendahara Penerimaan',0,$total,'K','','2','1')";
            $asg3 = $this->db->query($sql3);
            
        } 

    }
    
    function simpan_sts_ppkd(){
        
        $tabel  = $this->input->post('tabel');
        $nokas  = $this->input->post('nokas');
        $tglkas = $this->input->post('tglkas');
        $nomor  = $this->input->post('no');
        $bank   = $this->input->post('bank');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $jnsrek = $this->input->post('jnsrek');
        $giat   = $this->input->post('giat');
        $subgiat   = $this->input->post('subgiat');
        $rekbank= $this->input->post('rekbank');
        $total  = $this->input->post('total');
        $lckdrek = $this->input->post('kdrek');
        $lnil_rek = $this->input->post('nilai');
        $lcnilaidet = $this->input->post('value_det');
        $sumber   = $this->input->post('sumber');
        
		if($sumber=='' || $sumber=='0'){
			$sumber2 = $this->session->userdata('pcNama');
		}else{
			$sumber2 = $sumber;
		}
		
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
       
		//$last_update=  date('Y-m-d H:i:s');
		$last_update=  '';
        // Simpan Header //
        $msg = array();
        if ($tabel == 'trhkasin_ppkd') {
            $sql = "delete from trhkasin_ppkd where kd_skpd='$skpd' and no_kas='$nokas'";
            $asg = $this->db->query($sql);
            if ($asg){
               /* $sql = "insert into trhkasin_ppkd(no_kas,tgl_kas,no_sts,kd_skpd,tgl_sts,keterangan,total,kd_bank,kd_kegiatan,
                        jns_trans,rek_bank,sumber) 
                        values('$nokas','$tglkas','$nomor','$skpd','$tgl','$ket','$total','$bank','$giat','$jnsrek','$rekbank','$sumber')";
               */
			   $sql = "insert into trhkasin_ppkd(no_kas,tgl_kas,no_sts,kd_skpd,tgl_sts,keterangan,total,kd_kegiatan,jns_trans,sumber,kd_subkegiatan) 
                        values('$nokas','$tglkas','$nomor','$skpd','$tgl','$ket',$total,'$giat','$jnsrek','$sumber2','$subgiat')";
                $asg = $this->db->query($sql);
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }
                if ($asg){
                    $sql = "delete from trdkasin_ppkd where no_kas='$nokas'";
                    $asg = $this->db->query($sql);    
                    if(!($asg)){
                        $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }else{
                        $sql = "insert into trdkasin_ppkd(kd_skpd,no_sts,kd_rek5,rupiah,no_kas,kd_kegiatan,kd_subkegiatan) values $lcnilaidet";
                        $asg = $this->db->query($sql); 
                    }                
                }            
            } 
            echo '1';
        }
    }
    
 
 
    function simpan_tetap(){
        
       // $tabel  = $this->input->post('tabel');
//        $nomor  = $this->input->post('no');
//        $tgl    = $this->input->post('tgl');
//        $skpd   = $this->input->post('skpd');
//        $ket    = $this->input->post('ket');
//        $kd_rek5 = $this->input->post('kdrek');
//        $kd_rek_lo = $this->input->post('rek');
//        $lnil_rek = $this->input->post('nilai');
//        
//        $sql = "delete from tr_tetap where kd_skpd='$skpd' and no_tetap='$nomor'";
//        $asg = $this->db->query($sql);
//        if($asg){
//            $sql = "insert into tr_tetap(no_tetap,tgl_tetap,kd_skpd,kd_rek5,kd_rek_lo,nilai,keterangan) 
//            values('$nomor','$tgl','$skpd','$kd_rek_lo','$kd_rek5',$lnil_rek,'$ket')";
//            $asg = $this->db->query($sql);
//        }
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $kd_rek5 = $this->input->post('kdrek');
        $kd_rek_lo = $this->input->post('rek');
        $lnil_rek = $this->input->post('nilai');
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmrek=$this->tukd_model->get_nama($kd_rek_lo,'nm_rek5','ms_rek5','kd_rek5');
        $usernm= $this->session->userdata('pcNama');
		$last_update=  date('Y-m-d H:i:s');
        
        $sql = "delete from tr_tetap where kd_skpd='$skpd' and no_tetap='$nomor'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
        $asg1 = $this->db->query($sql1);
        $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg2 = $this->db->query($sql2);
       
            $sql = "insert into tr_tetap(no_tetap,tgl_tetap,kd_skpd,kd_rek5,kd_rek_lo,nilai,keterangan) 
            values('$nomor','$tgl','$skpd','$kd_rek_lo','$kd_rek5',$lnil_rek,'$ket')";
            $asg = $this->db->query($sql);
            $sql1 = "insert into trhju_pkd(no_voucher,tgl_voucher,kd_skpd,nm_skpd,ket,tgl_update,username,total_d,total_k,tabel) 
            values('$nomor','$tgl','$skpd','$nmskpd','$ket','$last_update','$usernm',$lnil_rek,$lnil_rek,'3')";
            $asg1 = $this->db->query($sql1);
            $sql2 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','1130101','Piutang Pajak',$lnil_rek,0,'D','','1','1')";
            $asg2 = $this->db->query($sql2);
            $sql3 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','$kd_rek5','$nmrek',0,$lnil_rek,'K','','2','1')";
            $asg3 = $this->db->query($sql3);
       
    }
    
    function simpan_utang(){

        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $kd_rek_d = $this->input->post('kdrek');
        $kd_rek_k = $this->input->post('kdrek1');
        $lnil_rek = $this->input->post('nilai');
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmrek=$this->tukd_model->get_nama($kd_rek_d,'nm_rek5','ms_rek5','kd_rek5');
        $nmrek1=$this->tukd_model->get_nama($kd_rek_k,'nm_rek5','ms_rek5','kd_rek5');
        $usernm= $this->session->userdata('pcNama');
		$last_update=  date('Y-m-d H:i:s');
        
        $sql = "delete from tr_utang where kd_skpd='$skpd' and no_dok='$nomor'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_ppkd where kd_skpd='$skpd' and no_voucher='$nomor'";
        $asg1 = $this->db->query($sql1);
        $sql2 = "delete from trdju_ppkd where no_voucher='$nomor'";
        $asg2 = $this->db->query($sql2);
       
            $sql = "insert into tr_utang(no_dok,tgl,kd_skpd,kd_rek_d,kd_rek_k,nilai,keterangan) 
            values('$nomor','$tgl','$skpd','$kd_rek_d','$kd_rek_k',$lnil_rek,'$ket')";
            $asg = $this->db->query($sql);
            $sql1 = "insert into trhju_ppkd(no_voucher,tgl_voucher,kd_skpd,nm_skpd,ket,tgl_update,username,total_d,total_k,tabel) 
            values('$nomor','$tgl','$skpd','$nmskpd','$ket','$last_update','$usernm',$lnil_rek,$lnil_rek,'8')";
            $asg1 = $this->db->query($sql1);
            $sql2 = "insert into trdju_ppkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','$kd_rek_d','$nmrek',$lnil_rek,0,'D','','1','1')";
            $asg2 = $this->db->query($sql2);
            $sql3 = "insert into trdju_ppkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','$kd_rek_k','$nmrek1',0,$lnil_rek,'K','','2','1')";
            $asg3 = $this->db->query($sql3);
       
    }
    
        function simpan_tetap_ppkd(){
        
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $tgl    = $this->input->post('tgl');
        $giat    = $this->input->post('giat');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $kd_rek5 = $this->input->post('kdrek');
        $kd_rek_lo = $this->input->post('reklo');
        $lnil_rek = $this->input->post('nilai');
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmrek=$this->tukd_model->get_nama($kd_rek_lo,'nm_rek5','ms_rek5','kd_rek5');
        $usernm= $this->session->userdata('pcNama');
		$last_update=  date('Y-m-d H:i:s');
        
        $sql = "delete from tr_tetap_ppkd where kd_skpd='$skpd' and no_tetap='$nomor'";
        $asg = $this->db->query($sql);
               
       
            $sql = "insert into tr_tetap_ppkd(no_tetap,tgl_tetap,kd_skpd,kd_rek_lo,kd_rek5,nilai,keterangan,kd_subkegiatan) 
            values('$nomor','$tgl','$skpd','$kd_rek_lo','$kd_rek5','$lnil_rek','$ket','$giat')";
            $asg = $this->db->query($sql);
            
       
    }
    
    function simpan_terima(){
        
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $kd_rek5 = $this->input->post('rek');
        $kd_rek_lo = $this->input->post('kdrek');
        $lnil_rek = $this->input->post('nilai');
        $no_tetap = $this->input->post('nottp');
        $tgl_tetap = $this->input->post('tglttp');
        $sts_tetap = $this->input->post('sts');
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmrek=$this->tukd_model->get_nama($kd_rek_lo,'nm_rek5','ms_rek5','kd_rek5');
        $usernm= $this->session->userdata('pcNama');
		$last_update=  date('Y-m-d H:i:s');
        
        $sql = "delete from tr_terima where kd_skpd='$skpd' and no_terima='$nomor'";
        $asg = $this->db->query($sql);
        $sql = "insert into tr_terima(no_terima,tgl_terima,no_tetap,tgl_tetap,sts_tetap,kd_skpd,kd_rek5,kd_rek_lo,nilai,keterangan) 
        values('$nomor','$tgl','$no_tetap','$tgl_tetap','$sts_tetap','$skpd','$kd_rek_lo','$kd_rek5',$lnil_rek,'$ket')";
        $asg = $this->db->query($sql);
        if ($sts_tetap=='1'){
            $sql1 = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
            $asg1 = $this->db->query($sql1);
            $sql1 = "insert into trhju_pkd(no_voucher,tgl_voucher,kd_skpd,nm_skpd,ket,tgl_update,username,total_d,total_k,tabel) 
            values('$nomor','$tgl','$skpd','$nmskpd','$ket','$last_update','$usernm',$lnil_rek,$lnil_rek,'4')";
            $asg1 = $this->db->query($sql1);
            
            $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
            $asg2 = $this->db->query($sql2);
            
            $sql2 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','1110201','Kas di Bendahara Penerimaan',$lnil_rek,0,'D','','1','1')";
            $asg2 = $this->db->query($sql2);
            $sql3 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','1130101','Piutang Pajak',0,$lnil_rek,'K','','2','1')";
            $asg3 = $this->db->query($sql3);
            
            $sql4 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','1110201','Kas di Bendahara Penerimaan',$lnil_rek,0,'D','','3','0')";
            $asg4 = $this->db->query($sql4);
            $sql5 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','$kd_rek_lo','$nmrek',0,$lnil_rek,'K','','4','1')";
            $asg5 = $this->db->query($sql5);
        }else{
            $sql1 = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
            $asg1 = $this->db->query($sql1);
            $sql1 = "insert into trhju_pkd(no_voucher,tgl_voucher,kd_skpd,nm_skpd,ket,tgl_update,username,total_d,total_k,tabel) 
            values('$nomor','$tgl','$skpd','$nmskpd','$ket','$last_update','$usernm',$lnil_rek,$lnil_rek,'4')";
            $asg1 = $this->db->query($sql1);
            
            $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
            $asg2 = $this->db->query($sql2);
            
            $sql2 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','1110201','Kas di Bendahara Penerimaan',$lnil_rek,0,'D','','1','1')";
            $asg2 = $this->db->query($sql2);
            $sql3 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','$kd_rek5','$nmrek',0,$lnil_rek,'K','','2','1')";
            $asg3 = $this->db->query($sql3);
            
            $sql4 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','1110201','Kas di Bendahara Penerimaan',$lnil_rek,0,'D','','3','0')";
            $asg4 = $this->db->query($sql4);
            $sql5 = "insert into trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
            values('$nomor','$kd_rek_lo','$nmrek',0,$lnil_rek,'K','','4','1')";
            $asg5 = $this->db->query($sql5);
        }
               
    }
    
    function simpan_terima_ppkd(){
        
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $giat  = $this->input->post('giat');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $kd_rek5 = $this->input->post('kdrek');
        $kd_rek_lo = $this->input->post('reklo');
        $lnil_rek = $this->input->post('nilai');
        $no_tetap = $this->input->post('nottp');
        $tgl_tetap = $this->input->post('tglttp');
        $sts_tetap = $this->input->post('sts');
		$jenis = $this->input->post('jenis');
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmrek_lo=$this->tukd_model->get_nama($kd_rek5,'nm_rek5','ms_rek5','kd_rek5');
        $nmrek=$this->tukd_model->get_nama($kd_rek_lo,'nm_rek5','ms_rek5','kd_rek5');
        $kd_rek64=$this->tukd_model->get_nama($kd_rek5,'kd_rek64','ms_rek5','kd_rek5');
        $nmrek64=$this->tukd_model->get_nama($kd_rek5,'nm_rek64','ms_rek5','kd_rek5');
        $usernm= $this->session->userdata('pcNama');
		$last_update=  date('Y-m-d H:i:s');
        
        $sql = "delete from tr_terima_ppkd where kd_skpd='$skpd' and no_terima='$nomor'";
        $asg = $this->db->query($sql);
        $sql = "insert into tr_terima_ppkd(no_terima,tgl_terima,no_tetap,tgl_tetap,sts_tetap,kd_skpd,kd_rek_lo,kd_rek5,nilai,keterangan,kd_subkegiatan,jenis) 
        values('$nomor','$tgl','$no_tetap','$tgl_tetap','$sts_tetap','$skpd','$kd_rek_lo','$kd_rek5',$lnil_rek,'$ket','$giat','$jenis')";
        $asg = $this->db->query($sql);
               
    }
		
    
    function simpan_tagih(){
        
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $kd_rek5 = $this->input->post('kdrek');
        $rek = $this->input->post('rek');
        $lnil_rek = $this->input->post('nilai');
        
        $sql = "delete from tr_tagih where kd_skpd='$skpd' and no_tagih='$nomor'";
        $asg = $this->db->query($sql);
        if($asg){
            $sql = "insert into tr_tagih(no_tagih,tgl_tagih,kd_skpd,kd_rek5,kd_rek_lo,nilai,keterangan) 
            values('$nomor','$tgl','$skpd','$kd_rek5','$rek',$lnil_rek,'$ket')";
            $asg = $this->db->query($sql);
        }
       
    }
    
    function simpan_pakai(){
        
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $nmskpd =$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $ket    = $this->input->post('ket');
        $kd_rek5 = $this->input->post('kdrek');
        $nmrek5 =$this->tukd_model->get_nama($kd_rek5,'nm_rek5','ms_rek5','kd_rek5');
        $kd_aset = $this->input->post('kdaset');
        $nmaset =$this->tukd_model->get_nama($kd_aset,'nm_rek5','ms_rek5','kd_rek5');
        $rek = $this->input->post('rek');
        $lnil_rek = $this->input->post('nilai');
        $usernm     = $this->session->userdata('pcNama');    
        $update     = date('y-m-d H:i:s'); 
        
        $sql = "delete from tr_pakai where kd_skpd='$skpd' and no_po='$nomor'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
        $asg = $this->db->query($sql1);
        $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg = $this->db->query($sql2);
        if($asg){
            $sql = "insert into tr_pakai(no_po,tgl_po,kd_skpd,kd_rek5,kd_aset,kd_rek_lo,nilai,keterangan) 
            values('$nomor','$tgl','$skpd','$kd_rek5','$kd_aset','$rek',$lnil_rek,'$ket')";
            $asg = $this->db->query($sql);
             $asq2 = " insert into trhju_pkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
						  values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$lnil_rek','$lnil_rek','6')";
            $asg = $this->db->query($asq2);
            $this->db->query("insert trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nomor','$kd_rek5','$nmrek5',$lnil_rek,'0','D','9','1','1') ");                   
            $this->db->query("insert trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nomor','$kd_aset','$nmaset','0',$lnil_rek,'K','1','2','1') ");
        }
       
    }
    
    function simpan_susut(){
        
        $tabel  = $this->input->post('tabel');
        $nomor  = $this->input->post('no');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $nmskpd =$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $ket    = $this->input->post('ket');
        $kd_rek5 = $this->input->post('kdrek');
        $nmrek5 =$this->tukd_model->get_nama($kd_rek5,'nm_rek5','ms_rek5','kd_rek5');
        $kd_aset = $this->input->post('kdaset');
        $nmaset =$this->tukd_model->get_nama($kd_aset,'nm_rek5','ms_rek5','kd_rek5');
        $rek = $this->input->post('rek');
        $lnil_rek = $this->input->post('nilai');
        $usernm     = $this->session->userdata('pcNama');    
        $update     = date('y-m-d H:i:s'); 
        
        $sql = "delete from tr_susut where kd_skpd='$skpd' and no_po='$nomor'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
        $asg = $this->db->query($sql1);
        $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg = $this->db->query($sql2);
        if($asg){
            $sql = "insert into tr_susut(no_po,tgl_po,kd_skpd,kd_rek5,kd_rek_lo,kd_aset,nilai,keterangan) 
            values('$nomor','$tgl','$skpd','$kd_rek5','$rek','$kd_aset',$lnil_rek,'$ket')";
            $asg = $this->db->query($sql);
            
            $asq2 = " insert into trhju_pkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
						  values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$lnil_rek','$lnil_rek','6')";
            $asg = $this->db->query($asq2);
            $this->db->query("insert trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nomor','$kd_rek5','$nmrek5',$lnil_rek,'0','D','9','1','1') ");                   
            $this->db->query("insert trdju_pkd(no_voucher,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
							  values('$nomor','$kd_aset','$nmaset','0',$lnil_rek,'K','1','2','1') ");  
        }
       
    }
    
    function update_tetap(){
        $query = $this->input->post('st_query');
        $asg = $this->db->query($query);
      
    }
    function update_terima(){
        $query = $this->input->post('st_query');
        $asg = $this->db->query($query);
      
    }
    function update_tagih(){
        $query = $this->input->post('st_query');
        $asg = $this->db->query($query);
      
    }
    
     function update_pakai(){
        $query = $this->input->post('st_query');
        $asg = $this->db->query($query);
      
    }
    
    function update_susut(){
        $query = $this->input->post('st_query');
        $asg = $this->db->query($query);
      
    }
    
	function update_sts_ppkd(){
        
        $tabel  = $this->input->post('tabel');
        $nokas  = $this->input->post('nokas');
        $nosimpan  = $this->input->post('nosimpan');
        $tglkas = $this->input->post('tglkas');
        $nomor  = $this->input->post('no');
        $bank   = $this->input->post('bank');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $ket    = $this->input->post('ket');
        $jnsrek = $this->input->post('jnsrek');
        $giat   = $this->input->post('giat');
        $rekbank= $this->input->post('rekbank');
        $total  = $this->input->post('total');
        $lckdrek = $this->input->post('kdrek');
        $lnil_rek = $this->input->post('nilai');
        $lcnilaidet = $this->input->post('value_det');
        $sumber   = 'BUD';//$this->input->post('sts');  
        //$skpd= $this->session->userdata('kdskpd');
        $nmskpd=$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
       
        $usernm= $this->session->userdata('pcNama');
		//$last_update=  date('Y-m-d H:i:s');
		$last_update=  '';
        // Simpan Header //
        $msg = array();
        if ($tabel == 'trhkasin_ppkd') {
            $sql = "delete from trhkasin_ppkd where kd_skpd='$skpd' and no_kas='$nosimpan'";
            $asg = $this->db->query($sql);
            if ($asg){
               /* $sql = "insert into trhkasin_ppkd(no_kas,tgl_kas,no_sts,kd_skpd,tgl_sts,keterangan,total,kd_bank,kd_kegiatan,
                        jns_trans,rek_bank,sumber) 
                        values('$nokas','$tglkas','$nomor','$skpd','$tgl','$ket','$total','$bank','$giat','$jnsrek','$rekbank','$sumber')";
               */
			   $sql = "insert into trhkasin_ppkd(no_kas,tgl_kas,no_sts,kd_skpd,tgl_sts,keterangan,total,kd_kegiatan,jns_trans,sumber) 
                        values('$nokas','$tglkas','$nomor','$skpd','$tgl','$ket',$total,'$giat','$jnsrek','usernm')";
                $asg = $this->db->query($sql);
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }
                if ($asg){
                    $sql = "delete from trdkasin_ppkd where no_kas='$nosimpan'";
                    $asg = $this->db->query($sql);    
                    if(!($asg)){
                        $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }else{
                        $sql = "insert into trdkasin_ppkd(kd_skpd,no_sts,kd_rek5,rupiah,no_kas,kd_kegiatan) values $lcnilaidet";
                        $asg = $this->db->query($sql); 
                    }                
                }            
            } 
            echo '1';
        }
    }

    
     function hapus_sts_ppkd(){
        $nomor = $this->input->post('no');
        $skpd     = $this->session->userdata('skpd');    
        $sql = "delete from trhkasin_ppkd where no_kas='$nomor' ";
        $asg = $this->db->query($sql);
        if ($asg > 0){
            $sql = "delete from trdkasin_ppkd where no_kas='$nomor' ";
            $asg = $this->db->query($sql);
            
            if (asg < 0){
                echo '0';
                break;
            } 

        } else {
            echo '0';
            break;
        }
        echo '1';                
    }


    
    function hapus_sts(){
        $nomor = $this->input->post('no');
        
        $sql = "delete from trhkasin_pkd where no_sts='$nomor'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_ppkd where no_voucher='$nomor' ";
        $asg1 = $this->db->query($sql1);
        $sql2 = "delete from trhju_ppkd where no_voucher='$nomor'";
        $asg2 = $this->db->query($sql2);
        if (asg > 0){
            $sql = "delete from trdkasin_pkd where no_sts='$nomor'";
            $asg = $this->db->query($sql);
            
            if (asg < 0){
                echo '0';
                break;
            } 

        } else {
            echo '0';
            break;
        }
        echo '1';                
    }
    
     function hapus_tetap(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_tetap where no_tetap='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_pkd where no_voucher='$nomor' and kd_skpd = '$skpd'";
        $asg1 = $this->db->query($sql1);
        $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg2 = $this->db->query($sql2);
        $sql3 = "delete from trhju where no_voucher='$nomor' and kd_skpd = '$skpd'";
        $asg3 = $this->db->query($sql3);
        $sql4 = "delete from trdju where no_voucher='$nomor'";
        $asg4 = $this->db->query($sql4);
        $sql5 = "delete from trhju_pkd where no_voucher='$nomor' and kd_skpd = '$skpd'";
        $asg5 = $this->db->query($sql5);
        $sql6 = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg6 = $this->db->query($sql6);
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function hapus_utang(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_utang where no_dok='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_ppkd where no_voucher='$nomor' and kd_skpd = '$skpd'";
        $asg1 = $this->db->query($sql1);
        $sql2 = "delete from trdju_ppkd where no_voucher='$nomor'";
        $asg2 = $this->db->query($sql2);
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function hapus_panjar(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_panjar where no_panjar='$nomor' ";
        $asg = $this->db->query($sql);
        
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function hapus_tetap_ppkd(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_tetap_ppkd where no_tetap='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_ppkd where no_voucher='$nomor' and kd_skpd = '$skpd'";
        $asg1 = $this->db->query($sql1);
        $sql2 = "delete from trdju_ppkd where no_voucher='$nomor'";
        $asg2 = $this->db->query($sql2);
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function hapus_terima(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_terima where no_terima='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_pkd where no_voucher='$nomor' and kd_skpd = '$skpd'";
        $asg1 = $this->db->query($sql1);
        $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg2 = $this->db->query($sql2);
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function hapus_terima_ppkd(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_terima_ppkd where no_terima='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql);
        
        
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function hapus_tagih(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_tagih where no_tagih='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql);
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function hapus_pakai(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_pakai where no_po='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_pkd where no_voucher='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql1);
        $sql2 = "delete from trdju_pkd where no_voucher='$nomor' ";
        $asg = $this->db->query($sql2);
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function hapus_susut(){
        //no:cnomor,skpd:cskpd
        $nomor = $this->input->post('no');
        $skpd = $this->input->post('skpd');
        
        $sql = "delete from tr_susut where no_po='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql);
        $sql1 = "delete from trhju_pkd where no_voucher='$nomor' and kd_skpd = '$skpd'";
        $asg = $this->db->query($sql1);
        $sql2 = "delete from trdju_pkd where no_voucher='$nomor' ";
        $asg = $this->db->query($sql2);
        if ($asg){
            echo '1'; 
        } else{
            echo '0';
        }
                       
    }
    
    function load_panjar() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_panjar) like upper('%$kriteria%') or tgl_panjar like '%$kriteria%' or kd_skpd like'%$kriteria%' or
            upper(keterangan) like upper('%$kriteria%'))";            
        }
        
        $sql = "SELECT * from tr_panjar $where order by no_panjar";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_panjar' => $resulte['no_panjar'],
                        'tgl_panjar' => $this->tukd_model->rev_date($resulte['tgl_panjar']),
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai']),
                        'pengguna' => $resulte['pengguna']                                                                                            
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
     function load_tetap() {
		$skpd  = "1.20.00.00";
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd='$skpd'";
        if ($kriteria <> ''){                               
            $where=" (upper(no_tetap) like upper('%$kriteria%') or tgl_tetap like '%$kriteria%' or kd_skpd like'%$kriteria%' or
            upper(keterangan) like upper('%$kriteria%'))";            
        }
        
        $sql = "SELECT * from tr_tetap_ppkd where $where order by no_tetap";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_tetap' => $resulte['no_tetap'],
                        'tgl_tetap' => $this->tukd_model->rev_date($resulte['tgl_tetap']),
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai'],2),
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_rek' => $resulte['kd_rek_lo']                                                                                            
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
    
    
    function load_terima() {
        $skpd  = "1.20.00.00";//$this->session->userdata('kdskpd');
		$kriteria = '';
        $kriteria = $this->input->post('cari');
        $where =" kd_skpd='$skpd'";
        if ($kriteria <> ''){                               
            $where=" (upper(no_terima) like upper('%$kriteria%') or tgl_terima like '%$kriteria%' or kd_skpd like'%$kriteria%' or
            upper(keterangan) like upper('%$kriteria%'))";            
        }
        
        $sql = "SELECT * from tr_terima_ppkd where $where order by no_terima";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_terima' => $resulte['no_terima'],
                        'no_tetap' => $resulte['no_tetap'],
                        'tgl_terima' => $resulte['tgl_terima'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai'],2),
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_rek' => $resulte['kd_rek_lo'],
                        'sts_tetap' =>$resulte['sts_tetap']                                                                                            
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}	  
    
    
    function load_utang() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_dok) like upper('%$kriteria%') or tgl like '%$kriteria%' or kd_skpd like'%$kriteria%' or
            upper(keterangan) like upper('%$kriteria%'))";            
        }
        
        $sql = "SELECT * from tr_utang $where order by no_dok";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_dok' => $resulte['no_dok'],
                        'tgl' => $this->tukd_model->rev_date($resulte['tgl']),
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai']),
                        'kd_rek_d' => $resulte['kd_rek_d'],
                        'kd_rek_k' => $resulte['kd_rek_k']                                                                                            
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
    
    function load_tagih() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_tagih) like upper('%$kriteria%') or tgl_tagih like '%$kriteria%' or kd_skpd like'%$kriteria%' or
            upper(keterangan) like upper('%$kriteria%'))";            
        }
        
        $sql = "SELECT * from tr_tagih $where order by no_tagih";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_tagih' => $resulte['no_tagih'],
                        'tgl_tagih' => $resulte['tgl_tagih'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai']),
                        'kd_rek5' => $resulte['kd_rek5']                                                                                           
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
    
    function load_no_tetap() { //wahyu
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='where ';
        if ($kriteria <> ''){                               
            $where=" (upper(no_tetap) like upper('%$kriteria%') or tgl_tetap like '%$kriteria%' or kd_skpd like'%$kriteria%' or
            upper(keterangan) like upper('%$kriteria%')) and ";            
        }

		$where2 =' no_tetap not in(select no_tetap from tr_terima)';

        $sql = "SELECT * from tr_tetap_ppkd $where $where2 order by no_tetap";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_tetap' => $resulte['no_tetap'],
                        'tgl_tetap' => $resulte['tgl_tetap'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => $resulte['nilai'],
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_rek_lo' => $resulte['kd_rek_lo']                                                                                           
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
 
    
    function load_pakai() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_po) like upper('%$kriteria%') or tgl_po like '%$kriteria%' or kd_skpd like'%$kriteria%' or
            upper(keterangan) like upper('%$kriteria%'))";            
        }
        
        $sql = "SELECT * from tr_pakai $where order by no_po";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_po' => $resulte['no_po'],
                        'tgl_po' => $resulte['tgl_po'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai']),
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_aset' => $resulte['kd_aset']                                                                                           
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
    
     function load_susut() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_po) like upper('%$kriteria%') or tgl_po like '%$kriteria%' or kd_skpd like'%$kriteria%' or
            upper(keterangan) like upper('%$kriteria%'))";            
        }
        
        $sql = "SELECT * from tr_susut $where order by no_po";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_po' => $resulte['no_po'],
                        'tgl_po' => $resulte['tgl_po'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai']),
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_aset' => $resulte['kd_aset']                                                                                           
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
    
    function load_tagih_trans() {
        $cskpd = $this->input->post('kd');
        $lccr = $this->input->post('q');
        
        $sql = "SELECT no_tagih,tgl_tagih,kd_skpd,kd_rek5,kd_rek_lo,nilai from tr_tagih where upper(kd_skpd) like upper('%$lccr%') or  
        upper(no_tagih) like upper('%$lccr%') or upper(kd_rek5) like upper('%$lccr%') order by no_tagih";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_tagih' => $resulte['no_tagih'],
                        'tgl_tagih' => $resulte['tgl_tagih'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'kd_rek5' => $resulte['kd_rek5'],
                        'kd_rek' => $resulte['kd_rek_lo'],
                        'nila' => number_format($resulte['nilai'],2,',','.'),
                        'nil' => $resulte['nilai']                                                                                           
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
    
    function load_no_penagihan() { //wahyu
        $cskpd = $this->session->userdata('kdskpd');
        $lccr = $this->input->post('q');
        
        $sql = "SELECT no_bukti,tgl_bukti,kd_skpd,total,ket from trhtagih where kd_skpd='$cskpd' and (upper(kd_skpd) like upper('%$lccr%') or  
				upper(no_bukti) like upper('%$lccr%')) and no_bukti not in(SELECT no_tagih as no_bukti FROM trhtransout WHERE no_tagih<>'') and sts_tagih='0' order by no_bukti";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_tagih' => $resulte['no_bukti'],
                        'tgl_tagih' => $resulte['tgl_bukti'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'ket' => $resulte['ket'],
                        'nila' => number_format($resulte['total'],2,',','.'),
                        'nil' => $resulte['total']                                                                                           
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
    
     function load_tetap_sts() {
        //$kriteria = '';
        //$kriteria = $this->input->post('cari');
        $skpd = $this->uri->segment(3);
        $kd_rek5 = $this->uri->segment(4);
        
        //$where ='';
//        if ($kriteria <> ''){                               
//            $where="where kd_skpd = '$skpd' and kd_rek5 = '$kd_rek5' and (upper(no_tetap) like upper('%$kriteria%') or
//            upper(keterangan) like upper('%$kriteria%'))";            
//        }
//        
        $sql = "SELECT * from tr_terima where kd_skpd = '$skpd' and kd_rek5 = '$kd_rek5' order by no_tetap";
        //echo $sql;
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_tetap' => $resulte['no_terima'],
                        'tgl_tetap' => $resulte['tgl_terima'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],    
                        'nilai' => number_format($resulte['nilai']),
                        'kd_rek5' => $resulte['kd_rek5']                                                                                           
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	} 
    function cetak_sts(){
        //$b = $this->uri->segment(3);
        $lcnosts = str_replace('123456789','/',$this->uri->segment(3));
        
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
        $cRet='';
        $lcpemda = $kab;

        $sql = "SELECT a.*,(SELECT nm_skpd FROM ms_skpd WHERE kd_skpd = a.kd_skpd) AS nm_skpd,
                (SELECT nama FROM ms_bank WHERE kode = a.kd_bank) AS nm_bank
                FROM trhkasin_pkd a WHERE no_sts = '$lcnosts'";
                
        $hasil = $this->db->query($sql);
        $trh = $hasil->row();

        $rupiah = $this->tukd_model->terbilang($trh->total);
        $lcbank = $trh->nm_bank;
        $lcrek = $trh->rek_bank;
        $lcskpd = $trh->nm_skpd;
        $lctglsts = $trh->tgl_sts;

        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>
                        <tr><td colspan=\"2\" style=\"text-align:center;border: solid 1px white;border-bottom:solid 1px black;\">$lcpemda</td></tr>
                        <tr><td colspan=\"2\" style=\"text-align:center;border: solid 1px white;border-bottom:solid 1px black;\">SURAT TANDA SETORAN</td></tr>
                        <tr><td colspan=\"2\" style=\"text-align:center;border: solid 1px white;border-bottom:solid 1px black;\">(STS)</td></tr>
                     </thead></table><br>";       
              
        
     
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
          <tr>
            <td>
                <table  style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td width=\"10%\">No STS</td>
                        <td width=\"50%\">: $lcnosts</td>
                        <td width=\"10%\">Bank</td>
                        <td width=\"40%\">: $lcbank</td>
                    </tr>
                    <tr>
                        <td width=\"10%\">SKPD</td>
                        <td width=\"50%\">: $lcskpd</td>
                        <td width=\"10%\">No Rekening</td>
                        <td width=\"40%\">: $lcrek</td>
                    </tr>
                </table>      
            </td>
          </tr>
          <tr>
            <td>
                <table  style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td width=\"30%\">Harap diterima uang sebesar <br>(dengan huruf)</td>
                        <td width=\"70%\" valign=\"top\"><i>( $rupiah )</i></td>
                    </tr>
                </table>      
            </td>
          </tr>
          <tr>
            <td valign=\"top\">Dengan rincian penerimaan sebagai berikut<br>
            <table  style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
              <tr>
                <td width=\"4%\" height=\"28\" bgcolor=\"#CCCCCC\" align=\"center\"><b>No</b></td>
                <td colspan=\"5\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Kode Rekening</b></td>
                <td width=\"48%\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Uraian Rincian Objek</b></td>
                <td width=\"50%\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Jumlah</b></td>
              </tr>";
           
           $sql = "SELECT a.*,(SELECT nm_rek5 FROM ms_rek5 WHERE kd_rek5 = a.kd_rek5) AS nm_rek5
                    FROM trdkasin_pkd a WHERE no_sts = '$lcnosts'";
                
        $hasil = $this->db->query($sql);
        $lcno = 0;
        $lntotal = 0;
        foreach ($hasil->result() as $row)
        {
           $lntotal = $lntotal + $row->rupiah;     
           $lcno = $lcno + 1;
           $cRet .=" <tr>
                        <td align=\"center\">$lcno</td>
                        <td width=\"3%\">".substr($row->kd_rek5,0,1)."</td>
                        <td width=\"3%\">".substr($row->kd_rek5,1,1)."</td>
                        <td width=\"3%\">".substr($row->kd_rek5,2,1)."</td>
                        <td width=\"3%\">".substr($row->kd_rek5,3,2)."</td>
                        <td width=\"3%\">".substr($row->kd_rek5,5,2)."</td>
                        <td>$row->nm_rek5</td>
                        <td align=\"right\">".number_format($row->rupiah)."</td>
                      </tr>";     
            
        }
            $cRet .="
            <tr>
                <td colspan=\"7\" align=\"right\">Jumlah</td>                
                <td align=\"right\">".number_format($lntotal)."</td>
                
            </tr>
            </table>
            </td>
          </tr>
          <tr>
            <td height=\"30\" align=\"center\" style=\"font-size:12px\">Uang tersebut diterima pada tanggal ".$this->tukd_model->tanggal_format_indonesia($lctglsts)."</td>
          </tr>
          <tr>
            <td height=\"60\" align=\"center\"></td>
          </tr>
          <tr>
            <td height=\"56\">
                <table style=\"border-collapse:collapse;\" width=\"700\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                  <tr>
                    <td width=\"50%\" align=\"center\" style=\"font-size:14px\"><b>Mengetahui<br>Pengguna Anggaran/Kuasa Pengguna Anggaran</b></td>
                    <td width=\"50%\" align=\"center\" style=\"font-size:14px\"><b>Bendahara Penerimaan<br>Bendahara Penerimaan Pembantu</b></td>
                  </tr>
                  <tr>
                  <td height=\"60\" colspan =\"2\" ></td>
                  </tr>
                  <tr>
                    <td width=\"50%\" align=\"center\" style=\"font-size:14px\"><b>Nama Lengkap<br>NIP.</b></td>
                    <td width=\"50%\" align=\"center\" style=\"font-size:14px\"><b>Nama Lengkap<br>NIP.</b></td>
                  </tr>                  
                </table>
            </td>
          </tr>
        </table>";

        $data['prev']= $cRet;    
        $this->tukd_model->_mpdf('',$cRet,'10','10',5,'0');
        
    }
    
    // akhir fungsi fungsi sts   
   //register
   
    function reg_spp()
    {
        $data['page_title']= 'REGISTER S P P';
        $this->template->set('title', 'REGISTER S P P');   
        $this->template->load('template','tukd/register/spp',$data) ; 
    }
     function reg_spm()
    {
        $data['page_title']= 'REGISTER S P M';
        $this->template->set('title', 'REGISTER S P M');   
        $this->template->load('template','tukd/register/spm',$data) ; 
    }
     function reg_sp2d()
    {
        $data['page_title']= 'REGISTER S P 2 D';
        $this->template->set('title', 'REGISTER S P 2 D');   
        $this->template->load('template','tukd/register/sp2d',$data) ; 
    }
    
     function reg_sp2d_ppkd()
    {
        $data['page_title']= 'REGISTER S P 2 D';
        $this->template->set('title', 'REGISTER S P 2 D');   
        $this->template->load('template','tukd/register/sp2d_ppkd',$data) ; 
    }
    ///////transout rendy
    function transout()
    {
        $data['page_title']= 'INPUT PEMBAYARAN TRANSAKSI';
        $this->template->set('title', 'INPUT PEMBAYARAN TRANSAKSI');   
        $this->template->load('template','tukd/transaksi/transout',$data) ; 
    }
    
    function simpan_transout(){
        $tabel    = $this->input->post('tabel');        
        $nomor    = $this->input->post('no');
        $tgl      = $this->input->post('tgl');
        $skpd     = $this->input->post('skpd');
        $nmskpd   = $this->input->post('nmskpd');       
        $beban    = trim($this->input->post('beban'));
        $ket      = $this->input->post('ket');
        $status   = $this->input->post('status');
        $notagih  = $this->input->post('notagih');
        $tgltagih = $this->input->post('tgltagih');
        $total    = $this->input->post('total');      
        $csql     = $this->input->post('sql');            
        $usernm     = $this->session->userdata('pcNama'); 
        $xpay     = $this->input->post('cpay');
           
        $update     = date('y-m-d H:i:s');      
        $msg        = array();

		// Simpan Header //
        if ($tabel == 'trhtransout_ppkd') {
            $sql = "delete from trhtransout_ppkd where kd_skpd='$skpd' and no_bukti='$nomor'";
			$asg = $this->db->query($sql);
            $sqlx = "delete from trhtransout where kd_skpd='$skpd' and no_bukti='$nomor'";
			$asgx = $this->db->query($sqlx);
			if ($beban=='1'){
	           $sql = "delete from trhju_ppkd where kd_skpd='$skpd' and no_voucher='$nomor'";
			   $asg = $this->db->query($sql);
               
               $sqlxx = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
			   $asgxx = $this->db->query($sqlxx);
               $sqlxxx = "delete from trhju where kd_skpd='$skpd' and no_voucher='$nomor'";
			   $asgxxx = $this->db->query($sqlxxx);
			}

            if ($asg){
                
				$sql = "insert into trhtransout_ppkd(no_bukti,tgl_bukti,ket,username,tgl_update,kd_skpd,nm_skpd,total,no_tagih,sts_tagih,tgl_tagih,jns_spp,pay) 
                        values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$notagih','$status','$tgltagih','$beban','$xpay')";
                $asg = $this->db->query($sql);
                
                $sqltrhtransout = "insert into trhtransout(no_bukti,tgl_bukti,ket,username,tgl_update,kd_skpd,nm_skpd,total,no_tagih,sts_tagih,tgl_tagih,jns_spp,pay) 
                        values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$notagih','$status','$tgltagih','$beban','$xpay')";
                $asgtrhtransout = $this->db->query($sqltrhtransout);

				if ($beban=='1'){
					$sql3 = " insert into trhju_ppkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
							  values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$total','0')";
					$asg3 = $this->db->query($sql3);
                    
                    $sqltrhju_pkd = " insert into trhju_pkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
							  values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$total','0')";
					$asgtrhju_pkd= $this->db->query($sqltrhju_pkd);
                    
                    $sqltrhju = " insert into trhju(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
							  values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$total','0')";
					$asgtrhju = $this->db->query($sqltrhju);
				}



                if (!($asg)){
                   $msg = array('pesan'=>'0');
                   echo json_encode($msg);
                    exit();
                } else {
                    $msg = array('pesan'=>'1');
                    echo json_encode($msg);
                }             
            } else {
                $msg = array('pesan'=>'0');
                echo json_encode($msg);
                exit();
            }
            
        }elseif($tabel == 'trdtransout_ppkd') {
            
            // Simpan Detail //                       
                $sql = "delete from trdtransout_ppkd where no_bukti='$nomor'";
                $asg = $this->db->query($sql);
                $sqlx = "delete from trdtransout where no_bukti='$nomor'";
                $asgx = $this->db->query($sqlx);
				if ($beban=='1'){
					$sql = "delete from trdju_ppkd where no_voucher='$nomor'";
					$asg = $this->db->query($sql);
                    
                    $sql2 = "delete from trdju_pkd where no_voucher='$nomor'";
					$asg2 = $this->db->query($sql2);
                    $sql3x = "delete from trdju where no_voucher='$nomor'";
					$asg3x = $this->db->query($sql3x);
				}
				if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into trdtransout_ppkd(no_bukti,no_sp2d,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai)"; 
                    $asg = $this->db->query($sql.$csql);
                    $sql4 = "insert into trdtransout(no_bukti,no_sp2d,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai)"; 
                    $asg4 = $this->db->query($sql4.$csql);
					if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                     //   exit();
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }

				$hasil=$this->db->query(" select * from trdtransout_ppkd where no_bukti='$nomor' ");  	
				foreach ($hasil->result_array() as $row){
					$no	   =$row['no_bukti'];	
					$sp2d  =$row['no_sp2d'];	
					$kdgiat=$row['kd_kegiatan'];	
					$nmgiat=$row['nm_kegiatan'];	
					$kdrek5=$row['kd_rek5'];	
					$nmrek5=$row['nm_rek5'];	
					$nilai =$row['nilai'];	
	  			    
					$kdrek9=$this->tukd_model->get_nama($kdrek5,'map_lo','ms_rek5','kd_rek5');
					$nmrek9=$this->tukd_model->get_nama($kdrek9,'nm_rek5','ms_rek5','kd_rek5');
                    $kdrek64=$this->tukd_model->get_nama($kdrek5,'kd_rek64','ms_rek5','kd_rek5');
					$nmrek64=$this->tukd_model->get_nama($kdrek64,'nm_rek64','ms_rek5','kd_rek64');
					$rek3=substr($kdrek5,0,3);
	  			    $rekutang=$this->tukd_model->get_nama($kdrek64,'piutang_utang','ms_rek5','kd_rek64');
					$nmrekutang=$this->tukd_model->get_nama($rekutang,'nm_rek5','ms_rek5','kd_rek5');

					if ($beban=='1'){
						if ($status=='1'){
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$rekutang','$nmrekutang',$nilai,'0','D','$beban','1','1') ");       			
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','2','1') ");		

						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek5','$nmrek5',$nilai,'0','D','$beban','3','1') ");       			
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','4','0') ");
                                             
                           //permen 64
						   $this->db->query("insert into trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$rekutang','$nmrekutang',$nilai,'0','D','$beban','1','1') ");       			
						   $this->db->query("insert into trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','2','1') ");		

						   $this->db->query("insert into trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek64','$nmrek64',$nilai,'0','D','$beban','3','1') ");       			
						   $this->db->query("insert into trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','4','0') ");
                           
                          //permen  21 
                           $this->db->query("insert into trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$rekutang','$nmrekutang',$nilai,'0','D','$beban','1','1') ");       			
						   $this->db->query("insert into trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','2','1') ");		

						   $this->db->query("insert into trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek5','$nmrek5',$nilai,'0','D','$beban','3','1') ");       			
						   $this->db->query("insert into trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','4','0') ");		
					    }else{
					   
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek9','$nmrek9',$nilai,'0','D','$beban','1','1') ");       			
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','2','1') ");		

						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek5','$nmrek5',$nilai,'0','D','$beban','3','1') ");       			
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','3120501','Estimasi Perubahan SAL','0','$nilai','K','','4','0') ");
                           //permen 64
						   $this->db->query("insert into trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek9','$nmrek9',$nilai,'0','D','$beban','1','1') ");       			
						   $this->db->query("insert into trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','2','1') ");		

						   $this->db->query("insert into trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek64','$nmrek64',$nilai,'0','D','$beban','3','1') ");       			
						   $this->db->query("insert into trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','3120501','Estimasi Perubahan SAL','0','$nilai','K','','4','0') ");
                           //permen  21 
                           $this->db->query("insert into trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek9','$nmrek9',$nilai,'0','D','$beban','1','1') ");       			
						   $this->db->query("insert into trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','2','1') ");		

						   $this->db->query("insert into trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek5','$nmrek5',$nilai,'0','D','$beban','3','1') ");       			
						   $this->db->query("insert into trdju(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','3120501','Estimasi Perubahan SAL','0','$nilai','K','','4','0') ");							   
					    }
					}

				}   
									 				
				
        }
         
        //$asg->free_result();
    }
    
     function simpan_penagihan(){
        $tabel    = $this->input->post('tabel');        
        $nomor    = $this->input->post('no');
        $tgl      = $this->input->post('tgl');
        $skpd     = $this->input->post('skpd');
        $nmskpd   = $this->input->post('nmskpd');       
        $beban    = $this->input->post('beban');
        $ket      = $this->input->post('ket');
        $status   = $this->input->post('status');
        $notagih  = $this->input->post('notagih');
        $tgltagih = $this->input->post('tgltagih');
        $total    = $this->input->post('total');      
        $csql     = $this->input->post('sql');            
        $usernm     = $this->session->userdata('pcNama');    
        $update     = date('y-m-d H:i:s');      
        $msg        = array();
        // Simpan Header //
        if ($tabel == 'trhtagih') {
            $sql = "delete from trhtagih where kd_skpd='$skpd' and no_bukti='$nomor'";
            $asg = $this->db->query($sql);

            $sql = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
            $asg = $this->db->query($sql);

			if ($asg){
                $sql = "insert into trhtagih(no_bukti,tgl_bukti,ket,username,tgl_update,kd_skpd,nm_skpd,total,no_tagih,sts_tagih,tgl_tagih,jns_spp) 
                        values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$notagih','$status','$tgltagih','$beban')";
                $asg = $this->db->query($sql);

				$asq3 = " insert into trhju_pkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
						  values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$total','0')";
				$asg3 = $this->db->query($asq3);

				if (!($asg)){
                   $msg = array('pesan'=>'0');
                   echo json_encode($msg);
                    exit();
                } else {
                    $msg = array('pesan'=>'1');
                    echo json_encode($msg);
                }             
            } else {
                $msg = array('pesan'=>'0');
                echo json_encode($msg);
                exit();
            }
            
        } else if ($tabel == 'trdtagih') {
            
            // Simpan Detail //                       
                $sql = "delete from trdtagih where no_bukti='$nomor'";
                $asg = $this->db->query($sql);
                $sql = "delete from trdju_pkd where no_voucher='$nomor'";
                $asg = $this->db->query($sql);
                
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into trdtagih(no_bukti,no_sp2d,kd_kegiatan,nm_kegiatan,kd_rek5,kd_rek,nm_rek5,nilai)"; 
    
                    $asg = $this->db->query($sql.$csql);
                    if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }            
				
				$hasil=$this->db->query(" select * from trdtagih where no_bukti='$nomor' ");  	
				foreach ($hasil->result_array() as $row){
					$no	   =$row['no_bukti'];	
					$sp2d  =$row['no_sp2d'];	
					$kdgiat=$row['kd_kegiatan'];	
					$nmgiat=$row['nm_kegiatan'];	
					$kdrek5=$row['kd_rek'];	
					$nmrek5=$row['nm_rek5'];	
					$nilai =$row['nilai'];	
					
					$kdrek9=$this->tukd_model->get_nama($kdrek5,'map_lo','ms_rek5','kd_rek5');
					$nmrek9=$this->tukd_model->get_nama($kdrek9,'nm_rek5','ms_rek5','kd_rek5');
					
					$rek3=substr($kdrek5,0,3);	  			    
					$rekutang=$this->tukd_model->get_nama($rek3,'kd_rek5','ms_rek5','map_lo');
					$nmrekutang=$this->tukd_model->get_nama($rekutang,'nm_rek5','ms_rek5','kd_rek5');

					$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
									  values('$no','$kdgiat','$nmgiat','$kdrek9','$nmrek9',$nilai,'0','D','$jns','1','1') ");                   
					$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
									  values('$no','$kdgiat','$nmgiat','$rekutang','$nmrekutang','0',$nilai,'K','$jns','2','1') ");  

				} 

        }
         
        //$asg->free_result();	
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);	
	}
    
    function hapus_transout(){
        $nomor = $this->input->post('no');
        $msg = array();
        $sql = "delete from trdtransout where no_bukti='$nomor'";
        $asg = $this->db->query($sql);

		$sql = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg = $this->db->query($sql);

		if ($asg){
            $sql = "delete from trhtransout where no_bukti='$nomor'";
            $asg = $this->db->query($sql);

            $sql = "delete from trhju_pkd where no_voucher='$nomor'";
            $asg = $this->db->query($sql);

			
			if (!($asg)){
              $msg = array('pesan'=>'0');
              echo json_encode($msg);
               exit();
            } 
        } else {
            $msg = array('pesan'=>'0');
            echo json_encode($msg);
            exit();
        }
        $msg = array('pesan'=>'1');
        echo json_encode($msg);
    }
    
    function hapus_penagihan(){
        $nomor = $this->input->post('no');
        $msg = array();
        $sql = "delete from trdtagih where no_bukti='$nomor'";
        $asg = $this->db->query($sql);

        $sql = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg = $this->db->query($sql);

		if ($asg){
            $sql = "delete from trhtagih where no_bukti='$nomor'";
            $asg = $this->db->query($sql);

            $sql = "delete from trhju_pkd where no_voucher='$nomor'";
            $asg = $this->db->query($sql);

			if (!($asg)){
              $msg = array('pesan'=>'0');
              echo json_encode($msg);
               exit();
            } 
        } else {
            $msg = array('pesan'=>'0');
            echo json_encode($msg);
            exit();
        }
        $msg = array('pesan'=>'1');
        echo json_encode($msg);
    }
    
    function load_transout(){
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where=" and (upper(no_bukti) like upper('%$kriteria%') or tgl_bukti like '%$kriteria%' or upper(nm_skpd) like 
                    upper('%$kriteria%') or upper(ket) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as total from trhtransout where jns_spp in ('1','3') $where " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
       	$result["total"] = $total->total; 
        $query1->free_result();        
        
        $sql = "SELECT * from trhtransout where jns_spp in ('1','3') $where order by tgl_bukti,no_bukti,kd_skpd limit $offset,$rows";
        $query1 = $this->db->query($sql);  
        
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_bukti' => $resulte['no_bukti'],
                        'tgl_bukti' => $resulte['tgl_bukti'],
                        'ket' => $resulte['ket'],
                        'username' => $resulte['username'],    
                        'tgl_update' => $resulte['tgl_update'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
                        'total' => $resulte['total'],
                        'no_tagih' => $resulte['no_tagih'],
                        'sts_tagih' => $resulte['sts_tagih'],
                        'tgl_tagih' => $resulte['tgl_tagih'],                       
                        'jns_beban' => $resulte['jns_spp'],
                        'pay' => $resulte['pay']                                                                                                        
                        );
                        $ii++;
        }
       	$result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();
    }
    
    function load_penagihan(){
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_bukti) like upper('%$kriteria%') or tgl_bukti like '%$kriteria%' or upper(nm_skpd) like 
                    upper('%$kriteria%') or upper(ket) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as total from trhtagih  $where " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
       	$result["total"] = $total->total; 
        $query1->free_result();        
        
        $sql = "SELECT * from trhtagih   $where order by tgl_bukti,no_bukti,kd_skpd limit $offset,$rows";
        $query1 = $this->db->query($sql);  
        
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_bukti' => $resulte['no_bukti'],
                        'tgl_bukti' => $resulte['tgl_bukti'],
                        'ket' => $resulte['ket'],
                        'username' => $resulte['username'],    
                        'tgl_update' => $resulte['tgl_update'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
                        'total' => $resulte['total'],
                        'no_tagih' => $resulte['no_tagih'],
                        'sts_tagih' => $resulte['sts_tagih'],
                        'tgl_tagih' => $resulte['tgl_tagih'],                       
                        'jns_beban' => $resulte['jns_spp']                                                                                              
                        );
                        $ii++;
        }
       	$result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();
    }
    
    function load_dtransout(){        
        $nomor = $this->input->post('no');    
        $sql = "SELECT b.*,
                (SELECT SUM(c.nilai) FROM trdtransout c LEFT JOIN trhtransout d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                d.kd_skpd=a.kd_skpd AND c.kd_rek5=b.kd_rek5 AND c.no_bukti <> a.no_bukti AND d.jns_spp = a.jns_spp ) AS lalu,
                (SELECT e.nilai FROM trhspp e INNER JOIN trdspp f ON e.no_spp=f.no_spp INNER JOIN trhspm g ON e.no_spp=g.no_spp INNER JOIN trhsp2d h ON g.no_spm=h.no_spm
                WHERE h.no_sp2d = b.no_sp2d AND f.kd_kegiatan=b.kd_kegiatan AND f.kd_rek5=b.kd_rek5) AS sp2d,
                (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek5) AS anggaran FROM trhtransout a INNER JOIN
                trdtransout b ON a.no_bukti=b.no_bukti WHERE a.no_bukti='$nomor' ORDER BY b.kd_kegiatan,b.kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id'            => $ii,        
                        'no_bukti'      => $resulte['no_bukti'],
                        'no_sp2d'       => $resulte['no_sp2d'],
                        'kd_kegiatan'   => $resulte['kd_kegiatan'],
                        'nm_kegiatan'   => $resulte['nm_kegiatan'],
                        'kd_rek5'       => $resulte['kd_rek5'],
                        'nm_rek5'       => $resulte['nm_rek5'],
                        'nilai'         => $resulte['nilai'],
                        'lalu'          => $resulte['lalu'],
                        'sp2d'          => $resulte['sp2d'],   
                        'anggaran'      => $resulte['anggaran']                                                                                                                                                          
                        );
                        $ii++;
        }           
        echo json_encode($result);
        $query1->free_result();
    }
    
    function load_dtagih(){        
        $nomor = $this->input->post('no');    
        $sql = "SELECT b.*,
                (SELECT SUM(c.nilai) FROM trdtagih c LEFT JOIN trhtagih d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                d.kd_skpd=a.kd_skpd AND c.kd_rek5=b.kd_rek AND c.no_bukti <> a.no_bukti AND d.jns_spp = a.jns_spp ) AS lalu,
                (SELECT e.nilai FROM trhspp e INNER JOIN trdspp f ON e.no_spp=f.no_spp INNER JOIN trhspm g ON e.no_spp=g.no_spp INNER JOIN trhsp2d h ON g.no_spm=h.no_spm
                WHERE h.no_sp2d = b.no_sp2d AND f.kd_kegiatan=b.kd_kegiatan AND f.kd_rek5=b.kd_rek5) AS sp2d,
                (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek) AS anggaran FROM trhtagih a INNER JOIN
                trdtagih b ON a.no_bukti=b.no_bukti WHERE a.no_bukti='$nomor' ORDER BY b.kd_kegiatan,b.kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id'            => $ii,        
                        'no_bukti'      => $resulte['no_bukti'],
                        'no_sp2d'       => $resulte['no_sp2d'],
                        'kd_kegiatan'   => $resulte['kd_kegiatan'],
                        'nm_kegiatan'   => $resulte['nm_kegiatan'],
                        'kd_rek5'       => $resulte['kd_rek5'],
                        'kd_rek'        => $resulte['kd_rek'],
                        'nm_rek5'       => $resulte['nm_rek5'],
                        'nilai'         => $resulte['nilai'],
                        'lalu'          => $resulte['lalu'],
                        'sp2d'          => $resulte['sp2d'],   
                        'anggaran'      => $resulte['anggaran']                                                                                                                                                          
                        );
                        $ii++;
        }           
        echo json_encode($result);
        $query1->free_result();
    }
    
    function load_sp2d_transout(){
       //$beban='',$giat=''
       $beban   = $this->input->post('jenis');
       $giat    = $this->input->post('giat');
       $kode    = $this->input->post('kd');
       $bukti   = $this->input->post('bukti');
       $where = '';
       if ($beban=='1'){
        $sisa = "c.nilai + (SELECT IF(SUM(v.nilai) IS NULL,0,SUM(v.nilai)) FROM trhspp z INNER JOIN trhspm s ON z.no_spp=s.no_spp 
                INNER JOIN trhsp2d v ON s.no_spm=v.no_spm WHERE z.jns_spp='1' AND z.kd_skpd=c.kd_skpd )
                -(SELECT IF(SUM(nilai) IS NULL,0,SUM(nilai)) FROM trdtransout WHERE no_sp2d = c.no_sp2d and no_bukti <> '$bukti') AS sisa";
       }else{
        $sisa = "c.nilai -(SELECT IF(SUM(nilai) IS NULL,0,SUM(nilai)) FROM trdtransout WHERE no_sp2d = c.no_sp2d and no_bukti <> '$bukti') AS sisa";   
       }
       if (($beban != '' && $giat == '') || ($beban == '1')){
            $where = " and a.jns_spp='$beban'"; 
       }
       if ($giat !='' && $beban != '1'){
            $where = " and a.jns_spp='$beban' and d.kd_kegiatan='$giat'";
       }
        $kriteria = $this->input->post('q');
            $sql = "SELECT DISTINCT c.no_sp2d,c.tgl_sp2d,c.nilai,
                    $sisa                   
                    FROM trhspp a INNER JOIN trhspm b ON a.no_spp=b.no_spp
                    INNER JOIN trhsp2d c ON b.no_spm=c.no_spm
                    INNER JOIN trdspp d ON a.no_spp=d.no_spp
                    WHERE c.kd_skpd = '$kode' AND c.status = 1 $where ORDER BY c.no_sp2d,c.tgl_sp2d";
       //and UPPER(no_sp2d) LIKE '%$kriteria%'  
        $query1 = $this->db->query($sql);                  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {                               
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'nilai' => $resulte['nilai'],
                        'sisa' => $resulte['sisa']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();
    }
    
 
        
     function load_trskpd() {        
        $jenis =$this->input->post('jenis');
        $giat =$this->input->post('giat');
        $cskpd = $this->input->post('kd');
        $cskpd2 = $this->session->userdata('kdskpd');
        
        if($cskpd==""){
            $cskpd = $cskpd2;
        }
        
        $jns_beban='';
        $cgiat = '';
        if ($jenis !=''){
            $jns_beban = "and a.jns_kegiatan='$jenis'";
        }
        if ($giat !=''){                               
            $cgiat = " and a.kd_kegiatan not in ($giat) ";
        }                
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,(select nm_program from m_prog where kd_program=a.kd_program) as nm_program,a.total FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                WHERE a.kd_skpd='$cskpd' $jns_beban $cgiat AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(b.nm_kegiatan) LIKE UPPER('%$lccr%'))";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'total'       => $resulte['total']        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}
    
    function load_trskpd_ppkd() {        
        $cskpd = $this->input->post('kd');
        
       
                    
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,(select nm_program from m_prog where kd_program=a.kd_program) as nm_program,a.total FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                WHERE a.kd_skpd='$cskpd'  and a.jns_kegiatan not in('4','61') AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(b.nm_kegiatan) LIKE UPPER('%$lccr%'))";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'total'       => $resulte['total']        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}
    
    function load_trskpd_ar_2() { 
        $cskpd  =  '' ;
        $cskpd  =  $this->input->post('kdskpd');
        $cskp = substr($cskpd,0,7); 
        $sql    = "SELECT kd_kegiatan, nm_kegiatan FROM trskpd where left(kd_skpd,7) = '$cskp' order by kd_kegiatan ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan']
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();    	   
	}
    
	
	
	
	
  function ambil_sts() {        
        $lccr = $this->input->post('q'); 
        $lckdskpd = $this->uri->segment(3); 
		$tgl_sts = $this->uri->segment(4);
        $sql = "SELECT no_sts, tgl_sts,kd_skpd, keterangan,sumber,kd_kegiatan,jns_trans,total FROM trhkasin_pkd WHERE no_sts NOT IN(SELECT no_sts FROM trhkasin_ppkd) AND (upper(no_sts) like upper('%$lccr%') or upper(total) like upper('%$lccr%'))
                and kd_skpd='$lckdskpd'
				and tgl_sts<='$tgl_sts'";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sts' => $resulte['no_sts'],  
                        'tgl_sts' => $resulte['tgl_sts'],
						'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],
						'sumber' => $resulte['sumber'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'jns_trans' => $resulte['jns_trans'],
                        'total'       => number_format($resulte['total'],2,'.',',')        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}
 

 function ambil_sts_retribusi() {        
        $lccr = $this->input->post('q'); 
        $lckdskpd = $this->uri->segment(3); 
		$tgl_sts = $this->uri->segment(4);
        $sql = "SELECT no_sts, tgl_sts,kd_skpd, keterangan,sumber,kd_kegiatan,jns_trans,total,(select a.nm_pengirim from ms_pengirim a where a.kd_pengirim=sumber) as nm_pengirim
				FROM trhkasin_pkd WHERE no_sts NOT IN(SELECT a.no_sts FROM trhkasin_ppkd a 
				INNER JOIN trdkasin_ppkd b ON a.no_kas=b.no_kas 
				WHERE LEFT(b.kd_rek5,1) NOT IN ('411','431') GROUP BY a.no_sts) 
				AND (upper(no_sts) like upper('%$lccr%') or upper(total) like upper('%$lccr%'))
                and kd_skpd='$lckdskpd'
				and tgl_sts<='$tgl_sts' order by no_sts";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_sts' => $resulte['no_sts'],  
                        'tgl_sts' => $resulte['tgl_sts'],
						'kd_skpd' => $resulte['kd_skpd'],
                        'keterangan' => $resulte['keterangan'],
						'sumber' => $resulte['sumber'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'jns_trans' => $resulte['jns_trans'],
						'nm_pengirim' => $resulte['nm_pengirim'],
                        'total'       => number_format($resulte['total'],2,'.',',')        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}
  
 
	function load_trskpd_penagihan() {        
        
        $giat =$this->input->post('giat');
        $cskpd = $this->input->post('kd');
        $cgiat = '';
       
        if ($giat !=''){                               
            $cgiat = " and a.kd_kegiatan not in ($giat) ";
        }                
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,(select nm_program from m_prog where kd_program=a.kd_program) as nm_program,a.total FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                WHERE a.kd_skpd= '$cskpd'  $cgiat AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(b.nm_kegiatan) LIKE UPPER('%$lccr%'))";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'total'       => $resulte['total']        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}

    function load_rek() {                      
        $jenis  = $this->input->post('jenis');
        $giat   = $this->input->post('giat');  
        $kode   = $this->input->post('kd');
        $nomor  = $this->input->post('no');
        $sp2d   = $this->input->post('sp2d');
        $rek    = $this->input->post('rek');        
        $lccr   = $this->input->post('q');
            
        if ($rek !=''){        
            $notIn = " and kd_rek5 not in ($rek) " ;
        }else{
            $notIn  = "";
        }
        
        if ($jenis=='1'){
            $sql = "SELECT a.kd_rek5,a.nm_rek5,
                    (SELECT SUM(c.nilai) FROM trdtransout c LEFT JOIN trhtransout d ON c.no_bukti=d.no_bukti WHERE c.kd_subkegiatan = a.kd_subkegiatan AND 
                    d.kd_skpd=a.kd_skpd  AND c.kd_rek5=a.kd_rek5 AND c.no_bukti <> '$nomor' AND d.jns_spp = '$jenis') AS lalu,
                    0 AS sp2d,nilai AS anggaran  FROM trdrka a WHERE a.kd_subkegiatan= '$giat' AND a.kd_skpd = '$kode' $notIn ";
                    
        } else {
            $sql = "SELECT b.kd_rek5,b.nm_rek5,
                    (SELECT SUM(c.nilai) FROM trdtransout c LEFT JOIN trhtransout d ON c.no_bukti=d.no_bukti WHERE c.kd_subkegiatan = b.kd_subkegiatan AND 
                    d.kd_skpd=a.kd_skpd AND c.kd_rek5=b.kd_rek5 AND c.no_bukti <> '$nomor' AND d.jns_spp = '$jenis') AS lalu,
                    a.nilai AS sp2d,(SELECT SUM(nilai) FROM trdrka WHERE kd_subkegiatan = b.kd_subkegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek5) AS anggaran 
                    FROM trhspp a INNER JOIN trdspp b ON a.no_spp=b.no_spp INNER JOIN trhspm c ON b.no_spp=c.no_spp INNER JOIN trhsp2d d ON c.no_spm=d.no_Spm
                    WHERE d.no_sp2d = '$sp2d' and b.kd_subkegiatan='$giat' $notIn ";
        }        
        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
                        'lalu' => $resulte['lalu'],
                        'sp2d' => $resulte['sp2d'],
                        'anggaran' => $resulte['anggaran']
                        );
                        $ii++;
        }                   
       echo json_encode($result);    
       $query1->free_result();       	   
	}
    
    function load_rek_ar() {  
        
        $ckdkegi  = $this->input->post('kdkegiatan');
        //$ckdkegi  = '1.20.1.20.12.01.00.51';
        $ckdrek   = $this->input->post('kdrek');
        
        if (  $ckdrek != '' ){
            $NotIn = " and kd_rek5 not in ($ckdrek) " ;
        } else {
            $NotIn = " " ;
        }
        
        $sql      = "SELECT kd_rek5, nm_rek5 FROM trdrka where kd_kegiatan = '$ckdkegi' $NotIn order by kd_rek5 ";
        $query1   = $this->db->query($sql);  
        $result   = array();
        $ii       = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id'      => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();    	   
	}
    
    function jumlah_ang_spp() {  
        
        $ckdkegi  = $this->input->post('kegiatan');
        $ckdrek   = $this->input->post('kdrek5');
        $ckdskpd  = $this->input->post('kd_skpd');
        $cnospp   = $this->input->post('no_spp');
        
                           
        $query1   = $this->db->query(" SELECT SUM(nilai) as rektotal, 
        ( select sum(a.nilai) from trdspp a inner join trhspp b on a.no_spp=b.no_spp
          inner join trhspm  c on c.no_spp=b.no_spp
          inner join trhsp2d d on d.no_spm=c.no_spm   
          where a.kd_kegiatan='$ckdkegi' and a.kd_rek5='$ckdrek' and a.kd_skpd='$ckdskpd' and a.no_spp <> '$cnospp' and d.status='1' )
          as rektotal_spp_lalu
          FROM trdrka WHERE kd_rek5='$ckdrek' and kd_kegiatan='$ckdkegi' and kd_skpd='$ckdskpd' ");   
        
        $result   = array();
        $ii       = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id'             => $ii,        
                        'nilai'          => number_format($resulte['rektotal'],2,'.',','),
                        'nilai_spp_lalu' => number_format($resulte['rektotal_spp_lalu'],2,'.',',')
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();	
	
    }
    
    function load_rek_penagihan() {                      
        $jenis  = $this->input->post('jenis');
        $giat   = $this->input->post('giat');  
        $kode   = $this->input->post('kd');
        $nomor  = $this->input->post('no');
        //$sp2d   = $this->input->post('sp2d');
        $rek    = $this->input->post('rek');        
        $lccr   = $this->input->post('q');
            
        if ($rek !=''){        
            $notIn = " and kd_rek5 not in ($rek) " ;
        }else{
            $notIn  = "";
        }
            $sql = "SELECT a.kd_rek5,a.nm_rek5,e.map_lo,
                    (SELECT SUM(c.nilai) FROM trdtagih c LEFT JOIN trhtagih d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = a.kd_kegiatan AND 
                    d.kd_skpd=a.kd_skpd  AND c.kd_rek=a.kd_rek5 AND c.no_bukti <> '$nomor' ) AS lalu,
                    0 AS sp2d,a.nilai AS anggaran  FROM trdrka a LEFT JOIN ms_rek5 e ON a.kd_rek5=e.kd_rek5  WHERE a.kd_kegiatan= '$giat' AND a.kd_skpd = '$kode' $notIn ";

        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['map_lo'],
                        'kd_rek' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
                        'lalu' => $resulte['lalu'],
                        'sp2d' => $resulte['sp2d'],
                        'anggaran' => $resulte['anggaran']
                        );
                        $ii++;
        }                   
       echo json_encode($result);    
       $query1->free_result();       	   
	}
    
    function out_lalu(){
         $giat = $this->input->post('giat');
         $sp2d = $this->input->post('sp2d');
         $rek  = $this->input->post('rek');
         $nomor  = $this->input->post('nomor');
         $tgl  = $this->input->post('tgl');
         $skpd  = $this->input->post('skpd');
         $jenis  = $this->input->post('jenis');
         $sql = "SELECT b.no_bukti,b.no_sp2d,b.kd_kegiatan,b.nm_kegiatan,b.kd_rek5,b.nm_rek5,
                (SELECT SUM(c.nilai) FROM trdtransout c LEFT JOIN trhtransout d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                d.kd_skpd=a.kd_skpd AND c.kd_kegiatan=b.kd_kegiatan AND c.kd_rek5=b.kd_rek5 AND c.no_bukti <> b.no_bukti AND d.tgl_bukti<=a.tgl_bukti AND d.jns_spp = a.jns_spp) AS lalu,
                (SELECT SUM(g.nilai) FROM trdspp g INNER JOIN trhspm h ON g.no_spp=h.no_spp INNER JOIN trhsp2d i ON h.no_spm=i.no_spm WHERE i.no_sp2d=b.no_sp2d) AS sp2d,
                (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek5) AS anggaran FROM trhtransout a INNER JOIN trdtransout b ON a.no_bukti=b.no_bukti
                WHERE a.kd_skpd = '$skpd' AND b.kd_kegiatan = '$giat' AND b.kd_rek5 = '$rek' AND a.tgl_bukti <> '$tgl' AND 
                b.no_sp2d = '$sp2d' AND a.no_bukti = '$nomor'";                           
         $query1 = $this->db->query($sql);        
         $row = $query1->row();
         $result[] = array('lalu' =>$row->rp);
         //$result = $row->rp;
         echo json_encode($result);
         //echo $result;
         $query1->free_result();
    }
    
     ////////////akhir transout rendy 
     function rincian_objek()
    {
        $data['page_title']= 'RINCIAN PEROBJEK';
        $this->template->set('title', 'RINCIAN PEROBJEK');   
        $this->template->load('template','tukd/transaksi/rincian_objek',$data) ; 
    }
    
	    
	function ld_giat_rinci_objek($skpd='') { 
		$skpd = $this->session->userdata('kdskpd');
        $lccr = $this->input->post('q');
        $sql = "SELECT DISTINCT kd_kegiatan,nm_kegiatan FROM trdtransout where kd_skpd='$skpd' and (upper(kd_kegiatan) like upper('%$lccr%') or upper(nm_kegiatan) like upper('%$lccr%')) order by kd_kegiatan ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan']                                         
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
     function ld_rek_rinci_objek($giat='') {
        $lccr = $this->input->post('q');
        $sql = " SELECT DISTINCT kd_rek5, nm_rek5 FROM trdtransout where kd_kegiatan='$giat' and (upper(kd_rek5) like upper('%$lccr%') or upper(nm_rek5) like upper('%$lccr%')) order by kd_rek5 ";       
       $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
    
    function cetak_rincian_objek($dcetak='',$ttd1='',$skpd='',$rek5='',$dcetak2='',$giat='',$tgl_ctk='',$ttd2='',$ctk='',$spasi=''){
           $ttd1 = str_replace('123456789',' ',$ttd1);
			$ttd2 = str_replace('123456789',' ',$ttd2);
			$sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$skpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $prov     = $rowsc->provinsi;
                    $nm_prov     = $rowsc->provinsi;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                 }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kd_skpd='$skpd' and kode='PA' and nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kd_skpd='$skpd' and kode='BK' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                }
		   if($giat<>''){
                $keg='1';
                $giat=$giat;
                $nm_giat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');
                //$nm_prov=$this->tukd_model->get_sclient('provinsi','sclient');
				}else{
                $keg='0';
                $giat='';
                $nm_giat='KESELURUHAN';
            }
            			
            //echo $dcetak .'/'. $ttd.'/'.$skpd.'/'.$rek5.'/'.$dcetak2.'/'.$giat.'/'.$keg;
		

			$cRet ='<TABLE width="100%">
					 <TR>                        
						<TD colspan="2" align="center" ><b>'.$nm_prov.'</TD>					
					 </TR>
					 <TR>                        
						<TD colspan="2" align="center" ><b>BUKU PEMBANTU RINCIAN OBJEK </TD>					
					 </TR>
					 </TABLE>
					 <TABLE style="font-size:12px" width="100%">
 					 <TR>                        
						<TD colspan="2" align="center" >&nbsp; </TD>					
					 </TR>
 					 <TR>                        
						<TD colspan="2" align="center" >&nbsp;</TD>					
					 </TR>
                     <TR>                        
						<TD align="left" width="15%" >SKPD </TD>
						<TD align="left" width="85%" >: '.$skpd.' '.$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd').'</TD>
					 </TR>
                     <TR>
						<TD align="left" width="15%" >Kegiatan</TD>
						<TD align="left" width="85%" >: '.$giat.' '.$nm_giat.'</TD>
					 </TR>
					 <TR>
						<TD align="left" width="15%" >Rekening </TD>
						<TD align="left" width="85%" >: '.$rek5.' '.$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek5').'</TD>
					 </TR>
					 <TR>
						<TD align="left" width="15%" >Periode</TD>
						<TD align="left" width="85%" >: '.$this->tukd_model->tanggal_format_indonesia($dcetak).' s/d '.$this->tukd_model->tanggal_format_indonesia($dcetak2).'</TD>
					 </TR>
                     <TR>                        
						<TD colspan="2" align="center" >&nbsp;</TD>					
					 </TR>
					 </TABLE>';

			$cRet .='<TABLE style="border-collapse:collapse;font-size:12px" border="1" cellspacing="0" cellpadding="'.$spasi.'" width="100%" >
					<THEAD>
					 <TR>
						<TD width="40%" rowspan="2" colspan="2"  align="center" ><b>Nomor dan Tanggal BKU</b></TD>
						<TD width="60%" colspan="4"  align="center" ><b>Pengeluaran (Rp)</b></TD>					
					 </TR>
                     <TR>
 		                <TD width="15%" align="center"><b>LS</b></TD>
                        <TD width="15%"  align="center"><b>UP/GU</b></TD>
                        <TD width="15%"  align="center"><b>TU</b></TD>
                        <TD width="15%"  align="center"><b>JUMLAH</b></TD>
                     </TR>
					 </THEAD>';    
                   
                    $query = $this->db->query("SELECT ISNULL(a.no_bukti,'') as no_bukti
												,b.tgl_bukti
												,ISNULL(a.no_sp2d,'') as no_sp2d
												,SUM(CASE WHEN jns_spp IN ('1','2') THEN a.nilai ELSE 0 END) AS up
												,SUM(CASE WHEN jns_spp IN ('3') THEN a.nilai ELSE 0 END) AS gu
												,SUM(CASE WHEN jns_spp IN ('4','5','6') THEN a.nilai ELSE 0 END) AS ls
												FROM trdtransout a 
												LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti AND a.kd_skpd = b.kd_skpd
												WHERE a.kd_kegiatan='$giat' 
												and a.kd_rek5='$rek5' 
												AND b.kd_skpd='$skpd' 
												and b.tgl_bukti>='$dcetak' 
												and b.tgl_bukti<='$dcetak2' 
												GROUP BY a.no_bukti, b.tgl_bukti,a.no_sp2d
												ORDER BY b.tgl_bukti,a.no_bukti
												");
				$i=0;
				$jumls=0;
				$jumup=0;
				$jumgu=0;
   	            $jml=0;  
				foreach($query->result_array() as $res){					
        							$cetak[1] = empty($res['no_bukti']) || $res['no_bukti']== null ?'&nbsp;' :$res['no_bukti'];
        							$cetak[2] = empty($res['no_sp2d']) || $res['no_sp2d']== null ?'&nbsp;' :$res['no_sp2d'];
        							$cetak[3] = empty($res['ls']) || $res['ls'] == null ?'&nbsp;' :$res['ls'];
        							$cetak[4] = empty($res['up']) || $res['up'] == null ?0 :$res['up'];
        							$cetak[5] = empty($res['gu']) || $res['gu'] == null ?0 :$res['gu'];
        							$cetak[6] = empty($res['tgl_bukti']) || $res['tgl_bukti'] == null ?0 :$res['tgl_bukti'];
                        $cRet .='<tr>
    								<td style="border-bottom:hidden;border-right:hidden;" align="left" ><b>&nbsp;'.$cetak[1].'</b> </td>
    								<td style="border-bottom:hidden;border-left:hidden;" align="right" >'.$this->tukd_model->tanggal_format_indonesia($cetak[6]).'&nbsp;</td>
									<td rowspan="2" align="right" >'.number_format($cetak[3],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[4],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[5],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[3]+$cetak[4]+$cetak[5],"2",",",".").'</td></tr>
								 <tr>
									<td colspan="2" align="left" ><i>&nbsp;SP2D: '.$cetak[2].'</i> </td>
    								
    							 </tr>';
                                     
                $jumls=$jumls+$cetak[3];
				$jumup=$jumup+$cetak[4];
				$jumgu=$jumgu+$cetak[5];
                $jml=$jml+$cetak[3]+$cetak[4]+$cetak[5];        
						
						
				}  
               
               
				$cRet .='<TR>				
					<TD colspan="2" align="left" ><i><b>Jumlah</i></b></TD>
					<TD align="right" ><b>'.number_format($jumls,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jumup,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jumgu,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jml,"2",",",".").'</b></TD>					
				 </TR>';
				 
                $query = $this->db->query("SELECT SUM(CASE WHEN jns_spp IN ('1','2') THEN a.nilai ELSE 0 END) AS lalu_up
												,SUM(CASE WHEN jns_spp IN ('3') THEN a.nilai ELSE 0 END) AS lalu_gu
												,SUM(CASE WHEN jns_spp IN ('4','5','6') THEN a.nilai ELSE 0 END) AS lalu_ls
												FROM trdtransout a 
												LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti AND a.kd_skpd = b.kd_skpd
												WHERE a.kd_kegiatan='$giat' 
												and a.kd_rek5='$rek5' 
												AND b.kd_skpd='$skpd' 
												and b.tgl_bukti<'$dcetak' 
												");
                foreach($query->result_array() as $res){										
					$lalu_up=$res['lalu_up'];
					$lalu_gu=$res['lalu_gu'];
					$lalu_ls=$res['lalu_ls'];
				}
                $jml_lalu=$lalu_up+$lalu_gu+$lalu_ls;
                $tot=$jumup+$lalu_up;
                $tot1=$jumgu+$lalu_gu;
                $tot2=$jumls+$lalu_ls;
                $total=$tot+$tot1+$tot2;			 					
                $cRet .='<TR>				
					<TD colspan="2" align="left" ><i><b>Jumlah s/d periode lalu </i></b></TD>
					<TD align="right" ><b>'.number_format($lalu_ls,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($lalu_up,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($lalu_gu,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jml_lalu,"2",",",".").'</b></TD>					
				 </TR>';
                 $cRet .='<TR>				
					<TD colspan="2" align="left" ><b><i>Jumlah s/d periode ini<i></b></TD>
					<TD align="right" ><b>'.number_format($tot2,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($tot,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($tot1,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($total,"2",",",".").'</b></TD>					
				 </TR>';
			$cRet .='</TABLE>';
			$cRet .='<TABLE style="font-size:12px" width="100%" border="0">
					<TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">Mengetahui,</TD>
						<TD align="center" width="50%">'.$daerah.', '.$this->tukd_model->tanggal_format_indonesia($tgl_ctk).'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">'.$jabatan.'</TD>
						<TD align="center" width="50%">'.$jabatan1.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><u><b>'.$nama.'</b></u><br>'.$pangkat.'</TD>
						<TD align="center" width="50%"><u><b>'.$nama1.'</b></u><br>'.$pangkat1.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">NIP. '.$nip.'</TD>
						<TD align="center" width="50%">NIP. '.$nip1.'</TD>
					</TR>
					</TABLE><br/>';
			$data['prev']= 'RINCIAN OBJEK';
            switch ($ctk) {
				case 0;
					echo ("<title> BP RINCIAN OBJEK</title>");
					echo $cRet;
					break;
				case 1;
					$this->_mpdf_margin('',$cRet,10,10,10,'L',0,'',15,15,15,15);
					break;
			}
	} 
    
	
	    function cetak_rincian_objek_kegiatan($dcetak='',$ttd1='',$skpd='',$dcetak2='',$giat='',$tgl_ctk='',$ttd2='',$ctk='',$spasi=''){
            //$this->load->library('mpdf');
			//$this->mpdf = new mPDF('utf-8', array(215,330),12); //folio


		   $ttd1 = str_replace('123456789',' ',$ttd1);
			$ttd2 = str_replace('123456789',' ',$ttd2);
			$sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$skpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $prov     = $rowsc->provinsi;
                    $nm_prov     = $rowsc->provinsi;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                 }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kd_skpd='$skpd' and kode='PA' and nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kd_skpd='$skpd' and kode='BK' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                }
		$cRet ='<TABLE style="font-size:16px" width="100%" border="0">
					<TR>
						<TD align="center" width="100%"><BR><BR><BR><b>CETAK BUKU RINCIAN OBJEK<BR>
						KEGIATAN '.strtoupper($this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan')).'<BR>
						'.strtoupper($this->tukd_model->tanggal_format_indonesia($dcetak)).' s/d '.strtoupper($this->tukd_model->tanggal_format_indonesia($dcetak2)).'</TD>
					</TR>
				</TABLE>';
		
		$sqlww= $this->db->query("SELECT b.kd_rek5 FROM trhtransout a LEFT JOIN trdtransout b ON a.no_bukti=b.no_bukti
			AND a.kd_skpd = b.kd_skpd
			WHERE a.tgl_bukti<='$dcetak2' 
			AND a.kd_skpd='$skpd' 
			AND b.kd_kegiatan='$giat' 
			GROUP BY b.kd_rek5 ORDER BY b.kd_rek5");
 foreach ($sqlww->result() as $row){
 $rek5=$row->kd_rek5;
			$nm_giat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');		
                $nm_giat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');
                //$nm_prov=$this->tukd_model->get_sclient('provinsi','sclient');
				
            
            //echo $rek5;

		$cRet .='		
		<pagebreak type="NEXT-ODD" resetpagenum="1" pagenumstyle="1" suppress="off" />
		<TABLE width="100%">
					 <TR>                        
						<TD colspan="2" align="center" ><b>'.$nm_prov.'</TD>					
					 </TR>
					 <TR>                        
						<TD colspan="2" align="center" ><b>BUKU PEMBANTU RINCIAN OBJEK </TD>					
					 </TR>
					 </TABLE>
					 <TABLE style="font-size:12px" width="100%">
 					 <TR>                        
						<TD colspan="2" align="center" >&nbsp; </TD>					
					 </TR>
 					 <TR>                        
						<TD colspan="2" align="center" >&nbsp;</TD>					
					 </TR>
                     <TR>                        
						<TD align="left" width="15%" >SKPD </TD>
						<TD align="left" width="85%" >: '.$skpd.' '.$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd').'</TD>
					 </TR>
                     <TR>
						<TD align="left" width="15%" >Kegiatan</TD>
						<TD align="left" width="85%" >: '.$giat.' '.$nm_giat.'</TD>
					 </TR>
					 <TR>
						<TD align="left" width="15%" >Rekening </TD>
						<TD align="left" width="85%" >: '.$rek5.' '.$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek5').'</TD>
					 </TR>
					 <TR>
						<TD align="left" width="15%" >Periode</TD>
						<TD align="left" width="85%" >: '.$this->tukd_model->tanggal_format_indonesia($dcetak).' s/d '.$this->tukd_model->tanggal_format_indonesia($dcetak2).'</TD>
					 </TR>
                     <TR>                        
						<TD colspan="2" align="center" >&nbsp;</TD>					
					 </TR>
					 </TABLE>';
			$cRet .='<TABLE style="border-collapse:collapse;font-size:12px" border="1" cellspacing="0" cellpadding="'.$spasi.'" width="100%" >
					<THEAD>
					 <TR>
						<TD width="40%" rowspan="2" colspan="2"  align="center" ><b>Nomor dan Tanggal BKU</b></TD>
						<TD width="60%" colspan="4"  align="center" ><b>Pengeluaran (Rp)</b></TD>					
					 </TR>
                     <TR>
 		                <TD width="15%" align="center"><b>LS</b></TD>
                        <TD width="15%"  align="center"><b>UP/GU</b></TD>
                        <TD width="15%"  align="center"><b>TU</b></TD>
                        <TD width="15%"  align="center"><b>JUMLAH</b></TD>
                     </TR>
					 </THEAD>';    
                   
                    $query = $this->db->query("SELECT ISNULL(a.no_bukti,'') as no_bukti
												,b.tgl_bukti
												,ISNULL(a.no_sp2d,'') as no_sp2d
												,SUM(CASE WHEN jns_spp IN ('1','2') THEN a.nilai ELSE 0 END) AS up
												,SUM(CASE WHEN jns_spp IN ('3') THEN a.nilai ELSE 0 END) AS gu
												,SUM(CASE WHEN jns_spp IN ('4','5','6') THEN a.nilai ELSE 0 END) AS ls
												FROM trdtransout a 
												LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti AND a.kd_skpd = b.kd_skpd
												WHERE a.kd_kegiatan='$giat' 
												and a.kd_rek5='$rek5' 
												AND b.kd_skpd='$skpd' 
												and b.tgl_bukti>='$dcetak' 
												and b.tgl_bukti<='$dcetak2' 
												GROUP BY a.no_bukti, b.tgl_bukti,a.no_sp2d
												ORDER BY b.tgl_bukti,a.no_bukti
												");
				$i=0;
				$jumls=0;
				$jumup=0;
				$jumgu=0;
   	            $jml=0;  
				foreach($query->result_array() as $res){					
        							$cetak[1] = empty($res['no_bukti']) || $res['no_bukti']== null ?'&nbsp;' :$res['no_bukti'];
        							$cetak[2] = empty($res['no_sp2d']) || $res['no_sp2d']== null ?'&nbsp;' :$res['no_sp2d'];
        							$cetak[3] = empty($res['ls']) || $res['ls'] == null ?'&nbsp;' :$res['ls'];
        							$cetak[4] = empty($res['up']) || $res['up'] == null ?0 :$res['up'];
        							$cetak[5] = empty($res['gu']) || $res['gu'] == null ?0 :$res['gu'];
        							$cetak[6] = empty($res['tgl_bukti']) || $res['tgl_bukti'] == null ?0 :$res['tgl_bukti'];
                        $cRet .='<tr>
    								<td style="border-bottom:hidden;border-right:hidden;" align="left" ><b>&nbsp;'.$cetak[1].'</b> </td>
    								<td style="border-bottom:hidden;border-left:hidden;" align="right" >'.$this->tukd_model->tanggal_format_indonesia($cetak[6]).'&nbsp;</td>
									<td rowspan="2" align="right" >'.number_format($cetak[3],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[4],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[5],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[3]+$cetak[4]+$cetak[5],"2",",",".").'</td></tr>
								 <tr>
									<td colspan="2" align="left" ><i>&nbsp;SP2D: '.$cetak[2].'</i> </td>
    								
    							 </tr>';
                                     
                $jumls=$jumls+$cetak[3];
				$jumup=$jumup+$cetak[4];
				$jumgu=$jumgu+$cetak[5];
                $jml=$jml+$cetak[3]+$cetak[4]+$cetak[5];        
						
						
				}  
               
               
				$cRet .='<TR>				
					<TD colspan="2" align="left" ><i><b>Jumlah</i></b></TD>
					<TD align="right" ><b>'.number_format($jumls,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jumup,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jumgu,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jml,"2",",",".").'</b></TD>					
				 </TR>';
				 
                $query = $this->db->query("SELECT SUM(CASE WHEN jns_spp IN ('1','2') THEN a.nilai ELSE 0 END) AS lalu_up
												,SUM(CASE WHEN jns_spp IN ('3') THEN a.nilai ELSE 0 END) AS lalu_gu
												,SUM(CASE WHEN jns_spp IN ('4','5','6') THEN a.nilai ELSE 0 END) AS lalu_ls
												FROM trdtransout a 
												LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti AND a.kd_skpd = b.kd_skpd
												WHERE a.kd_kegiatan='$giat' 
												and a.kd_rek5='$rek5' 
												AND b.kd_skpd='$skpd' 
												and b.tgl_bukti<'$dcetak' 
												");
                foreach($query->result_array() as $res){										
					$lalu_up=$res['lalu_up'];
					$lalu_gu=$res['lalu_gu'];
					$lalu_ls=$res['lalu_ls'];
				}
                $jml_lalu=$lalu_up+$lalu_gu+$lalu_ls;
                $tot=$jumup+$lalu_up;
                $tot1=$jumgu+$lalu_gu;
                $tot2=$jumls+$lalu_ls;
                $total=$tot+$tot1+$tot2;			 					
                $cRet .='<TR>				
					<TD colspan="2" align="left" ><i><b>Jumlah s/d periode lalu </i></b></TD>
					<TD align="right" ><b>'.number_format($lalu_ls,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($lalu_up,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($lalu_gu,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jml_lalu,"2",",",".").'</b></TD>					
				 </TR>';
                 $cRet .='<TR>				
					<TD colspan="2" align="left" ><b><i>Jumlah s/d periode ini<i></b></TD>
					<TD align="right" ><b>'.number_format($tot2,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($tot,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($tot1,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($total,"2",",",".").'</b></TD>					
				 </TR>';
			$cRet .='</TABLE>';
			$cRet .='<TABLE style="font-size:12px" width="100%" border="0">
					<TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">Mengetahui,</TD>
						<TD align="center" width="50%">'.$daerah.', '.$this->tukd_model->tanggal_format_indonesia($tgl_ctk).'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">'.$jabatan.'</TD>
						<TD align="center" width="50%">'.$jabatan1.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><u><b>'.$nama.'</b></u><br>'.$pangkat.'</TD>
						<TD align="center" width="50%"><u><b>'.$nama1.'</b></u><br>'.$pangkat1.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">NIP. '.$nip.'</TD>
						<TD align="center" width="50%">NIP. '.$nip1.'</TD>
					</TR>
					</TABLE></pagebreak>';
		//tambahkan bila tak ingin menggunakan mpdf
        //$this->mpdf->AddPage('P','',1,'1','off');
        //$this->mpdf->writeHTML($cRet);         
			
			}

			$data['prev']= 'RINCIAN OBJEK';
		//tambahkan bila tak ingin mpdf
        //$this->mpdf->Output();
            switch ($ctk) {
				case 0;
					echo ("<title> BP RINCIAN OBJEK</title>");
					echo $cRet;
					break;
				case 1;
					//$this->_mpdf('',$cRet,10,10,10,'0',0,'');
					$this->_mpdf('',$cRet,10,10,10,'L',1,'');
					break;
			}
	}
	
	
	function cetak_rincian_objek_all($dcetak='',$ttd1='',$skpd='',$dcetak2='',$tgl_ctk='',$ttd2='',$ctk='',$spasi=''){
            //$this->load->library('mpdf');
			//$this->mpdf = new mPDF('utf-8', array(215,330),12); //folio


		   $ttd1 = str_replace('123456789',' ',$ttd1);
			$ttd2 = str_replace('123456789',' ',$ttd2);
			$sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$skpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $prov     = $rowsc->provinsi;
                    $nm_prov     = $rowsc->provinsi;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                 }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kd_skpd='$skpd' and kode='PA' and nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kd_skpd='$skpd' and kode='BK' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                }
		$cRet ='<TABLE style="font-size:16px" width="100%" border="0">
					<TR>
						<TD align="center" width="100%"><BR><BR><BR><b>CETAK BUKU RINCIAN OBJEK<BR>
						'.strtoupper($this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd')).'<BR>
						'.strtoupper($this->tukd_model->tanggal_format_indonesia($dcetak)).' s/d '.strtoupper($this->tukd_model->tanggal_format_indonesia($dcetak2)).'</TD>
					</TR>
				</TABLE>';
		
		$sqlww= $this->db->query("SELECT b.kd_kegiatan,b.kd_rek5 FROM trhtransout a LEFT JOIN trdtransout b ON a.no_bukti=b.no_bukti
			AND a.kd_skpd = b.kd_skpd
			WHERE a.tgl_bukti<='$dcetak2' 
			AND a.kd_skpd='$skpd' 
			GROUP BY b.kd_kegiatan,b.kd_rek5 ORDER BY b.kd_kegiatan,b.kd_rek5");
		foreach ($sqlww->result() as $row){
			$giat=$row->kd_kegiatan;
			$rek5=$row->kd_rek5;
			$nm_giat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');		
			$nm_giat=$this->tukd_model->get_nama($giat,'nm_kegiatan','trskpd','kd_kegiatan');
			//$nm_prov=$this->tukd_model->get_sclient('provinsi','sclient');
			
            
            //echo $rek5;

		$cRet .='		
		<pagebreak type="NEXT-ODD" resetpagenum="1" pagenumstyle="1" suppress="off" />
		<TABLE width="100%">
					 <TR>                        
						<TD colspan="2" align="center" ><b>'.$nm_prov.'</TD>					
					 </TR>
					 <TR>                        
						<TD colspan="2" align="center" ><b>BUKU PEMBANTU RINCIAN OBJEK </TD>					
					 </TR>
					 </TABLE>
					 <TABLE style="font-size:12px" width="100%">
 					 <TR>                        
						<TD colspan="2" align="center" >&nbsp; </TD>					
					 </TR>
 					 <TR>                        
						<TD colspan="2" align="center" >&nbsp;</TD>					
					 </TR>
                     <TR>                        
						<TD align="left" width="15%" >SKPD </TD>
						<TD align="left" width="85%" >: '.$skpd.' '.$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd').'</TD>
					 </TR>
                     <TR>
						<TD align="left" width="15%" >Kegiatan</TD>
						<TD align="left" width="85%" >: '.$giat.' '.$nm_giat.'</TD>
					 </TR>
					 <TR>
						<TD align="left" width="15%" >Rekening </TD>
						<TD align="left" width="85%" >: '.$rek5.' '.$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek5').'</TD>
					 </TR>
					 <TR>
						<TD align="left" width="15%" >Periode</TD>
						<TD align="left" width="85%" >: '.$this->tukd_model->tanggal_format_indonesia($dcetak).' s/d '.$this->tukd_model->tanggal_format_indonesia($dcetak2).'</TD>
					 </TR>
                     <TR>                        
						<TD colspan="2" align="center" >&nbsp;</TD>					
					 </TR>
					 </TABLE>';
			$cRet .='<TABLE style="border-collapse:collapse;font-size:12px" border="1" cellspacing="0" cellpadding="'.$spasi.'" width="100%" >
					<THEAD>
					 <TR>
						<TD width="40%" rowspan="2" colspan="2"  align="center" ><b>Nomor dan Tanggal BKU</b></TD>
						<TD width="60%" colspan="4"  align="center" ><b>Pengeluaran (Rp)</b></TD>					
					 </TR>
                     <TR>
 		                <TD width="15%" align="center"><b>LS</b></TD>
                        <TD width="15%"  align="center"><b>UP/GU</b></TD>
                        <TD width="15%"  align="center"><b>TU</b></TD>
                        <TD width="15%"  align="center"><b>JUMLAH</b></TD>
                     </TR>
					 </THEAD>';    
                   
                    $query = $this->db->query("SELECT ISNULL(a.no_bukti,'') as no_bukti
												,b.tgl_bukti
												,ISNULL(a.no_sp2d,'') as no_sp2d
												,SUM(CASE WHEN jns_spp IN ('1','2') THEN a.nilai ELSE 0 END) AS up
												,SUM(CASE WHEN jns_spp IN ('3') THEN a.nilai ELSE 0 END) AS gu
												,SUM(CASE WHEN jns_spp IN ('4','5','6') THEN a.nilai ELSE 0 END) AS ls
												FROM trdtransout a 
												LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti AND a.kd_skpd = b.kd_skpd
												WHERE a.kd_kegiatan='$giat' 
												and a.kd_rek5='$rek5' 
												AND b.kd_skpd='$skpd' 
												and b.tgl_bukti>='$dcetak' 
												and b.tgl_bukti<='$dcetak2' 
												GROUP BY a.no_bukti, b.tgl_bukti,a.no_sp2d
												ORDER BY b.tgl_bukti,a.no_bukti
												");
				$i=0;
				$jumls=0;
				$jumup=0;
				$jumgu=0;
   	            $jml=0;  
				foreach($query->result_array() as $res){					
        							$cetak[1] = empty($res['no_bukti']) || $res['no_bukti']== null ?'&nbsp;' :$res['no_bukti'];
        							$cetak[2] = empty($res['no_sp2d']) || $res['no_sp2d']== null ?'&nbsp;' :$res['no_sp2d'];
        							$cetak[3] = empty($res['ls']) || $res['ls'] == null ?'&nbsp;' :$res['ls'];
        							$cetak[4] = empty($res['up']) || $res['up'] == null ?0 :$res['up'];
        							$cetak[5] = empty($res['gu']) || $res['gu'] == null ?0 :$res['gu'];
        							$cetak[6] = empty($res['tgl_bukti']) || $res['tgl_bukti'] == null ?0 :$res['tgl_bukti'];
                        $cRet .='<tr>
    								<td style="border-bottom:hidden;border-right:hidden;" align="left" ><b>&nbsp;'.$cetak[1].'</b> </td>
    								<td style="border-bottom:hidden;border-left:hidden;" align="right" >'.$this->tukd_model->tanggal_format_indonesia($cetak[6]).'&nbsp;</td>
									<td rowspan="2" align="right" >'.number_format($cetak[3],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[4],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[5],"2",",",".").'</td>
    								<td rowspan="2" align="right" >'.number_format($cetak[3]+$cetak[4]+$cetak[5],"2",",",".").'</td></tr>
								 <tr>
									<td colspan="2" align="left" ><i>&nbsp;SP2D: '.$cetak[2].'</i> </td>
    								
    							 </tr>';
                                     
                $jumls=$jumls+$cetak[3];
				$jumup=$jumup+$cetak[4];
				$jumgu=$jumgu+$cetak[5];
                $jml=$jml+$cetak[3]+$cetak[4]+$cetak[5];        
						
						
				}  
               
               
				$cRet .='<TR>				
					<TD colspan="2" align="left" ><i><b>Jumlah</i></b></TD>
					<TD align="right" ><b>'.number_format($jumls,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jumup,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jumgu,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jml,"2",",",".").'</b></TD>					
				 </TR>';
				 
                $query = $this->db->query("SELECT SUM(CASE WHEN jns_spp IN ('1','2') THEN a.nilai ELSE 0 END) AS lalu_up
												,SUM(CASE WHEN jns_spp IN ('3') THEN a.nilai ELSE 0 END) AS lalu_gu
												,SUM(CASE WHEN jns_spp IN ('4','5','6') THEN a.nilai ELSE 0 END) AS lalu_ls
												FROM trdtransout a 
												LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti AND a.kd_skpd = b.kd_skpd
												WHERE a.kd_kegiatan='$giat' 
												and a.kd_rek5='$rek5' 
												AND b.kd_skpd='$skpd' 
												and b.tgl_bukti<'$dcetak' 
												");
                foreach($query->result_array() as $res){										
					$lalu_up=$res['lalu_up'];
					$lalu_gu=$res['lalu_gu'];
					$lalu_ls=$res['lalu_ls'];
				}
                $jml_lalu=$lalu_up+$lalu_gu+$lalu_ls;
                $tot=$jumup+$lalu_up;
                $tot1=$jumgu+$lalu_gu;
                $tot2=$jumls+$lalu_ls;
                $total=$tot+$tot1+$tot2;			 					
                $cRet .='<TR>				
					<TD colspan="2" align="left" ><i><b>Jumlah s/d periode lalu </i></b></TD>
					<TD align="right" ><b>'.number_format($lalu_ls,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($lalu_up,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($lalu_gu,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($jml_lalu,"2",",",".").'</b></TD>					
				 </TR>';
                 $cRet .='<TR>				
					<TD colspan="2" align="left" ><b><i>Jumlah s/d periode ini<i></b></TD>
					<TD align="right" ><b>'.number_format($tot2,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($tot,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($tot1,"2",",",".").'</b></TD>
					<TD align="right" ><b>'.number_format($total,"2",",",".").'</b></TD>					
				 </TR>';
			$cRet .='</TABLE>';
			$cRet .='<TABLE style="font-size:12px" width="100%" border="0">
					<TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">Mengetahui,</TD>
						<TD align="center" width="50%">'.$daerah.', '.$this->tukd_model->tanggal_format_indonesia($tgl_ctk).'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">'.$jabatan.'</TD>
						<TD align="center" width="50%">'.$jabatan1.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%"><u><b>'.$nama.'</b></u><br>'.$pangkat.'</TD>
						<TD align="center" width="50%"><u><b>'.$nama1.'</b></u><br>'.$pangkat1.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">NIP. '.$nip.'</TD>
						<TD align="center" width="50%">NIP. '.$nip1.'</TD>
					</TR>
					</TABLE></pagebreak>';
		//tambahkan bila tak ingin menggunakan mpdf
        //$this->mpdf->AddPage('P','',1,'1','off');
        //$this->mpdf->writeHTML($cRet);         
			
			}

			$data['prev']= 'RINCIAN OBJEK';
		//tambahkan bila tak ingin mpdf
        //$this->mpdf->Output();
            switch ($ctk) {
				case 0;
					echo ("<title> BP RINCIAN OBJEK</title>");
					echo $cRet;
					break;
				case 1;
					//$this->_mpdf('',$cRet,10,10,10,'0',0,'');
					$this->_mpdf('',$cRet,10,10,10,'L',1,'');
					break;
			}
	}
	
	
	
	
	function kas_bulan()
    {
        $data['page_title']= 'LAPORAN AKHIR KAS ';
        $this->template->set('title', 'LAPORAN AKHIR KAS');   
        $this->template->load('template','tukd/transaksi/kas_akhir',$data) ; 
    }
    
    function cetak_kas_akhir($lcskpd='',$nbulan='',$ctk=''){
        $nomor = str_replace('123456789',' ',$this->uri->segment(6));
		$nip2 = str_replace('123456789',' ',$this->uri->segment(7));
		$tanggal_ttd = $this->tukd_model->tanggal_format_indonesia($this->uri->segment(8));
        $skpd = $this->tukd_model->get_nama($lcskpd,'nm_skpd','ms_skpd','kd_skpd');
 		$this->db->query("exec recall '$lcskpd'");
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$lcskpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $prov     = $rowsc->provinsi;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                 }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip='$nip2' AND kd_skpd='$lcskpd' AND kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip = '$nomor' AND kd_skpd='$lcskpd' AND kode='BK'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                }
		
			$cRet ='<TABLE style="border-collapse:collapse;font-size:12px" width="100%" border="0" cellspacing="0" cellpadding="1" align=center>
					<TR>
						<TD align="center" ><b>'.$prov.' </TD>
					</TR>
					<tr></tr>
                    <TR>
						<TD align="center" ><b>LAPORAN PENUTUPAN KAS BULANAN <br> BULAN '.strtoupper($this->tukd_model->getBulan($nbulan)).' TAHUN '.strtoupper($thn).'</TD>
					</TR>
					</TABLE><br/>';
					
			$csql3 = "SELECT SUM(z.terima) AS jmter,SUM(z.keluar) AS jm_kel , SUM(z.terima)-SUM(z.keluar) AS sel FROM (SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,
             '' AS rekening,uraian,0 AS terima,0 AS keluar , 0 AS st,jns_trans FROM trhrekal
             UNION ALL
             SELECT a.kd_skpd,a.tgl_kas,'' AS tanggal,b.no_kas,b.kd_rek5 AS rekening,
             b.nm_rek5 AS uraian, b.terima,b.keluar , case when b.terima<>0 then'1' else '2' end AS st, b.jns_trans FROM
             trdrekal b INNER JOIN trhrekal a ON a.no_kas = b.no_kas and a.kd_skpd = b.kd_skpd)z WHERE
             month(z.tgl_kas) < '$nbulan' and year(z.tgl_kas) = $thn AND z.kd_skpd = '$lcskpd'";
             $tox_awal="SELECT isnull(sld_awal,0) AS jumlah FROM ms_skpd where kd_skpd='$lcskpd'";
             $hasil = $this->db->query($tox_awal);
             $tox = $hasil->row('jumlah');
             $hasil = $this->db->query($csql3);
			 $trh4 = $hasil->row(); 
			 $saldoawal = $trh4->sel;
			 $saldoawal=$saldoawal+$tox;
			 
			 
			 $csql4 = "SELECT SUM(z.terima) AS jmter,SUM(z.keluar) AS jm_kel  FROM (SELECT a.kd_skpd,a.tgl_kas,'' AS tanggal,b.no_kas,b.kd_rek5 AS rekening,
             b.nm_rek5 AS uraian, b.terima,b.keluar , case when b.terima<>0 then'1' else '2' end AS st, b.jns_trans FROM
             trdrekal b INNER JOIN trhrekal a ON a.no_kas = b.no_kas and a.kd_skpd = b.kd_skpd)z WHERE
             month(z.tgl_kas) = '$nbulan' and year(z.tgl_kas) = $thn AND z.kd_skpd = '$lcskpd'";
             $hasil4 = $this->db->query($csql4);
			 $trh5 = $hasil4->row(); 
			 $terima1 = $trh5->jmter;
			 $keluar1 = $trh5->jm_kel;
			 $saldo_akhir = $saldoawal+$terima1-$keluar1;

			 
			 $esteh="SELECT 
				SUM(case when jns=1 then jumlah else 0 end ) AS terima,
				SUM(case when jns=2 then jumlah else 0 end) AS keluar
				FROM (
				SELECT tgl_kas AS tgl,no_kas AS bku,keterangan AS ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM tr_ambilsimpanan UNION ALL
				select tgl_kas as tgl,no_kas as bku,keterangan as ket, nilai as jumlah, '1' as jns,kd_skpd as kode from tr_jpanjar where jns=2 UNION ALL
				select tgl_panjar as tgl,no_panjar as bku,keterangan as ket, nilai as jumlah, '2' as jns,kd_skpd as kode from tr_panjar UNION ALL
				select a.tgl_sts as tgl,a.no_sts as bku, a.keterangan as ket, SUM(b.rupiah) as jumlah, '2' as jns, a.kd_skpd as kode 
					from trhkasin_pkd a INNER JOIN trdkasin_pkd b ON a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd 
					where jns_trans<>4 and pot_khusus =0  
					GROUP BY a.tgl_sts,a.no_sts, a.keterangan,a.kd_skpd				
				UNION ALL
				SELECT	a.tgl_bukti AS tgl,	a.no_bukti AS bku, a.ket AS ket, SUM(z.nilai) - isnull(pot, 0) AS jumlah, '2' AS jns, a.kd_skpd AS kode
					FROM trhtransout a INNER JOIN trdtransout z ON a.no_bukti=z.no_bukti AND a.kd_skpd=z.kd_skpd
					LEFT JOIN trhsp2d b ON z.no_sp2d = b.no_sp2d
					LEFT JOIN (SELECT no_spm, SUM (nilai) pot	FROM trspmpot GROUP BY no_spm) c ON b.no_spm = c.no_spm WHERE pay = 'TUNAI' AND panjar <> 1
					GROUP BY a.tgl_bukti,a.no_bukti,a.ket,a.no_sp2d,z.no_sp2d,a.total,pot,a.kd_skpd
				UNION ALL
				SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM trhoutlain  WHERE pay='TUNAI' UNION ALL
				SELECT tgl_kas AS tgl,no_kas AS bku,keterangan AS ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM tr_setorsimpanan WHERE jenis ='2' UNION ALL
				SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM trhINlain WHERE pay='TUNAI'
				) a 
				where month(a.tgl)<='$nbulan' and kode='$lcskpd'";
				 $hasil = $this->db->query($esteh);
				 $okok = $hasil->row();  
				 $tox_awal="SELECT isnull(sld_awal,0) AS jumlah FROM ms_skpd where kd_skpd='$lcskpd'";
				 $hasil = $this->db->query($tox_awal);					 
				 $tox = $hasil->row('jumlah');
				 $terima = $okok->terima;
				 $keluar = $okok->keluar;					 
				 $saldotunai=($terima+$tox)-$keluar;
				 
			 $asql="select
				SUM(case when jns=1 then jumlah else 0 end) AS terima,
				SUM(case when jns=2 then jumlah else 0 end) AS keluar
				from (
				SELECT tgl_kas AS tgl,no_kas AS bku,keterangan as ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM tr_setorsimpanan UNION ALL
				SELECT tgl_bukti AS tgl,no_bukti AS bku,ket as ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM trhINlain WHERE pay='BANK' UNION ALL
				SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,total-isnull(pot,0) AS jumlah,'2' AS jns,a.kd_skpd AS kode FROM trhtransout a join trhsp2d b on a.no_sp2d=b.no_sp2d left join (select no_spm, sum(nilai)pot from trspmpot group by no_spm) c on b.no_spm=c.no_spm WHERE pay='BANK' UNION ALL
				SELECT tgl_kas AS tgl,no_kas AS bku,keterangan AS ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM tr_ambilsimpanan UNION ALL
				SELECT tgl_bukti AS tgl,no_bukti AS bku,ket as ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM trhoutlain WHERE pay='BANK') a
				where month(tgl)<='$nbulan' and kode='$lcskpd'";
				$hasil=$this->db->query($asql);
				$bank=$hasil->row();
				$keluarbank=$bank->keluar;
				$terimabank=$bank->terima;
				$saldobank=$terimabank-$keluarbank;
				
			 $csql="select sum(nilai) as total from trhsp2d where month(tgl_terima)='$nbulan' and kd_skpd = '$lcskpd' 
					and status_terima = '1' and month(tgl_kas) > '$nbulan'";
					 $hasil_srt = $this->db->query($csql);
					 $saldoberharga = $hasil_srt->row('total');
					 
			$cRet .="<TABLE width=\"100%\" style=\"font-size:12px\">
					 <TR>
						<TD align=\"left\" width=\"20%\" >Kepada Yth. <br> 
						Di tempat</TD>
					 </TR>
					 <TR>
						<TD align=\"left\">Dengan memperhatikan Peraturan Walikota KABUPATEN SANGGAU No. 70 Tahun 2013 Tentang mekanisme pembayaran dan pertarnggungjawaban
						Penggunaan Dana Atas Beban APBD KABUPATEN SANGGAU, Bersama ini kami sampaikan Laporan Kas Bulanan yang terdapat di Bendahara Pengeluaran 
						SKPD $skpd adalah sejumlah Rp.".number_format($saldo_akhir,'2','.',',')." (".ucwords($this->tukd_model->terbilang($saldo_akhir)).") dengan rincian sebagai berikut:</TD>
					 </TR>
					 </TABLE>";
			$cRet .="<TABLE width=\"100%\" style=\"font-size:12px\">
					 <TR>
						<TD align=\"left\" width=\"5%\" >A.</TD>
						<TD align=\"left\" width=\"60%\" >Kas Bendahara Pengeluaran : </TD>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
						</TR>
					 <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >A.1   Saldo Awal </TD>
						<TD align=\"left\" width=\"5%\" >Rp.</TD>
						<TD align=\"right\" width=\"15%\" >".number_format($saldoawal,'2','.',',')."</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
					 </TR>
					 <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >A.2   Jumlah Penerimaan </TD>
						<TD align=\"left\" width=\"5%\" >Rp.</TD>
						<TD align=\"right\" width=\"15%\" >".number_format($terima1,'2','.',',')."</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
					 </TR>
					  <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >A.3   Jumlah Pengeluaran </TD>
						<TD align=\"left\" width=\"5%\" >Rp.</TD>
						<TD align=\"right\" width=\"15%\" >".number_format($keluar1,'2','.',',')."</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
					 </TR>
					  <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >A.4   Saldo Akhir Bulan </TD>
						<TD align=\"left\" width=\"5%\" >Rp.</TD>
						<TD align=\"right\" width=\"15%\" >".number_format($saldo_akhir,'2','.',',')."</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
					 </TR>
					 <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD colspan=\"4\" align=\"left\" width=\"40%\" ><br>
						Saldo Akhir Bulan Tanggal: $tanggal_ttd  Terdiri dari Saldo Kas Tunai sebesar Rp ".number_format($saldotunai,'2','.',',')." <br>
						Saldo di Bank sebesar Rp ".number_format($saldobank,'2','.',',')." dan Saldo Surat Berharga sebesar Rp ".number_format($saldoberharga,'2','.',',')." 
						<br></TD>
					 </TR>
					 </TABLE>";
					 
			$cRet .="<TABLE width=\"100%\" style=\"font-size:12px\">
			<TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >&nbsp; </TD>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
						</TR>
					 <TR>
					 <TR>
						<TD align=\"left\" width=\"5%\" >B.</TD>
						<TD align=\"left\" width=\"60%\" >Rekapitulasi Posisi Kas di Bendahara Pengeluaran : </TD>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
						</TR>
					 <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >B.1 Saldo di Kas Tunai </TD>
						<TD align=\"left\" width=\"5%\" >Rp.</TD>
						<TD align=\"right\" width=\"15%\" >".number_format($saldotunai,'2','.',',')."</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
					 </TR>
					 <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >B.2 Saldo di Bank </TD>
						<TD align=\"left\" width=\"5%\" >Rp.</TD>
						<TD align=\"right\" width=\"15%\" >".number_format($saldobank,'2','.',',')."</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
					 </TR>
					  <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >B.3 Saldo Surat Berharga</TD>
						<TD align=\"left\" width=\"5%\" >Rp.</TD>
						<TD align=\"right\" width=\"15%\" >".number_format($saldoberharga,'2','.',',')."</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
					 </TR>
					  <TR>
						<TD align=\"left\" width=\"5%\" >&nbsp;</TD>
						<TD align=\"left\" width=\"60%\" >B.4   Saldo Total </TD>
						<TD align=\"left\" width=\"5%\" >Rp.</TD>
						<TD align=\"right\" width=\"15%\" >".number_format(($saldotunai+$saldobank+$saldoberharga),'2','.',',')."</TD>
						<TD align=\"left\" width=\"15%\" >&nbsp;</TD>
					 </TR>
					 
					 </TABLE>";
			
			
			$cRet .='<TABLE width="100%" style="font-size:12px" border="0">
					<TR>
						<TD align="center" width="30%"><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" >&nbsp;</TD>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$daerah.', '.$tanggal_ttd.'</TD>
					</TR>
                    <TR>
						<TD align="center" >&nbsp;</TD>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$jabatan1.'</TD>
					</TR>
                    <TR>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" >&nbsp;</TD>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" ><u><b>'.$nama1.'<b></u><br>'.$pangkat1.'</TD>
					</TR>
                    <TR>
						<TD align="center" >&nbsp;</TD>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" >NIP. '.$nip1.'</TD>
					</TR>
					</TABLE><br/>';

			$data['prev']= 'DTH';
             switch ($ctk)
        {
            case 0;
			echo ("<title>LAPORAN KAS AKHIR BULAN</title>");
				echo $cRet;
				break;
            case 1;
               $this->tukd_model->_mpdf('', $cRet, 10, 10, 0, '0');
               break;
		}
	}
	
	
	
	function realisasi_fisik()
    {
        $data['page_title']= 'LAPORAN REALISASI FISIK ';
        $this->template->set('title', 'LAPORAN REALISASI FISIK');   
        $this->template->load('template','tukd/transaksi/realisasi_fisik',$data) ; 
    }
	
	
	function cetak_real_fisik($lcskpd='',$nbulan='',$ctk=''){
        $nomor = str_replace('123456789',' ',$this->uri->segment(6));
		$nip2 = str_replace('123456789',' ',$this->uri->segment(7));
		$tanggal_ttd = $this->tukd_model->tanggal_format_indonesia($this->uri->segment(8));
		$spasi = $this->uri->segment(9);
        $skpd = $this->tukd_model->get_nama($lcskpd,'nm_skpd','ms_skpd','kd_skpd');
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$lcskpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $prov     = $rowsc->provinsi;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                 }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat FROM ms_ttd where nip='$nip2' AND kd_skpd='$lcskpd' AND kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip = '$nomor' AND kd_skpd='$lcskpd' AND kode='BK'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                }
		
			$cRet ='<TABLE style="border-collapse:collapse;font-size:12px" width="100%" border="0" cellspacing="0" cellpadding="1" align=center>
					<TR>
						<TD align="center" ><b>'.$prov.' </TD>
					</TR>
					<tr></tr>
                    <TR>
						<TD align="center" ><b>LAPORAN REALISASI FISIK <br> Bulan '.$this->tukd_model->getBulan($nbulan).' Tahun '.$thn.'</TD>
					</TR>
					</TABLE><br/>';
					
			$cRet .="<table style=\"border-collapse:collapse; font-size:12px\" width=\"90%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$spasi\">
            <thead>
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\"><b>KODE REKENING</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\"><b>URAIAN</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\"><b>ANGARAN</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\"><b>REALISASI</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\"><b>SISA ANGGARAN</b></td>
                <td align=\"center\" bgcolor=\"#CCCCCC\"><b>%</b></td>
            </tr>
			</thead>
           ";
					$tot_nilai=0;
					$tot_realisasi=0;
				$query = $this->db->query("exec realisasi_fisik '$lcskpd',$nbulan");		
                   foreach ($query->result() as $row) {
                    $rek = $row->rek; 
                    $urut = $row->urut;                   
                    $uraian = $row->uraian;                   
                    $nilai = $row->nilai;
                    $realisasi =$row->realisasi;
                    $sisa=$row->sisa;
                    $persen = $row->persen;
					
					$nilai1  = empty($nilai) || $nilai == 0 ? number_format(0,"2",",",".") :number_format($nilai,"2",",",".");	
					$realisasi1  = empty($realisasi) || $realisasi == 0 ? number_format(0,"2",",",".") :number_format($realisasi,"2",",",".");
					$sisa1  = empty($sisa) || $sisa == 0 ? number_format(0,"2",",",".") :number_format($sisa,"2",",",".");
					$persen1  = empty($persen) || $persen == 0 ? number_format(0,"2",",",".") :number_format($persen,"2",",",".");
			if(strlen($rek)==21){
			$cRet .="
				<tr>
                <td align=\"left\" ><b>$urut</b></td>
                <td align=\"left\" ><b>$uraian</b></td>
                <td align=\"right\" ><b>$nilai1</b></td>
                <td align=\"right\" ><b>$realisasi1</b></td>
                <td align=\"right\" ><b>$sisa1</b></td>
                <td align=\"right\" ><b>$persen1</b></td>
				</tr>
				";
				$tot_nilai=$tot_nilai+$nilai;
				$tot_realisasi=$tot_realisasi+$realisasi;
			} else {
				$cRet .="
				<tr>
                <td align=\"left\" >$urut</td>
                <td align=\"left\" >$uraian</td>
                <td align=\"right\" >$nilai1</td>
                <td align=\"right\" >$realisasi1</td>
                <td align=\"right\" >$sisa1</td>
                <td align=\"right\" >$persen1</td>
				</tr>
				";
			}		
            }
			$cRet .="
				<tr>
                <td colspan=\"2\" align=\"center\" >Total</td>
                <td align=\"right\" >".number_format($tot_nilai,"2",",",".")."</td>
                <td align=\"right\" >".number_format($tot_realisasi,"2",",",".")."</td>
                <td align=\"right\" >".number_format($tot_nilai-$tot_realisasi,"2",",",".")."</td>
                <td align=\"right\" >".number_format(($tot_realisasi/$tot_nilai)*100,"2",",",".")."</td>
				</tr>
				";
				
			
			$cRet .="</table>";
			$cRet .='<TABLE width="100%" style="font-size:12px" border="0" cellspacing="0">
					<TR>
						<TD align="center" width="50%"><b>&nbsp;</TD>
						<TD align="center" width="50%"><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" width="50%">Mengetahui</TD>
						<TD align="center" width="30%">'.$daerah.', '.$tanggal_ttd.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="30%">'.$jabatan.'</TD>
						<TD align="center" width="30%">'.$jabatan1.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="30%"><b>&nbsp;</TD>
						<TD align="center" width="30%"><b>&nbsp;</TD>
					</TR>
					 <TR>
						<TD align="center" width="30%"><b>&nbsp;</TD>
						<TD align="center" width="30%"><b>&nbsp;</TD>
					</TR>
					 <TR>
						<TD align="center" width="30%"><b>&nbsp;</TD>
						<TD align="center" width="30%"><b>&nbsp;</TD>
					</TR>
					
                    <TR>
						<TD align="center" width="30%"><u><b>'.$nama.' </b><br></u> '.$pangkat.'</TD>
						<TD align="center" width="30%"><u><b>'.$nama1.' </b><br></u> '.$pangkat1.'</TD>
					</TR>
                    <TR>
						<TD align="center" width="30%">NIP. '.$nip.'</TD>
						<TD align="center" width="30%">NIP. '.$nip1.'</TD>
					</TR>
					</TABLE><br/>';

			$data['prev']= 'DTH';
             switch ($ctk)
        {
            case 0;
			echo ("<title>LAPORAN REALISASI FISIK</title>");
				echo $cRet;
				break;
            case 1;
				$this->_mpdf('',$cRet,10,10,10,'L',0,'');
               break;
		}
	}
	
	
	
	
	
	
	
   
    ////////spj
    
    
    function spj()
    {
        $data['page_title']= 'SPJ';
        $this->template->set('title', 'SPJ');   
        $this->template->load('template','tukd/transaksi/spj',$data) ; 
    }
    function spj_skpd()
    {
        $data['page_title']= 'SPJ';
        $this->template->set('title', 'SPJ');   
        $this->template->load('template','tukd/transaksi/spj_skpd',$data) ; 
    }
    
    //function cetak_spj($lcskpd='',$nbulan=''){
//        $bulan = $this-> getBulan($nbulan);
//        $skpd = $this->tukd_model->get_nama($lcskpd,'nm_skpd','ms_skpd','kd_skpd'); 
//        
//        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
//                 $sqlsclient=$this->db->query($sqlsc);
//                 foreach ($sqlsclient->result() as $rowsc)
//                 {
//                    $kab     = $rowsc->kab_kota;
//                    $daerah  = $rowsc->daerah;
//                    $thn     = $rowsc->thn_ang;
//                 }
//        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$lcskpd' and kode='PA'";
//                 $sqlttd=$this->db->query($sqlttd1);
//                 foreach ($sqlttd->result() as $rowttd)
//                {
//                    $nip=$rowttd->nip;                    
//                    $nama= $rowttd->nm;
//                    $jabatan  = $rowttd->jab;
//                }
//        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$lcskpd' and kode='BP'";
//                 $sqlttd=$this->db->query($sqlttd1);
//                 foreach ($sqlttd->result() as $rowttd)
//                {
//                    $nip1=$rowttd->nip;                    
//                    $nama1= $rowttd->nm;
//                    $jabatan1  = $rowttd->jab;
//                }
//           
//        $cRet = '';
//        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">";
//        $cRet .="
//            
//            <tr>
//                <td align=\"center\" style=\"font-size:12px;\" colspan=\"2\">
//                  $kab<BR>
//                  SURAT PENGESAHAN PERTANGGUNGJAWABAN BENDAHARA PENGELUARAN<BR>
//                  (SPJ BELANJA)<BR>&nbsp;
//                </td>
//            </tr>
//            <tr>
//                <td align=\"left\" style=\"font-size:12px;\" width=\"25%\">
//                  SKPD
//                </td> 
//                <td width=\"75%\">:$lcskpd  -  $skpd
//                </td>         
//            </tr>
//            <tr>
//                <td align=\"left\" style=\"font-size:12px;\">
//                  Pengguna Anggaran/Kuasa Pengguna Anggaran
//                </td> 
//                <td>:$nama
//                </td>         
//            </tr>
//            <tr>
//                <td align=\"left\" style=\"font-size:12px;\">
//                  Bendahara Pengeluaran
//                </td> 
//                <td>:$nama1
//                </td>         
//            </tr>
//            <tr>
//                <td align=\"left\" style=\"font-size:12px;\">
//                  Tahun Anggaran
//                </td> 
//                <td>:$thn
//                </td>         
//            </tr>
//            <tr>
//                <td align=\"left\" style=\"font-size:12px;\">
//                  Bulan
//                </td> 
//                <td>:$bulan
//                </td>         
//            </tr>
//            <tr>
//                <td align=\"left\" style=\"font-size:12px;\" colspan=\"2\">
//                 &nbsp;
//                </td> 
//            </tr>
//            
//            </table>
//            <table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
//            <thead>
//            <tr>
//                <td align=\"center\" rowspan=\"2\" style=\"font-size:10px\">Kode<br>Rekening</td>
//                <td align=\"center\" rowspan=\"2\" style=\"font-size:10px\">Uraian</td>
//                <td align=\"center\" rowspan=\"2\" style=\"font-size:10px\">Jumlah<br>Anggaran</td>
//                <td align=\"center\" colspan=\"3\" style=\"font-size:10px\">SPJ-LS Gaji</td>
//                <td align=\"center\" colspan=\"3\" style=\"font-size:10px\">SPJ-LS Barang & Jasa</td>
//                <td align=\"center\" colspan=\"3\" style=\"font-size:10px\">SPJ UP/GU/TU</td>
//                <td align=\"center\" rowspan=\"2\" style=\"font-size:10px\">Jumlah SPJ<br>(LS+UP/GU/TU)<br>s.d Bulan Ini</td>
//                <td align=\"center\" rowspan=\"2\" style=\"font-size:10px\">Sisa Pagu<br>Anggaran</td>
//            </tr>
//            <tr>
//                <td align=\"center\" style=\"font-size:10px\">s.d<br>Bulan<br>lalu</td>
//                <td align=\"center\" style=\"font-size:10px\">Bulan Ini</td>
//                <td align=\"center\" style=\"font-size:10px\">s.d<br>Bulan Ini</td>
//                <td align=\"center\" style=\"font-size:10px\">s.d<br>Bulan<br>lalu</td>
//                <td align=\"center\" style=\"font-size:10px\">Bulan Ini</td>
//                <td align=\"center\" style=\"font-size:10px\">s.d<br>Bulan Ini</td>
//                <td align=\"center\" style=\"font-size:10px\">s.d<br>Bulan<br>lalu</td>
//                <td align=\"center\" style=\"font-size:10px\">Bulan Ini</td>
//                <td align=\"center\" style=\"font-size:10px\">s.d<br>Bulan Ini</td>
//            </tr>                 
//            <tr>
//                <td align=\"center\" style=\"font-size:10px\">1</td>
//                <td align=\"center\" style=\"font-size:10px\">2</td>
//                <td align=\"center\" style=\"font-size:10px\">3</td>
//                <td align=\"center\" style=\"font-size:10px\">4</td>
//                <td align=\"center\" style=\"font-size:10px\">5</td>
//                <td align=\"center\" style=\"font-size:10px\">6</td>
//                <td align=\"center\" style=\"font-size:10px\">7</td>
//                <td align=\"center\" style=\"font-size:10px\">8</td>
//                <td align=\"center\" style=\"font-size:10px\">9</td>
//                <td align=\"center\" style=\"font-size:10px\">10</td>
//                <td align=\"center\" style=\"font-size:10px\">11</td>
//                <td align=\"center\" style=\"font-size:10px\">12</td>
//                <td align=\"center\" style=\"font-size:10px\">13</td>
//                <td align=\"center\" style=\"font-size:10px\">14</td>
//            </tr> 
//             </thead>
//            <tr>
//                <td align=\"center\" style=\"font-size:10px\">&nbsp;</td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//            </tr>";
//            
//                   
//            $csql = "SELECT * FROM (
//                    SELECT DISTINCT 'H' as tipe,a.kd_program as kode2,concat('<b>',a.kd_program,'</b>') AS kode,'' as kode1, concat('<b>',a.nm_program,'</b>') AS uraian,
//                    (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan IN (SELECT kd_kegiatan FROM trskpd WHERE kd_program = a.kd_program)) AS anggaran,
//                    (SELECT SUM(nilai) FROM (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                    trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan IN (SELECT kd_kegiatan FROM trskpd WHERE kd_program = a.kd_program)
//                    AND z.jns_spp IN ('1','2','3') AND MONTH(z.tgl_bukti) = '$nbulan') AS real_up_ini,
//                    (SELECT SUM(nilai) FROM (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                    trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan IN (SELECT kd_kegiatan FROM trskpd WHERE kd_program = a.kd_program)
//                    AND z.jns_spp ='4' AND MONTH(z.tgl_bukti) = '$nbulan') AS real_gaji_ini,
//                    (SELECT SUM(nilai) FROM (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                    trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan IN (SELECT kd_kegiatan FROM trskpd WHERE kd_program = a.kd_program)
//                    AND z.jns_spp ='6' AND MONTH(z.tgl_bukti) = '$nbulan') AS real_brg_js_ini,
//                    (SELECT SUM(nilai) FROM (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                    trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan IN (SELECT kd_kegiatan FROM trskpd WHERE kd_program = a.kd_program)
//                    AND z.jns_spp IN ('1','2','3') AND MONTH(z.tgl_bukti) < '$nbulan') AS real_up_ll,
//                    (SELECT SUM(nilai) FROM (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                    trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan IN (SELECT kd_kegiatan FROM trskpd WHERE kd_program = a.kd_program)
//                    AND z.jns_spp ='4' AND MONTH(z.tgl_bukti) < '$nbulan') AS real_gaji_ll,
//                    (SELECT SUM(nilai) FROM (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                    trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan IN (SELECT kd_kegiatan FROM trskpd WHERE kd_program = a.kd_program)
//                    AND z.jns_spp ='6' AND MONTH(z.tgl_bukti) < '$nbulan') AS real_brg_js_ll
//                    FROM trskpd a WHERE a.kd_skpd = '$lcskpd'
//                    UNION 
//                    SELECT 'H' as tipe,a.kd_kegiatan as kode2,CONCAT('<b>',a.kd_kegiatan,'</b>'),'' as kode1 ,concat('<b>',a.nm_kegiatan,'</b>') AS uraian,
//                    (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan) AS anggaran,
//                    (SELECT SUM(nilai) FROM (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                     trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan = a.kd_kegiatan AND z.jns_spp IN ('1','2','3') AND MONTH(z.tgl_bukti) = '$nbulan') AS real_up_ini,
//                    (SELECT SUM(nilai) FROM (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                     trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan = a.kd_kegiatan AND z.jns_spp ='4' AND MONTH(z.tgl_bukti) = '$nbulan') AS real_gaji_ini,
//                    (SELECT SUM(nilai) FROM (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                     trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan = a.kd_kegiatan AND z.jns_spp ='6' AND MONTH(z.tgl_bukti) = '$nbulan') AS real_brg_js_ini,
//                    (SELECT SUM(nilai) FROM (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                     trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan = a.kd_kegiatan AND z.jns_spp IN ('1','2','3') AND MONTH(z.tgl_bukti) < '$nbulan') AS real_up_ll,
//                    (SELECT SUM(nilai) FROM (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                     trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan = a.kd_kegiatan AND z.jns_spp ='4' AND MONTH(z.tgl_bukti) < '$nbulan') AS real_gaji_ll,
//                    (SELECT SUM(nilai) FROM (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                     trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan = a.kd_kegiatan AND z.jns_spp ='6' AND MONTH(z.tgl_bukti) < '$nbulan') AS real_brg_js_ll
//                     FROM trskpd a WHERE a.kd_skpd = '$lcskpd'
//                     UNION 
//                     SELECT 'S' as tipe,a.kd_kegiatan as kode2,CONCAT(a.kd_kegiatan,'.') as kode,a.kd_rek5 AS kode1,a.nm_rek5 AS uraian,
//                    nilai AS anggaran,
//                    (SELECT SUM(nilai) FROM 
//                    (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                     trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan = a.kd_kegiatan AND z.jns_spp IN ('1','2','3') AND MONTH(z.tgl_bukti) = '$nbulan' AND z.kd_rek5=a.kd_rek5) AS real_up_ini,
//                    (SELECT SUM(nilai) FROM 
//                    (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                     trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan = a.kd_kegiatan AND z.jns_spp ='4' AND MONTH(z.tgl_bukti) = '$nbulan' AND z.kd_rek5=a.kd_rek5) AS real_gaji_ini,
//                    (SELECT SUM(nilai) FROM 
//                    (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                     trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan = a.kd_kegiatan AND z.jns_spp ='6' AND MONTH(z.tgl_bukti) = '$nbulan' AND z.kd_rek5=a.kd_rek5) AS real_brg_js_ini,
//                    (SELECT SUM(nilai) FROM 
//                    (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                     trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan = a.kd_kegiatan AND z.jns_spp IN ('1','2','3') AND MONTH(z.tgl_bukti) < '$nbulan' AND z.kd_rek5=a.kd_rek5) AS real_up_ll,
//                    (SELECT SUM(nilai) FROM 
//                    (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                     trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan = a.kd_kegiatan AND z.jns_spp ='4' AND MONTH(z.tgl_bukti) < '$nbulan' AND z.kd_rek5=a.kd_rek5) AS real_gaji_ll,
//                    (SELECT SUM(nilai) FROM 
//                    (SELECT a.tgl_bukti,a.kd_skpd,a.jns_spp,b.kd_kegiatan,b.kd_rek5,b.nilai FROM trhtransout a INNER JOIN 
//                     trdtransout b ON a.no_bukti = b.no_bukti)z WHERE z.kd_skpd = a.kd_skpd AND 
//                    z.kd_kegiatan = a.kd_kegiatan AND z.jns_spp ='6' AND MONTH(z.tgl_bukti) < '$nbulan' AND z.kd_rek5=a.kd_rek5) AS real_brg_js_ll
//                     FROM trdrka a WHERE a.kd_skpd = '$lcskpd')t ORDER BY CONCAT(t.kode2,t.kode1)";
//             
//                    $hasil = $this->db->query($csql);
//                    $lcno = 0;
//                    $totang = 0;
//                    $totgjini = 0;
//                    $totgjll = 0;
//                    $totgjsd = 0;
//                    $totbrini = 0;
//                    $totbrll = 0;
//                    $totbrsd = 0;
//                    $totupini = 0;
//                    $totupll = 0;                  
//                    $totupsd = 0;
//                                        
//                    foreach ($hasil->result() as $row)
//                    {
//                       
//                       $jmspj = $row->real_gaji_ini + $row->real_gaji_ll + $row->real_brg_js_ini + $row->real_brg_js_ll + $row->real_up_ini + $row->real_up_ll;
//                       $lcno = $lcno + 1;
//                       if($row->tipe=='S'){
//                           $totang = $totang + $row->anggaran;
//                           $totgjini = $totgjini + $row->real_gaji_ini;
//                           $totgjll = $totgjll + $row->real_gaji_ll;
//                           $totgjsd = $totgjsd + $row->real_gaji_ini +$row->real_gaji_ll ;
//                           $totbrini = $totbrini + $row->real_brg_js_ini;
//                           $totbrll = $totbrll + $row->real_brg_js_ll;
//                           $totbrsd = $totbrsd + $row->real_brg_js_ini + $row->real_brg_js_ll;
//                           $totupini = $totupini + $row->real_up_ini;
//                           $totupll = $totupll + $row->real_up_ll;                    
//                           $totupsd = $totupsd + $row->real_up_ini + $row->real_up_ll;
//                       }
//                       if(!empty($row->anggaran)){
//                       $cRet .="<tr>
//                                <td align=\"left\" width=\"11%\" style=\"font-size:8px\">$row->kode".$this->tukd_model->dotrek($row->kode1)."</td>
//                                <td valign=\"top\" align=\"left\" width=\"26%\" style=\"font-size:8px\">$row->uraian</td>";
//                                
//                                if ($row->tipe=='S'){
//                                    $cRet .="<td align=\"right\" width=\"6%\" style=\"font-size:8px\">".number_format($row->anggaran)."&nbsp;</td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\">".number_format($row->real_gaji_ll)."&nbsp;</td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\">".number_format($row->real_gaji_ini)."&nbsp;</td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\">".number_format($row->real_gaji_ini+$row->real_gaji_ll)."&nbsp;</td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\">".number_format($row->real_brg_js_ll)."&nbsp;</td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\">".number_format($row->real_brg_js_ini)."&nbsp;</td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\">".number_format($row->real_brg_js_ll+$row->real_brg_js_ini)."&nbsp;</td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\">".number_format($row->real_up_ll)."&nbsp;</td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\">".number_format($row->real_up_ini)."&nbsp;</td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\">".number_format($row->real_up_ini+$row->real_up_ll)."&nbsp;</td>
//                                            <td align=\"right\" width=\"6%\" style=\"font-size:8px\">".number_format($jmspj)."&nbsp;</td>
//                                            <td align=\"right\" width=\"6%\" style=\"font-size:8px\">".number_format($row->anggaran - $jmspj)."&nbsp;</td>";
//                                }else{
//                                    $cRet .="<td align=\"right\" width=\"6%\" style=\"font-size:8px\"><b>".number_format($row->anggaran)."&nbsp;</b></td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\"><b>".number_format($row->real_gaji_ll)."&nbsp;</b></td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\"><b>".number_format($row->real_gaji_ini)."&nbsp;</b></td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\"><b>".number_format($row->real_gaji_ini+$row->real_gaji_ll)."&nbsp;</b></td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\"><b>".number_format($row->real_brg_js_ll)."&nbsp;</b></td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\"><b>".number_format($row->real_brg_js_ini)."&nbsp;</b></td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\"><b>".number_format($row->real_brg_js_ll+$row->real_brg_js_ini)."&nbsp;</b></td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\"><b>".number_format($row->real_up_ll)."&nbsp;</b></td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\"><b>".number_format($row->real_up_ini)."&nbsp;</b></td>
//                                            <td align=\"right\" width=\"5%\" style=\"font-size:8px\"><b>".number_format($row->real_up_ini+$row->real_up_ll)."&nbsp;</b></td>
//                                            <td align=\"right\" width=\"6%\" style=\"font-size:8px\"><b>".number_format($jmspj)."&nbsp;</b></td>
//                                            <td align=\"right\" width=\"6%\" style=\"font-size:8px\"><b>".number_format($row->anggaran - $jmspj)."&nbsp;</b></td>";
//                                }
//                                         
//                                 $cRet .="</tr> "; 
//                            }  
//                        
//                    }
//            
//          $cRet .="
//           <tr>
//                <td valign=\"top\" align=\"center\" style=\"font-size:8px\" ><b>&ensp;&ensp;JUMLAH</b></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"right\" style=\"font-size:8px\"><b>".number_format($totang)."&nbsp;</b></td>
//                <td align=\"right\" style=\"font-size:8px\"><b>".number_format($totgjll)."&nbsp;</b></td>
//                <td align=\"right\" style=\"font-size:8px\"><b>".number_format($totgjini)."&nbsp;</b></td>
//                <td align=\"right\" style=\"font-size:8px\"><b>".number_format($totgjsd)."&nbsp;</b></td>
//                <td align=\"right\" style=\"font-size:8px\"><b>".number_format($totbrll)."&nbsp;</b></td>
//                <td align=\"right\" style=\"font-size:8px\"><b>".number_format($totbrini)."&nbsp;</b></td>
//                <td align=\"right\" style=\"font-size:8px\"><b>".number_format($totbrsd)."&nbsp;</b></td>
//                <td align=\"right\" style=\"font-size:8px\"><b>".number_format($totupll)."&nbsp;</b></td>
//                <td align=\"right\" style=\"font-size:8px\"><b>".number_format($totupini)."&nbsp;</b></td>
//                <td align=\"right\" style=\"font-size:8px\"><b>".number_format($totupsd)."&nbsp;</b></td>
//                <td align=\"right\" style=\"font-size:8px\"><b>".number_format($totgjsd+$totbrsd+$totupsd)."&nbsp;</b></td>
//                <td valign=\"top\" align=\"right\" style=\"font-size:8px\"><b>".number_format($totang-$totgjsd-$totbrsd-$totupsd)."&nbsp;</b></td>
//            </tr>
//            <tr>
//                <td valign=\"top\" align=\"center\" style=\"font-size:8px\" rowspan=\"22\">&ensp;</td>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">Penerimaan :</td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td valign=\"top\" align=\"center\" style=\"font-size:10px\" rowspan=\"22\">&nbsp;</td>
//            </tr>";
//            
//            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
//                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
//                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
//                    MONTH(a.tgl_sp2d)='$nbulan' AND c.jns_spp IN ('1','2','3') AND a.status='1') AS sp2d_up_ini,
//                    (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
//                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
//                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
//                    MONTH(a.tgl_sp2d)<'$nbulan' AND c.jns_spp IN ('1','2','3') AND a.status='1') AS sp2d_up_ll,
//                    (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
//                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
//                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
//                    MONTH(a.tgl_sp2d)='$nbulan' AND c.jns_spp ='4' AND a.status='1') AS sp2d_gj_ini,
//                    (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
//                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
//                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
//                    MONTH(a.tgl_sp2d)<'$nbulan' AND c.jns_spp ='4'  AND a.status='1') AS sp2d_gj_ll,
//                    (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
//                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
//                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
//                    MONTH(a.tgl_sp2d)='$nbulan' AND c.jns_spp ='6'  AND a.status='1') AS sp2d_brjs_ini,
//                    (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
//                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
//                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
//                    MONTH(a.tgl_sp2d)<'$nbulan' AND c.jns_spp ='6' AND a.status='1') AS sp2d_brjs_ll";
//            
//            $hasil = $this->db->query($csql);
//            $trh1 = $hasil->row(); 
//            $totalsp2d = $trh1->sp2d_gj_ll+$trh1->sp2d_gj_ini+$trh1->sp2d_brjs_ll+
//                         $trh1->sp2d_brjs_ini+$trh1->sp2d_up_ll+$trh1->sp2d_up_ini;
//                         
//            $cobacoba = $trh1->sp2d_gj_ll;
//            
//            
//            
//            $cRet .="   
//            <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">&ensp;&ensp;- SP2D</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh1->sp2d_gj_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh1->sp2d_gj_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh1->sp2d_gj_ll + $trh1->sp2d_gj_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh1->sp2d_brjs_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh1->sp2d_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh1->sp2d_brjs_ll + $trh1->sp2d_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh1->sp2d_up_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh1->sp2d_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh1->sp2d_up_ll + $trh1->sp2d_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($totalsp2d)."&nbsp;</td>
//            </tr>            
//            
//            <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">&ensp;&ensp;- Potongan Pajak</td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//            </tr>";
//            
//            $lcrek = '2110401'; // ppn terima
//            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jppn_up_ini,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jppn_up_ll,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='4') AS jppn_gaji_ini,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='4') AS jppn_gaji_ll,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='6') AS jppn_brjs_ini,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='6') AS jppn_brjs_ll";
//            
//            $hasil = $this->db->query($csql);
//            $trh2 = $hasil->row();
//            $totalppn = $trh2->jppn_up_ini + $trh2->jppn_up_ll + $trh2->jppn_gaji_ini + 
//                        $trh2->jppn_gaji_ll + $trh2->jppn_brjs_ini + $trh2->jppn_brjs_ll;
//            
//            
//            $cRet .=" 
//            <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">&ensp;&ensp;a.PPN</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh2->jppn_gaji_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh2->jppn_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh2->jppn_gaji_ll + $trh2->jppn_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh2->jppn_brjs_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh2->jppn_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh2->jppn_brjs_ll + $trh2->jppn_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh2->jppn_up_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh2->jppn_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh2->jppn_up_ll + $trh2->jppn_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($totalppn)."&nbsp;</td>
//            </tr>";
//            
//            $lcrek = '2130101'; // pph 21 terima
//            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jpph21_up_ini,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jpph21_up_ll,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='4') AS jpph21_gaji_ini,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='4') AS jpph21_gaji_ll,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='6') AS jpph21_brjs_ini,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='6') AS jpph21_brjs_ll";
//            
//            $hasil = $this->db->query($csql);
//            $trh3 = $hasil->row();
//            $totalpph21 = $trh3->jpph21_up_ini + $trh3->jpph21_up_ll + $trh3->jpph21_gaji_ini + 
//                        $trh3->jpph21_gaji_ll + $trh3->jpph21_brjs_ini + $trh3->jpph21_brjs_ll;
//            
//            
//            $cRet .="
//             <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">&ensp;&ensp;b.PPH 21</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh3->jpph21_gaji_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh3->jpph21_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh3->jpph21_gaji_ll + $trh3->jpph21_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh3->jpph21_brjs_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh3->jpph21_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh3->jpph21_brjs_ll + $trh3->jpph21_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh3->jpph21_up_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh3->jpph21_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh3->jpph21_up_ll + $trh3->jpph21_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($totalpph21)."&nbsp;</td>
//            </tr>";
//            
//            $lcrek = '2130201'; // pph 22 terima
//            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jpph22_up_ini,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jpph22_up_ll,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='4') AS jpph22_gaji_ini,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='4') AS jpph22_gaji_ll,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='6') AS jpph22_brjs_ini,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='6') AS jpph22_brjs_ll";
//            
//            $hasil = $this->db->query($csql);
//            $trh4 = $hasil->row();
//            $totalpph22 = $trh4->jpph22_up_ini + $trh4->jpph22_up_ll + $trh4->jpph22_gaji_ini + 
//                        $trh4->jpph22_gaji_ll + $trh4->jpph22_brjs_ini + $trh4->jpph22_brjs_ll;
//            
//            
//            $cRet .="
//             <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">&ensp;&ensp;c.PPH 22</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh4->jpph22_gaji_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh4->jpph22_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh4->jpph22_gaji_ll + $trh4->jpph22_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh4->jpph22_brjs_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh4->jpph22_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh4->jpph22_brjs_ll + $trh4->jpph22_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh4->jpph22_up_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh4->jpph22_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh4->jpph22_up_ll + $trh4->jpph22_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($totalpph22)."&nbsp;</td>
//            </tr>";
//            
//            $lcrek = '2130401'; // pph 23 terima
//            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jpph23_up_ini,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jpph23_up_ll,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='4') AS jpph23_gaji_ini,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='4') AS jpph23_gaji_ll,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='6') AS jpph23_brjs_ini,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='6') AS jpph23_brjs_ll";
//            
//            $hasil = $this->db->query($csql);
//            $trh5 = $hasil->row();
//            $totalpph23 = $trh5->jpph23_up_ini + $trh5->jpph23_up_ll + $trh5->jpph23_gaji_ini + 
//                        $trh5->jpph23_gaji_ll + $trh5->jpph23_brjs_ini + $trh5->jpph23_brjs_ll;
//            
//            
//            $cRet .="
//             <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">&ensp;&ensp;d.PPH 23</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh5->jpph23_gaji_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh5->jpph23_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh5->jpph23_gaji_ll + $trh5->jpph23_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh5->jpph23_brjs_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh5->jpph23_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh5->jpph23_brjs_ll + $trh5->jpph23_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh5->jpph23_up_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh5->jpph23_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh5->jpph23_up_ll + $trh5->jpph23_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($totalpph23)."&nbsp;</td>
//            </tr>";
//            
//            // lain terima
//            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 NOT IN ('2130101','2130201','2130401','2110401') AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jlain_up_ini,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 NOT IN ('2130101','2130201','2130401','2110401') AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jlain_up_ll,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 NOT IN ('2130101','2130201','2130401','2110401') AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='4') AS jlain_gaji_ini,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 NOT IN ('2130101','2130201','2130401','2110401') AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='4') AS jlain_gaji_ll,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 NOT IN ('2130101','2130201','2130401','2110401') AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='6') AS jlain_brjs_ini,
//                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 NOT IN ('2130101','2130201','2130401','2110401') AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='6') AS jlain_brjs_ll";
//            $hasil = $this->db->query($csql);
//            $trh6 = $hasil->row();
//            $totallain = $trh6->jlain_up_ini + $trh6->jlain_up_ll + $trh6->jlain_gaji_ini + 
//                         $trh6->jlain_gaji_ll + $trh6->jlain_brjs_ini + $trh6->jlain_brjs_ll;
//            
//            
//            $jmtrmgaji_ll =  $trh1->sp2d_gj_ll+ $trh2->jppn_gaji_ll + $trh3->jpph21_gaji_ll +
//                             $trh4->jpph22_gaji_ll + $trh5->jpph23_gaji_ll + $trh6->jlain_gaji_ll;
//            
//            $jmtrmgaji_ini =  $trh1->sp2d_gj_ini + $trh2->jppn_gaji_ini + $trh3->jpph21_gaji_ini +
//                             $trh4->jpph22_gaji_ini + $trh5->jpph23_gaji_ini + $trh6->jlain_gaji_ini;
//                             
//            $jmtrmgaji_sd = $jmtrmgaji_ll + $jmtrmgaji_ini;
//            
//            
//            $jmtrmbrjs_ll =  $trh1->sp2d_brjs_ll + $trh2->jppn_brjs_ll + $trh3->jpph21_brjs_ll +
//                             $trh4->jpph22_brjs_ll + $trh5->jpph23_brjs_ll + $trh6->jlain_brjs_ll;
//                                                                                                 
//            $jmtrmbrjs_ini =  $trh1->sp2d_brjs_ini + $trh2->jppn_brjs_ini + $trh3->jpph21_brjs_ini +
//                             $trh4->jpph22_brjs_ini + $trh5->jpph23_brjs_ini + $trh6->jlain_brjs_ini;
//                             
//            $jmtrmbrjs_sd = $jmtrmbrjs_ll + $jmtrmbrjs_ini;
//            
//            $jmtrmup_ll =  $trh1->sp2d_up_ll + $trh2->jppn_up_ll + $trh3->jpph21_up_ll +
//                             $trh4->jpph22_up_ll + $trh5->jpph23_up_ll + $trh6->jlain_up_ll;
//            
//            $jmtrmup_ll =  $trh1->sp2d_up_ll + $trh2->jppn_up_ll + $trh3->jpph21_up_ll +
//                             $trh4->jpph22_up_ll + $trh5->jpph23_up_ll + $trh6->jlain_up_ll;                             
//            
//            $jmtrmup_ini =  $trh1->sp2d_up_ini + $trh2->jppn_up_ini + $trh3->jpph21_up_ini +
//                             $trh4->jpph22_up_ini + $trh5->jpph23_up_ini + $trh6->jlain_up_ini;
//            
//            $jmtrmup_sd = $jmtrmup_ll + $jmtrmup_ini;
//            
//            
//            $cRet .="
//                       
//            <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">&ensp;&ensp;- Lain-lain</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh6->jlain_gaji_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh6->jlain_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh6->jlain_gaji_ll + $trh6->jlain_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh6->jlain_brjs_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh6->jlain_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh6->jlain_brjs_ll + $trh6->jlain_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh6->jlain_up_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh6->jlain_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh6->jlain_up_ll + $trh6->jlain_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($totallain)."&nbsp;</td>
//            </tr>
//            
//            <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">Jumlah Penerimaan :</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmgaji_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmgaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmgaji_sd)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmbrjs_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmbrjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmbrjs_sd)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmup_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmup_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmup_sd)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmgaji_sd + $jmtrmbrjs_sd + $jmtrmup_sd)."&nbsp;</td>
//            </tr> 
//           
//           
//            
//            <tr>
//                <td align=\"center\" style=\"font-size:8px\" colspan=\"2\">&nbsp;</td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//            </tr>
//            
//            <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">Pengeluaran :</td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//                <td align=\"center\" style=\"font-size:8px\"></td>
//            </tr>";
//            
//           $csql = "SELECT (SELECT SUM(a.nilai) FROM trdtransout a INNER JOIN trhtransout b ON 
//                    a.no_bukti = b.no_bukti WHERE b.kd_skpd = '$lcskpd' AND b.jns_spp IN('1','2','3')
//                    AND MONTH(b.tgl_bukti) = '$nbulan') AS spj_up_ini,
//                    (SELECT SUM(a.nilai) FROM trdtransout a INNER JOIN trhtransout b ON 
//                    a.no_bukti = b.no_bukti WHERE b.kd_skpd = '$lcskpd' AND b.jns_spp IN('1','2','3')
//                    AND MONTH(b.tgl_bukti) < '$nbulan') AS spj_up_ll,
//                    (SELECT SUM(a.nilai) FROM trdtransout a INNER JOIN trhtransout b ON 
//                    a.no_bukti = b.no_bukti WHERE b.kd_skpd = '$lcskpd' AND b.jns_spp ='4'
//                    AND MONTH(b.tgl_bukti) = '$nbulan') AS spj_gaji_ini,
//                    (SELECT SUM(a.nilai) FROM trdtransout a INNER JOIN trhtransout b ON 
//                    a.no_bukti = b.no_bukti WHERE b.kd_skpd = '$lcskpd' AND b.jns_spp ='4'
//                    AND MONTH(b.tgl_bukti) < '$nbulan') AS spj_gaji_ll,
//                    (SELECT SUM(a.nilai) FROM trdtransout a INNER JOIN trhtransout b ON 
//                    a.no_bukti = b.no_bukti WHERE b.kd_skpd = '$lcskpd' AND b.jns_spp ='6'
//                    AND MONTH(b.tgl_bukti) = '$nbulan') AS spj_brjs_ini,
//                    (SELECT SUM(a.nilai) FROM trdtransout a INNER JOIN trhtransout b ON 
//                    a.no_bukti = b.no_bukti WHERE b.kd_skpd = '$lcskpd' AND b.jns_spp ='6'
//                    AND MONTH(b.tgl_bukti) < '$nbulan') AS spj_brjs_ll"; 
//           
//           $hasil = $this->db->query($csql);
//           $trh7 = $hasil->row(); 
//           $totalspj = $trh7->spj_gaji_ll + $trh7->spj_gaji_ini + $trh7->spj_brjs_ll + 
//                       $trh7->spj_brjs_ini + $trh7->spj_up_ll + $trh7->spj_up_ini;
//                                                            
//           $cRet .="
//            <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">&ensp;- SPJ(LS + UP/GU/TU)</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh7->spj_gaji_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh7->spj_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh7->spj_gaji_ini + $trh7->spj_gaji_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh7->spj_brjs_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh7->spj_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh7->spj_brjs_ini + $trh7->spj_brjs_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh7->spj_up_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh7->spj_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh7->spj_up_ini + $trh7->spj_up_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($totalspj)."&nbsp;</td>
//            </tr>
//            <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">&ensp;- Penyetoran Pajak</td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//            </tr>";
//            
//           $lcrek = '2110401'; // ppn setor
//           $csql = "SELECT (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jppn_up_ini,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jppn_up_ll,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='4') AS jppn_gaji_ini,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='4') AS jppn_gaji_ll,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='6') AS jppn_brjs_ini,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='6') AS jppn_brjs_ll";
//            
//           $hasil = $this->db->query($csql);
//           $trh8 = $hasil->row();
//           $totalppn = $trh8->jppn_up_ini + $trh8->jppn_up_ll + $trh8->jppn_gaji_ini + 
//                        $trh8->jppn_gaji_ll + $trh8->jppn_brjs_ini + $trh8->jppn_brjs_ll;
//            
//            $cRet .="
//            <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">&ensp;&ensp;a.PPN</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh8->jppn_gaji_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh8->jppn_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh8->jppn_gaji_ll + $trh8->jppn_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh8->jppn_brjs_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh8->jppn_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh8->jppn_brjs_ll + $trh8->jppn_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh8->jppn_up_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh8->jppn_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh8->jppn_up_ll + $trh8->jppn_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($totalppn)."&nbsp;</td>
//            </tr>";
//            
//            
//            $lcrek = '2130101'; // pph 21 setor
//            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jpph21_up_ini,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jpph21_up_ll,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='4') AS jpph21_gaji_ini,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='4') AS jpph21_gaji_ll,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='6') AS jpph21_brjs_ini,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='6') AS jpph21_brjs_ll";
//            
//            $hasil = $this->db->query($csql);
//            $trh9 = $hasil->row();
//            $totalpph21 = $trh9->jpph21_up_ini + $trh9->jpph21_up_ll + $trh9->jpph21_gaji_ini + 
//                          $trh9->jpph21_gaji_ll + $trh9->jpph21_brjs_ini + $trh9->jpph21_brjs_ll;
//            
//            
//            $cRet .="
//             <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">&ensp;&ensp;b.PPH 21</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh9->jpph21_gaji_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh9->jpph21_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh9->jpph21_gaji_ll + $trh9->jpph21_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh9->jpph21_brjs_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh9->jpph21_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh9->jpph21_brjs_ll + $trh9->jpph21_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh9->jpph21_up_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh9->jpph21_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh9->jpph21_up_ll + $trh9->jpph21_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($totalpph21)."&nbsp;</td>
//            </tr>";
//            
//            $lcrek = '2130201'; // pph 22 setor
//            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jpph22_up_ini,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jpph22_up_ll,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='4') AS jpph22_gaji_ini,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='4') AS jpph22_gaji_ll,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='6') AS jpph22_brjs_ini,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='6') AS jpph22_brjs_ll";
//            
//            $hasil = $this->db->query($csql);
//            $trh10 = $hasil->row();
//            $totalpph22 = $trh10->jpph22_up_ini + $trh10->jpph22_up_ll + $trh10->jpph22_gaji_ini + 
//                        $trh10->jpph22_gaji_ll + $trh10->jpph22_brjs_ini + $trh10->jpph22_brjs_ll;
//            
//            
//            $cRet .="
//             <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">&ensp;&ensp;c.PPH 22</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh10->jpph22_gaji_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh10->jpph22_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh10->jpph22_gaji_ll + $trh10->jpph22_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh10->jpph22_brjs_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh10->jpph22_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh10->jpph22_brjs_ll + $trh10->jpph22_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh10->jpph22_up_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh10->jpph22_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh10->jpph22_up_ll + $trh10->jpph22_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($totalpph22)."&nbsp;</td>
//            </tr>";
//            
//            $lcrek = '2130401'; // pph 23 setor
//            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jpph23_up_ini,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jpph23_up_ll,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='4') AS jpph23_gaji_ini,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='4') AS jpph23_gaji_ll,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='6') AS jpph23_brjs_ini,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='6') AS jpph23_brjs_ll";
//            
//            $hasil = $this->db->query($csql);
//            $trh11 = $hasil->row();
//            $totalpph23 = $trh11->jpph23_up_ini + $trh11->jpph23_up_ll + $trh11->jpph23_gaji_ini + 
//                        $trh11->jpph23_gaji_ll + $trh11->jpph23_brjs_ini + $trh11->jpph23_brjs_ll;
//            
//            
//            $cRet .="
//             <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">&ensp;&ensp;d.PPH 23</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh11->jpph23_gaji_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh11->jpph23_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh11->jpph23_gaji_ll + $trh11->jpph23_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh11->jpph23_brjs_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh11->jpph23_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh11->jpph23_brjs_ll + $trh11->jpph23_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh11->jpph23_up_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh11->jpph23_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh11->jpph23_up_ll + $trh11->jpph23_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($totalpph23)."&nbsp;</td>
//            </tr>";
//            
//            
//            // lain lain setoran
//            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 NOT IN ('2130101','2130201','2130401','2110401') AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jlain_up_ini,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 NOT IN ('2130101','2130201','2130401','2110401') AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp IN('1','2','3')) AS jlain_up_ll,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 NOT IN ('2130101','2130201','2130401','2110401') AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='4') AS jlain_gaji_ini,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 NOT IN ('2130101','2130201','2130401','2110401') AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='4') AS jlain_gaji_ll,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 NOT IN ('2130101','2130201','2130401','2110401') AND MONTH(a.tgl_bukti)='$nbulan' AND 
//                    a.jns_spp ='6') AS jlain_brjs_ini,
//                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
//                    ON a.no_bukti = b.no_bukti WHERE a.kd_skpd = '$lcskpd' AND 
//                    b.kd_rek5 NOT IN ('2130101','2130201','2130401','2110401') AND MONTH(a.tgl_bukti)<'$nbulan' AND 
//                    a.jns_spp ='6') AS jlain_brjs_ll";
//            $hasil = $this->db->query($csql);
//            $trh12 = $hasil->row();
//            $totallain = $trh12->jlain_up_ini + $trh12->jlain_up_ll + $trh12->jlain_gaji_ini + 
//                         $trh12->jlain_gaji_ll + $trh12->jlain_brjs_ini + $trh12->jlain_brjs_ll;
//            
//            
//            $jmsetgaji_ll =  $trh7->spj_gaji_ll+ $trh8->jppn_gaji_ll + $trh9->jpph21_gaji_ll +
//                             $trh10->jpph22_gaji_ll + $trh11->jpph23_gaji_ll + $trh12->jlain_gaji_ll;
//            
//            $jmsetgaji_ini = $trh7->spj_gaji_ini + $trh8->jppn_gaji_ini + $trh9->jpph21_gaji_ini +
//                             $trh10->jpph22_gaji_ini + $trh11->jpph23_gaji_ini + $trh12->jlain_gaji_ini;
//                             
//            $jmsetgaji_sd = $jmsetgaji_ll + $jmsetgaji_ini;
//            
//            
//            $jmsetbrjs_ll =  $trh7->spj_brjs_ll + $trh8->jppn_brjs_ll + $trh9->jpph21_brjs_ll +
//                             $trh10->jpph22_brjs_ll + $trh11->jpph23_brjs_ll + $trh12->jlain_brjs_ll;
//                                                                                                 
//            $jmsetbrjs_ini =  $trh7->spj_brjs_ini + $trh8->jppn_brjs_ini + $trh9->jpph21_brjs_ini +
//                             $trh10->jpph22_brjs_ini + $trh11->jpph23_brjs_ini + $trh12->jlain_brjs_ini;
//                             
//            $jmsetbrjs_sd = $jmsetbrjs_ll + $jmsetbrjs_ini;
//            
//            $jmsetup_ll =  $trh7->spj_up_ll + $trh8->jppn_up_ll + $trh9->jpph21_up_ll +
//                             $trh10->jpph22_up_ll + $trh11->jpph23_up_ll + $trh12->jlain_up_ll;
//            
//            $jmsetup_ll =  $trh7->spj_up_ll + $trh8->jppn_up_ll + $trh9->jpph21_up_ll +
//                             $trh10->jpph22_up_ll + $trh11->jpph23_up_ll + $trh12->jlain_up_ll;                             
//            
//            $jmsetup_ini =  $trh7->spj_up_ini + $trh8->jppn_up_ini + $trh9->jpph21_up_ini +
//                             $trh10->jpph22_up_ini + $trh11->jpph23_up_ini + $trh12->jlain_up_ini;
//            
//            $jmsetup_sd = $jmsetup_ll + $jmsetup_ini;
//            
//            
//            $cRet .="
//                       
//            <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">&ensp;&ensp;- Lain-lain</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh12->jlain_gaji_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh12->jlain_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh12->jlain_gaji_ll + $trh12->jlain_gaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh12->jlain_brjs_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh12->jlain_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh12->jlain_brjs_ll + $trh12->jlain_brjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh12->jlain_up_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh12->jlain_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($trh12->jlain_up_ll + $trh12->jlain_up_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($totallain)."&nbsp;</td>
//            </tr>";
//
//            $cRet .="
//            <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">Jumlah Pengeluaran :</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmsetgaji_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmsetgaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmsetgaji_sd)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmsetbrjs_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmsetbrjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmsetbrjs_sd)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmsetup_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmsetup_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmsetup_sd)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmsetgaji_sd + $jmsetbrjs_sd + $jmsetup_sd)."&nbsp;</td>
//            </tr> 
//                        
//            <tr>
//                <td align=\"center\" style=\"font-size:8px\" colspan=\"2\">&nbsp;</td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//            </tr>
//            <tr>
//                <td align=\"left\" style=\"font-size:8px\" colspan=\"2\">Saldo Kas</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmgaji_ll - $jmsetgaji_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmgaji_ini - $jmsetgaji_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmgaji_sd - $jmsetgaji_sd)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmbrjs_ll - $jmsetbrjs_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmbrjs_ini - $jmsetbrjs_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmbrjs_sd - $jmsetbrjs_sd)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmup_ll - $jmsetup_ll)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmup_ini - $jmsetup_ini)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmup_sd - $jmsetup_sd)."&nbsp;</td>
//                <td align=\"right\" style=\"font-size:8px\">".number_format($jmtrmgaji_sd + $jmtrmbrjs_sd + $jmtrmup_sd - $jmsetgaji_sd - $jmsetbrjs_sd - $jmsetup_sd)."&nbsp;</td>
//            </tr>
//            <tr>
//                <td align=\"center\" style=\"font-size:8px\" colspan=\"2\">&nbsp;</td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//                <td align=\"center\" style=\"font-size:10px\"></td>
//            </tr>
//            </table>";
//        
//        
//         $data['prev']= $cRet;    
//         $this->tukd_model->_mpdf('',$cRet,'5','5',5,'1');  
//    }
//////////spj
//
//
    function pajak()
    {
        $data['page_title']= 'PAJAK';
        $this->template->set('title', 'PAJAK');   
        $this->template->load('template','tukd/transaksi/pajak',$data) ; 
    }
    
    
    function cetak_pajak($lcskpd='',$nbulan=''){
        
        $skpd = $this->tukd_model->get_nama($lcskpd,'nm_skpd','ms_skpd','kd_skpd');
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                 }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$lcskpd' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$lcskpd' and kode='BP'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                }
			$cRet ='<TABLE width="100%">
					<TR>
						<TD align="center" >'.$kab.' </TD>
					</TR>
                    <TR>
						<TD align="center" >BUKU PAJAK PPN/PPh </TD>
					</TR>
					</TABLE><br/>';

			$cRet .='<TABLE width="100%">
					 <TR>
						<TD align="left" width="20%" >SKPD</TD>
						<TD align="left" width="80%" >: '.$lcskpd.' '.$skpd.'</TD>
					 </TR>
					 <TR>
						<TD align="left" width="20%" >Kepala SKPD</TD>
						<TD align="left" width="100" >:'.$nama.'</TD>
					 </TR>
					 <TR>
						<TD align="left" width="20%" >Bendahara </TD>
						<TD align="left" width="80%" >:'.$nama1.'</TD>
					 </TR>
					 </TABLE>';

			$cRet .='<TABLE border="1" cellspacing="0" cellpadding="0" >
					 <TR>
						<TD width="80" align="center" >NO</TD>
                        <TD width="90" align="center" >Tanggal</TD>
						<TD width="350" align="center" >Uraian</TD>						
						<TD width="100" align="center" >Pomotongan (Rp)</TD>
						<TD width="100" align="center" >Penyetoran (Rp)</TD>
						<TD width="120" align="center" >Saldo</TD>
					 </TR>';
			

			
				$query = $this->db->query("SELECT * FROM(SELECT no_bukti as no,no_bukti AS no_bukti,tgl_bukti AS tgl,CONCAT(ket,'  no sp2d:',no_sp2d) AS keterangan,'0' AS terima,'0' AS keluar,'1' AS ket,'D' as jns FROM trhtrmpot WHERE MONTH(tgl_bukti)='$nbulan' AND kd_skpd='$lcskpd'
	                                       UNION ALL
	                                       SELECT '' as no,a.no_bukti AS no_bukti ,'' AS tgl,CONCAT(a.kd_rek5,' - ',a.nm_rek5) AS keterangan,a.nilai AS terima,'0' AS keluar,'2'AS ket,'D' as jns FROM trdtrmpot a INNER JOIN trhtrmpot b ON a.no_bukti=b.no_bukti WHERE MONTH(b.tgl_bukti)='$nbulan' AND b.kd_skpd='$lcskpd'
	                                       UNION ALL
	                                       SELECT no_bukti as no,no_bukti AS no_bukti,tgl_bukti AS tgl,CONCAT(ket,'  terima:',no_terima) AS keterangan,'0' AS terima,'0' AS keluar,'1' AS ket,'K' as jns FROM trhstrpot WHERE MONTH(tgl_bukti)='$nbulan' AND kd_skpd='$lcskpd'
	                                       UNION ALL
	                                       SELECT '' as no,a.no_bukti AS no_bukti ,'' AS tgl,CONCAT(a.kd_rek5,' - ',a.nm_rek5) AS keterangan,'0' AS terima,a.nilai AS keluar,'2'AS ket,'K' as jns FROM trdstrpot  a INNER JOIN trhstrpot b ON a.no_bukti=b.no_bukti WHERE MONTH(b.tgl_bukti)='$nbulan' AND b.kd_skpd='$lcskpd') a ORDER BY no_bukti,ket ");  
				

			
				$lcno=0;
				$saldo=0;
                $tbukti='';
				foreach ($query->result() as $row) {
					$lcno = $lcno + 1;
                    if ($tbukti != $row->no_bukti){
						$nokas=$row->no_bukti;
					}else{
						$nokas='';					
					}
                    $bukti = $row->no; 
                    $tanggal = $row->tgl;                   
                    $ket = $row->keterangan;
                    $in =$row->terima;
                    $out=$row->keluar;                    
                    $debet = empty($row->terima) || $row->terima == 0 ? '' :number_format($row->terima);                     
                    $kredit = empty($row->keluar) || $row->keluar == 0 ? '' :number_format($row->keluar);
					if ($row->jns=='D'){					
						$saldo=$saldo+$row->terima;
                        $sal = empty($saldo) || $saldo == 0 ? '' :number_format($saldo);
					}else{
						$saldo=$saldo-$row->keluar;
                        $sal = empty($saldo) || $saldo == 0 ? '' :number_format($saldo);
					}

					$cRet .='<TR>
								<TD width="80" align="left" >'.$bukti.'</TD>
                                <TD width="90" align="left" >'.$tanggal.'</TD>
								<TD width="350" align="left" >'.$ket.'</TD>								
								<TD width="100" align="right" >'.$debet.'</TD>
								<TD width="100" align="right" >'.$kredit.'</TD>
								<TD width="120" align="right" >'.$saldo.'</TD>
							 </TR>';					
			
				}

									

			$cRet .='</TABLE>';

			$data['prev']= 'BUKU PAJAK PPN/PPh';
            $this->tukd_model->_mpdf('',$cRet,10,5,10,'0');	
	
	}
   
  function cetak_spj($lcskpd='',$nbulan='',$ang=''){
		$tanda_ang=2;
        $thn_ang	   = $this->session->userdata('pcThang');
        $skpd = $lcskpd;
        $nama=  $this->tukd_model->get_nama($lcskpd,'nm_skpd','ms_skpd','kd_skpd');
        $bulan= $this->tukd_model->getBulan($nbulan); 
		$prv = $this->db->query("SELECT * from sclient");
		$prvn = $prv->row();          
		$prov = $prvn->provinsi;         
		$daerah = $prvn->daerah;
		
        $cRet = '';
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="
            
            <tr>
                <td align=\"center\" style=\"font-size:14px;\" colspan=\"2\">
                 <b> $prov<BR></b>
                 <b> SURAT PENGESAHAN PERTANGGUNGJAWABAN BENDAHARA PENGELUARAN<BR></b>
                </td>
            </tr>
            <tr>
                <td align=\"left\" style=\"font-size:12px;\" width=\"25%\">
                  SKPD
                </td> 
                <td width=\"75%\" style=\"font-size:12px;\">: $skpd - $nama
                </td>         
            </tr>
            
            <tr>
                <td align=\"left\" style=\"font-size:12px;\">
                  Tahun Anggaran
                </td> 
                <td style=\"font-size:12px;\">: $thn_ang
                </td>         
            </tr>
            <tr>
                <td align=\"left\" style=\"font-size:12px;\">
                  Bulan
                </td> 
                <td style=\"font-size:12px;\">: $bulan
                </td>         
            </tr>
            <tr>
                <td align=\"left\" style=\"font-size:12px;\" colspan=\"2\">
                 &nbsp;
                </td> 
            </tr>
            
            </table>
            <table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <thead>
            <tr>
                <td bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\" style=\"font-size:12px\"><b>Kode<br>Rekening</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\" style=\"font-size:12px\"><b>Uraian</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\" style=\"font-size:12px\"><b>Jumlah<br>Anggaran</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" colspan=\"3\" style=\"font-size:12px\"><b>SPJ-LS Gaji</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" colspan=\"3\" style=\"font-size:12px\"><b>SPJ-LS Barang & Jasa</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" colspan=\"3\" style=\"font-size:12px\"><b>SPJ UP/GU/TU</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\" style=\"font-size:12px\"><b>Jumlah SPJ<br>(LS+UP/GU/TU)<br>s.d Bulan Ini</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\" style=\"font-size:12px\"><b>Sisa Pagu<br>Anggaran</b></td>
            </tr>
            <tr>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>s.d<br>Bulan<br>lalu</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>Bulan Ini</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>s.d<br>Bulan Ini</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>s.d<br>Bulan<br>lalu</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>Bulan Ini</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>s.d<br>Bulan Ini</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>s.d<br>Bulan<br>lalu</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>Bulan Ini</b></td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\"><b>s.d<br>Bulan Ini</b></td>
            </tr>                 
            <tr>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">1</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">2</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">3</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">4</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">5</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">6</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">7</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">8</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">9</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">10</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">11</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">12</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">13</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"font-size:12px\">14</td>
            </tr> 
             </thead>
            <tr>
                <td align=\"center\" style=\"font-size:12px\">&nbsp;</td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
            </tr>";
			/*
			$att="select * from (
select a.kd_kegiatan+'.'+a.kd_rek5 as kd_rek, nm_rek5 as uraian, anggaran, isnull(gaji_lalu,0) as gaji_lalu, isnull(gaji_ini,0) as gaji_ini, 
isnull(brg_lalu,0) as brg_lalu, isnull(brg_ini,0) as brg_ini, isnull(up_lalu,0) as up_lalu, isnull(up_ini,0) as up_ini from
(select kd_kegiatan, kd_rek5, nm_rek5, sum($anggaran) as anggaran from trdrka where LEFT(kd_rek5,1)=5 and kd_skpd='$lcskpd' group by kd_kegiatan, kd_rek5, nm_rek5) a
left join
(select kd_kegiatan, kd_rek5, sum(gaji_lalu) as gaji_lalu, sum(gaji_ini) as gaji_ini, sum(brg_lalu) as brg_lalu, 
sum(brg_ini) as brg_ini, sum(up_lalu) as up_lalu, sum(up_ini) as up_ini from
(select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, isnull(a.nilai,0) as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)=$nbulan and jns_spp in (1,2,3)
union all
select b.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdinlain a join TRHINLAIN b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.TGL_BUKTI)=$nbulan and b.pengurang_belanja=1
union all
select a.kd_kegiatan, a.kd_rek5, isnull(a.nilai,0) as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)=$nbulan and jns_spp in (4)
union all
select a.kd_kegiatan, a.kd_rek5, isnull(a.rupiah*-1,0) as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_sts)=$nbulan and b.jns_cp in (1) and b.pot_khusus<>0
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, isnull(a.nilai,0) as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)=$nbulan and jns_spp in (6)
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, isnull(a.rupiah*-1,0) as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_sts)=$nbulan and b.jns_cp in (2) and b.pot_khusus<>0
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, isnull(a.nilai,0) as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)<$nbulan and jns_spp in (1,2,3)
union all
select b.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, isnull(a.nilai*-1,0) as up_lalu from trdinlain a join TRHINLAIN b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.TGL_BUKTI)<=$nbulan and b.pengurang_belanja=1
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, isnull(a.nilai,0) as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)<$nbulan and jns_spp in (4)
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, isnull(a.rupiah*-1,0) as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_sts)<$nbulan and b.jns_cp in (1) and b.pot_khusus<>0
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, isnull(a.nilai,0) as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)<$nbulan and jns_spp in (6)
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, isnull(a.rupiah*-1,0) as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_sts)<$nbulan and b.jns_cp in (2) and b.pot_khusus<>0) a group by kd_kegiatan, kd_rek5) b
on a.kd_kegiatan=b.kd_kegiatan and a.kd_rek5=b.kd_rek5
union all
select a.kd_kegiatan as kd_rek, a.nm_kegiatan as uraian, anggaran, isnull(gaji_lalu,0) as gaji_lalu, isnull(gaji_ini,0) as gaji_ini, 
isnull(brg_lalu,0) as brg_lalu, isnull(brg_ini,0) as brg_ini, isnull(up_lalu,0) as up_lalu, isnull(up_ini,0) as up_ini from
(select kd_kegiatan, nm_kegiatan, sum($anggaran) as anggaran from trdrka where LEFT(kd_rek5,1)=5 and kd_skpd='$lcskpd' group by kd_kegiatan, nm_kegiatan) a
left join
(select kd_kegiatan, '' as kd_rek5, sum(gaji_lalu) as gaji_lalu, sum(gaji_ini) as gaji_ini, sum(brg_lalu) as brg_lalu, 
sum(brg_ini) as brg_ini, sum(up_lalu) as up_lalu, sum(up_ini) as up_ini from
(select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, isnull(a.nilai,0) as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)=$nbulan and jns_spp in (1,2,3)
union all
select b.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdinlain a join TRHINLAIN b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.TGL_BUKTI)=$nbulan and b.pengurang_belanja=1
union all
select a.kd_kegiatan, a.kd_rek5, isnull(a.nilai,0) as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)=$nbulan and jns_spp in (4)
union all
select a.kd_kegiatan, a.kd_rek5, isnull(a.rupiah*-1,0) as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_sts)=$nbulan and b.jns_cp in (1) and b.pot_khusus<>0
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, isnull(a.nilai,0) as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)=$nbulan and jns_spp in (6)
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, isnull(a.rupiah*-1,0) as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_sts)=$nbulan and b.jns_cp in (2) and b.pot_khusus<>0
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, isnull(a.nilai,0) as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)<$nbulan and jns_spp in (1,2,3)
union all
select b.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, isnull(a.nilai*-1,0) as up_lalu from trdinlain a join TRHINLAIN b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.TGL_BUKTI)<=$nbulan and b.pengurang_belanja=1
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, isnull(a.nilai,0) as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)<$nbulan and jns_spp in (4)
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, isnull(a.rupiah*-1,0) as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_sts)<$nbulan and b.jns_cp in (1) and b.pot_khusus<>0
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, isnull(a.nilai,0) as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)<$nbulan and jns_spp in (6)
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, isnull(a.rupiah*-1,0) as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_sts)<$nbulan and b.jns_cp in (2) and b.pot_khusus<>0) a group by kd_kegiatan
) b on a.kd_kegiatan=b.kd_kegiatan
union all
select a.kd_program as kd_rek, a.nm_program as uraian, anggaran, isnull(gaji_lalu,0) as gaji_lalu, isnull(gaji_ini,0) as gaji_ini, 
isnull(brg_lalu,0) as brg_lalu, isnull(brg_ini,0) as brg_ini, isnull(up_lalu,0) as up_lalu, isnull(up_ini,0) as up_ini from
(select kd_program, nm_program, anggaran from (select left(kd_kegiatan,18) as kd_kegiatan, sum($anggaran) as anggaran from trdrka 
where LEFT(kd_rek5,1)=5 and kd_skpd='$lcskpd' group by left(kd_kegiatan,18)) a join m_prog b on left(a.kd_kegiatan,18)=b.kd_program) a
left join
(select left(kd_kegiatan,18) as kd_kegiatan, '' as kd_rek5, sum(gaji_lalu) as gaji_lalu, sum(gaji_ini) as gaji_ini, sum(brg_lalu) as brg_lalu, 
sum(brg_ini) as brg_ini, sum(up_lalu) as up_lalu, sum(up_ini) as up_ini from
(select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, isnull(a.nilai,0) as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)=$nbulan and jns_spp in (1,2,3)
union all
select b.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdinlain a join TRHINLAIN b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.TGL_BUKTI)=$nbulan and b.pengurang_belanja=1
union all
select a.kd_kegiatan, a.kd_rek5, isnull(a.nilai,0) as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)=$nbulan and jns_spp in (4)
union all
select a.kd_kegiatan, a.kd_rek5, isnull(a.rupiah*-1,0) as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_sts)=$nbulan and b.jns_cp in (1) and b.pot_khusus<>0
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, isnull(a.nilai,0) as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)=$nbulan and jns_spp in (6)
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, isnull(a.rupiah*-1,0) as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_sts)=$nbulan and b.jns_cp in (2) and b.pot_khusus<>0
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, isnull(a.nilai,0) as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)<$nbulan and jns_spp in (1,2,3)
union all
select b.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, isnull(a.nilai*-1,0) as up_lalu from trdinlain a join TRHINLAIN b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.TGL_BUKTI)<=$nbulan and b.pengurang_belanja=1
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, isnull(a.nilai,0) as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)<$nbulan and jns_spp in (4)
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, isnull(a.rupiah*-1,0) as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_sts)<$nbulan and b.jns_cp in (1) and b.pot_khusus<>0
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, isnull(a.nilai,0) as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)<$nbulan and jns_spp in (6)
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, isnull(a.rupiah*-1,0) as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_sts)<$nbulan and b.jns_cp in (2) and b.pot_khusus<>0) a group by left(kd_kegiatan,18)
) b on a.kd_program=b.kd_kegiatan
union all
select 'JUMLAH' as kd_rek, '' as uraian, sum(anggaran), isnull(sum(gaji_lalu),0) as gaji_lalu, isnull(sum(gaji_ini),0) as gaji_ini, 
isnull(sum(brg_lalu),0) as brg_lalu, isnull(sum(brg_ini),0) as brg_ini, isnull(sum(up_lalu),0) as up_lalu, isnull(sum(up_ini),0) as up_ini from
(select kd_kegiatan, kd_rek5, nm_rek5, sum($anggaran) as anggaran from trdrka where LEFT(kd_rek5,1)=5 and kd_skpd='$lcskpd' group by kd_kegiatan, kd_rek5, nm_rek5) a
left join
(select kd_kegiatan, kd_rek5, sum(gaji_lalu) as gaji_lalu, sum(gaji_ini) as gaji_ini, sum(brg_lalu) as brg_lalu, 
sum(brg_ini) as brg_ini, sum(up_lalu) as up_lalu, sum(up_ini) as up_ini from
(select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, isnull(a.nilai,0) as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)=$nbulan and jns_spp in (1,2,3)
union all
select b.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdinlain a join TRHINLAIN b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.TGL_BUKTI)=$nbulan and b.pengurang_belanja=1
union all
select a.kd_kegiatan, a.kd_rek5, isnull(a.nilai,0) as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)=$nbulan and jns_spp in (4)
union all
select a.kd_kegiatan, a.kd_rek5, isnull(a.rupiah*-1,0) as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_sts)=$nbulan and b.jns_cp in (1) and b.pot_khusus<>0
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, isnull(a.nilai,0) as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)=$nbulan and jns_spp in (6)
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, isnull(a.rupiah*-1,0) as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_sts)=$nbulan and b.jns_cp in (2) and b.pot_khusus<>0
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, isnull(a.nilai,0) as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)<$nbulan and jns_spp in (1,2,3)
union all
select b.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, isnull(a.nilai*-1,0) as up_lalu from trdinlain a join TRHINLAIN b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.TGL_BUKTI)<=$nbulan and b.pengurang_belanja=1
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, isnull(a.nilai,0) as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)<$nbulan and jns_spp in (4)
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, isnull(a.rupiah*-1,0) as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_sts)<$nbulan and b.jns_cp in (1) and b.pot_khusus<>0
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, isnull(a.nilai,0) as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_bukti)<$nbulan and jns_spp in (6)
union all
select a.kd_kegiatan, a.kd_rek5, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, isnull(a.rupiah*-1,0) as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
where MONTH(b.tgl_sts)<$nbulan and b.jns_cp in (2) and b.pot_khusus<>0) a group by kd_kegiatan, kd_rek5) b
on a.kd_kegiatan=b.kd_kegiatan and a.kd_rek5=b.kd_rek5
) a order by kd_rek, uraian"; */

				$att="exec spj_skpd_2 '$lcskpd','$nbulan','$ang'";
				$hasil=$this->db->query($att);
				foreach ($hasil->result() as $trh1){
				$bre				=	$trh1->kd_rek;
				$wok				=	$trh1->uraian;
				$nilai				=	$trh1->anggaran;
				$real_up_ini		=	$trh1->up_ini;
				$real_up_ll			=	$trh1->up_lalu;
				$real_gaji_ini		=	$trh1->gaji_ini;
				$real_gaji_ll		=	$trh1->gaji_lalu;
				$real_brg_js_ini	=	$trh1->brg_ini;
				$real_brg_js_ll		=	$trh1->brg_lalu;
				$total	= $real_gaji_ll+$real_gaji_ini+$real_brg_js_ll+$real_brg_js_ini+$real_up_ll+$real_up_ini;
				$sisa	= $nilai-$real_gaji_ll-$real_gaji_ini-$real_brg_js_ll-$real_brg_js_ini-$real_up_ll-$real_up_ini;
				$a=strlen($bre);
			if($a==18){
			$cRet .="
           <tr>
                <td style=\"border-top:double;border-bottom:double;\" valign=\"top\" width=\"8%\" align=\"left\" style=\"font-size:12px\" ><b>".$bre."</b></td>
                <td style=\"border-top:double;border-bottom:double;\" valign=\"top\" align=\"left\" width=\"25%\" style=\"font-size:12px\"><b>".$wok."</b></td>
                <td style=\"border-top:double;border-bottom:double;\" valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($nilai,"2",",",".")."</b>&nbsp;</td>
                <td style=\"border-top:double;border-bottom:double;\" valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_gaji_ll,"2",",",".")."</b>&nbsp;</td>
                <td style=\"border-top:double;border-bottom:double;\" valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_gaji_ini,"2",",",".")."</b>&nbsp;</td>
                <td style=\"border-top:double;border-bottom:double;\" valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_gaji_ll+$real_gaji_ini,"2",",",".")."</b>&nbsp;</td>
                <td style=\"border-top:double;border-bottom:double;\" valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_brg_js_ll,"2",",",".")."</b>&nbsp;</td>
                <td style=\"border-top:double;border-bottom:double;\" valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_brg_js_ini,"2",",",".")."</b>&nbsp;</td>
                <td style=\"border-top:double;border-bottom:double;\" valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_brg_js_ll+$real_brg_js_ini,"2",",",".")."</b>&nbsp;</td>
                <td style=\"border-top:double;border-bottom:double;\" valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_up_ll,"2",",",".")."</b>&nbsp;</td>
                <td style=\"border-top:double;border-bottom:double;\" valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_up_ini,"2",",",".")."</b>&nbsp;</td>
                <td style=\"border-top:double;border-bottom:double;\" valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_up_ll+$real_up_ini,"2",",",".")."</b>&nbsp;</td>
                <td style=\"border-top:double;border-bottom:double;\" valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($total,"2",",",".")."</b>&nbsp;</b></td>
                <td style=\"border-top:double;border-bottom:double;\" valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($sisa,"2",",",".")."</b>&nbsp;</td>
            </tr>";
			}else if($a==21){
			$cRet .="
           <tr>
                <td valign=\"top\" width=\"8%\" align=\"left\" style=\"font-size:12px\" ><b>".$bre."</b></td>
                <td valign=\"top\" align=\"left\" width=\"25%\" style=\"font-size:12px\"><b>".$wok."</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($nilai,"2",",",".")."&nbsp;</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_gaji_ll,"2",",",".")."&nbsp;</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_gaji_ini,"2",",",".")."&nbsp;</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_gaji_ll+$real_gaji_ini,"2",",",".")."</b>&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_brg_js_ll,"2",",",".")."</b>&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_brg_js_ini,"2",",",".")."</b>&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_brg_js_ll+$real_brg_js_ini,"2",",",".")."</b>&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_up_ll,"2",",",".")."</b>&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_up_ini,"2",",",".")."</b>&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($real_up_ll+$real_up_ini,"2",",",".")."</b>&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($total,"2",",",".")."</b>&nbsp;</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($sisa,"2",",",".")."</b>&nbsp;</td>
            </tr>";
			} else{
			$cRet .="
				<tr>
                <td valign=\"top\" width=\"8%\" align=\"left\" style=\"font-size:12px\" >&nbsp;".substr($bre,22,7)."</td>
                <td valign=\"top\" align=\"left\" width=\"25%\" style=\"font-size:12px\">&nbsp;".$wok."</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($nilai,"2",",",".")."&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_gaji_ll,"2",",",".")."&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_gaji_ini,"2",",",".")."&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_gaji_ll+$real_gaji_ini,"2",",",".")."&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_brg_js_ll,"2",",",".")."&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_brg_js_ini,"2",",",".")."&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_brg_js_ll+$real_brg_js_ini,"2",",",".")."&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_up_ll,"2",",",".")."&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_up_ini,"2",",",".")."&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($real_up_ll+$real_up_ini,"2",",",".")."&nbsp;</td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($total,"2",",",".")."&nbsp;</b></td>
                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($sisa,"2",",",".")."&nbsp;</td>
            </tr>";
			}
			}
			$cRet .="

            <tr>
                <td valign=\"top\" align=\"center\" style=\"font-size:12px\" >&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">Penerimaan :</td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td valign=\"top\" align=\"center\" style=\"font-size:12px\">&nbsp;</td>
            </tr>";
            
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
                    MONTH(a.tgl_kas)='$nbulan' AND c.jns_spp IN ('1','2','3') AND a.status='1') AS sp2d_up_ini,
                    (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
                    MONTH(a.tgl_kas)<'$nbulan' AND c.jns_spp IN ('1','2','3') AND a.status='1') AS sp2d_up_ll,
                    (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
                    MONTH(a.tgl_kas)='$nbulan' AND c.jns_spp ='4' AND a.status='1') AS sp2d_gj_ini,
                    (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
                    MONTH(a.tgl_kas)<'$nbulan' AND c.jns_spp ='4'  AND a.status='1') AS sp2d_gj_ll,
                    (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
                    MONTH(a.tgl_kas)='$nbulan' AND c.jns_spp ='6'  AND a.status='1') AS sp2d_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhsp2d a INNER JOIN trdspp b 
                    ON a.no_spp = b.no_spp INNER JOIN trhspp c
                    ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd' AND 
                    MONTH(a.tgl_kas)<'$nbulan' AND c.jns_spp ='6' AND a.status='1') AS sp2d_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh1 = $hasil->row(); 
            $totalsp2d = $trh1->sp2d_gj_ll+$trh1->sp2d_gj_ini+$trh1->sp2d_brjs_ll+
                         $trh1->sp2d_brjs_ini+$trh1->sp2d_up_ll+$trh1->sp2d_up_ini;
                         
            $cobacoba = $trh1->sp2d_gj_ll;
            
            
            
            $cRet .="   
            <tr>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\" >&ensp;&ensp;- SP2D</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_gj_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_gj_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_gj_ll + $trh1->sp2d_gj_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_brjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_brjs_ll + $trh1->sp2d_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_up_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh1->sp2d_up_ll + $trh1->sp2d_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalsp2d,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr> ";           
            
			$csqlsp2d = "SELECT a.no_sp2d,
						SUM(CASE WHEN a.jns_spp IN ('4') AND MONTH(a.tgl_kas)<$nbulan THEN b.nilai ELSE 0 END) AS gj_ll,
						SUM(CASE WHEN a.jns_spp IN ('4') AND MONTH(a.tgl_kas)=$nbulan THEN b.nilai ELSE 0 END) AS gj_ini,
						SUM(CASE WHEN a.jns_spp IN ('4') AND MONTH(a.tgl_kas)<=$nbulan THEN b.nilai ELSE 0 END) AS gj_sdini,
						SUM(CASE WHEN a.jns_spp IN ('6') AND MONTH(a.tgl_kas)<$nbulan THEN b.nilai ELSE 0 END) AS br_ll,
						SUM(CASE WHEN a.jns_spp IN ('6') AND MONTH(a.tgl_kas)=$nbulan THEN b.nilai ELSE 0 END) AS br_ini,
						SUM(CASE WHEN a.jns_spp IN ('6') AND MONTH(a.tgl_kas)<=$nbulan THEN b.nilai ELSE 0 END) AS br_sdini,
						SUM(CASE WHEN a.jns_spp IN ('1','2','3') AND MONTH(a.tgl_kas)<$nbulan THEN b.nilai ELSE 0 END) AS up_ll,
						SUM(CASE WHEN a.jns_spp IN ('1','2','3') AND MONTH(a.tgl_kas)=$nbulan THEN b.nilai ELSE 0 END) AS up_ini,
						SUM(CASE WHEN a.jns_spp IN ('1','2','3') AND MONTH(a.tgl_kas)<=$nbulan THEN b.nilai ELSE 0 END) AS up_sdini
						FROM trhsp2d a INNER JOIN trdspp b 
						ON a.no_spp = b.no_spp INNER JOIN trhspp c
						ON a.no_spp = c.no_spp WHERE a.kd_skpd = '$lcskpd'
						AND a.status='1' AND MONTH(a.tgl_kas)=$nbulan
						GROUP BY a.no_sp2d";
			
			$hasilsp2d=$this->db->query($csqlsp2d);
				foreach ($hasilsp2d->result() as $trsp2d){
				$xno_sp2d	=	$trsp2d->no_sp2d;
				$xup_ll		=	$trsp2d->up_ll;
				$xup_ini	=	$trsp2d->up_ini;
				$xup_sdini	=	$trsp2d->up_sdini;
				$xbr_ll		=	$trsp2d->br_ll;
				$xbr_ini	=	$trsp2d->br_ini;
				$xbr_sdini	=	$trsp2d->br_sdini;
				$xgj_ll		=	$trsp2d->gj_ll;
				$xgj_ini	=	$trsp2d->gj_ini;
				$xgj_sdini	=	$trsp2d->gj_sdini;
			
			
			$cRet .="   
            <tr>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp; $xno_sp2d</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xgj_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xgj_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xgj_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xbr_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xbr_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xbr_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xup_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xup_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xup_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($xgj_sdini+$xbr_sdini+$xup_sdini,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
		   </tr> "; 
				}
			$cRet .="
            <tr>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Potongan Pajak</td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
            $lcrek = '2130301';//'2110401'; // ppn terima
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jppn_up_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jppn_up_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS jppn_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS jppn_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS jppn_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS jppn_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh2 = $hasil->row();
            $totalppn = $trh2->jppn_up_ini + $trh2->jppn_up_ll + $trh2->jppn_gaji_ini + 
                        $trh2->jppn_gaji_ll + $trh2->jppn_brjs_ini + $trh2->jppn_brjs_ll;
            
            
            $cRet .=" 
            <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;a. PPN</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_gaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_gaji_ll + $trh2->jppn_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_brjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_brjs_ll + $trh2->jppn_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_up_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh2->jppn_up_ll + $trh2->jppn_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalppn,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
			</tr>";
            
            $lcrek = '2130101'; // pph 21 terima
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph21_up_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph21_up_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS jpph21_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS jpph21_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS jpph21_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS jpph21_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh3 = $hasil->row();
            $totalpph21 = $trh3->jpph21_up_ini + $trh3->jpph21_up_ll + $trh3->jpph21_gaji_ini + 
                        $trh3->jpph21_gaji_ll + $trh3->jpph21_brjs_ini + $trh3->jpph21_brjs_ll;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;b. PPH 21</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_gaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_gaji_ll + $trh3->jpph21_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_brjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_brjs_ll + $trh3->jpph21_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_up_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh3->jpph21_up_ll + $trh3->jpph21_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalpph21,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
            $lcrek = '2130201'; // pph 22 terima
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph22_up_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph22_up_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS jpph22_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS jpph22_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS jpph22_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS jpph22_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh4 = $hasil->row();
            $totalpph22 = $trh4->jpph22_up_ini + $trh4->jpph22_up_ll + $trh4->jpph22_gaji_ini + 
                        $trh4->jpph22_gaji_ll + $trh4->jpph22_brjs_ini + $trh4->jpph22_brjs_ll;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;c. PPH 22</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_gaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_gaji_ll + $trh4->jpph22_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_brjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_brjs_ll + $trh4->jpph22_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_up_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh4->jpph22_up_ll + $trh4->jpph22_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalpph22,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
			$lcrek = '2130401'; // pph 23 terima
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph23_up_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph23_up_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS jpph23_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS jpph23_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS jpph23_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS jpph23_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh5 = $hasil->row();
            $totalpph23 = $trh5->jpph23_up_ini + $trh5->jpph23_up_ll + $trh5->jpph23_gaji_ini + 
                        $trh5->jpph23_gaji_ll + $trh5->jpph23_brjs_ini + $trh5->jpph23_brjs_ll;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;d. PPH 23</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_gaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_gaji_ll + $trh5->jpph23_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_brjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_brjs_ll + $trh5->jpph23_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_up_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh5->jpph23_up_ll + $trh5->jpph23_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalpph23,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			
           
			
            
			$lcrek = '2110701'; // IWP
            $csql = "SELECT 
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<'$nbulan' THEN a.nilai ELSE 0 END) AS up_iwp_lalu,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)='$nbulan' THEN a.nilai ELSE 0 END) AS up_iwp_ini,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<='$nbulan' THEN a.nilai ELSE 0 END) AS up_iwp_sdini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<'$nbulan' THEN a.nilai ELSE 0 END) AS gj_iwp_lalu,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)='$nbulan' THEN a.nilai ELSE 0 END) AS gj_iwp_ini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<='$nbulan' THEN a.nilai ELSE 0 END) AS gj_iwp_sdini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<'$nbulan' THEN a.nilai ELSE 0 END) AS ls_iwp_lalu,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)='$nbulan' THEN a.nilai ELSE 0 END) AS ls_iwp_ini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<='$nbulan' THEN a.nilai ELSE 0 END) AS ls_iwp_sdini
					FROM trdtrmpot a INNER JOIN trhtrmpot b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_rek5='$lcrek' AND a.kd_skpd='$lcskpd'";
            
            $hasil = $this->db->query($csql);
            $trh70 = $hasil->row();
            $totaliwp = $trh70->up_iwp_sdini + $trh70->gj_iwp_sdini + $trh70->ls_iwp_sdini;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. IWP</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->gj_iwp_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->gj_iwp_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->gj_iwp_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->ls_iwp_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->ls_iwp_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->ls_iwp_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->up_iwp_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->up_iwp_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh70->up_iwp_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totaliwp,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			$lcrek = '2110501'; // TAPERUM
            $csql = "SELECT 
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<'$nbulan' THEN a.nilai ELSE 0 END) AS up_tap_lalu,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)='$nbulan' THEN a.nilai ELSE 0 END) AS up_tap_ini,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<='$nbulan' THEN a.nilai ELSE 0 END) AS up_tap_sdini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<'$nbulan' THEN a.nilai ELSE 0 END) AS gj_tap_lalu,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_tap_ini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_tap_sdini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS ls_tap_lalu,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_tap_ini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_tap_sdini
					FROM trdtrmpot a INNER JOIN trhtrmpot b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_rek5='$lcrek' AND a.kd_skpd='$lcskpd'";
            
            $hasil = $this->db->query($csql);
            $trh71 = $hasil->row();
            $totaltap = $trh71->up_tap_sdini + $trh71->gj_tap_sdini + $trh71->ls_tap_sdini;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. Taperum</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->gj_tap_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->gj_tap_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->gj_tap_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->ls_tap_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->ls_tap_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->ls_tap_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->up_tap_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->up_tap_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh71->up_tap_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totaltap,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			
			$lcrek = '2130501'; // pph4
            $csql = "SELECT 
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS up_pph4_lalu,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS up_pph4_ini,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS up_pph4_sdini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS gj_pph4_lalu,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_pph4_ini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_pph4_sdini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS ls_pph4_lalu,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_pph4_ini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_pph4_sdini
					FROM trdtrmpot a INNER JOIN trhtrmpot b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_rek5='$lcrek' AND a.kd_skpd='$lcskpd'";
            
            $hasil = $this->db->query($csql);
            $trh72 = $hasil->row();
            $totalpph4 = $trh72->up_pph4_sdini + $trh72->gj_pph4_sdini + $trh72->ls_pph4_sdini;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. PPh Pasal 4</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->gj_pph4_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->gj_pph4_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->gj_pph4_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->ls_pph4_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->ls_pph4_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->ls_pph4_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->up_pph4_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->up_pph4_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh72->up_pph4_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalpph4,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			
			$lcrek = '2110901'; // PPnPn
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS ppnpn_up_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS ppnpn_up_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS ppnpn_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS ppnpn_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS ppnpn_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhtrmpot a INNER JOIN trdtrmpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS ppnpn_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh15 = $hasil->row();
            $totalppnpn = $trh15->ppnpn_up_ini + $trh15->ppnpn_up_ll + $trh15->ppnpn_gaji_ini + 
                        $trh15->ppnpn_gaji_ll + $trh15->ppnpn_brjs_ini + $trh15->ppnpn_brjs_ll;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. Iuran Wajib PPNPN</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_gaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_gaji_ll + $trh15->ppnpn_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_brjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_brjs_ll + $trh15->ppnpn_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_up_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh15->ppnpn_up_ll + $trh15->ppnpn_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalppnpn,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			
			
			
			
			
			
			
			
			
			
            // lain terima
            $csql = "SELECT 
					SUM(ISNULL(jlain_up_ll,0)) jlain_up_ll, SUM(ISNULL(jlain_up_ini,0)) jlain_up_ini, 
					SUM(ISNULL(jlain_gaji_ll,0)) jlain_gaji_ll, SUM(ISNULL(jlain_gaji_ini,0)) jlain_gaji_ini, 
					SUM(ISNULL(jlain_brjs_ll,0)) jlain_brjs_ll, SUM(ISNULL(jlain_brjs_ini,0)) jlain_brjs_ini
					 FROM(
					SELECT 
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<'$nbulan' AND a.kd_rek5 NOT IN ('2130101','2130201','2130401','2130301','2110901','2110701','2110501','2130501') THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_up_ll,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)='$nbulan' AND a.kd_rek5 NOT IN ('2130101','2130201','2130401','2130301','2110901','2110701','2110501','2130501') THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_up_ini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<'$nbulan' AND a.kd_rek5 NOT IN ('2130101','2130201','2130401','2130301','2110901','2110701','2110501','2130501') THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_gaji_ll,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)='$nbulan' AND a.kd_rek5 NOT IN ('2130101','2130201','2130401','2130301','2110901','2110701','2110501','2130501') THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_gaji_ini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<'$nbulan' AND a.kd_rek5 NOT IN ('2130101','2130201','2130401','2130301','2110901','2110701','2110501','2130501') THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_brjs_ll,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)='$nbulan' AND a.kd_rek5 NOT IN ('2130101','2130201','2130401','2130301','2110901','2110701','2110501','2130501') THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_brjs_ini
					FROM trdtrmpot a INNER JOIN trhtrmpot b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd='$lcskpd'
					UNION ALL
					SELECT 
					SUM(CASE WHEN a.jns_beban='1' AND MONTH(a.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_up_ll,
					SUM(CASE WHEN a.jns_beban='1' AND MONTH(a.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_up_ini,
					SUM(CASE WHEN a.jns_beban='4' AND MONTH(a.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_gaji_ll,
					SUM(CASE WHEN a.jns_beban='4' AND MONTH(a.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_gaji_ini,
					SUM(CASE WHEN a.jns_beban='6' AND MONTH(a.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_brjs_ll,
					SUM(CASE WHEN a.jns_beban='6' AND MONTH(a.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_brjs_ini
					FROM TRHINLAIN a WHERE pengurang_belanja !='1'
					AND a.kd_skpd='$lcskpd'
					) a ";

			
			
					
					
					
            $tox_awal="SELECT isnull(sld_awal,0) AS jumlah FROM ms_skpd where kd_skpd='$lcskpd'";
            $hasil = $this->db->query($tox_awal);
            $tox = $hasil->row('jumlah');
            
            $hasil = $this->db->query($csql);
            $trh6 = $hasil->row();
            $totallain = $trh6->jlain_up_ini + $trh6->jlain_up_ll + $trh6->jlain_gaji_ini + 
                         $trh6->jlain_gaji_ll + $trh6->jlain_brjs_ini + $trh6->jlain_brjs_ll;
            
            //-------- TOTAL PENERIMAAN
            $jmtrmgaji_ll =  $trh1->sp2d_gj_ll+ $trh2->jppn_gaji_ll + $trh3->jpph21_gaji_ll +
                             $trh4->jpph22_gaji_ll + $trh5->jpph23_gaji_ll + $trh6->jlain_gaji_ll+ $trh15->ppnpn_gaji_ll+
							 $trh70->gj_iwp_lalu + $trh71->gj_tap_lalu+$trh72->gj_pph4_lalu;
            
            $jmtrmgaji_ini =  $trh1->sp2d_gj_ini + $trh2->jppn_gaji_ini + $trh3->jpph21_gaji_ini +
                             $trh4->jpph22_gaji_ini + $trh5->jpph23_gaji_ini + $trh6->jlain_gaji_ini+ $trh15->ppnpn_gaji_ini+
							 $trh70->gj_iwp_ini + $trh71->gj_tap_ini+$trh72->gj_pph4_ini;
                             
            $jmtrmgaji_sd = $jmtrmgaji_ll + $jmtrmgaji_ini;
            
            
            $jmtrmbrjs_ll =  $trh1->sp2d_brjs_ll + $trh2->jppn_brjs_ll + $trh3->jpph21_brjs_ll +
                             $trh4->jpph22_brjs_ll + $trh5->jpph23_brjs_ll + $trh6->jlain_brjs_ll + $trh15->ppnpn_brjs_ll+
							 $trh70->ls_iwp_lalu + $trh71->ls_tap_lalu+$trh72->ls_pph4_lalu;
                                                                                                 
            $jmtrmbrjs_ini =  $trh1->sp2d_brjs_ini + $trh2->jppn_brjs_ini + $trh3->jpph21_brjs_ini +
                             $trh4->jpph22_brjs_ini + $trh5->jpph23_brjs_ini + $trh6->jlain_brjs_ini + $trh15->ppnpn_brjs_ini +
							 $trh70->ls_iwp_ini + $trh71->ls_tap_ini + $trh72->ls_pph4_ini;
                             
            $jmtrmbrjs_sd = $jmtrmbrjs_ll + $jmtrmbrjs_ini;
            
            $jmtrmup_ll =  $trh1->sp2d_up_ll + $trh2->jppn_up_ll + $trh3->jpph21_up_ll +
                             $trh4->jpph22_up_ll + $trh5->jpph23_up_ll + $trh6->jlain_up_ll+$tox + $trh15->ppnpn_up_ll+
							 $trh70->up_iwp_ini + $trh71->up_tap_ini + $trh72->up_pph4_lalu;                           
            
            $jmtrmup_ini =  $trh1->sp2d_up_ini + $trh2->jppn_up_ini + $trh3->jpph21_up_ini +
                             $trh4->jpph22_up_ini + $trh5->jpph23_up_ini + $trh6->jlain_up_ini + $trh15->ppnpn_up_ini+
							 $trh70->up_iwp_ini + $trh71->up_tap_ini + $trh72->up_pph4_ini;
            
            $jmtrmup_sd = $jmtrmup_ll + $jmtrmup_ini;
            
            
            $cRet .="
                       
            <tr>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Lain-lain</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_gaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_gaji_ll + $trh6->jlain_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_brjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_brjs_ll + $trh6->jlain_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_up_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh6->jlain_up_ll + $trh6->jlain_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totallain,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>
            
            <tr>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">Jumlah Penerimaan :</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmgaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmgaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmgaji_sd,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmbrjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmbrjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmbrjs_sd,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmup_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmup_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmup_sd,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmgaji_sd + $jmtrmbrjs_sd + $jmtrmup_sd,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr> 
           
           
            
            <tr>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"center\" style=\"font-size:12px\" colspan=\"2\">&nbsp;</td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>
            
            <tr>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">Pengeluaran :</td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
           $csql = "select sum(gaji_lalu) as spj_gaji_ll, sum(gaji_ini) as spj_gaji_ini, sum(brg_lalu) as spj_brjs_ll, 
				sum(brg_ini) as spj_brjs_ini, sum(up_lalu) as spj_up_ll, sum(up_ini) as spj_up_ini from
				(select  a.kd_skpd, 0 as gaji_ini, 0 as brg_ini, isnull(a.nilai,0) as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
				where MONTH(b.tgl_bukti)='$nbulan' and jns_spp in (1,2,3) 
				union all
				select  a.kd_skpd, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdinlain a join TRHINLAIN b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
				where MONTH(b.TGL_BUKTI)='$nbulan' and b.pengurang_belanja=1
				union all
				select a.kd_skpd, isnull(a.nilai,0) as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
				where MONTH(b.tgl_bukti)='$nbulan' and jns_spp in (4)
				union all
				select  a.kd_skpd, isnull(a.rupiah*-1,0) as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
				where MONTH(b.tgl_sts)='$nbulan' and b.jns_cp in (1) and b.pot_khusus<>0
				union all
				select a.kd_skpd, 0 as gaji_ini, isnull(a.nilai,0) as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
				where MONTH(b.tgl_bukti)='$nbulan' and jns_spp in (6)
				union all
				select  a.kd_skpd, 0 as gaji_ini, isnull(a.rupiah*-1,0) as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
				where MONTH(b.tgl_sts)='$nbulan' and b.jns_cp in (2) and b.pot_khusus<>0
				union all
				select a.kd_skpd, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, isnull(a.nilai,0) as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
				where MONTH(b.tgl_bukti)<'$nbulan' and jns_spp in (1,2,3)
				union all
				select a.kd_skpd, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, 0 as brg_lalu, isnull(a.nilai*-1,0) as up_lalu from trdinlain a join TRHINLAIN b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
				where MONTH(b.TGL_BUKTI)<='$nbulan' and b.pengurang_belanja=1
				union all
				select a.kd_skpd, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, isnull(a.nilai,0) as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
				where MONTH(b.tgl_bukti)<'$nbulan' and jns_spp in (4)
				union all
				select a.kd_skpd, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, isnull(a.rupiah*-1,0) as gaji_lalu, 0 as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
				where MONTH(b.tgl_sts)<'$nbulan' and b.jns_cp in (1) and b.pot_khusus<>0
				union all
				select a.kd_skpd, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, isnull(a.nilai,0) as brg_lalu, 0 as up_lalu from trdtransout a join trhtransout b on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
				where MONTH(b.tgl_bukti)<'$nbulan' and jns_spp in (6)
				union all
				select a.kd_skpd, 0 as gaji_ini, 0 as brg_ini, 0 as up_ini, 0 as gaji_lalu, isnull(a.rupiah*-1,0) as brg_lalu, 0 as up_lalu from trdkasin_pkd a join trhkasin_pkd b on a.no_sts=b.no_sts and a.kd_skpd=b.kd_skpd
				where MONTH(b.tgl_sts)<'$nbulan' and b.jns_cp in (2) and b.pot_khusus<>0) a 
				WHERE a.kd_skpd='$lcskpd' ";

           
           $hasil = $this->db->query($csql);
           $trh7 = $hasil->row(); 
           $totalspj = $trh7->spj_gaji_ll + $trh7->spj_gaji_ini + $trh7->spj_brjs_ll + 
                       $trh7->spj_brjs_ini + $trh7->spj_up_ll + $trh7->spj_up_ini;
                                                            
           $cRet .="
            <tr>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;- SPJ(LS + UP/GU/TU)</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_gaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_gaji_ini + $trh7->spj_gaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_brjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_brjs_ini + $trh7->spj_brjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_up_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh7->spj_up_ini + $trh7->spj_up_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalspj,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>
            <tr>
			<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;- Penyetoran Pajak</td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
           $lcrek = '2130301';//'2110401'; // ppn setor
           $csql = "SELECT (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jppn_up_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jppn_up_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS jppn_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS jppn_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS jppn_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS jppn_brjs_ll";
            
           $hasil = $this->db->query($csql);
           $trh8 = $hasil->row();
           $totalppn = $trh8->jppn_up_ini + $trh8->jppn_up_ll + $trh8->jppn_gaji_ini + 
                        $trh8->jppn_gaji_ll + $trh8->jppn_brjs_ini + $trh8->jppn_brjs_ll;
            
            $cRet .="
            <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;a. PPN</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_gaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_gaji_ll + $trh8->jppn_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_brjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_brjs_ll + $trh8->jppn_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_up_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh8->jppn_up_ll + $trh8->jppn_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalppn,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
            
            $lcrek = '2130101'; // pph 21 setor
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph21_up_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph21_up_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS jpph21_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS jpph21_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS jpph21_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS jpph21_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh9 = $hasil->row();
            $totalpph21 = $trh9->jpph21_up_ini + $trh9->jpph21_up_ll + $trh9->jpph21_gaji_ini + 
                          $trh9->jpph21_gaji_ll + $trh9->jpph21_brjs_ini + $trh9->jpph21_brjs_ll;
            
            
            $cRet .="
             <tr> <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;b. PPH 21</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_gaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_gaji_ll + $trh9->jpph21_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_brjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_brjs_ll + $trh9->jpph21_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_up_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh9->jpph21_up_ll + $trh9->jpph21_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalpph21,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
            $lcrek = '2130201'; // pph 22 setor
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph22_up_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph22_up_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS jpph22_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS jpph22_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS jpph22_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS jpph22_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh10 = $hasil->row();
            $totalpph22 = $trh10->jpph22_up_ini + $trh10->jpph22_up_ll + $trh10->jpph22_gaji_ini + 
                        $trh10->jpph22_gaji_ll + $trh10->jpph22_brjs_ini + $trh10->jpph22_brjs_ll;
            
            
            $cRet .="
             <tr>
			 <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;c. PPH 22</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_gaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_gaji_ll + $trh10->jpph22_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_brjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_brjs_ll + $trh10->jpph22_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_up_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh10->jpph22_up_ll + $trh10->jpph22_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalpph22,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
            $lcrek = '2130401'; // pph 23 setor
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph23_up_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS jpph23_up_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS jpph23_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS jpph23_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS jpph23_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS jpph23_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh11 = $hasil->row();
            $totalpph23 = $trh11->jpph23_up_ini + $trh11->jpph23_up_ll + $trh11->jpph23_gaji_ini + 
                        $trh11->jpph23_gaji_ll + $trh11->jpph23_brjs_ini + $trh11->jpph23_brjs_ll;
            
            
            $cRet .="
             <tr>
			 <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;&ensp;&ensp;d. PPH 23</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_gaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_gaji_ll + $trh11->jpph23_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_brjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_brjs_ll + $trh11->jpph23_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_up_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh11->jpph23_up_ll + $trh11->jpph23_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalpph23,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			$lcrek = '2110701'; // IWP
            $csql = "SELECT 
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS up_iwp_lalu,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS up_iwp_ini,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS up_iwp_sdini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS gj_iwp_lalu,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_iwp_ini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_iwp_sdini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS ls_iwp_lalu,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_iwp_ini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_iwp_sdini
					FROM trdstrpot a INNER JOIN trhstrpot b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_rek5='$lcrek' AND a.kd_skpd='$lcskpd'";
            
            $hasil = $this->db->query($csql);
            $trh73 = $hasil->row();
            $totaliwp_setor = $trh73->up_iwp_sdini + $trh73->gj_iwp_sdini + $trh73->ls_iwp_sdini;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. IWP</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->gj_iwp_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->gj_iwp_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->gj_iwp_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->ls_iwp_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->ls_iwp_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->ls_iwp_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->up_iwp_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->up_iwp_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh73->up_iwp_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totaliwp_setor,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			$lcrek = '2110501'; // TAPERUM
            $csql = "SELECT 
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS up_tap_lalu,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS up_tap_ini,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS up_tap_sdini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS gj_tap_lalu,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_tap_ini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_tap_sdini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS ls_tap_lalu,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_tap_ini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_tap_sdini
					FROM trdstrpot a INNER JOIN trhstrpot b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_rek5='$lcrek' AND a.kd_skpd='$lcskpd'";
            
            $hasil = $this->db->query($csql);
            $trh74 = $hasil->row();
            $totaltap_setor = $trh74->up_tap_sdini + $trh74->gj_tap_sdini + $trh74->ls_tap_sdini;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. Taperum</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->gj_tap_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->gj_tap_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->gj_tap_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->ls_tap_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->ls_tap_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->ls_tap_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->up_tap_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->up_tap_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh74->up_tap_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totaltap_setor,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			
			$lcrek = '2130501'; // pph4
            $csql = "SELECT 
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS up_pph4_lalu,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS up_pph4_ini,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS up_pph4_sdini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS gj_pph4_lalu,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_pph4_ini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS gj_pph4_sdini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS ls_pph4_lalu,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_pph4_ini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<='$nbulan' THEN  a.nilai ELSE 0 END) AS ls_pph4_sdini
					FROM trdstrpot a INNER JOIN trhstrpot b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_rek5='$lcrek' AND a.kd_skpd='$lcskpd'";
            
            $hasil = $this->db->query($csql);
            $trh75 = $hasil->row();
            $totalpph4_setor = $trh75->up_pph4_sdini + $trh75->gj_pph4_sdini + $trh75->ls_pph4_sdini;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. PPh Pasal 4</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->gj_pph4_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->gj_pph4_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->gj_pph4_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->ls_pph4_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->ls_pph4_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->ls_pph4_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->up_pph4_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->up_pph4_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh75->up_pph4_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalpph4_setor,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			
			
			
			
			
			 $lcrek = '2110901'; // PPnpn
            $csql = "SELECT (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS ppnpn_up_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp IN('1','2','3')) AS ppnpn_up_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='4') AS ppnpn_gaji_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='4') AS ppnpn_gaji_ll,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)='$nbulan' AND 
                    a.jns_spp ='6') AS ppnpn_brjs_ini,
                    (SELECT SUM(b.nilai) FROM trhstrpot a INNER JOIN trdstrpot b
                    ON a.no_bukti = b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd = '$lcskpd' AND 
                    b.kd_rek5 = '$lcrek' AND MONTH(a.tgl_bukti)<'$nbulan' AND 
                    a.jns_spp ='6') AS ppnpn_brjs_ll";
            
            $hasil = $this->db->query($csql);
            $trh16 = $hasil->row();
            $totalppnpn = $trh16->ppnpn_up_ini + $trh16->ppnpn_up_ll + $trh16->ppnpn_gaji_ini + 
                        $trh16->ppnpn_gaji_ll + $trh16->ppnpn_brjs_ini + $trh16->ppnpn_brjs_ll;
            
            
            $cRet .="
             <tr>
			 <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. Iuran Wajib PPNPN</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_gaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_gaji_ll + $trh16->ppnpn_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_brjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_brjs_ll + $trh16->ppnpn_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_up_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh16->ppnpn_up_ll + $trh16->ppnpn_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalppnpn,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			// HKPG
            $csql = "SELECT 
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '3' and MONTH(tgl_sts)<'$nbulan' then a.rupiah else 0 end),0)) AS up_hkpg_lalu,
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '3' and MONTH(tgl_sts)='$nbulan' then a.rupiah else 0 end),0)) AS up_hkpg_ini,
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '3' and MONTH(tgl_sts)<='$nbulan' then a.rupiah else 0 end),0)) AS up_hkpg_sdini,
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '2' and MONTH(tgl_sts)<'$nbulan' then a.rupiah else 0 end),0)) AS ls_hkpg_lalu,
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '2' and MONTH(tgl_sts)='$nbulan' then a.rupiah else 0 end),0)) AS ls_hkpg_ini,
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '2' and MONTH(tgl_sts)<='$nbulan' then a.rupiah else 0 end),0)) AS ls_hkpg_sdini,
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '1' and MONTH(tgl_sts)<'$nbulan' then a.rupiah else 0 end),0)) AS gj_hkpg_lalu,
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '1' and MONTH(tgl_sts)='$nbulan' then a.rupiah else 0 end),0)) AS gj_hkpg_ini,
				SUM(isnull((case when pot_khusus='1' AND rtrim(jns_cp)= '1' and MONTH(tgl_sts)<='$nbulan' then a.rupiah else 0 end),0)) AS gj_hkpg_sdini
				FROM trdkasin_pkd a 
				INNER JOIN trhkasin_pkd b on a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd
				WHERE a.kd_skpd ='$lcskpd' AND jns_trans='5'";
							
            $hasil = $this->db->query($csql);
            $trhxx = $hasil->row();
            $totalhkpg = $trhxx->up_hkpg_sdini + $trhxx->gj_hkpg_sdini + $trhxx->ls_hkpg_sdini;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- HKPG</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->gj_hkpg_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->gj_hkpg_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->gj_hkpg_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->ls_hkpg_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->ls_hkpg_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->ls_hkpg_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->up_hkpg_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->up_hkpg_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxx->up_hkpg_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totalhkpg,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
			// Potongan Penghasilan Lainnya
            $csql = "SELECT 
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '3' and MONTH(tgl_sts)<'$nbulan'  then a.rupiah else 0 end),0)) AS up_lain_lalu,
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '3' and MONTH(tgl_sts)='$nbulan'  then a.rupiah else 0 end),0)) AS up_lain_ini,
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '3' and MONTH(tgl_sts)<='$nbulan'  then a.rupiah else 0 end),0)) AS up_lain_sdini,
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '2' and MONTH(tgl_sts)<'$nbulan'  then a.rupiah else 0 end),0)) AS ls_lain_lalu,
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '2' and MONTH(tgl_sts)='$nbulan'  then a.rupiah else 0 end),0)) AS ls_lain_ini,
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '2' and MONTH(tgl_sts)<='$nbulan'  then a.rupiah else 0 end),0)) AS ls_lain_sdini,
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '1' and MONTH(tgl_sts)<'$nbulan'  then a.rupiah else 0 end),0)) AS gj_lain_lalu,
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '1' and MONTH(tgl_sts)='$nbulan'  then a.rupiah else 0 end),0)) AS gj_lain_ini,
				SUM(isnull((case when pot_khusus='2' AND rtrim(jns_cp)= '1' and MONTH(tgl_sts)<='$nbulan'  then a.rupiah else 0 end),0)) AS gj_lain_sdini
				FROM trdkasin_pkd a 
				INNER JOIN trhkasin_pkd b on a.no_sts=b.no_sts AND a.kd_skpd=b.kd_skpd
				WHERE a.kd_skpd ='$lcskpd' AND jns_trans='5'";
							
            $hasil = $this->db->query($csql);
            $trhxy = $hasil->row();
            $totallain = $trhxy->up_lain_sdini + $trhxy->gj_lain_sdini + $trhxy->ls_lain_sdini;
            
            
            $cRet .="
             <tr><td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Pot. Penghasilan Lainnya</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->gj_lain_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->gj_lain_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->gj_lain_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->ls_lain_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->ls_lain_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->ls_lain_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->up_lain_lalu,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->up_lain_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trhxy->up_lain_sdini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totallain,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
			
            // CONTRA POS
            $csql = "select 
			SUM(isnull((case when rtrim(jns_cp)= '3' and MONTH(tgl_sts)='$nbulan' then z.nilai else 0 end),0)) AS cp_spj_up_ini,
			SUM(isnull((case when rtrim(jns_cp)= '3' and MONTH(tgl_sts)<'$nbulan' then z.nilai else 0 end),0)) AS cp_spj_up_ll,
			SUM(isnull((case when rtrim(jns_cp)= '1' and MONTH(tgl_sts)='$nbulan' then z.nilai else 0 end),0)) AS cp_spj_gaji_ini,
			SUM(isnull((case when rtrim(jns_cp)= '1' and MONTH(tgl_sts)<'$nbulan' then z.nilai else 0 end),0)) AS cp_spj_gaji_ll,
			SUM(isnull((case when rtrim(jns_cp)= '2' and MONTH(tgl_sts)='$nbulan' then z.nilai else 0 end),0)) AS cp_spj_brjs_ini,
			SUM(isnull((case when rtrim(jns_cp)= '2' and MONTH(tgl_sts)<'$nbulan' then z.nilai else 0 end),0)) AS cp_spj_brjs_ll
			from (select rupiah as nilai,jns_trans,pot_khusus,jns_cp,d.tgl_sts ,d.kd_skpd from 
			trdkasin_pkd c INNER JOIN trhkasin_pkd d ON c.no_sts = d.no_sts AND c.kd_skpd = d.kd_skpd where d.kd_skpd ='$lcskpd' AND 
			((jns_trans='5' AND pot_khusus='0') OR jns_trans='1')) z";
            
            $hasil = $this->db->query($csql);
            $trh_x = $hasil->row();
            $total_cp = $trh_x->cp_spj_up_ini + $trh_x->cp_spj_up_ll + $trh_x->cp_spj_gaji_ini + 
                        $trh_x->cp_spj_gaji_ll + $trh_x->cp_spj_brjs_ini + $trh_x->cp_spj_brjs_ll;
            
            
            $cRet .="
             <tr>
			 <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Contra Pos</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_gaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_gaji_ll + $trh_x->cp_spj_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_brjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_brjs_ll + $trh_x->cp_spj_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_up_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh_x->cp_spj_up_ll + $trh_x->cp_spj_up_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($total_cp,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";
            
            
            // lain lain setoran
          $csql = "SELECT 
					SUM(ISNULL(jlain_up_ll,0)) jlain_up_ll, SUM(ISNULL(jlain_up_ini,0)) jlain_up_ini, 
					SUM(ISNULL(jlain_gaji_ll,0)) jlain_gaji_ll, SUM(ISNULL(jlain_gaji_ini,0)) jlain_gaji_ini, 
					SUM(ISNULL(jlain_brjs_ll,0)) jlain_brjs_ll, SUM(ISNULL(jlain_brjs_ini,0)) jlain_brjs_ini
					 FROM(
					SELECT 
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)<'$nbulan' AND a.kd_rek5 NOT IN ('2130101','2130201','2130401','2130301','2110901','2110701','2110501','2130501') THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_up_ll,
					SUM(CASE WHEN b.jns_spp IN ('1','2','3') AND MONTH(b.tgl_bukti)='$nbulan' AND a.kd_rek5 NOT IN ('2130101','2130201','2130401','2130301','2110901','2110701','2110501','2130501') THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_up_ini,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)<'$nbulan' AND a.kd_rek5 NOT IN ('2130101','2130201','2130401','2130301','2110901','2110701','2110501','2130501') THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_gaji_ll,
					SUM(CASE WHEN b.jns_spp IN ('4') AND MONTH(b.tgl_bukti)='$nbulan' AND a.kd_rek5 NOT IN ('2130101','2130201','2130401','2130301','2110901','2110701','2110501','2130501') THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_gaji_ini,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)<'$nbulan' AND a.kd_rek5 NOT IN ('2130101','2130201','2130401','2130301','2110901','2110701','2110501','2130501') THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_brjs_ll,
					SUM(CASE WHEN b.jns_spp IN ('6') AND MONTH(b.tgl_bukti)='$nbulan' AND a.kd_rek5 NOT IN ('2130101','2130201','2130401','2130301','2110901','2110701','2110501','2130501') THEN  ISNULL(a.nilai,0) ELSE 0 END) AS jlain_brjs_ini
					FROM trdstrpot a INNER JOIN trhstrpot b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
					WHERE a.kd_skpd='$lcskpd'
					UNION ALL
					SELECT 
					SUM(CASE WHEN a.jns_beban='1' AND MONTH(a.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_up_ll,
					SUM(CASE WHEN a.jns_beban='1' AND MONTH(a.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_up_ini,
					SUM(CASE WHEN a.jns_beban='4' AND MONTH(a.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_gaji_ll,
					SUM(CASE WHEN a.jns_beban='4' AND MONTH(a.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_gaji_ini,
					SUM(CASE WHEN a.jns_beban='6' AND MONTH(a.tgl_bukti)<'$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_brjs_ll,
					SUM(CASE WHEN a.jns_beban='6' AND MONTH(a.tgl_bukti)='$nbulan' THEN  a.nilai ELSE 0 END) AS jlain_brjs_ini
					FROM TRHOUTLAIN a 
					WHERE a.kd_skpd='$lcskpd'
					) a ";
            $hasil = $this->db->query($csql);
            $trh12 = $hasil->row();
            $totallain = $trh12->jlain_up_ini + $trh12->jlain_up_ll + $trh12->jlain_gaji_ini + 
                         $trh12->jlain_gaji_ll + $trh12->jlain_brjs_ini + $trh12->jlain_brjs_ll;
            
            $tox_awal="SELECT isnull(sld_awal,0) AS jumlah FROM ms_skpd where kd_skpd='$lcskpd' and '1'=$nbulan";
            $hasil = $this->db->query($tox_awal);
            $tox_ini = $hasil->row('jumlah');
//			echo  $tox_ini;			   
            $tox_ini=(empty($tox_ini)?0:$tox_ini);

            $tox_awal="SELECT isnull(sld_awal,0) AS jumlah FROM ms_skpd where kd_skpd='$lcskpd' and '1'<$nbulan";
            $hasil = $this->db->query($tox_awal);
            $tox_ll = $hasil->row('jumlah');
            $tox_ll=(empty($tox_ll)?0:$tox_ll);

//			echo  '-'.$tox_ini;
//			echo  '-'.$tox_ll;
			
            $jmsetgaji_ll =  $trh7->spj_gaji_ll+ $trh8->jppn_gaji_ll + $trh9->jpph21_gaji_ll + $trh16->ppnpn_gaji_ll +
                             $trh10->jpph22_gaji_ll + $trh11->jpph23_gaji_ll + $trh12->jlain_gaji_ll+ $trh_x->cp_spj_gaji_ll+
							 $trh73->gj_iwp_lalu + $trh74->gj_tap_lalu+$trh75->gj_pph4_lalu+$trhxx->gj_hkpg_lalu+$trhxy->gj_lain_lalu;
            
            $jmsetgaji_ini = $trh7->spj_gaji_ini + $trh8->jppn_gaji_ini + $trh9->jpph21_gaji_ini + $trh16->ppnpn_gaji_ini +
                             $trh10->jpph22_gaji_ini + $trh11->jpph23_gaji_ini + $trh12->jlain_gaji_ini+$trh_x->cp_spj_gaji_ini+
							 $trh73->gj_iwp_ini + $trh74->gj_tap_ini+$trh75->gj_pph4_ini+$trhxx->gj_hkpg_ini+$trhxy->gj_lain_ini;
                             
            $jmsetgaji_sd = $jmsetgaji_ll + $jmsetgaji_ini;
            
            
            $jmsetbrjs_ll =  $trh7->spj_brjs_ll + $trh8->jppn_brjs_ll + $trh9->jpph21_brjs_ll + $trh16->ppnpn_brjs_ll +
                             $trh10->jpph22_brjs_ll + $trh11->jpph23_brjs_ll + $trh12->jlain_brjs_ll+$trh_x->cp_spj_brjs_ll+
							 $trh73->ls_iwp_lalu + $trh74->ls_tap_lalu+$trh75->ls_pph4_lalu+$trhxx->ls_hkpg_lalu+$trhxy->ls_lain_lalu;
                                                                                                 
            $jmsetbrjs_ini =  $trh7->spj_brjs_ini + $trh8->jppn_brjs_ini + $trh9->jpph21_brjs_ini + $trh16->ppnpn_brjs_ini +
                             $trh10->jpph22_brjs_ini + $trh11->jpph23_brjs_ini + $trh12->jlain_brjs_ini+$trh_x->cp_spj_brjs_ini+
							 $trh73->ls_iwp_ini + $trh74->ls_tap_ini+$trh75->ls_pph4_ini+$trhxx->ls_hkpg_ini+$trhxy->ls_lain_ini;
                             
            $jmsetbrjs_sd = $jmsetbrjs_ll + $jmsetbrjs_ini;
            /* 
            $jmsetup_ll =  $trh7->spj_up_ll + $trh8->jppn_up_ll + $trh9->jpph21_up_ll +
                             $trh10->jpph22_up_ll + $trh11->jpph23_up_ll + $trh12->jlain_up_ll; */
            
            $jmsetup_ll =  $trh7->spj_up_ll + $trh8->jppn_up_ll + $trh9->jpph21_up_ll + $trh16->ppnpn_up_ll +
                             $trh10->jpph22_up_ll + $trh11->jpph23_up_ll + $trh12->jlain_up_ll + $tox_ll+$trh_x->cp_spj_up_ll+
							 $trh73->up_iwp_lalu + $trh74->up_tap_lalu+$trh75->up_pph4_lalu+$trhxx->up_hkpg_lalu+$trhxy->up_lain_lalu;                             
            
            $jmsetup_ini =  $trh7->spj_up_ini + $trh8->jppn_up_ini + $trh9->jpph21_up_ini + $trh16->ppnpn_up_ini +
                             $trh10->jpph22_up_ini + $trh11->jpph23_up_ini + $trh12->jlain_up_ini+$tox_ini+$trh_x->cp_spj_up_ini+
							 $trh73->up_iwp_ini + $trh74->up_tap_ini+$trh75->up_pph4_ini+$trhxx->up_hkpg_ini+$trhxy->up_lain_ini;
            
            $jmsetup_sd = $jmsetup_ll + $jmsetup_ini;
            
            
            $cRet .="
                       
            <tr>
			<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">&ensp;&ensp;- Lain-lain</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_gaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_gaji_ll + $trh12->jlain_gaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_brjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_brjs_ll + $trh12->jlain_brjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_up_ll+$tox_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_up_ini+$tox_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($trh12->jlain_up_ll + $trh12->jlain_up_ini+$tox_ll+$tox_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($totallain,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>";

            $cRet .="
            <tr>
			<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">Jumlah Pengeluaran :</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetgaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetgaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetgaji_sd,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetbrjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetbrjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetbrjs_sd,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetup_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetup_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetup_sd,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmsetgaji_sd + $jmsetbrjs_sd + $jmsetup_sd,"2",",",".")."&nbsp;</td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr> 
                        
            <tr>
			<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"center\" style=\"font-size:12px\" colspan=\"2\">&nbsp;</td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>
            <tr>
			<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"left\" style=\"font-size:12px\" colspan=\"2\">Saldo Kas</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmgaji_ll - $jmsetgaji_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmgaji_ini - $jmsetgaji_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmgaji_sd - $jmsetgaji_sd,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmbrjs_ll - $jmsetbrjs_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmbrjs_ini - $jmsetbrjs_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmbrjs_sd - $jmsetbrjs_sd,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmup_ll - $jmsetup_ll,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmup_ini - $jmsetup_ini,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmup_sd - $jmsetup_sd,"2",",",".")."&nbsp;</td>
                <td align=\"right\" style=\"font-size:12px\">".number_format($jmtrmgaji_sd + $jmtrmbrjs_sd + $jmtrmup_sd - $jmsetgaji_sd - $jmsetbrjs_sd - $jmsetup_sd,"2",",",".")."&nbsp;</td>
           <td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
		   </tr>
            <tr>
			<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
                <td align=\"center\" style=\"font-size:12px\" colspan=\"2\">&nbsp;</td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
                <td align=\"center\" style=\"font-size:12px\"></td>
				<td align=\"left\" style=\"font-size:12px;border-top:hidden;\">&ensp;&ensp;</td>
            </tr>
            </table>";
			/*
       if($jenis=='1'){
		    $cRet .='<TABLE width="100%" style="font-size:12px">
					<TR>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" >Mengetahui,</TD>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$daerah.', '.$this->tukd_model->tanggal_format_indonesia($tgl_ctk).'</TD>
					</TR>
                    <TR>
						<TD align="center" >'.$jabatan.'</TD>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$jabatan1.'</TD>
					</TR>
                    <TR>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD align="center" ><b><u>'.$nama2.'</u></b> <br> '.$pangkat.' </TD>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" ><b><u>'.$nama1.'</u></b><br> '.$pangkat1.'</TD>
					</TR>
                    <TR>
						<TD align="center" >'.$nip.'</TD>
						<TD align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$nip1.'</TD>
					</TR>
					</TABLE><br/>';
	   } else if ($jenis=='2'){
		    $cRet .='<TABLE width="100%" style="font-size:12px">
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ></TD>
						<TD width="50%" align="center" >'.$daerah.', '.$this->tukd_model->tanggal_format_indonesia($tgl_ctk).'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ></TD>
						<TD width="50%" align="center" >'.$jabatan1.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" > </TD>
						<TD width="50%" align="center" ><b><u>'.$nama1.'</u></b><br> '.$pangkat1.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ></TD>
						<TD width="50%" align="center" >'.$nip1.'</TD>
					</TR>
					</TABLE><br/>';
	   } else {
		    $cRet .='<TABLE width="100%" style="font-size:12px">
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ></TD>
						<TD width="50%" align="center" >'.$daerah.', '.$this->tukd_model->tanggal_format_indonesia($tgl_ctk).'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ></TD>
						<TD width="50%" align="center" >'.$jabatan.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" > </TD>
						<TD width="50%" align="center" ><b><u>'.$nama2.'</u></b><br> '.$pangkat.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ></TD>
						<TD width="50%" align="center" >'.$nip.'</TD>
					</TR>
					</TABLE><br/>';
	   }
       */ 
	$data['prev']= $cRet;
	
	echo "<title>  SPJ $bulan</title>" ; 
	echo $cRet; 
		
    }
    
	
	
	
    function bku()
    {
        $data['page_title']= 'BKU';
        $this->template->set('title', 'BKU');   
        $this->template->load('template','tukd/transaksi/bku',$data) ; 
    }
    
function cetak_bku(){
        $thn_ang = $this->session->userdata('pcThang');
        $lcskpd = $_REQUEST['kd_skpd'];
        $pilih = $_REQUEST['cpilih'];
        $spasi = $_REQUEST['spasi'];
 		$this->db->query("exec recall '$lcskpd'");
		//$daerah=$this->tukd_model->get_nama($lcskpd,'daerah','sclient','kd_skpd');
         if ($pilih==1){
            $lctgl1 = $_REQUEST['tgl1'];
            $lctgl2 = $_REQUEST['tgl2'];   
            $lcperiode = $this->tukd_model->tanggal_format_indonesia($lctgl1)."  S.D. ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            $lcperiode1 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl1);
            $lcperiode2 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl2);			
			
         }else{
            $bulan = $_REQUEST['bulan'];
            
            $lcperiode = $this->tukd_model->getBulan($bulan);
            if($bulan==1){
                $lcperiode1 = "Bulan Sebelumnya";    
            }else{
            $lcperiode1 = "Bulan ".$this->tukd_model->getBulan($bulan-1);
            }  
            $lcperiode2 = "Bulan ".$this->tukd_model->getBulan($bulan);;
         }
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
         

         if ($pilih==1){
             $csql3 = "SELECT SUM(z.terima) AS jmter,SUM(z.keluar) AS jm_kel , SUM(z.terima)-SUM(z.keluar) AS sel FROM (SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,
             '' AS rekening,uraian,0 AS terima,0 AS keluar , 0 AS st,jns_trans FROM trhrekal
             UNION ALL
             SELECT a.kd_skpd,a.tgl_kas,'' AS tanggal,b.no_kas,b.kd_rek5 AS rekening,
             b.nm_rek5 AS uraian, b.terima,b.keluar , case when b.terima<>0 then'1' else '2' end AS st, b.jns_trans FROM
             trdrekal b LEFT JOIN trhrekal a ON a.no_kas = b.no_kas and a.kd_skpd = b.kd_skpd)z WHERE
             z.tgl_kas < '$lctgl1' and year(z.tgl_kas) = $thn_ang AND z.kd_skpd = '$lcskpd'";
         }else{
             $csql3 = "SELECT SUM(z.terima) AS jmter,SUM(z.keluar) AS jm_kel , SUM(z.terima)-SUM(z.keluar) AS sel FROM (SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,
             '' AS rekening,uraian,0 AS terima,0 AS keluar , 0 AS st,jns_trans FROM trhrekal
             UNION ALL
             SELECT a.kd_skpd,a.tgl_kas,'' AS tanggal,b.no_kas,b.kd_rek5 AS rekening,
             b.nm_rek5 AS uraian, b.terima,b.keluar , case when b.terima<>0 then'1' else '2' end AS st, b.jns_trans FROM
             trdrekal b LEFT JOIN trhrekal a ON a.no_kas = b.no_kas and a.kd_skpd = b.kd_skpd)z WHERE
             month(z.tgl_kas) < '$bulan' and year(z.tgl_kas) = $thn_ang AND z.kd_skpd = '$lcskpd'";
             }

             $tox_awal="SELECT isnull(sld_awal,0) AS jumlah FROM ms_skpd where kd_skpd='$lcskpd'";
             $hasil = $this->db->query($tox_awal);
             $tox = $hasil->row('jumlah');
             
         $hasil = $this->db->query($csql3);
         $trh4 = $hasil->row(); 
         
         $saldoawal = $trh4->sel;
         $saldoawal=$saldoawal+$tox;
         
			$prv = $this->db->query("SELECT provinsi,daerah from sclient WHERE kd_skpd='$lcskpd'");
			$prvn = $prv->row();          
			$prov = $prvn->provinsi;         
			$daerah = $prvn->daerah;
			
			if ($pilih==1){
			$asql="select
			SUM(case when jns=1 then jumlah else 0 end) AS terima,
			SUM(case when jns=2 then jumlah else 0 end) AS keluar
			from (
			SELECT tgl_kas AS tgl,no_kas AS bku,keterangan as ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM tr_setorsimpanan union ALL
			SELECT tgl_bukti AS tgl,no_bukti AS bku,ket as ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM trhINlain WHERE pay='BANK' union ALL
			SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,total-isnull(pot,0) AS jumlah,'2' AS jns,a.kd_skpd AS kode FROM trhtransout a join trhsp2d b on a.no_sp2d=b.no_sp2d left join (select no_spm, sum(nilai)pot from trspmpot group by no_spm) c on b.no_spm=c.no_spm WHERE pay='BANK' UNION ALL
			SELECT tgl_kas AS tgl,no_kas AS bku,keterangan AS ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM tr_ambilsimpanan union ALL
			SELECT tgl_bukti AS tgl,no_bukti AS bku,ket as ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM trhoutlain where pay='BANK' ) a
			where tgl<='$lctgl2' and kode='$lcskpd'";		
			}else{
			$asql="select
			SUM(case when jns=1 then jumlah else 0 end) AS terima,
			SUM(case when jns=2 then jumlah else 0 end) AS keluar
			from (
			SELECT tgl_kas AS tgl,no_kas AS bku,keterangan as ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM tr_setorsimpanan union ALL
			SELECT tgl_bukti AS tgl,no_bukti AS bku,ket as ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM trhINlain WHERE pay='BANK' union ALL
			SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,total-isnull(pot,0) AS jumlah,'2' AS jns,a.kd_skpd AS kode FROM trhtransout a join trhsp2d b on a.no_sp2d=b.no_sp2d left join (select no_spm, sum(nilai)pot from trspmpot group by no_spm) c on b.no_spm=c.no_spm WHERE pay='BANK' UNION ALL
			SELECT tgl_kas AS tgl,no_kas AS bku,keterangan AS ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM tr_ambilsimpanan union ALL
			SELECT tgl_bukti AS tgl,no_bukti AS bku,ket as ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM trhoutlain where pay='BANK' ) a
			where month(tgl)<='$bulan' and kode='$lcskpd'";	
			}

						
		$hasil=$this->db->query($asql);
		$bank=$hasil->row();
		$keluarbank=$bank->keluar;
		$terimabank=$bank->terima;
		$saldobank=$terimabank-$keluarbank;
		/*
		$esteh="SELECT 
				SUM(case when jns=1 then jumlah else 0 end ) AS terima,
				SUM(case when jns=2 then jumlah else 0 end) AS keluar
				FROM (
				SELECT tgl_kas AS tgl,no_kas AS bku,keterangan AS ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM tr_ambilsimpanan UNION ALL
				select tgl_kas as tgl,no_kas as bku,keterangan as ket, nilai as jumlah, '1' as jns,kd_skpd as kode from tr_jpanjar where jns=2 UNION ALL
				SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM trhINlain WHERE pay='TUNAI' UNION ALL
				select tgl_panjar as tgl,no_panjar as bku,keterangan as ket, nilai as jumlah, '2' as jns,kd_skpd as kode from tr_panjar UNION ALL
				select tgl_sts as tgl,no_sts as bku, keterangan as ket, total as jumlah, '2' as jns, kd_skpd as kode from trhkasin_pkd where jns_trans<>4 and pot_khusus =0 union
                SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,total-isnull(pot,0) AS jumlah,'2' AS jns,a.kd_skpd AS kode FROM trhtransout a left join trhsp2d b on a.no_sp2d=b.no_sp2d left join (select no_spm, sum(nilai)pot from trspmpot group by no_spm) c on b.no_spm=c.no_spm WHERE pay = 'TUNAI' and panjar<>1 UNION ALL
				SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,nilai AS jumlah,'2' AS jns,kd_skpd AS kode FROM trhoutlain WHERE pay='TUNAI') a 
				where month(a.tgl)<='$bulan' and kode='$lcskpd'";
		
					 $hasil = $this->db->query($esteh);
					 $okok = $hasil->row();
		$tox_awal="SELECT isnull(sld_awal,0) AS jumlah FROM ms_skpd where kd_skpd='$lcskpd'";

		             $hasil = $this->db->query($tox_awal);
					 $tox = $hasil->row('jumlah');
					 $terima = $okok->terima;
					 $keluar = $okok->keluar;

			$querypaj="SELECT
					 sum(case when jns=1 then terima else 0 end) as debet,
					 sum(case when jns=2 then keluar else 0 end ) as kredit
					 FROM(
					 SELECT no_bukti AS bku,tgl_bukti AS tgl,(ket+'  no sp2d:'+no_sp2d) AS ket,nilai AS terima,'0' AS keluar,'1' as jns,kd_skpd FROM trhtrmpot UNION ALL
					 SELECT no_bukti AS bku,tgl_bukti AS tgl,(ket+'  terima:'+no_terima) AS ket,'0' AS terima,nilai AS keluar,'2' as jns,kd_skpd FROM trhstrpot ) a WHERE MONTH(tgl)<='$bulan' AND kd_skpd='$lcskpd'";
					 $querypjk=$this->db->query($querypaj);

					 $debet=$querypjk->row('debet');
					 $kredit=$querypjk->row('kredit');
					 $saldopjk=$debet-$kredit;
					 
					 $saldotunai=($terima+$tox+$saldopjk)-$keluar;
			*/		 		 
		 // SALDO SURAT BERHARGA (SP2D yang tanggal pencairannya beda dengan tanggal sp2dnya) 
		if ($pilih==1){
		$csql="select sum(nilai) as total from trhsp2d where (tgl_terima BETWEEN '$lctgl1' and '$lctgl2')  and kd_skpd = '$lcskpd' and status_terima = '1' and (tgl_kas > '$lctgl2' or no_kas is null or no_kas='')";
		}else{
		$csql="select sum(nilai) as total from trhsp2d where month(tgl_terima)='$bulan' and kd_skpd = '$lcskpd' and status_terima = '1' and (month(tgl_kas) > '$bulan' or no_kas is null or no_kas='')";
		}			 
					 $hasil_srt = $this->db->query($csql);
					 $saldoberharga = $hasil_srt->row('total');
		
		
 $nippa = str_replace('123456789',' ',$_REQUEST['ttd']);		     
 $csql="SELECT nip as nip_pa,nama as nm_pa,jabatan,pangkat FROM ms_ttd WHERE nip = '$nippa' AND kd_skpd = '$lcskpd' AND kode='PA'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row(); 
 $nipbk = str_replace('123456789',' ',$_REQUEST['ttd2']);		     
 $csql="SELECT nip as nip_bk,nama as nm_bk,jabatan,pangkat FROM ms_ttd WHERE nip = '$nipbk' AND kd_skpd = '$lcskpd' AND kode='BK'";
                
         $hasil3 = $this->db->query($csql);
         $trh3 = $hasil3->row(); 
 $csql="SELECT nm_skpd FROM ms_skpd WHERE kd_skpd = '$lcskpd' ";
                
         $hasil4 = $this->db->query($csql);
         $trh4 = $hasil4->row();
		 
		$cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
			<tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>$prov<br>BUKU KAS UMUM PENGELUARAN</b></td>
            </tr>
            <tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;\"><b>PERIODE ".strtoupper($lcperiode)."</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;\">SKPD</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$trh4->nm_skpd</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$trh2->nm_pa</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;\">Bendahara Pengeluaran</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$trh3->nm_bk</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
			</table>
			<table style=\"border-collapse:collapse; border-color: black;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"$spasi\" >
            <thead> 
			<tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"5%\" style=\"font-size:12px;font-weight:bold;\">No.</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"15%\" style=\"font-size:12px;font-weight:bold\">Tanggal</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" colspan=\"10%\" width=\"15%\" style=\"font-size:12px;font-weight:bold\">Kode Rekening</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"40%\" style=\"font-size:12px;font-weight:bold\">Uraian</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-size:12px;font-weight:bold\">Penerimaan</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-size:12px;font-weight:bold\">Pengeluaran</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" width=\"10%\" style=\"font-size:12px;font-weight:bold\">Saldo</td>
            </tr>
            <tr>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px;border-top:solid 1px black\">1</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px;border-top:solid 1px black\">2</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" colspan=\"10\" style=\"font-size:12px;border-top:solid 1px black\">3</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px;border-top:solid 1px black\">4</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px;border-top:solid 1px black\">5</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px;border-top:solid 1px black\">6</td>
                <td align=\"center\" bgcolor=\"#CCCCCC\" style=\"font-size:12px;border-top:solid 1px black\">7</td>
            </tr>
			</thead>";
           
           if ($pilih==1){
           $sql = "SELECT z.* FROM ((SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,'' AS kegiatan,
           '' AS rekening,uraian,0 AS terima,0 AS keluar , '' AS st,jns_trans FROM trhrekal a
           where (a.tgl_kas BETWEEN '$lctgl1' AND '$lctgl2') AND
           year(a.tgl_kas) = '$thn_ang'and kd_skpd='$lcskpd')
               UNION ALL
              ( SELECT a.kd_skpd,a.tgl_kas,NULL AS tanggal,b.no_kas,b.kd_kegiatan as kegiatan,b.kd_rek5 AS rekening,
               b.nm_rek5 AS uraian, b.terima,b.keluar , case when b.terima<>0 then '1' else '2' end AS st, b.jns_trans FROM
               trdrekal b LEFT JOIN trhrekal a ON a.no_kas = b.no_kas and a.kd_skpd = b.kd_skpd where (a.tgl_kas BETWEEN '$lctgl1' AND '$lctgl2')
               AND year(a.tgl_kas) = '$thn_ang' and b.kd_skpd='$lcskpd'))z
               ORDER BY tgl_kas,Cast(REPLACE(no_kas, 'A', '')  as int),jns_trans,st,rekening";
           }else{
       
           $sql = " SELECT z.* FROM ((SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,'' AS kegiatan,
           '' AS rekening,uraian,0 AS terima,0 AS keluar , '' AS st,jns_trans FROM trhrekal a
           where month(a.tgl_kas) = '$bulan' AND
           year(a.tgl_kas) = '$thn_ang'and kd_skpd='$lcskpd')
               UNION ALL
              ( SELECT a.kd_skpd,a.tgl_kas,NULL AS tanggal,b.no_kas,b.kd_kegiatan as kegiatan,b.kd_rek5 AS rekening,
               b.nm_rek5 AS uraian, b.terima,b.keluar , case when b.terima<>0 then '1' else '2' end AS st, b.jns_trans FROM
               trdrekal b LEFT JOIN trhrekal a ON a.no_kas = b.no_kas and a.kd_skpd = b.kd_skpd where month(a.tgl_kas) ='$bulan' AND
               year(a.tgl_kas) = '$thn_ang' and b.kd_skpd='$lcskpd'))z
               ORDER BY tgl_kas,Cast(REPLACE(no_kas, 'A', '')  as int),jns_trans,st,rekening";
           
           }
           
                            
                    $hasil = $this->db->query($sql);
                    $lcno = 0;
                    $lcterima = 0;
                    $lckeluar = 0;
                    $lhasil = $saldoawal;
                    $saldolalu=number_format($lhasil,"2",",",".");
                    $cRet .= "<tr><td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px gray;border-top:solid 1px black\"></td>";
                    $cRet .="<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px gray;border-top:solid 1px black\"></td>
                                <td valign=\"top\" colspan=\"9\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px gray;border-top:solid 1px black\"></td>
                                <td valign=\"top\" colspan=\"1\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px gray;border-top:solid 1px black\"></td>
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px gray;border-top:solid 1px black\">Saldo Lalu</td>";
                                $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px gray;border-top:solid 1px black\"></td>";
                                 $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px gray;border-top:solid 1px black\"></td>";
                                 $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px gray;border-top:solid 1px black\">$saldolalu</td></tr>";
                    foreach ($hasil->result() as $row)
                    {
                        $cRet .="<tr>";
                        $lhasil = $lhasil + $row->terima - $row->keluar;
                       if(!empty($row->tanggal)){
                         $a=$row->tanggal;
                         $jaka=$this->tukd_model->tanggal_ind($a);
                         $lcno = $lcno + 1;
                         $no_bku = $row->no_kas;
                         $cRet .= "<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none 1px gray;border-top:solid 1px gray\">$no_bku</td>
                                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\">$jaka</td>
									<td valign=\"top\" colspan=\"9\" align=\"center\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\">".($row->kegiatan)."</td>
									<td valign=\"top\" colspan=\"1\"align=\"center\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\">".($row->rekening)."</td>                
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\">$row->uraian</td>
								";
								 if(empty($row->terima) or ($row->terima)==0){
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\"></td>";
                                }else{
                                    $lcterima = $lcterima + $row->terima; 
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\">".number_format($row->terima,"2",",",".")."</td>";
                                }
								if(empty($row->keluar) or ($row->keluar)==0){
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\"></td>";
                                }else{
                                    $lckeluar = $lckeluar + $row->keluar; 
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\">".number_format($row->keluar,"2",",",".")."</td>";
                                }
                                if(empty($row->terima) and empty($row->keluar) or ($row->terima)==0 and ($row->keluar)==0){
                                $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\"></td>";
                                }else{
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:solid 1px gray\">".number_format($lhasil,"2",",",".")."</td>";
                                }
                       }else{
                        $cRet .= " <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none 1px gray;border-top:none 1px gray\">&nbsp;</td>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\">&nbsp;</td>
                                <td valign=\"top\" colspan=\"9\" align=\"center\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\">".($row->kegiatan)."</td>
								<td valign=\"top\" colspan=\"1\"align=\"center\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\">".($row->rekening)."</td>                
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\">$row->uraian</td>
								";
								 if(empty($row->terima) or ($row->terima)==0){
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\"></td>";
                                }else{
                                    $lcterima = $lcterima + $row->terima; 
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\">".number_format($row->terima,"2",",",".")."</td>";
                                }
								if(empty($row->keluar) or ($row->keluar)==0){
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\"></td>";
                                }else{
                                    $lckeluar = $lckeluar + $row->keluar; 
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\">".number_format($row->keluar,"2",",",".")."</td>";
                                }
                                if(empty($row->terima) and empty($row->keluar) or ($row->terima)==0 and ($row->keluar)==0){
                                $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\"></td>";
                                }else{
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:dashed 1px gray;border-top:dashed 1px gray\">".number_format($lhasil,"2",",",".")."</td>";
                                }
                       }
                            $cRet .="</tr>";    
                    }

        $cRet .="<tr>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" colspan=\"9\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                 </tr>
                  <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">Jumlah Periode $lcperiode </td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($lcterima+$tox,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($lckeluar,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($lhasil,"2",",",".")."</td>
                 </tr> ";
                 
                 if ($pilih==1){                 
                 $csql="SELECT SUM(b.terima) AS jmterima, SUM(b.keluar) AS jmkeluar FROM trdrekal b INNER JOIN 
                        trhrekal a ON a.no_kas=b.no_kas and a.kd_skpd = b.kd_skpd WHERE a.tgl_kas < '$lctgl1'  and a.kd_skpd = '$lcskpd'";
                 }else{
                    $csql="SELECT SUM(b.terima) AS jmterima, SUM(b.keluar) AS jmkeluar FROM trdrekal b INNER JOIN 
                        trhrekal a ON a.no_kas=b.no_kas and a.kd_skpd = b.kd_skpd WHERE month(a.tgl_kas) < '$bulan' and year(a.tgl_kas) = $thn_ang and a.kd_skpd = '$lcskpd'";
                 }
                        
                 $hasil = $this->db->query($csql);
                 $trh1 = $hasil->row(); 
                
        $cRet .="<tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">Jumlah Sampai $lcperiode1 </td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($trh1->jmterima,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($trh1->jmkeluar,"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">Jumlah s/d $lcperiode2 </td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format(($trh1->jmterima+$lcterima+$tox),"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format(($trh1->jmkeluar+$lckeluar),"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">Sisa Kas Pada $lcperiode2 </td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format(($trh1->jmterima+$lcterima-$trh1->jmkeluar-$lckeluar+$tox),"2",",",".")."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"2\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<b><u>Terdiri dari :</u></b></td>
                    <td colspan =\"14\"valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. Saldo Tunai</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\"><b>Rp  ".number_format(($trh1->jmterima+$lcterima-$trh1->jmkeluar-$lckeluar+$tox-$saldobank-$saldoberharga),"2",",",".")."</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. Saldo Bank</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\"><b>Rp  ".number_format(($saldobank),"2",",",".")."</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\"><b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. Surat Berharga</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\"><b>Rp  ".number_format(($saldoberharga),"2",",",".")."</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
				 </table>";
		$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td valign=\"top\" align=\"center\" width=\"50%\" style=\"font-size:12px;border:\">
					Mengetahui,<br> $trh2->jabatan <br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;<u><b>$trh2->nm_pa</b></u><br>$trh2->pangkat<br>NIP. $trh2->nip_pa</td>
                    <td valign=\"top\" align=\"center\" width=\"50%\" style=\"font-size:12px;\">
					".$daerah.",&nbsp;".$this->tukd_model->tanggal_format_indonesia($tgl_ttd)."<br>$trh3->jabatan <br>&nbsp;<br>&nbsp;<br>&nbsp;
					<br>&nbsp;<u><b>$trh3->nm_bk</b></u><br>$trh3->pangkat<br>NIP. $trh3->nip_bk</td>
            
        </table>";
        
        $print = $this->uri->segment(3);
		if($print==0){
 
         $data['prev']= $cRet;    
		 echo ("<title>Buku Kas Umum</title>");
		 echo $cRet;}
		 else{

	    $this->_mpdf('',$cRet,10,10,10,'L',1,'');
}		
     
     }
     


	
    function lpjup()
    {
        $data['page_title']= 'PERTANGGUNG JAWABAN PERSEDIAAN';
        $this->template->set('title', 'PERTANGGUNG JAWABAN PERSEDIAAN');   
        $this->template->load('template','tukd/transaksi/spjup',$data) ; 
    }
    
     function lpjtu()
    {
        $data['page_title']= 'PERTANGGUNG JAWABAN TAMBAH UANG';
        $this->template->set('title', 'PERTANGGUNG JAWABAN TAMBAH UANG(TU)');   
        $this->template->load('template','tukd/transaksi/spjtu',$data) ; 
    }						  

    function cetaklpjup(){
		
		$cskpd =   $this->uri->segment(5);
        //$cttd  =   $this->uri->segment(4);
        $cttd=str_replace('a',' ',$this->uri->segment(4));


		$lctgl1 =   $this->uri->segment(3);
		$lctgl2 =   $this->uri->segment(6);
          $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }

		$cRet  =" <table border='0' width='100%'>
					<tr>
						<td align='center' > $kab</td>
					</tr>
					<tr>
						<td align='center'>LAPORAN PERTANGGUNG JAWABAN UANG PERSEDIAAN</td>
					</tr>
					<tr>
						<td align='center'>BENDAHARA PENGELUARAN</td>
					</tr>
					</table>				
				";

		$cRet .=" <table border='0' width='100%'>
					<tr>
						<td align='left' width='10%'>SKPD&nbsp;&nbsp;&nbsp;</td>
						<td align='center' width='1%'>:&nbsp;&nbsp;&nbsp;</td>
						<td align='left' > ".$cskpd." ".$this->tukd_model->get_nama($cskpd,'nm_skpd','ms_skpd','kd_skpd')." </td>
					</tr>
					<tr>
						<td align='left' width='10%'>PERIODE&nbsp;&nbsp;&nbsp;</td>
						<td align='center' width='1%'>:&nbsp;&nbsp;&nbsp;</td>
						<td align='left' >".$this->tukd_model->tanggal_format_indonesia($lctgl1).' s/d '.$this->tukd_model->tanggal_format_indonesia($lctgl2)."</td>
					</tr>
					</table>				
				";		

		$cRet .=" <table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td align='center' width='30%'>KODE REKENING</td>
						<td align='center' width='50%'>URAIAN</td>
						<td align='center' width='20%'>JUMLAH</td>
					</tr>
				";		


				$sql = "SELECT DISTINCT kd_kegiatan,kd_rek5,nm_kegiatan,nm_rek5 FROM trdtransout a INNER JOIN trhtransout b ON a.no_bukti=b.no_bukti 
                        WHERE b.kd_skpd='$cskpd' AND b.jns_spp=1 ORDER BY kd_kegiatan,kd_rek5";
				$query1 = $this->db->query($sql);  	
				$tkeg="";
				$total=0;
				foreach($query1->result_array() as $resulte){ 
					//	$kd_skpd=$resulte["kd_skpd"];
						$kd_kegiatan=$resulte["kd_kegiatan"];
						$kd_rek5=$resulte["kd_rek5"];
						$nm_kegiatan=$resulte["nm_kegiatan"];
						$nm_rek5=$resulte["nm_rek5"];
						
						if ($tkeg!=$kd_kegiatan){

							$sqlr = "SELECT sum(a.nilai) as nilai FROM trdtransout a LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti 
									WHERE b.`jns_spp`=1 AND b.tgl_bukti>'$lctgl1' AND b.tgl_bukti<'$lctgl2' AND kd_skpd='$cskpd' and a.kd_kegiatan='$kd_kegiatan' ";
							$queryr = $this->db->query($sqlr);  	
							foreach($queryr->result_array() as $nl){ 
									$nilaik=number_format($nl["nilai"]);
							}
							if($nilaik==0) $nilaik="";

							$cRet .="
									<tr>
										<td align='left' >$kd_kegiatan</td>
										<td align='left' ><b>$nm_kegiatan</b></td>
										<td align='right' ><b>$nilaik</b></td>
									</tr>					
							";
												
						}
						
						$sqlr = "SELECT sum(a.nilai) as nilai FROM trdtransout a LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti 
								WHERE b.jns_spp=1 AND b.tgl_bukti>'$lctgl1' AND b.tgl_bukti<'$lctgl2' AND kd_skpd='$cskpd' and a.kd_kegiatan='$kd_kegiatan' and a.kd_rek5='$kd_rek5' ";
						$queryr = $this->db->query($sqlr);  	
						foreach($queryr->result_array() as $nl){ 
	  						    $total=$total+$nl["nilai"];
								$nilai=number_format($nl["nilai"]);
						}
						if($nilai==0) $nilai="";
						
						$cRet .="
								<tr>
									<td align='left' >$kd_kegiatan.".$this->tukd_model->dotrek($kd_rek5)."</td>
									<td align='left' >$nm_rek5</td>
									<td align='right' >$nilai</td>
								</tr>					
						";

						$tkeg=$kd_kegiatan;
				}


				$sqlp = "SELECT SUM(a.nilai) AS nilai FROM trdspp a LEFT JOIN trhsp2d b ON b.no_spp=a.no_spp  
						 WHERE b.kd_skpd='$cskpd' AND (b.jns_spp=1 or b.jns_spp=2) AND b.tgl_sp2d<'$lctgl1' ";
				$queryp = $this->db->query($sqlp);  	
				foreach($queryp->result_array() as $nlx){ 
						$persediaan=$nlx["nilai"];
				}

				$cRet .="
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' >&nbsp;</td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Total</b></td>
							<td align='right' ><b>".number_format($total)."</b></td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Uang Persediaan Awal Periode</b></td>
							<td align='right' ><b>".number_format($persediaan)."</b></td>
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Uang Persediaan Ahir Periode</b></td>
							<td align='right' ><b>".number_format($persediaan-$total)."</b></td>
						</tr>
						</tr>
					    ";


				$cRet .="</table><p>";				

 		$cRet .=" <table width='100%' border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'>Jakarta, ".$this->tukd_model->tanggal_format_indonesia(date("Y-m-d"))."</td>
					</tr>
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'><u>".$this->tukd_model->get_nama($cttd,'nama','ms_ttd','nip')."</u></td>
					</tr>
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'>$cttd</td>
					</tr>
				  </table>
				";		



        $data['prev']= $cRet;    
        $this->tukd_model->_mpdf('',$cRet,'5','5','5','0');		
	} 
    
     function cetaklpjtu(){
		
		$cskpd =   $this->uri->segment(5);
		//$cttd  =   $this->uri->segment(4);
        $cttd=str_replace('a',' ',$this->uri->segment(4));
       

		$lctgl1 =   $this->uri->segment(3);
		$lctgl2 =   $this->uri->segment(6);
          $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }

		$cRet  =" <table border='0' width='100%'>
					<tr>
						<td align='center' >PEMERINTAH $kab</td>
					</tr>
					<tr>
						<td align='center'>LAPORAN PERTANGGUNG JAWABAN TAMBAHAN UANG(TU)</td>
					</tr>
					<tr>
						<td align='center'>BENDAHARA PENGELUARAN</td>
					</tr>
					</table>				
				";

		$cRet .=" <table border='0' width='100%'>
					<tr>
						<td align='left' width='10%'>SKPD&nbsp;&nbsp;&nbsp;</td>
						<td align='center' width='1%'>:&nbsp;&nbsp;&nbsp;</td>
						<td align='left' > ".$cskpd." ".$this->tukd_model->get_nama($cskpd,'nm_skpd','ms_skpd','kd_skpd')." </td>
					</tr>
					<tr>
						<td align='left' width='10%'>PERIODE&nbsp;&nbsp;&nbsp;</td>
						<td align='center' width='1%'>:&nbsp;&nbsp;&nbsp;</td>
						<td align='left' >".$this->tukd_model->tanggal_format_indonesia($lctgl1).' s/d '.$this->tukd_model->tanggal_format_indonesia($lctgl2)."</td>
					</tr>
					</table>				
				";		

		$cRet .=" <table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td align='center' width='30%'>KODE REKENING</td>
						<td align='center' width='50%'>URAIAN</td>
						<td align='center' width='20%'>JUMLAH</td>
					</tr>
				";		


				$sql = "SELECT DISTINCT kd_kegiatan,kd_rek5,nm_kegiatan,nm_rek5 FROM trdtransout a INNER JOIN trhtransout b ON a.no_bukti=b.no_bukti 
                        WHERE b.kd_skpd='$cskpd' AND b.jns_spp=3 ORDER BY kd_kegiatan,kd_rek5";
				$query1 = $this->db->query($sql);  	
				$tkeg="";
				$total=0;
				foreach($query1->result_array() as $resulte){ 
						$kd_skpd=$resulte["kd_skpd"];
						$kd_kegiatan=$resulte["kd_kegiatan"];
						$kd_rek5=$resulte["kd_rek5"];
						$nm_kegiatan=$resulte["nm_kegiatan"];
						$nm_rek5=$resulte["nm_rek5"];
						
						if ($tkeg!=$kd_kegiatan){

							$sqlr = "SELECT sum(a.nilai) as nilai FROM trdtransout a LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti 
									WHERE b.jns_spp=3 AND b.tgl_bukti>'$lctgl1' AND b.tgl_bukti<'$lctgl2' AND kd_skpd='$cskpd' and a.kd_kegiatan='$kd_kegiatan' ";
							$queryr = $this->db->query($sqlr);  	
							foreach($queryr->result_array() as $nl){ 
									$nilaik=number_format($nl["nilai"]);
							}
							if($nilaik==0) $nilaik="";

							$cRet .="
									<tr>
										<td align='left' >$kd_kegiatan</td>
										<td align='left' ><b>$nm_kegiatan</b></td>
										<td align='right' ><b>$nilaik</b></td>
									</tr>					
							";
												
						}
						
						$sqlr = "SELECT sum(a.nilai) as nilai FROM trdtransout a LEFT JOIN trhtransout b ON a.no_bukti=b.no_bukti 
								WHERE b.jns_spp=3 AND b.tgl_bukti>'$lctgl1' AND b.tgl_bukti<'$lctgl2' AND kd_skpd='$cskpd' and a.kd_kegiatan='$kd_kegiatan' and a.kd_rek5='$kd_rek5' ";
						$queryr = $this->db->query($sqlr);  	
						foreach($queryr->result_array() as $nl){ 
	  						    $total=$total+$nl["nilai"];
								$nilai=number_format($nl["nilai"]);
						}
						if($nilai==0) $nilai="";
						
						$cRet .="
								<tr>
									<td align='left' >$kd_kegiatan.$kd_rek5</td>
									<td align='left' >$nm_rek5</td>
									<td align='right' >$nilai</td>
								</tr>					
						";

						$tkeg=$kd_kegiatan;
				}


				$sqlp = "SELECT SUM(a.nilai) AS nilai FROM trdspp a LEFT JOIN trhsp2d b ON b.no_spp=a.no_spp  
						 WHERE b.kd_skpd='$cskpd' AND b.jns_spp=3 AND b.tgl_sp2d<'$lctgl1' ";
				$queryp = $this->db->query($sqlp);  	
				foreach($queryp->result_array() as $nlx){ 
						$persediaan=$nlx["nilai"];
				}

				$cRet .="
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' >&nbsp;</td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Total</b></td>
							<td align='right' ><b>".number_format($total)."</b></td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Uang Persediaan Awal Periode</b></td>
							<td align='right' ><b>".number_format($persediaan)."</b></td>
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Uang Persediaan Ahir Periode</b></td>
							<td align='right' ><b>".number_format($persediaan-$total)."</b></td>
						</tr>
						</tr>
					    ";


				$cRet .="</table><p>";				

 		$cRet .=" <table width='100%' border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'>Jakarta, ".$this->tukd_model->tanggal_format_indonesia(date("Y-m-d"))."</td>
					</tr>
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'><u>".$this->tukd_model->get_nama($cttd,'nama','ms_ttd','nip')."</u></td>
					</tr>
					<tr>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='30%'>&nbsp;</td>
						<td align='center' width='40%'>$cttd</td>
					</tr>
				  </table>
				";		



        $data['prev']= $cRet;    
        $this->tukd_model->_mpdf('',$cRet,'5','5','5','0');		
	}
    
 // joice ==================================================================================================== 
    function terima_objek()
    {
        $data['page_title']= 'RincianObjek';
        $this->template->set('title', 'Rincian Objek');   
        $this->template->load('template','tukd/pendapatan/terima_objek',$data) ; 
    }
    
    

    function rek5_skpd($lcskpd='') {
        $sql = " SELECT a.kd_rek5 as kd_rek5,b.nm_rek5 as nm_rek5 FROM trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 where (left(a.kd_rek5,1)='4' or left(a.kd_rek5,2)='61') and rtrim(a.kd_skpd)='$lcskpd' order by a.kd_rek5 ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();	   
	}
    
    
    function cetak_tobjek($lcskpd='',$nbulan='',$crek5=''){
        //$nbulan = 12;
        $thn_ang	   = $this->session->userdata('pcThang');
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$lcskpd' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
                
        $sqlBP="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$lcskpd' and kode='BP'";
                 $sqlttdbp=$this->db->query($sqlBP);
                 foreach ($sqlttdbp->result() as $rowttdbp)
                {
                    $nip2=$rowttdbp->nip;                    
                    $nama2= $rowttdbp->nm;
                    $jabatan2  = $rowttdbp->jab;
                }
                
        $abc="select nm_rek5 from ms_rek5 where kd_rek5='$crek5'";
                $sqlrek=$this->db->query($abc);
                foreach ($sqlrek->result() as $rowrek)
                {
                    $nmrek5=$rowrek->nm_rek5;
                }
        
        $abc2="SELECT SUM(nilai_ubah) as rupiah FROM trdrka  where kd_rek5='$crek5' and kd_skpd='$lcskpd'";
                $sqlang=$this->db->query($abc2);
                foreach ($sqlang->result() as $rowang)
                {
                    $nang=$rowang->rupiah;
                }
                
        //$this->template->set('title', 'CETAK RINCIAN OBYEK');
        $skpd = $lcskpd;
        $nama=  $this->tukd_model->get_nama($lcskpd,'nm_skpd','ms_skpd','kd_skpd');
        $bulan= $this->tukd_model->getBulan($nbulan); 
        $cRet = '';
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"0\">";                 
        $cRet .="
            
            <tr>
                <td align=\"center\" style=\"font-size:16px;\" colspan=\"5\">
                  PROVINSI/KABUPATEN/KOTA<BR>
                  BUKU PEMBANTU<BR>
                  PER RINCIAN OBYEK PENERIMAAN<BR>&nbsp;
                </td>
            </tr>
            
            <tr>
                <td align=\"left\" style=\"font-size:12px;\" width=\"25%\">
                  SKPD
                </td> 
                <td width=\"75%\">: $skpd - $nama
                </td>         
            </tr>
            
            

            <tr>
                <td align=\"left\" style=\"font-size:12px;\">
                  Kode Rekening
                </td> 
                <td>: $crek5
                </td>         
            </tr>
            
            <tr>
                <td align=\"left\" style=\"font-size:12px;\">
                  Nama Rekening
                </td> 
                <td>: $nmrek5
                </td>         
            </tr>
            
            <tr>
                <td align=\"left\" style=\"font-size:12px;\">
                  Jumlah Anggaran
                </td> 
                <td>: $nang
                </td>         
            </tr>
            
            <tr>
                <td align=\"left\" style=\"font-size:12px;\">
                  Tahun Anggaran
                </td> 
                <td>: $thn_ang
                </td>         
            </tr>
            
            <tr>
                <td align=\"left\" style=\"font-size:12px;\" colspan=\"5\">
                 &nbsp;
                </td> 
            </tr>
            
            </table>
                
    <table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"2\">
            <thead> 
            <tr>                        
                <td align=\"center\" style=\"font-size:12px\"><b>No<br>Urut</b></td>
                <td align=\"center\" style=\"font-size:12px\"><b>No BKU<br>Penerimaan</b></td>
                <td align=\"center\" style=\"font-size:12px\"><b>Tanggal Sektor</b></td>
                <td align=\"center\" style=\"font-size:12px\"><b>Nomor STS & Bukti<br>Penerimaan Lainnya</b></td>
                <td align=\"center\" style=\"font-size:12px\"><b>Jumlah<br>(Rp)</b></td>                
            </tr>                                                                    
            
            <tr>                          
                <td align=\"center\" rowspan=\"1\" style=\"font-size:10px\">1</td>
                <td align=\"center\" rowspan=\"1\" style=\"font-size:10px\">2</td>
                <td align=\"center\" rowspan=\"1\" style=\"font-size:10px\">3</td>
                <td align=\"center\" rowspan=\"1\" style=\"font-size:10px\">4</td>
                <td align=\"center\" rowspan=\"1\" style=\"font-size:10px\">5 &nbsp;</td>                
            </tr>
            </thead>";                          
       

            $lcjumlah=0;
             $csql="SELECT a.no_sts, a.kd_skpd, a.tgl_sts, a.no_kas, b.kd_rek5, b.rupiah FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) where a.kd_skpd= '$lcskpd' and b.kd_rek5='$crek5' and month(a.tgl_sts)='$nbulan' and year(a.tgl_sts)='$thn_ang' ";
                    $i_urut=1;
                    $hasil = $this->db->query($csql);
                                        
                    foreach ($hasil->result() as $row)
                    {                                                                                                           
                       $cRet .="<tr>
                                <td align=\"center\" width=\"5%\" style=\"font-size:12px\">$i_urut</td>
                                <td valign=\"top\" align=\"left\" width=\"35%\" style=\"font-size:12px\">$row->no_kas</td>
                                <td valign=\"top\" align=\"center\" width=\"10%\" style=\"font-size:12px\">$row->tgl_sts</td>
                                <td valign=\"top\" align=\"left\" width=\"35%\" style=\"font-size:12px\">$row->no_sts</td>
                                <td align=\"right\" width=\"15%\" style=\"font-size:12px\">".number_format($row->rupiah)."&nbsp;</td>";                                
                                $cRet .="</tr> "; 
                       $lcjumlah = $lcjumlah + $row->rupiah;                                                                                                                           
                       $i_urut++;
                        
                    };
             $nlalu=0;
            $csql="SELECT sum(b.rupiah) as xlalu FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) where a.kd_skpd= '$lcskpd' and b.kd_rek5='$crek5' and month(a.tgl_sts)<'$nbulan' and year(a.tgl_sts)='$thn_ang' ";
                    $i_urut=1;
                    $hasil2 = $this->db->query($csql);
                    
                    foreach ($hasil2->result() as $row2)
                    {            
                        $nlalu = $row2->xlalu;
                    };
                    
                    $nsdini=$nlalu+$lcjumlah;
                    

            $cRet .="     <tr>
                    <td colspan=\"4\" valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-left:none;border-right:none;\">Jumlah Bulan Ini</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcjumlah)."</td>
                 </tr>
                 
                 <tr>
                    <td colspan=\"4\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;border-right: solid 1px black;\">Jumlah s.d. Bulan Lalu</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($nlalu)."</td>
                 </tr>
                 
                 <tr>
                    <td colspan=\"4\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;border-right: solid 1px black;\">Jumlah s.d. Bulan Ini</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px black;\"><b>".number_format($nsdini)."</b></td>
                 </tr>";
            
                 
            $cRet .="<tr>                
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            
            <tr>                
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            
            <tr>
                <td colspan=\"2\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">                
                  Mengetahui
                </td> 
                <td colspan=\"3\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">
                .............., Tanggal..........
                </td>         
            </tr>
            
             <tr>
                <td colspan=\"2\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">                
                  Pengguna Anggaran/ <br> Kuasa Pengguna Anggaran
                </td> 
                <td colspan=\"3\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">
                Bendahara Penerimaan
                </td>         
            </tr>
            <tr>                
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>                
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
                <td align=\"center\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>             
            
            <tr>
                <td colspan=\"2\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">                
                    <u><b>$nama1</b></u><br>Nip. $nip
                </td> 
                <td colspan=\"3\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">
                    <u><b>$nama2</b></u><br>Nip. $nip2
                </td>         
            </tr>";
            
                    
        
        $cRet .= '</TABLE>';
        $data['prev'] = 'RINCIAN OBYEK';                 
        $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');  
    }
        
     
    function rekap_terima()
    {
        $data['page_title']= 'Rekapitulasi Penerimaan';
        $this->template->set('title', 'Rekapitulasi Penerimaan');   
        $this->template->load('template','tukd/pendapatan/terima_rekap',$data) ; 
    }
    
    function cetak_rekapterima()
    { 
         $thn_ang = $this->session->userdata('pcThang');
         $lcskpd = $_REQUEST['kd_skpd'];
         $pilih = $_REQUEST['cpilih'];
         if ($pilih==1){
            $lctgl1 = $_REQUEST['tgl1'];
            $lctgl2 = $_REQUEST['tgl2'];   
            $lcperiode = $this->tukd_model->tanggal_format_indonesia($lctgl1)."  S.D. ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            $lcperiode1 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl1);
            $lcperiode2 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            
         }else{
            $bulan = $_REQUEST['bulan'];
            
            $lcperiode = $this->tukd_model->getBulan($bulan);
            if($bulan==1){
                $lcperiode1 = "Bulan Sebelumnya";    
            }else{
            $lcperiode1 = "Bulan ".$this->tukd_model->getBulan($bulan-1);
            }  
            $lcperiode2 = "Bulan ".$this->tukd_model->getBulan($bulan);;
         }
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
                  
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'PA' AND a.kd_skpd = '$lcskpd'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         
         $lcNmPA = $trh2->nama;
         $lcNipPA = $trh2->nip;
         
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'BP' AND a.kd_skpd = '$lcskpd'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmBP = $trh2->nama;
         $lcNipBP = $trh2->nip;                  

        $csql="SELECT a.nm_skpd FROM ms_skpd a WHERE a.kd_skpd = '$lcskpd'";
        $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmskpd = $trh2->nm_skpd;
            
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"9\" style=\"font-size:14px;border: solid 1px white;\"><b>KABUPATEN MAHARDIKA<br>BUKU REKAPITULASI PENERIMAAN HARIAN</b></td>
            </tr>
            <tr>
                <td align=\"center\" colspan=\"9\" style=\"font-size:14px;border: solid 1px white;\"><b>PERIODE ".strtoupper($lcperiode)."</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">SKPD</td>
                <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmskpd</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td>
                <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmPA</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">Bendahara Penerimaan</td>
                <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmBP</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
            
            <tr>
                <td align=\"center\" rowspan=\"2\" width=\"5%\" style=\"font-size:12px\">No<br>Urut</td>
                <td align=\"center\" rowspan=\"2\" width=\"10%\" style=\"font-size:12px\">Tanggal</td>
                <td align=\"center\" rowspan=\"2\" width=\"10%\" style=\"font-size:12px\">Referensi</td>
                <td align=\"center\" colspan=\"2\" width=\"25%\" style=\"font-size:12px\">Pajak Daerah<br>(Rp)</td>
                <td align=\"center\" colspan=\"2\" width=\"25%\" style=\"font-size:12px\">Retribusi Daerah<br>(Rp)</td>
                <td align=\"center\" colspan=\"2\" width=\"25%\" style=\"font-size:12px\">Lain-lain PAD yang Sah<br>(Rp)</td>
            </tr>
            <tr>                
                <td align=\"center\" width=\"15%\" style=\"font-size:12px\">Kode dan Nama Kode Rekening Rincian Obyek</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px\">Rupiah</td>
                <td align=\"center\" width=\"15%\" style=\"font-size:12px\">Kode dan Nama Kode Rekening Rincian Obyek</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px\">Rupiah</td>
                <td align=\"center\" width=\"15%\" style=\"font-size:12px\">Kode dan Nama Kode Rekening Rincian Obyek</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px\">Rupiah</td>
            </tr>
            <tr>
                <td align=\"center\" style=\"font-size:12px\">1</td>
                <td align=\"center\" style=\"font-size:12px\">2</td>
                <td align=\"center\" style=\"font-size:12px\">3</td>
                <td align=\"center\" style=\"font-size:12px\">4</td>
                <td align=\"center\" style=\"font-size:12px\">5</td>
                <td align=\"center\" style=\"font-size:12px\">6</td>
                <td align=\"center\" style=\"font-size:12px\">7</td>
                <td align=\"center\" style=\"font-size:12px\">8</td>
                <td align=\"center\" style=\"font-size:12px\">9</td>
            </tr>";
           
           if ($pilih==1){
           $sql = "SELECT a.no_sts, a.tgl_sts, a.kd_skpd, a.keterangan, a.kd_kegiatan, a.jns_trans, b.kd_rek5, b.rupiah, c.nm_rek5 FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts)
                    INNER JOIN ms_rek5 c ON RTRIM(b.kd_rek5)=RTRIM(c.kd_rek5)                               
                    WHERE  (a.tgl_sts >= '$lctgl1' AND a.tgl_sts <= '$lctgl2') AND a.kd_skpd = '$lcskpd'
                    AND (SUBSTRING(b.kd_rek5,1,3)='411' OR SUBSTRING(b.kd_rek5,1,3)='412' OR SUBSTRING(b.kd_rek5,1,3)='414') 
                    ORDER BY a.tgl_sts,a.no_sts,a.jns_trans,b.kd_rek5";
           }else{
           $sql = "SELECT a.no_sts, a.tgl_sts, a.kd_skpd, a.keterangan, a.kd_kegiatan, a.jns_trans, b.kd_rek5, b.rupiah, c.nm_rek5 FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts)
                    INNER JOIN ms_rek5 c ON RTRIM(b.kd_rek5)=RTRIM(c.kd_rek5)
                    WHERE  (month(a.tgl_sts)= '$bulan' AND year(a.tgl_sts) = '$thn_ang') AND a.kd_skpd = '$lcskpd'
                    AND (SUBSTRING(b.kd_rek5,1,3)='411' OR SUBSTRING(b.kd_rek5,1,3)='412' OR SUBSTRING(b.kd_rek5,1,3)='414') 
                    ORDER BY a.tgl_sts,a.no_sts,a.jns_trans,b.kd_rek5";                    
           };
                                       
                    $hasil = $this->db->query($sql);
                    $lcno = 0;
                    $lcno_sts_lama="";

                    foreach ($hasil->result() as $row)
                    {
                        $cRet .="<tr>";                        
                       if(($row->no_sts)<>$lcno_sts_lama){
                         $lcno = $lcno + 1;
                         $cRet .= "<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$lcno</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->tgl_sts</td>";                         
                       }else{
                        $cRet .= "<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">&nbsp;</td> 
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">&nbsp;</td>";
                       }
                        
                        $cRet .="<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>";
                                
                                if((substr($row->kd_rek5,0,3))=='411'){
                        $cRet .="<td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->kd_rek5 - $row->nm_rek5</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->rupiah)."</td>";
                                    }
                                else{
                        $cRet .="<td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">0</td>";
                                    }
                                
                                if((substr($row->kd_rek5,0,3))=='412'){
                        $cRet .="<td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->kd_rek5 - $row->nm_rek5</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->rupiah)."</td>";
                                    }
                                else{
                        $cRet .="<td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">0</td>";
                                    }
                                    
                                if((substr($row->kd_rek5,0,3))=='414'){
                        $cRet .="<td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->kd_rek5 - $row->nm_rek5</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->rupiah)."</td>";
                                    }
                                else{
                        $cRet .="<td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">0</td>";
                                    }
                       
                       $lcno_sts_lama=$row->no_sts;         
                                    
                    };
                    
                    
        $cRet .="<tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">Mengetahui</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">....................., tanggal ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">Pengguna Anggaran/<br>Kuasa Pengguna Aggaran</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">Bendahara Penerimaan</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmPA</u></b></td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmBP</u></b></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipPA</td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipPA</td>
                </tr>";
                
                                  
                
        $cRet .='</table>';
                 
         $data['prev']= $cRet;    
         //$this->tukd_model->_mpdf('',$cRet,'10','10',5,'0');
         $this->tukd_model->_mpdf('', $cRet, 10, 10, 10, 'L');
    }
      
    function buku_terima_ppkd()
    {
        $data['page_title']= 'Buku Kas Penerimaan';
        $this->template->set('title', 'Buku Kas Penerimaan');   
        $this->template->load('template','tukd/pendapatan/kas_terima',$data) ; 
    }
    
    function buku_kas()
    {
        $data['page_title']= 'Buku Kas Penerimaan';
        $this->template->set('title', 'Buku Kas Penerimaan');   
        $this->template->load('template','tukd/pendapatan/kas_harian',$data) ; 
    }
    
    
    
    
    function cetak_terima_ppkd()
    {
        $thn_ang = $this->session->userdata('pcThang');
         $lcskpd = '1.20.00.00';//$_REQUEST['kd_skpd'];
         $pilih = $_REQUEST['cpilih'];
         if ($pilih==1){
            $lctgl1 = $_REQUEST['tgl1'];
            $lctgl2 = $_REQUEST['tgl2'];   
            $lcperiode = $this->tukd_model->tanggal_format_indonesia($lctgl1)."  S.D. ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            $lcperiode1 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl1);
            $lcperiode2 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            
         }else{
            $bulan = $_REQUEST['bulan'];
            
            $lcperiode = $this->tukd_model->getBulan($bulan);
            if($bulan==1){
                $lcperiode1 = "Bulan Sebelumnya";    
            }else{
            $lcperiode1 = "Bulan ".$this->tukd_model->getBulan($bulan-1);
            }  
            $lcperiode2 = "Bulan ".$this->tukd_model->getBulan($bulan);;
         }
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
                  
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'PA' AND a.kd_skpd = '$lcskpd'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         
         $lcNmPA = $trh2->nama;
         $lcNipPA = $trh2->nip;
         
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'PA' AND a.kd_skpd = '$lcskpd'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmBP = $trh2->nama;
         $lcNipBP = $trh2->nip;                  

        $csql="SELECT a.nm_skpd FROM ms_skpd a WHERE a.kd_skpd = '$lcskpd'";
        $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmskpd = $trh2->nm_skpd;
            
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"8\" style=\"font-size:14px;border: solid 1px white;\"><b>PEMERINTAH KABUPATEN SANGGAU<br>BUKU PENERIMAAN PPKD <br> BENDAHARA PENERIMAAN PPKD</b></td>
            </tr>
              <tr>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
        
            
            <tr>
                <td align=\"center\" width=\"4%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\" >Nomor</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Tanggal</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Kode Kredit</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Bukti lain</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Kode Rekening</td>
                <td align=\"center\" width=\"30%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Uraian</td>
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Jumlah<br>(Rp)</td>
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Keterangan</td>                
            </tr>            
            <tr>
                <td align=\"center\" style=\"font-size:12px\">1</td>
                <td align=\"center\" style=\"font-size:12px\">2</td>
                <td align=\"center\"  style=\"font-size:12px\">3</td>
                <td align=\"center\"  style=\"font-size:12px\">4</td>
                <td align=\"center\"  style=\"font-size:12px\">5</td>
                <td align=\"center\" style=\"font-size:12px\">6</td>
                <td align=\"center\" style=\"font-size:12px\">7</td>
                <td align=\"center\" style=\"font-size:12px\">8</td>                
            </tr>";
           
           
           $lcterima_lalu =0;
           if ($pilih==1){
                $csql= "select SUM(nilai) AS nilai FROM tr_terima_ppkd  WHERE  tgl_terima < '$lctgl1' AND kd_skpd = '1.20.00.00'";
                $hasil2 = $this->db->query($csql);
                $trh2 = $hasil2->row();          
                $lcterima_lalu = $trh2->nilai;                                              
                
           }else{
                $csql= "select SUM(nilai) AS nilai FROM tr_terima_ppkd WHERE  month(tgl_terima)< '$bulan' AND kd_skpd = '1.20.00.00'";
                $hasil = $this->db->query($csql);
                $trh2 = $hasil->row();          
                $lcterima_lalu = $trh2->nilai;
                                    
           }
                     
           
            if ($pilih==1   ){
           $sql = "SELECT a.no_terima, a.tgl_terima, a.keterangan, a.kd_rek5,a.nilai,b.nm_rek5 FROM tr_terima_ppkd a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5
                    WHERE  (a.tgl_terima >= '$lctgl1' AND a.tgl_terima <= '$lctgl2') AND a.kd_skpd = '1.20.00.00'                    
                    ORDER BY tgl_terima, no_terima";
           }else{
            $sql = "SELECT a.no_terima, a.tgl_terima, a.keterangan, a.kd_rek5,a.nilai,b.nm_rek5 FROM tr_terima_ppkd a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5
                    WHERE  (month(a.tgl_terima)= '$bulan' AND year(a.tgl_terima) = '$thn_ang') AND a.kd_skpd = '1.20.00.00'                     
                    ORDER BY tgl_terima, no_terima "; 
                    
                                                        
           }
           
           
                                       
                    $hasil = $this->db->query($sql);                
                    $lcno_sts_lama="";
                    $lcstatus_lama=0;
                    $lcterima_ini=0;
                    $lckeluar_ini=0;
                    foreach ($hasil->result() as $row)
                    {
                                            
                        
                        $cRet .="<tr>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->no_terima</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".$this->tanggal_indonesia($row->tgl_terima)."</td>";
                                                                                                                                
                       $cRet .="<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                              <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                              <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->kd_rek5</td>>
                              <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->nm_rek5</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->nilai)."</td>
                              <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">$row->keterangan</td>
                              </tr>";                     
                                                                    
                       $lcterima_ini=$lcterima_ini+$row->nilai;
                                  
                    }
                    


        if ($pilih==1){
        $cRet .="<tr>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;border-top:solid 1px black;\">Jumlah tanggal $lcperiode</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_ini)."</td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">Jumlah sampai tanggal lalu</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_lalu)."</td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">Jumlah semua s/d tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl2)."</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_lalu+$lcterima_ini)."</td>
                </tr>";
            
        }else{
                                    
        $cRet .="<tr>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;border-top:solid 1px black;\">Jumlah bulan $lcperiode</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_ini)."</td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">Jumlah sampai bulan lalu</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_lalu)."</td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">Jumlah semua s/d bulan ".$this->tukd_model->getBulan($bulan)."</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_lalu+$lcterima_ini)."</td>
                </tr>";
        }
                
        $cRet .="<tr>
                    <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">Jumlah Akhir</td>
                    <td align=\"left\" colspan=\"1\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;border-top:solid 1px black;\"></td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_lalu+$lcterima_ini)."</td>
                </tr>";
         $cRet .="
                <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">Mengetahui,</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Sanggau, ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">Pengguna Anggaran</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Bendahara Penerimaan PPKD</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmPA</u></b></td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"><b><u></u></b></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipPA</td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">NIP. </td>
                </tr>";        
                                  
                
        $cRet .='</table>';
                 
         $data['prev']= $cRet;    
         //$this->tukd_model->_mpdf('',$cRet,'10','10',5,'0');
         //$this->tukd_model->_mpdf('', $cRet, 10, 10, 10, 'L');
         $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
    }
    



    function spj_terima()
    {
        $data['page_title']= 'SPJ PENDAPATAN';
        $this->template->set('title', 'SPJ Pendapatan');   
        $this->template->load('template','tukd/pendapatan/spj_terima',$data) ; 
    }
    
     
    function cetak_spjterima()
    {
        $thn_ang = $this->session->userdata('pcThang');
         $lcskpd = $_REQUEST['kd_skpd'];
         $pilih = $_REQUEST['cpilih'];
         if ($pilih==1){
            $lctgl1 = $_REQUEST['tgl1'];
            $lctgl2 = $_REQUEST['tgl2'];   
            $lcperiode = $this->tukd_model->tanggal_format_indonesia($lctgl1)."  S.D. ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            $lcperiode1 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl1);
            $lcperiode2 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            
         }else{
            $bulan = $_REQUEST['bulan'];
            
            $lcperiode = $this->tukd_model->getBulan($bulan);
            if($bulan==1){
                $lcperiode1 = "Bulan Sebelumnya";    
            }else{
            $lcperiode1 = "Bulan ".$this->tukd_model->getBulan($bulan-1);
            }  
            $lcperiode2 = "Bulan ".$this->tukd_model->getBulan($bulan);;
         }
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
                  
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'PA' AND a.kd_skpd = '$lcskpd'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         
         $lcNmPA = $trh2->nama;
         $lcNipPA = $trh2->nip;
         
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'BP' AND a.kd_skpd = '$lcskpd'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmBP = $trh2->nama;
         $lcNipBP = $trh2->nip;                  

        $csql="SELECT a.nm_skpd FROM ms_skpd a WHERE a.kd_skpd = '$lcskpd'";
        $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmskpd = $trh2->nm_skpd;
            
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"13\" style=\"font-size:14px;border: solid 1px white;\"><b>KABUPATEN MAHARDIKA<br>
                    LAPORAN PERTANGGUNGJAWABAN BENDAHARA PENERIMAAN<BR>SPJ PENDAPATAN PERIODE ".strtoupper($lcperiode)."</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">SKPD</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmskpd</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmPA</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Bendahara Penerimaan</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">:&nbsp;$lcNmBP</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
            
            
            <tr>
                <td align=\"center\" rowspan=\"2\" width=\"10%\" style=\"font-size:12px\">Kode<br>Rekening</td>
                <td align=\"center\" rowspan=\"2\" width=\"24%\" style=\"font-size:12px\">Uraian</td>
                <td align=\"center\" rowspan=\"2\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran</td>
                <td align=\"center\" colspan=\"3\" width=\"18%\" style=\"font-size:12px\">Sampai dengan Bulan Lalu</td>
                <td align=\"center\" colspan=\"3\" width=\"18%\" style=\"font-size:12px\">Bulan Ini</td>
                <td align=\"center\" colspan=\"4\" width=\"24%\" style=\"font-size:12px\">Sampai dengan Bulan Ini</td>
            </tr>
            <tr>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penerimaan</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penyetoran</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penerimaan</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Penyetoran</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran<br>yang<br>Terealisasi</td>                
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Jumlah<br>Anggaran<br>yang telah<br>Disetor</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:12px\">Sisa yang<br>Belum<br>Disetor</td>
                <td align=\"center\" width=\"6%\" style=\"font-size:10px\">Sisa Anggaran yang<br>Belum<br>Terealisasi/Pelam-<br>pauan Anggaran</td>                                
            </tr>            
            <tr>
                <td align=\"center\" style=\"font-size:10px\">1</td>
                <td align=\"center\" style=\"font-size:10px\">2</td>
                <td align=\"center\" style=\"font-size:10px\">3</td>
                <td align=\"center\" style=\"font-size:10px\">4</td>
                <td align=\"center\" style=\"font-size:10px\">5</td>
                <td align=\"center\" style=\"font-size:10px\">6=(5-4)</td>
                <td align=\"center\" style=\"font-size:10px\">7</td>
                <td align=\"center\" style=\"font-size:10px\">8</td>
                <td align=\"center\" style=\"font-size:10px\">9=(8-7)</td>
                <td align=\"center\" style=\"font-size:10px\">10=(4+7)</td>
                <td align=\"center\" style=\"font-size:10px\">11=(5+8)</td>
                <td align=\"center\" style=\"font-size:10px\">12=(11-10)</td>
                <td align=\"center\" style=\"font-size:10px\">13=(3-10)</td>                
            </tr>";
           

            if ($pilih==1   ){
                $kon_terimaini = " (a.tgl_sts >= '$lctgl1' AND a.tgl_sts <= '$lctgl2')";
                $kon_keluarini = " (a.tgl_sts >= '$lctgl1' AND a.tgl_sts <= '$lctgl2')";          
                $kon_terimalalu = " (a.tgl_sts < '$lctgl1')";
                $kon_keluarlalu = " (tgl_sts)";
           }else{
                $kon_terimaini = " (month(a.tgl_sts)= '$bulan' AND year(a.tgl_sts) = '$thn_ang')";
                $kon_keluarini = " (month(a.tgl_sts)= '$bulan' AND year(a.tgl_sts) = '$thn_ang')";
                $kon_terimalalu = " (month(a.tgl_sts)< '$bulan' AND year(a.tgl_sts) = '$thn_ang')";
                $kon_keluarlalu = " (month(a.tgl_sts)< '$bulan' AND year(a.tgl_sts) = '$thn_ang')";
           }

            
            $kon_skpd="a.kd_skpd = ";
            $sql  = "SELECT z.kd_skpd, z.kd_kegiatan, z.kd_rek5, z.nm_rek5, SUM(z.nilai) AS ang, SUM(z.nilai_ubah) AS ang_ubah,
                    (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_terimaini) AS terima_ini,
                    (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_terimalalu) AS terima_lalu,
                    (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_keluarini) AS keluar_ini,
                    (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE b.kd_rek5=z.kd_rek5 and a.kd_skpd=z.kd_skpd and $kon_keluarlalu) AS keluar_lalu                    
                    FROM trdrka z WHERE z.kd_skpd='$lcskpd' and left(z.kd_rek5,1)='4'
                    GROUP BY z.kd_skpd, z.kd_kegiatan, z.kd_rek5
                    ORDER BY z.kd_rek5"     ;
                                       
                    $hasil = $this->db->query($sql);                                                      
                    $lcterima_ini=0;
                    $lckeluar_ini=0;
                    $lcprog_lama="";
                    $lckeg_lama="";
                    $ln_jlh1 =0;
                    $ln_jlh2 =0;
                    $ln_jlh3 =0;
                    $ln_jlh4 =0;
                    $ln_jlh5 =0;
                    $ln_jlh6 =0;
                    $ln_jlh7 =0;
                    $ln_jlh8 =0;
                    $ln_jlh9 =0;
                    $ln_jlh10 =0;
                    $ln_jlh11 =0;
                    
                    foreach ($hasil->result() as $row)
                    {
                        $lcprog=substr($row->kd_kegiatan,0,18);
                        $lckeg=$row->kd_kegiatan;
                        $lcrek=$row->kd_rek5;
                        
                        if($lcprog<>$lcprog_lama){//cek program
                            $sql="select z.kd_program, z.nm_program,
                                (SELECT SUM(a.nilai_ubah) FROM trdrka a WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and a.kd_skpd='$lcskpd' and left(a.kd_rek5,1)='4') AS ang_ubah,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and a.kd_skpd='$lcskpd' and $kon_terimaini) AS terima_ini,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and a.kd_skpd='$lcskpd' and $kon_terimalalu) AS terima_lalu,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and a.kd_skpd='$lcskpd' and $kon_keluarini) AS keluar_ini,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE substring(a.kd_kegiatan,1,18)=z.kd_program and a.kd_skpd='$lcskpd' and $kon_keluarlalu) AS keluar_lalu 
                                    from trskpd z where z.kd_kegiatan='$lckeg' and z.kd_skpd='$lcskpd'
                                    group by z.kd_program, z.nm_program";
                             $hasil_prog = $this->db->query($sql);
                             foreach ($hasil_prog->result() as $row_prog)
                             {
                             $cRet .="<tr>
                                    <td valign=\"top\" align=\"left\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>$lcprog</b></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"><b>$row_prog->nm_program</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->ang_ubah)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->terima_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->keluar_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu)-($row_prog->terima_lalu))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->terima_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->keluar_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_ini)-($row_prog->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->terima_lalu)+($row_prog->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu)+($row_prog->keluar_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_prog->keluar_lalu+$row_prog->keluar_ini)-($row_prog->terima_lalu+$row_prog->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_prog->ang_ubah-($row_prog->terima_lalu+$row_prog->terima_ini))."</b></td>
                                  </tr>";
                                    
                                
                             }
                                                                                                                                                                 
                        }
                        
                        if($lckeg<>$lckeg_lama){ //cek kegiatan
                            $sql="select z.kd_kegiatan, z.nm_kegiatan,
                                (SELECT SUM(a.nilai_ubah) FROM trdrka a WHERE a.kd_kegiatan=z.kd_kegiatan and a.kd_skpd='$lcskpd') AS ang_ubah,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE a.kd_kegiatan=z.kd_kegiatan and a.kd_skpd='$lcskpd' and $kon_terimaini) AS terima_ini,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE a.kd_kegiatan=z.kd_kegiatan and a.kd_skpd='$lcskpd' and $kon_terimalalu) AS terima_lalu,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE a.kd_kegiatan=z.kd_kegiatan and a.kd_skpd='$lcskpd' and $kon_keluarini) AS keluar_ini,
                                (SELECT SUM(b.rupiah) FROM trhkasin_pkd a INNER JOIN trdkasin_pkd b ON RTRIM(a.no_sts)=RTRIM(b.no_sts) WHERE a.kd_kegiatan=z.kd_kegiatan and a.kd_skpd='$lcskpd' and $kon_keluarlalu) AS keluar_lalu 
                                    from trskpd z where z.kd_kegiatan='$lckeg' and z.kd_skpd='$lcskpd' 
                                    group by z.kd_kegiatan, z.nm_kegiatan";
                             $hasil_keg = $this->db->query($sql);
                             foreach ($hasil_keg->result() as $row_keg)
                             {
                                $cRet .="<tr>
                                    <td valign=\"top\" align=\"left\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>$lckeg</b></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:11px;border-bottom:none;border-top:none\"><b>$row_keg->nm_kegiatan</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->ang_ubah)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->terima_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->keluar_lalu)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu)-($row_keg->terima_lalu))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->terima_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->keluar_ini)."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_ini)-($row_keg->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->terima_lalu)+($row_keg->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu)+($row_keg->keluar_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format(($row_keg->keluar_lalu+$row_keg->keluar_ini)-($row_keg->terima_lalu+$row_keg->terima_ini))."</b></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\"><b>".number_format($row_keg->ang_ubah-($row_keg->terima_lalu+$row_keg->terima_ini))."</b></td>
                                  </tr>";
                                
                                
                             }
                                                                                                                                                                 
                        }                                                                                                                        
                                                                                                                                
                       $cRet .="<tr>
                                <td valign=\"top\" align=\"left\" style=\"font-size:10px;border-bottom:none;border-top:none\">$lckeg.".$this->tukd_model->dotrek($lcrek)."</td>
                              <td valign=\"top\" align=\"left\" style=\"font-size:10px;border-bottom:none;border-top:none\">$row->nm_rek5</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format($row->ang_ubah)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format($row->terima_lalu)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format($row->keluar_lalu)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu)-($row->terima_lalu))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format($row->terima_ini)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format($row->keluar_ini)."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format(($row->keluar_ini)-($row->terima_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format(($row->terima_lalu)+($row->terima_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu)+($row->keluar_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format(($row->keluar_lalu+$row->keluar_ini)-($row->terima_lalu+$row->terima_ini))."</td>
                              <td valign=\"top\" align=\"right\" style=\"font-size:10px;border-bottom:none;border-top:none\">".number_format($row->ang_ubah-($row->terima_lalu+$row->terima_ini))."</td>
                              </tr>";    
                                                              
                        $ln_jlh1=$ln_jlh1+ $row->ang_ubah;
                        $ln_jlh2=$ln_jlh2+ $row->terima_lalu;
                        $ln_jlh3=$ln_jlh3+ $row->keluar_lalu;
                        $ln_jlh4=$ln_jlh4+ ($row->keluar_lalu)-($row->terima_lalu);
                        $ln_jlh5=$ln_jlh5+ $row->terima_ini;
                        $ln_jlh6=$ln_jlh6+ $row->keluar_ini;
                        $ln_jlh7=$ln_jlh7+ ($row->keluar_ini-$row->terima_ini);
                        $ln_jlh8=$ln_jlh8+ ($row->terima_lalu+$row->terima_ini);
                        $ln_jlh9=$ln_jlh9+ ($row->keluar_lalu+$row->keluar_ini);
                        $ln_jlh10=$ln_jlh10+ (($row->keluar_lalu+$row->keluar_ini)-($row->terima_lalu+$row->terima_ini));
                        $ln_jlh11=$ln_jlh11+ ($row->ang_ubah-($row->terima_lalu+$row->terima_ini));
                                                                             
                        $lcprog_lama=$lcprog;
                        $lckeg_lama=$lckeg;           
                    }
                    


        $cRet .="<tr>
                    <td valign=\"top\" align=\"center\" colspan=\"2\" style=\"font-size:10px\"><b>Jumlah</b></td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh1)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh2)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh3)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh4)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh5)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh6)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh7)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh8)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh9)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh10)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:10px\">".number_format($ln_jlh11)."</td>
                </tr>
                
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Mengetahui</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">....................., tanggal ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">Pengguna Anggaran/<br>Kuasa Pengguna Aggaran</td>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">Bendahara Penerimaan</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"11\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmPA</u></b></td>
                    <td align=\"center\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\"><b><u>$lcNmBP</u></b></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipPA</td>
                    <td align=\"center\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\">NIP. $lcNipPA</td>
                </tr>";
                
                                  
                
        $cRet .='</table>';
         $data['prev']= $cRet;    
         $this->tukd_model->_mpdf('', $cRet, 10, 10, 10, 'L');
    }
    
    
// flag    
    function nosp2d_bank($lcskpd='') {                 
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.no_sp2d, a.tgl_sp2d, a.no_spm, 
            (SELECT SUM(c.nilai) FROM trdspp c INNER JOIN trhspm b ON RTRIM(b.no_spp)=RTRIM(c.no_spp) WHERE RTRIM(b.no_spm)=RTRIM(a.no_spm)) AS nilai
            FROM trhsp2d a
            WHERE UPPER(a.no_sp2d) LIKE UPPER('%$lccr%') AND RTRIM(a.kd_skpd)= '$lcskpd' AND no_sp2d NOT IN  
                                (SELECT no_sp2d FROM trbank_terima)";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],  
                        'tgl_sp2d' => $resulte['tgl_sp2d'],      
                        'nilai' => number_format($resulte['nilai']),
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();
    }
    
    function config_bank_simpanan() {
        $lccr   = $this->input->post('q');
        $sql    = "SELECT kode, nama FROM ms_bank where upper(kode) like '%$lccr%' or upper(nama) like '%$lccr%' order by kode ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'kode' => $resulte['kode'],  
                        'nama' => $resulte['nama']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
	}


   		/* function config_skpd(){
        $skpd     = '1.20.05.01';//$this->session->userdata('kdskpd');
        $sql = "SELECT kd_skpd,nm_skpd FROM  ms_skpd where kd_skpd = '$skpd'";
        $query1 = $this->db->query($sql);  
		
		$test = $query1->num_rows();
		
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        } 
		

		
		
        echo json_encode($result);
    	$query1->free_result();   
    }*/
    
	
	function load_sp2d_transout_ppkd(){
       //$beban='',$giat=''
       $beban   =$this->input->post('jenis');
       $giat    =$this->input->post('giat');
       $kode    ='1.20.05.01';//$this->input->post('kd');
       $bukti   =$this->input->post('bukti');
       $where = '';
       if ($beban=='1'){
        $sisa = "(SELECT IF(SUM(v.nilai) IS NULL,0,SUM(v.nilai)) FROM trhspp z INNER JOIN trhspm s ON z.no_spp=s.no_spp 
                INNER JOIN trhsp2d v ON s.no_spm=v.no_spm WHERE z.jns_spp='1' AND z.kd_skpd=c.kd_skpd )
                -(SELECT IF(SUM(nilai) IS NULL,0,SUM(nilai)) FROM trdtransout_ppkd WHERE no_sp2d = c.no_sp2d and no_bukti <> '$bukti') AS sisa";
       }else{
        $sisa = "c.nilai -(SELECT IF(SUM(nilai) IS NULL,0,SUM(nilai)) FROM trdtransout_ppkd WHERE no_sp2d = c.no_sp2d and no_bukti <> '$bukti') AS sisa";   
       }
       if (($beban != '' && $giat == '') || ($beban == '1')){
            $where = " and a.jns_spp='$beban'"; 
       }
       if ($giat !='' && $beban != '1'){
            $where = " and a.jns_spp='$beban' and d.kd_kegiatan='$giat'";
       }
        $kriteria = $this->input->post('q');
            $sql = "SELECT DISTINCT c.no_sp2d,c.tgl_sp2d,c.nilai,
                    $sisa                   
                    FROM trhspp a INNER JOIN trhspm b ON a.no_spp=b.no_spp
                    INNER JOIN trhsp2d c ON b.no_spm=c.no_spm
                    INNER JOIN trdspp d ON a.no_spp=d.no_spp
                    WHERE c.kd_skpd = '$kode' AND c.status = 1 $where ORDER BY c.no_sp2d,c.tgl_sp2d";
       //and UPPER(no_sp2d) LIKE '%$kriteria%'  
        $query1 = $this->db->query($sql);                  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {                               
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'nilai' => $resulte['nilai'],
                        'sisa' => $resulte['sisa']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();
    }
	
	function hapus_transout_ppkd(){
        $nomor = $this->input->post('no');
        $msg = array();
        $sql = "delete from trdtransout_ppkd where no_bukti='$nomor'";
        $asg = $this->db->query($sql);
        
        $sql = "delete from trdtransout where no_bukti='$nomor'";
        $asg = $this->db->query($sql);

		$sql = "delete from trdju_ppkd where no_voucher='$nomor'";
        $asg = $this->db->query($sql);
        
        $sql = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg = $this->db->query($sql);
        
        $sql = "delete from trdju where no_voucher='$nomor'";
        $asg = $this->db->query($sql);

		if ($asg){
            $sql = "delete from trhtransout_ppkd where no_bukti='$nomor'";
            $asg = $this->db->query($sql);
            
            $sql = "delete from trhtransout where no_bukti='$nomor'";
            $asg = $this->db->query($sql);

            $sql = "delete from trhju_ppkd where no_voucher='$nomor'";
            $asg = $this->db->query($sql);
            
            $sql = "delete from trhju_pkd where no_voucher='$nomor'";
            $asg = $this->db->query($sql);
            
            $sql = "delete from trhju where no_voucher='$nomor'";
            $asg = $this->db->query($sql);

			
			if (!($asg)){
              $msg = array('pesan'=>'0');
              echo json_encode($msg);
               exit();
            } 
        } else {
            $msg = array('pesan'=>'0');
            echo json_encode($msg);
            exit();
        }
        $msg = array('pesan'=>'1');
        echo json_encode($msg);
    }

	function load_transout_ppkd(){
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where=" and (upper(no_bukti) like upper('%$kriteria%') or tgl_bukti like '%$kriteria%' or upper(nm_skpd) like 
                    upper('%$kriteria%') or upper(ket) like upper('%$kriteria%'))";            
        }
        
        $sql = "SELECT count(*) as total from trhtransout_ppkd where kd_skpd='1.20.05.01' $where " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
       	$result["total"] = $total->total; 
        $query1->free_result();        
        
        $sql = "SELECT * from trhtransout_ppkd where kd_skpd='1.20.05.01' $where order by tgl_bukti,no_bukti,kd_skpd limit $offset,$rows";
        $query1 = $this->db->query($sql);  
        
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_bukti' => $resulte['no_bukti'],
                        'tgl_bukti' => $resulte['tgl_bukti'],
                        'ket' => $resulte['ket'],
                        'username' => $resulte['username'],    
                        'tgl_update' => $resulte['tgl_update'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
                        'total' => $resulte['total'],
                        'no_tagih' => $resulte['no_tagih'],
                        'sts_tagih' => $resulte['sts_tagih'],
                        'tgl_tagih' => $resulte['tgl_tagih'],                       
                        'jns_beban' => $resulte['jns_spp'],
                        'pay' => $resulte['pay']                                                                                                        
                        );
                        $ii++;
        }
       	$result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();
    }

	function load_dtransout_ppkd(){        
        $nomor = $this->input->post('no');    
        $sql = "SELECT b.*,
                (SELECT SUM(c.nilai) FROM trdtransout_ppkd c LEFT JOIN trhtransout_ppkd d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                d.kd_skpd=a.kd_skpd AND c.kd_rek5=b.kd_rek5 AND c.no_bukti <> a.no_bukti AND d.jns_spp = a.jns_spp ) AS lalu,
                (SELECT e.nilai FROM trhspp e INNER JOIN trdspp f ON e.no_spp=f.no_spp INNER JOIN trhspm g ON e.no_spp=g.no_spp INNER JOIN trhsp2d h ON g.no_spm=h.no_spm
                WHERE h.no_sp2d = b.no_sp2d AND f.kd_kegiatan=b.kd_kegiatan AND f.kd_rek5=b.kd_rek5) AS sp2d,
                (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek5) AS anggaran FROM trhtransout_ppkd a INNER JOIN
                trdtransout_ppkd b ON a.no_bukti=b.no_bukti WHERE a.no_bukti='$nomor' ORDER BY b.kd_kegiatan,b.kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id'            => $ii,        
                        'no_bukti'      => $resulte['no_bukti'],
                        'no_sp2d'       => $resulte['no_sp2d'],
                        'kd_kegiatan'   => $resulte['kd_kegiatan'],
                        'nm_kegiatan'   => $resulte['nm_kegiatan'],
                        'kd_rek5'       => $resulte['kd_rek5'],
                        'nm_rek5'       => $resulte['nm_rek5'],
                        'nilai'         => $resulte['nilai'],
                        'lalu'          => $resulte['lalu'],
                        'sp2d'          => $resulte['sp2d'],   
                        'anggaran'      => $resulte['anggaran']                                                                                                                                                          
                        );
                        $ii++;
        }           
        echo json_encode($result);
        $query1->free_result();
    }
	
	function bku_ppkd()
    {
        $data['page_title']= 'BKU PPKD';
        $this->template->set('title', 'BKU PPKD');   
        $this->template->load('template','tukd/transaksi/bku_ppkd',$data) ; 
    }
     function cetak_bku_ppkd(){
         
         //$cskpd = $_REQUEST['kd_skpd'];
//          $cnm_skpd = $_REQUEST['nm_skpd'];
//          $cskpd = $_REQUEST['kd_skpd'];
         
         //lc = '?kd_skpd='+ckdskpd+'&tgl1='+ctgl1+'&tgl2='+ctgl2+'&tgl_ttd='+ctglttd+'&cpilih=1';
        //lc = '?kd_skpd='+ckdskpd+'&bulan1='+cbulan1+'&bulan2='+cbulan2+'&tgl_ttd='+ctglttd+'&cpilih=2'; 
         $thn_ang = $this->session->userdata('pcThang');
         $lcskpd = $_REQUEST['kd_skpd'];
         $pilih = $_REQUEST['cpilih'];
         if ($pilih==1){
            $lctgl1 = $_REQUEST['tgl1'];
            $lctgl2 = $_REQUEST['tgl2'];   
            $lcperiode = $this->tukd_model->tanggal_format_indonesia($lctgl1)."  S.D. ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            $lcperiode1 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl1);
            $lcperiode2 = "Tanggal ".$this->tukd_model->tanggal_format_indonesia($lctgl2);
            
         }else{
            $bulan = $_REQUEST['bulan'];
            
            $lcperiode = $this->tukd_model->getBulan($bulan);
            if($bulan==1){
                $lcperiode1 = "Bulan Sebelumnya";    
            }else{
            $lcperiode1 = "Bulan ".$this->tukd_model->getBulan($bulan-1);
            }  
            $lcperiode2 = "Bulan ".$this->tukd_model->getBulan($bulan);;
         }
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
         
//         
//         $lcskpd = str_replace('123456789','/',$this->uri->segment(3));
//         $lctgl1 = $this->uri->segment(4);
//         $lctgl2 = $this->uri->segment(5);
//         $tgl_ttd = $this->uri->segment(6);
         
         //echo  $lcskpd.$lctgl1.$lctgl2;  
         
         if ($pilih==1){
         $csql3 = "SELECT SUM(z.terima) AS jmter,SUM(z.keluar) AS jm_kel , SUM(z.terima)-SUM(z.keluar) AS sel FROM (SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,
            '' AS rekening,uraian,0 AS terima,0 AS keluar , 0 AS st,jns_trans FROM trhrekal
            UNION 
            SELECT a.kd_skpd,a.tgl_kas,'' AS tanggal,b.no_kas,b.kd_rek5 AS rekening,
            b.nm_rek5 AS uraian, b.terima,b.keluar , IF(b.terima<>0,'1','2') AS st, b.jns_trans FROM 
            trdrekal b LEFT JOIN trhrekal a ON a.no_kas = b.no_kas)z WHERE  
            z.tgl_kas < '$lctgl1' AND z.kd_skpd = '$lcskpd' and year(z.tgl_kas) = $thn_ang
            ORDER BY tgl_kas,no_kas,jns_trans,st,rekening";
         }else{
             $csql3 = "SELECT SUM(z.terima) AS jmter,SUM(z.keluar) AS jm_kel , SUM(z.terima)-SUM(z.keluar) AS sel FROM (SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,
            '' AS rekening,uraian,0 AS terima,0 AS keluar , 0 AS st,jns_trans FROM trhrekal
            UNION 
            SELECT a.kd_skpd,a.tgl_kas,'' AS tanggal,b.no_kas,b.kd_rek5 AS rekening,
            b.nm_rek5 AS uraian, b.terima,b.keluar , IF(b.terima<>0,'1','2') AS st, b.jns_trans FROM 
            trdrekal b LEFT JOIN trhrekal a ON a.no_kas = b.no_kas)z WHERE  
            month(z.tgl_kas) < '$bulan' and year(z.tgl_kas) = $thn_ang AND z.kd_skpd = '$lcskpd'
            ORDER BY tgl_kas,no_kas,jns_trans,st,rekening";
         }
         
         

         
         $hasil = $this->db->query($csql3);
         $trh4 = $hasil->row(); 
         
         $saldoawal = $trh4->sel;
         
         
         
                  
         $csql="SELECT a.nm_skpd,(SELECT nama FROM ms_ttd WHERE kode = 'PA' AND kd_skpd = a.kd_skpd) AS nm_pa,
                (SELECT nip FROM ms_ttd WHERE kode = 'PA' AND kd_skpd = a.kd_skpd) AS nip_pa,
                (SELECT nama FROM ms_ttd WHERE kode = 'BK' AND kd_skpd = a.kd_skpd) AS nm_bk,
                (SELECT nip FROM ms_ttd WHERE kode = 'BK' AND kd_skpd = a.kd_skpd) AS nip_bk
                 FROM ms_skpd a WHERE a.kd_skpd = '$lcskpd'";
                
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row(); 
            
        
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\"><b>KABUPATEN MAHARDIKA<br>BUKU KAS UMUM PENGELUARAN</b></td>
            </tr>
            <tr>
                <td align=\"center\" colspan=\"16\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\"><b>PERIODE ".strtoupper($lcperiode)."</b></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">SKPD</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">:&nbsp;$trh2->nm_skpd</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">Pengguna Anggaran / Kuasa Pengguna Anggaran</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">:&nbsp;$trh2->nm_pa</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">Bendahara Pengeluaran</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">:&nbsp;$trh2->nm_bk</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 1px black;\"></td>
            </tr>
            <tr>
                <td align=\"center\" width=\"5%\" style=\"font-size:12px\">No<br>Urut</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px\">Tanggal</td>
                <td align=\"center\" colspan=\"10\" width=\"30%\" style=\"font-size:12px\">Kode Rekening</td>
                <td align=\"center\" width=\"25%\" style=\"font-size:12px\">Uraian</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px\">Penerimaan</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px\">Pengeluaran</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px\">Saldo</td>
            </tr>
            <tr>
                <td align=\"center\" style=\"font-size:12px\">1</td>
                <td align=\"center\" style=\"font-size:12px\">2</td>
                <td align=\"center\" colspan=\"10\" style=\"font-size:12px\">3</td>
                <td align=\"center\" style=\"font-size:12px\">4</td>
                <td align=\"center\" style=\"font-size:12px\">5</td>
                <td align=\"center\" style=\"font-size:12px\">6</td>
                <td align=\"center\" style=\"font-size:12px\">7</td>
            </tr>";
           
           if ($pilih==1){
           $sql = "SELECT z.* FROM (SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,'' AS kegiatan,
                    '' AS rekening,uraian,0 AS terima,0 AS keluar , 0 AS st,jns_trans FROM trhrekal
                    UNION 
                    SELECT a.kd_skpd,a.tgl_kas,'' AS tanggal,b.no_kas,b.kd_kegiatan as kegiatan,b.kd_rek5 AS rekening,
                    b.nm_rek5 AS uraian, b.terima,b.keluar , IF(b.terima<>0,'1','2') AS st, b.jns_trans FROM 
                    trdrekal b LEFT JOIN trhrekal a ON a.no_kas = b.no_kas)z WHERE  
                    z.tgl_kas >= '$lctgl1' AND z.tgl_kas <= '$lctgl2' AND z.kd_skpd = '$lcskpd'
                    ORDER BY tgl_kas,no_kas,jns_trans,st,rekening";
           }else{
           $sql = "SELECT z.* FROM (SELECT kd_skpd,tgl_kas,tgl_kas AS tanggal,no_kas,'' AS kegiatan,
                    '' AS rekening,uraian,0 AS terima,0 AS keluar , 0 AS st,jns_trans FROM trhrekal
                    UNION 
                    SELECT a.kd_skpd,a.tgl_kas,'' AS tanggal,b.no_kas,b.kd_kegiatan as kegiatan,b.kd_rek5 AS rekening,
                    b.nm_rek5 AS uraian, b.terima,b.keluar , IF(b.terima<>0,'1','2') AS st, b.jns_trans FROM 
                    trdrekal b LEFT JOIN trhrekal a ON a.no_kas = b.no_kas)z WHERE  
                    month(z.tgl_kas) = '$bulan' AND 
                    year(z.tgl_kas) = $thn_ang and z.kd_skpd = '$lcskpd'
                    ORDER BY tgl_kas,no_kas,jns_trans,st,rekening";     
                    
                    
           }
           
                            
                    $hasil = $this->db->query($sql);
                    $lcno = 0;
                    $lcterima = 0;
                    $lckeluar = 0;
                    $lhasil = $saldoawal;
                    $saldolalu=number_format($lhasil);
                    $cRet .= "<tr><td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>";
                    $cRet .="<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>                
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">Saldo Lalu</td>";
                                $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>";
                                 $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>";
                                 $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">$saldolalu</td></tr>";
                    foreach ($hasil->result() as $row)
                    {
                        $cRet .="<tr>";
                        $lhasil = $lhasil + $row->terima - $row->keluar;
                       if(!empty($row->tanggal)){
                         $lcno = $lcno + 1;
                         $cRet .= "<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$lcno</td>";
                       }else{
                        $cRet .= "<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">&nbsp;</td>";
                       }
                        
                        $cRet .="<td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->tanggal</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->kegiatan,0,4)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->kegiatan,5,7)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->kegiatan,13,2)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->kegiatan,16,2)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->kegiatan,19,2)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->rekening,0,1)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->rekening,1,1)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->rekening,2,1)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->rekening,3,2)."</td>
                                <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">".substr($row->rekening,5,2)."</td>                
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$row->uraian</td>";
                                if(empty($row->terima)){
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>";
                                }else{
                                    $lcterima = $lcterima + $row->terima; 
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->terima)."</td>";
                                }
                                
                                if(empty($row->keluar)){
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>";
                                }else{
                                    $lckeluar = $lckeluar + $row->keluar; 
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($row->keluar)."</td>";
                                }
                                if(empty($row->rekening)){
                                $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>";
                                }else{
                                    $cRet .="<td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($lhasil)."</td>";
                                }
                            $cRet .="</tr>";    
                    }
            
        $cRet .="<tr>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-top:none\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;border-top:solid 1px black;\">&nbsp;</td>
                 </tr>                 
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">Jumlah Periode $lcperiode </td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($lcterima)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($lckeluar)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($lhasil)."</td>
                 </tr>";
                 
                 if ($pilih==1){                 
                 $csql="SELECT SUM(b.terima) AS jmterima, SUM(b.keluar) AS jmkeluar FROM trdrekal b LEFT JOIN 
                        trhrekal a ON a.no_kas=b.no_kas WHERE a.tgl_kas < '$lctgl1'";
                 }else{
                    $csql="SELECT SUM(b.terima) AS jmterima, SUM(b.keluar) AS jmkeluar FROM trdrekal b LEFT JOIN 
                        trhrekal a ON a.no_kas=b.no_kas WHERE month(a.tgl_kas) < '$bulan' and year(a.tgl_kas) = $thn_ang";
                 }
                        
                 $hasil = $this->db->query($csql);
                 $trh1 = $hasil->row(); 
                
        $cRet .="<tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">Jumlah Sampai $lcperiode1 </td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($trh1->jmterima)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($trh1->jmkeluar)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">Jumlah s/d $lcperiode2 </td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($trh1->jmterima+$lcterima)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($trh1->jmkeluar+$lckeluar)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">Sisa Kas Pada $lcperiode2 </td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">".number_format($trh1->jmterima+$lcterima-$trh1->jmkeluar-$lckeluar)."</td>
                    <td valign=\"top\" align=\"right\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td colspan=\"12\" valign=\"top\" align=\"left\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                 </tr>
                 <tr>
                    <td align=\"center\" colspan=\"12\" style=\"font-size:12px;border: solid 1px white;\">
                    Mengetahui,<br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;$trh2->nm_pa<br>$trh2->nip_pa</td>
                    <td valign=\"top\" align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">
                    ".$this->tukd_model->tanggal_format_indonesia($tgl_ttd)."
                    <br>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;$trh2->nm_bk<br>$trh2->nip_bk
                    </td>
                </tr>
              
            
        </table>";
        
         
         $data['prev']= $cRet;    
         $this->tukd_model->_mpdf('',$cRet,'10','10',5,'0');
     
     }
	//============
    
    //============04022014bowo
    function lpj_ppkd()
    {
        $data['page_title']= 'INPUT LPJ PPKD';
        $this->template->set('title', 'INPUT LPJ PPKD');   
        $this->template->load('template','tukd/transaksi/lpj_ppkd',$data) ; 
    }
    
    function simpan_lpj(){
        $tabel    = $this->input->post('tabel');        
        $nomor    = $this->input->post('no');
        $tgl      = $this->input->post('tgl');
        $skpd     = $this->input->post('skpd');
        $nmskpd   = $this->input->post('nmskpd');       
        $beban    = trim($this->input->post('beban'));
        $ket      = $this->input->post('ket');
        $status   = $this->input->post('status');
        $notagih  = $this->input->post('notagih');
        $tgltagih = $this->input->post('tgltagih');
        $total    = $this->input->post('total');      
        $csql     = $this->input->post('sql');            
        $usernm     = $this->session->userdata('pcNama');    
        $update     = date('y-m-d H:i:s');      
        $msg        = array();

		// Simpan Header //
        if ($tabel == 'hlpj_ppkd') {
            $sql = "delete from hlpj_ppkd where kd_skpd='$skpd' and no_bukti='$nomor' and kd_skpd='1.20.05.01'";
			$asg = $this->db->query($sql);
			if ($beban=='1'){
	           $sql = "delete from trhju_ppkd where kd_skpd='$skpd' and no_voucher='$nomor' and kd_skpd='1.20.05.01'";
			   $asg = $this->db->query($sql);
			}

            if ($asg){
                
				$sql = "insert into hlpj_ppkd(no_bukti,tgl_bukti,ket,username,tgl_update,kd_skpd,nm_skpd,total,no_tagih,sts_tagih,tgl_tagih,jns_spp) 
                        values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$notagih','$status','$tgltagih','$beban')";
                $asg = $this->db->query($sql);

				if ($beban=='1'){
					$asq3 = " insert into trhju_ppkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
							  values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$total','0')";
					$asg3 = $this->db->query($asq3);
				}



                if (!($asg)){
                   $msg = array('pesan'=>'0');
                   echo json_encode($msg);
                    exit();
                } else {
                    $msg = array('pesan'=>'1');
                    echo json_encode($msg);
                }             
            } else {
                $msg = array('pesan'=>'0');
                echo json_encode($msg);
                exit();
            }
            
        }elseif($tabel == 'dlpj_ppkd') {
            
            // Simpan Detail //                       
                $sql = "delete from dlpj_ppkd where no_bukti='$nomor'";
                $asg = $this->db->query($sql);
				if ($beban=='1'){
					$sql = "delete from dlpj_ppkd where no_voucher='$nomor'";
					$asg = $this->db->query($sql);
				}
				if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into dlpj_ppkd(no_bukti,no_sp2d,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai)"; 
                    $asg = $this->db->query($sql.$csql);
					if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                     //   exit();
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }

				$hasil=$this->db->query(" select * from dlpj_ppkd where no_bukti='$nomor' ");  	
				foreach ($hasil->result_array() as $row){
					$no	   =$row['no_bukti'];	
					$sp2d  =$row['no_sp2d'];	
					$kdgiat=$row['kd_kegiatan'];	
					$nmgiat=$row['nm_kegiatan'];	
					$kdrek5=$row['kd_rek5'];	
					$nmrek5=$row['nm_rek5'];	
					$nilai =$row['nilai'];	
	  			    
					$kdrek9=$this->tukd_model->get_nama($kdrek5,'map_lo','ms_rek5','kd_rek5');
					$nmrek9=$this->tukd_model->get_nama($kdrek9,'nm_rek5','ms_rek5','kd_rek5');
					$rek3=substr($kdrek5,0,3);
	  			    $rekutang=$this->tukd_model->get_nama($rek3,'kd_rek5','ms_rek5','map_lo');
					$nmrekutang=$this->tukd_model->get_nama($rekutang,'nm_rek5','ms_rek5','kd_rek5');

					if ($beban=='1'){
						if ($status=='1'){
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$rekutang','$nmrekutang',$nilai,'0','D','$beban','1','1') ");       			
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','2','1') ");		

						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek5','$nmrek5',$nilai,'0','D','$beban','3','1') ");       			
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','4','0') ");		
					    }else{
					   
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek9','$nmrek9',$nilai,'0','D','$beban','1','1') ");       			
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','2','1') ");		

						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','$kdgiat','$nmgiat','$kdrek5','$nmrek5',$nilai,'0','D','$beban','3','1') ");       			
						   $this->db->query("insert into trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
											 values('$no','','','1110301','Kas di Bendahara Pengeluaran','0','$nilai','K','','4','0') ");							   
					    }
					}

				}   
									 				
				
        }
         
        //$asg->free_result();
    }

     function simpan_penagihan_lpj(){
        $tabel    = $this->input->post('tabel');        
        $nomor    = $this->input->post('no');
        $tgl      = $this->input->post('tgl');
        $skpd     = $this->input->post('skpd');
        $nmskpd   = $this->input->post('nmskpd');       
        $beban    = $this->input->post('beban');
        $ket      = $this->input->post('ket');
        $status   = $this->input->post('status');
        $notagih  = $this->input->post('notagih');
        $tgltagih = $this->input->post('tgltagih');
        $total    = $this->input->post('total');      
        $csql     = $this->input->post('sql');            
        $usernm     = $this->session->userdata('pcNama');    
        $update     = date('y-m-d H:i:s');      
        $msg        = array();
        // Simpan Header //
        if ($tabel == 'trhtagih') {
            $sql = "delete from trhtagih where kd_skpd='$skpd' and no_bukti='$nomor'";
            $asg = $this->db->query($sql);

            $sql = "delete from trhju_pkd where kd_skpd='$skpd' and no_voucher='$nomor'";
            $asg = $this->db->query($sql);

			if ($asg){
                $sql = "insert into trhtagih(no_bukti,tgl_bukti,ket,username,tgl_update,kd_skpd,nm_skpd,total,no_tagih,sts_tagih,tgl_tagih,jns_spp) 
                        values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$notagih','$status','$tgltagih','$beban')";
                $asg = $this->db->query($sql);

				$asq3 = " insert into trhju_pkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
						  values('$nomor','$tgl','$ket','$usernm','$update','$skpd','$nmskpd','$total','$total','0')";
				$asg3 = $this->db->query($asq3);

				if (!($asg)){
                   $msg = array('pesan'=>'0');
                   echo json_encode($msg);
                    exit();
                } else {
                    $msg = array('pesan'=>'1');
                    echo json_encode($msg);
                }             
            } else {
                $msg = array('pesan'=>'0');
                echo json_encode($msg);
                exit();
            }
            
        } else if ($tabel == 'trdtagih') {
            
            // Simpan Detail //                       
                $sql = "delete from trdtagih where no_bukti='$nomor'";
                $asg = $this->db->query($sql);
                $sql = "delete from trdju_pkd where no_voucher='$nomor'";
                $asg = $this->db->query($sql);
                
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into trdtagih(no_bukti,no_sp2d,kd_kegiatan,nm_kegiatan,kd_rek5,kd_rek,nm_rek5,nilai)"; 
    
                    $asg = $this->db->query($sql.$csql);
                    if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }            
				
				$hasil=$this->db->query(" select * from trdtagih where no_bukti='$nomor' ");  	
				foreach ($hasil->result_array() as $row){
					$no	   =$row['no_bukti'];	
					$sp2d  =$row['no_sp2d'];	
					$kdgiat=$row['kd_kegiatan'];	
					$nmgiat=$row['nm_kegiatan'];	
					$kdrek5=$row['kd_rek'];	
					$nmrek5=$row['nm_rek5'];	
					$nilai =$row['nilai'];	
					
					$kdrek9=$this->tukd_model->get_nama($kdrek5,'map_lo','ms_rek5','kd_rek5');
					$nmrek9=$this->tukd_model->get_nama($kdrek9,'nm_rek5','ms_rek5','kd_rek5');
					
					$rek3=substr($kdrek5,0,3);	  			    
					$rekutang=$this->tukd_model->get_nama($rek3,'kd_rek5','ms_rek5','map_lo');
					$nmrekutang=$this->tukd_model->get_nama($rekutang,'nm_rek5','ms_rek5','kd_rek5');

					$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
									  values('$no','$kdgiat','$nmgiat','$kdrek9','$nmrek9',$nilai,'0','D','$jns','1','1') ");                   
					$this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
									  values('$no','$kdgiat','$nmgiat','$rekutang','$nmrekutang','0',$nilai,'K','$jns','2','1') ");  

				} 

        }
         
        //$asg->free_result();	
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);	
	}
    
    function hapus_lpj(){
        $nomor = $this->input->post('no');
        $msg = array();
        $sql = "delete from dlpj_ppkd where no_bukti='$nomor'";
        $asg = $this->db->query($sql);

		$sql = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg = $this->db->query($sql);

		if ($asg){
            $sql = "delete from hlpj_ppkd where no_bukti='$nomor'";
            $asg = $this->db->query($sql);

            $sql = "delete from trhju_pkd where no_voucher='$nomor'";
            $asg = $this->db->query($sql);

			
			if (!($asg)){
              $msg = array('pesan'=>'0');
              echo json_encode($msg);
               exit();
            } 
        } else {
            $msg = array('pesan'=>'0');
            echo json_encode($msg);
            exit();
        }
        $msg = array('pesan'=>'1');
        echo json_encode($msg);
    }
    
	
	
    function hapus_penagihan_lpj(){
        $nomor = $this->input->post('no');
        $msg = array();
        $sql = "delete from trdtagih where no_bukti='$nomor'";
        $asg = $this->db->query($sql);

        $sql = "delete from trdju_pkd where no_voucher='$nomor'";
        $asg = $this->db->query($sql);

		if ($asg){
            $sql = "delete from trhtagih where no_bukti='$nomor'";
            $asg = $this->db->query($sql);

            $sql = "delete from trhju_pkd where no_voucher='$nomor'";
            $asg = $this->db->query($sql);

			if (!($asg)){
              $msg = array('pesan'=>'0');
              echo json_encode($msg);
               exit();
            } 
        } else {
            $msg = array('pesan'=>'0');
            echo json_encode($msg);
            exit();
        }
        $msg = array('pesan'=>'1');
        echo json_encode($msg);
    }
    
    function load_lpj(){
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where=" and (upper(no_bukti) like upper('%$kriteria%') or tgl_bukti like '%$kriteria%' or upper(nm_skpd) like 
                    upper('%$kriteria%') or upper(ket) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as total from hlpj_ppkd where jns_spp in ('1','3') $where " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
       	$result["total"] = $total->total; 
        $query1->free_result();        
        
        $sql = "SELECT * from hlpj_ppkd where jns_spp in ('1','3') $where order by tgl_bukti,no_bukti,kd_skpd limit $offset,$rows";
        $query1 = $this->db->query($sql);  
        
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_bukti' => $resulte['no_bukti'],
                        'tgl_bukti' => $resulte['tgl_bukti'],
                        'ket' => $resulte['ket'],
                        'username' => $resulte['username'],    
                        'tgl_update' => $resulte['tgl_update'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
                        'total' => $resulte['total'],
                        'no_tagih' => $resulte['no_tagih'],
                        'sts_tagih' => $resulte['sts_tagih'],
                        'tgl_tagih' => $resulte['tgl_tagih'],                       
                        'jns_beban' => $resulte['jns_spp']                                                                                              
                        );
                        $ii++;
        }
       	$result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();
    }
	
	
	
    
    function load_penagihan_lpj(){
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_bukti) like upper('%$kriteria%') or tgl_bukti like '%$kriteria%' or upper(nm_skpd) like 
                    upper('%$kriteria%') or upper(ket) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as total from trhtagih  $where " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
       	$result["total"] = $total->total; 
        $query1->free_result();        
        
        $sql = "SELECT * from trhtagih   $where order by tgl_bukti,no_bukti,kd_skpd limit $offset,$rows";
        $query1 = $this->db->query($sql);  
        
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_bukti' => $resulte['no_bukti'],
                        'tgl_bukti' => $resulte['tgl_bukti'],
                        'ket' => $resulte['ket'],
                        'username' => $resulte['username'],    
                        'tgl_update' => $resulte['tgl_update'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
                        'total' => $resulte['total'],
                        'no_tagih' => $resulte['no_tagih'],
                        'sts_tagih' => $resulte['sts_tagih'],
                        'tgl_tagih' => $resulte['tgl_tagih'],                       
                        'jns_beban' => $resulte['jns_spp']                                                                                              
                        );
                        $ii++;
        }
       	$result["rows"] = $row; 
        echo json_encode($result);
        $query1->free_result();
    }
    
    function load_ambilsimpanan() {
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where    = '';
        
        if ($kriteria <> ''){                               
            $where="where ( upper(no_kas) like upper('%$kriteria%') )";            
        }
        
        $sql    = "SELECT * from tr_ambilsimpanan_ppkd $where order by no_kas";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id'          => $ii,        
                        'no_kas'      => $resulte['no_kas'],
                        //'tgl_kas'     => $this->tukd_model->rev_date($resulte['tgl_kas']),
                        'tgl_kas'     => $resulte['tgl_kas'],
                        'kd_skpd'     => $resulte['kd_skpd'],
                        'nilai'       => number_format($resulte['nilai']),
                        'bank'        => $resulte['bank'],
                        'nm_rekening' => $resulte['nm_rekening'],
                        'keterangan'  => $resulte['keterangan']    
                        );
                        $ii++;
        }
        echo json_encode($result);
	}
    
    function load_dlpj(){        
        $nomor = $this->input->post('no');    
        $sql = "SELECT b.*,
                (SELECT SUM(c.nilai) FROM dlpj_ppkd c LEFT JOIN hlpj_ppkd d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                d.kd_skpd=a.kd_skpd AND c.kd_rek5=b.kd_rek5 AND c.no_bukti <> a.no_bukti AND d.jns_spp = a.jns_spp ) AS lalu,
                (SELECT e.nilai FROM trhspp e INNER JOIN trdspp f ON e.no_spp=f.no_spp INNER JOIN trhspm g ON e.no_spp=g.no_spp INNER JOIN trhsp2d h ON g.no_spm=h.no_spm
                WHERE h.no_sp2d = b.no_sp2d AND f.kd_kegiatan=b.kd_kegiatan AND f.kd_rek5=b.kd_rek5) AS sp2d,
                (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek5) AS anggaran FROM trhtransout a INNER JOIN
                dlpj_ppkd b ON a.no_bukti=b.no_bukti WHERE a.no_bukti='$nomor' ORDER BY b.kd_kegiatan,b.kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id'            => $ii,        
                        'no_bukti'      => $resulte['no_bukti'],
                        'no_sp2d'       => $resulte['no_sp2d'],
                        'kd_kegiatan'   => $resulte['kd_kegiatan'],
                        'nm_kegiatan'   => $resulte['nm_kegiatan'],
                        'kd_rek5'       => $resulte['kd_rek5'],
                        'nm_rek5'       => $resulte['nm_rek5'],
                        'nilai'         => $resulte['nilai'],
                        'lalu'          => $resulte['lalu'],
                        'sp2d'          => $resulte['sp2d'],   
                        'anggaran'      => $resulte['anggaran']                                                                                                                                                          
                        );
                        $ii++;
        }           
        echo json_encode($result);
        $query1->free_result();
    }
    
	
	
	
    function load_dtagih_lpj(){        
        $nomor = $this->input->post('no');    
        $sql = "SELECT b.*,
                (SELECT SUM(c.nilai) FROM trdtagih c LEFT JOIN trhtagih d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                d.kd_skpd=a.kd_skpd AND c.kd_rek5=b.kd_rek AND c.no_bukti <> a.no_bukti AND d.jns_spp = a.jns_spp ) AS lalu,
                (SELECT e.nilai FROM trhspp e INNER JOIN trdspp f ON e.no_spp=f.no_spp INNER JOIN trhspm g ON e.no_spp=g.no_spp INNER JOIN trhsp2d h ON g.no_spm=h.no_spm
                WHERE h.no_sp2d = b.no_sp2d AND f.kd_kegiatan=b.kd_kegiatan AND f.kd_rek5=b.kd_rek5) AS sp2d,
                (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek) AS anggaran FROM trhtagih a INNER JOIN
                trdtagih b ON a.no_bukti=b.no_bukti WHERE a.no_bukti='$nomor' ORDER BY b.kd_kegiatan,b.kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id'            => $ii,        
                        'no_bukti'      => $resulte['no_bukti'],
                        'no_sp2d'       => $resulte['no_sp2d'],
                        'kd_kegiatan'   => $resulte['kd_kegiatan'],
                        'nm_kegiatan'   => $resulte['nm_kegiatan'],
                        'kd_rek5'       => $resulte['kd_rek5'],
                        'kd_rek'        => $resulte['kd_rek'],
                        'nm_rek5'       => $resulte['nm_rek5'],
                        'nilai'         => $resulte['nilai'],
                        'lalu'          => $resulte['lalu'],
                        'sp2d'          => $resulte['sp2d'],   
                        'anggaran'      => $resulte['anggaran']                                                                                                                                                          
                        );
                        $ii++;
        }           
        echo json_encode($result);
        $query1->free_result();
    }
    
    function load_sp2d_lpj(){
       //$beban='',$giat=''
       $beban   = $this->input->post('jenis');
       $giat    = $this->input->post('giat');
       $kode    = $this->input->post('kd');
       $bukti   = $this->input->post('bukti');
       $where = '';
       if ($beban=='1'){
        $sisa = "c.nilai + (SELECT IF(SUM(v.nilai) IS NULL,0,SUM(v.nilai)) FROM trhspp z INNER JOIN trhspm s ON z.no_spp=s.no_spp 
                INNER JOIN trhsp2d v ON s.no_spm=v.no_spm WHERE z.jns_spp='1' AND z.kd_skpd=c.kd_skpd )
                -(SELECT IF(SUM(nilai) IS NULL,0,SUM(nilai)) FROM dlpj_ppkd WHERE no_sp2d = c.no_sp2d and no_bukti <> '$bukti') AS sisa";
       }else{
        $sisa = "c.nilai -(SELECT IF(SUM(nilai) IS NULL,0,SUM(nilai)) FROM dlpj_ppkd WHERE no_sp2d = c.no_sp2d and no_bukti <> '$bukti') AS sisa";   
       }
       if (($beban != '' && $giat == '') || ($beban == '1')){
            $where = " and a.jns_spp='$beban'"; 
       }
       if ($giat !='' && $beban != '1'){
            $where = " and a.jns_spp='$beban' and d.kd_kegiatan='$giat'";
       }
        $kriteria = $this->input->post('q');
            $sql = "SELECT DISTINCT c.no_sp2d,c.tgl_sp2d,c.nilai,
                    $sisa                   
                    FROM trhspp a INNER JOIN trhspm b ON a.no_spp=b.no_spp
                    INNER JOIN trhsp2d c ON b.no_spm=c.no_spm
                    INNER JOIN trdspp d ON a.no_spp=d.no_spp
                    WHERE c.kd_skpd = '$kode' AND c.status = 1 $where ORDER BY c.no_sp2d,c.tgl_sp2d";
       //and UPPER(no_sp2d) LIKE '%$kriteria%'  
        $query1 = $this->db->query($sql);                  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {                               
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'nilai' => $resulte['nilai'],
                        'sisa' => $resulte['sisa']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();
    }
    
	
	    
     function load_trskpd_lpj() {        
        $jenis =$this->input->post('jenis');
        $giat =$this->input->post('giat');
        $cskpd = $this->input->post('kd');
        
        $jns_beban='';
        $cgiat = '';
        if ($jenis !=''){
            $jns_beban = "and a.jns_kegiatan='$jenis'";
        }
        if ($giat !=''){                               
            $cgiat = " and a.kd_kegiatan not in ($giat) ";
        }                
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,(select nm_program from m_prog where kd_program=a.kd_program) as nm_program,a.total FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                WHERE a.kd_skpd='$cskpd' $jns_beban $cgiat AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(b.nm_kegiatan) LIKE UPPER('%$lccr%'))";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'total'       => $resulte['total']        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}
    
     function load_trskpd_penagihan_lpj() {        
        
        $giat =$this->input->post('giat');
        $cskpd = $this->input->post('kd');
        $cgiat = '';
       
        if ($giat !=''){                               
            $cgiat = " and a.kd_kegiatan not in ($giat) ";
        }                
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,(select nm_program from m_prog where kd_program=a.kd_program) as nm_program,a.total FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                WHERE a.kd_skpd= '$cskpd'  $cgiat AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(b.nm_kegiatan) LIKE UPPER('%$lccr%'))";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'total'       => $resulte['total']        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}

    function load_rek_lpj() {                      
        $jenis  = $this->input->post('jenis');
        $giat   = $this->input->post('giat');  
        $kode   = $this->input->post('kd');
        $nomor  = $this->input->post('no');
        $sp2d   = $this->input->post('sp2d');
        $rek    = $this->input->post('rek');        
        $lccr   = $this->input->post('q');
            
        if ($rek !=''){        
            $notIn = " and kd_rek5 not in ($rek) " ;
        }else{
            $notIn  = "";
        }
        
        if ($jenis=='1'){
            $sql = "SELECT a.kd_rek5,a.nm_rek5,
                    (SELECT SUM(c.nilai) FROM dlpj_ppkd c LEFT JOIN hlpj_ppkd d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = a.kd_kegiatan AND 
                    d.kd_skpd=a.kd_skpd  AND c.kd_rek5=a.kd_rek5 AND c.no_bukti <> '$nomor' AND d.jns_spp = '$jenis') AS lalu,
                    0 AS sp2d,nilai AS anggaran  FROM trdrka a WHERE a.kd_kegiatan= '$giat' AND a.kd_skpd = '$kode' $notIn ";
                    
        } else {
            $sql = "SELECT b.kd_rek5,b.nm_rek5,
                    (SELECT SUM(c.nilai) FROM dlpj_ppkd c LEFT JOIN hlpj_ppkd d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                    d.kd_skpd=a.kd_skpd AND c.kd_rek5=b.kd_rek5 AND c.no_bukti <> '$nomor' AND d.jns_spp = '$jenis') AS lalu,
                    a.nilai AS sp2d,(SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek5) AS anggaran 
                    FROM trhspp a INNER JOIN trdspp b ON a.no_spp=b.no_spp INNER JOIN trhspm c ON b.no_spp=c.no_spp INNER JOIN trhsp2d d ON c.no_spm=d.no_Spm
                    WHERE d.no_sp2d = '$sp2d' and b.kd_kegiatan='$giat' $notIn ";
        }        
        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
                        'lalu' => $resulte['lalu'],
                        'sp2d' => $resulte['sp2d'],
                        'anggaran' => $resulte['anggaran']
                        );
                        $ii++;
        }                   
       echo json_encode($result);    
       $query1->free_result();       	   
	}
    
    function load_rek_penagihan_lpj() {                      
        $jenis  = $this->input->post('jenis');
        $giat   = $this->input->post('giat');  
        $kode   = $this->input->post('kd');
        $nomor  = $this->input->post('no');
        //$sp2d   = $this->input->post('sp2d');
        $rek    = $this->input->post('rek');        
        $lccr   = $this->input->post('q');
            
        if ($rek !=''){        
            $notIn = " and kd_rek5 not in ($rek) " ;
        }else{
            $notIn  = "";
        }
            $sql = "SELECT a.kd_rek5,a.nm_rek5,e.map_lo,
                    (SELECT SUM(c.nilai) FROM trdtagih c LEFT JOIN trhtagih d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = a.kd_kegiatan AND 
                    d.kd_skpd=a.kd_skpd  AND c.kd_rek=a.kd_rek5 AND c.no_bukti <> '$nomor' ) AS lalu,
                    0 AS sp2d,a.nilai AS anggaran  FROM trdrka a LEFT JOIN ms_rek5 e ON a.kd_rek5=e.kd_rek5  WHERE a.kd_kegiatan= '$giat' AND a.kd_skpd = '$kode' $notIn ";

        //echo $sql;
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['map_lo'],
                        'kd_rek' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],
                        'lalu' => $resulte['lalu'],
                        'sp2d' => $resulte['sp2d'],
                        'anggaran' => $resulte['anggaran']
                        );
                        $ii++;
        }                   
       echo json_encode($result);    
       $query1->free_result();       	   
	}
    
    function out_lalu_lpj(){
         $giat = $this->input->post('giat');
         $sp2d = $this->input->post('sp2d');
         $rek  = $this->input->post('rek');
         $nomor  = $this->input->post('nomor');
         $tgl  = $this->input->post('tgl');
         $skpd  = $this->input->post('skpd');
         $jenis  = $this->input->post('jenis');
         $sql = "SELECT b.no_bukti,b.no_sp2d,b.kd_kegiatan,b.nm_kegiatan,b.kd_rek5,b.nm_rek5,
                (SELECT SUM(c.nilai) FROM dlpj_ppkd c LEFT JOIN hlpj_ppkd d ON c.no_bukti=d.no_bukti WHERE c.kd_kegiatan = b.kd_kegiatan AND 
                d.kd_skpd=a.kd_skpd AND c.kd_kegiatan=b.kd_kegiatan AND c.kd_rek5=b.kd_rek5 AND c.no_bukti <> b.no_bukti AND d.tgl_bukti<=a.tgl_bukti AND d.jns_spp = a.jns_spp) AS lalu,
                (SELECT SUM(g.nilai) FROM trdspp g INNER JOIN trhspm h ON g.no_spp=h.no_spp INNER JOIN trhsp2d i ON h.no_spm=i.no_spm WHERE i.no_sp2d=b.no_sp2d) AS sp2d,
                (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = b.kd_kegiatan AND kd_skpd=a.kd_skpd AND kd_rek5=b.kd_rek5) AS anggaran FROM hlpj_ppkd a INNER JOIN dlpj_ppkd b ON a.no_bukti=b.no_bukti
                WHERE a.kd_skpd = '$skpd' AND b.kd_kegiatan = '$giat' AND b.kd_rek5 = '$rek' AND a.tgl_bukti <> '$tgl' AND 
                b.no_sp2d = '$sp2d' AND a.no_bukti = '$nomor'";                           
         $query1 = $this->db->query($sql);        
         $row = $query1->row();
         $result[] = array('lalu' =>$row->rp);
         //$result = $row->rp;
         echo json_encode($result);
         //echo $result;
         $query1->free_result();
    }
    
	
	//=============
    
      function cetak_register_sp2d_ppkd(){
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
        $kd = $this->uri->segment(3);
        if ($kd <> ''){
            $a ='SKPD :';
        $sqls="SELECT nm_skpd FROM ms_skpd where kd_skpd='$kd'";
                 $sqls =$this->db->query($sqls);
                 foreach ($sqls->result() as $row)
                {
                    $nama     = $row->nm_skpd;
                    
                   
                }
        }
        $cRet = '';
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"12\"><b> $kab</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"12\"><b>REGISTER SPP/SPM/SP2D</b></td>
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"12\"><b> BENDAHARA PENGELUARAN PPKD</b><br>&nbsp;</td>
        </tr>
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"3%\" rowspan=\"2\"><b>No.<br>Urut</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>Jenis Belanja</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"15%\" colspan=\"2\"><b>SPP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"15%\" colspan=\"2\"><b>SPM</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"15%\" colspan=\"2\"><b>SP2D</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"25%\" rowspan=\"2\"><b>Uraian</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>Jumlah <br>(Rp)</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"7%\" rowspan=\"2\"><b>Keterangan</b></td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>TGL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>No.</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>TGL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>No.</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>TGL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>No.</b></td>
           
        </tr>
         
          </thead>
          <tr>
            <td style=\"font-size:10px\" align=\"center\" width=\"3%\"><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"7%\"><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"5%\"><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"10%\"><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"5%\"><b>5</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"10%\"><b>6</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"5%\"><b>7</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"10%\"><b>8</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"25%\"><b>9</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"10%\"><b>10</b></td>
            <td style=\"font-size:10px\" align=\"center\" width=\"7%\"><b>11</b></td>
          </tr>";
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $this->uri->segment(3);
        $where ="";
        if ($kriteria <> ''){                               
            $where="where a.kd_skpd ='$kriteria' ";            
        }       
              
        $sql = "SELECT a.no_spm,a.tgl_spm,a.no_spp,a.tgl_spp,a.jns_spp,b.tgl_sp2d,b.no_sp2d,b.keperluan,
                b.nilai FROM TRHSPM a LEFT JOIN TRHSP2D b ON a.no_spm=b.no_spm $where ";
                $hasil = $this->db->query($sql);
                $lcno = 0;
                foreach ($hasil->result() as $row)
                {
                    $beban= $row->jns_spp;
                    $tgl_spp=$row->tgl_spp;
                    $spp= $row->no_spp;
                    $spm= $row->no_spm;
                    $tgl_spm=$row->tgl_spm;
                    $sp2d= $row->no_sp2d;
                    $tgl_sp2d=$row->tgl_sp2d;
                    $kkeperluan= $row->keperluan;
                    $n= $row->nilai;
                    $lcno = $lcno + 1;
                    switch ($beban) 
                    {
                        case '1': //UP
                            $jns='UP';
                            break;
                        case '2': //GU
                            $jns='GU';
                            break;
                        case '3': //TU
                            $jns='TU';
                            break;
                        case '4': //LS gaji
                           $jns='LS gaji';
                            break;
                        case '5': //LS PPKD
                            $jns='LS PPKD';
                            break;
                        case '6': //LS barang dan jasa
                            $jns='LS barang & jasa';
                            break;
                            
                    }
                    
                    $cRet .=  "<tr>
                                <td align=\"center\" width=\"3%\" style=\"font-size:12px\">$lcno</td>
                                <td align=\"center\" width=\"7%\" style=\"font-size:12px\">$jns</td>
                                <td align=\"center\" width=\"5%\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_spp)."</td>
                                <td align=\"left\" width=\"10%\" style=\"font-size:12px\">$spp</td>
                                <td align=\"center\" width=\"5%\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_spm)."</td>
                                <td align=\"left\" width=\"10%\" style=\"font-size:12px\">$spm</td>
                                <td align=\"center\" width=\"5%\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_sp2d)."</td>
                                <td align=\"left\" width=\"10%\" style=\"font-size:12px\">$sp2d</td>

                                <td align=\"left\" width=\"25%\" style=\"font-size:12px\">$kkeperluan</td>
                                <td align=\"right\" width=\"10%\" style=\"font-size:12px\">".number_format($n)."</td>
                                <td align=\"right\" width=\"7%\" style=\"font-size:12 px\"></td>
                              </tr>  "; 
                   
                }
                  
                  
        $cRet .="</table>";
        $data['prev']= $cRet;    
        $this->tukd_model->_mpdf('',$cRet,'2','10',5,'1');   
    }
    
     function cetak_kas_umum()
    {
        $thn_ang = $this->session->userdata('pcThang');
        $jnscetak = $this->uri->segment(3);
            $bulan =''; 
            $lcperiode = $this->tukd_model->getBulan($bulan);
           
         $tgl= $_REQUEST['tgl1'];
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
         
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'BUD' AND a.kd_skpd = '1.20.00.00' and nip='19611019 198412 1 002'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmBP = $trh2->nama;
         $lcNipBP = $trh2->nip;                         
            
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"7\" style=\"font-size:14px;border: solid 1px white;\"><b>PEMERINTAH KABUPATEN SANGGAU <br>LAPORAN BUKU KAS UMUM</b></td>
            </tr>
              <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">TANGGAL</td>
                <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\">: ".$this->tanggal_format_indonesia($tgl)."</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
            </tr>
            
            <tr>                
				<td align=\"center\" rowspan=\"2\" width=\"7%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\" >KASDA</td>
                <td align=\"center\" colspan=\"2\" width=\"30%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Transaksi</td>
                <td align=\"center\" rowspan=\"2\" width=\"7%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">SKPD</td>
                <td align=\"center\" rowspan=\"2\" width=\"36%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Uraian</td>
                <td align=\"center\" rowspan=\"2\" width=\"6%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Rek</td>
                <td align=\"center\" rowspan=\"2\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Penerimaan<br>(Rp)</td> 
                <td align=\"center\" rowspan=\"2\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Pengeluaran<br>(Rp)</td>             
            </tr> 
            <tr>
                <td align=\"center\"  width=\"12%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">SP2D</td>
                <td align=\"center\"  width=\"12%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">STS</td>
                       
            </tr>           
            <tr>
                <td align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">1</td>
                        <td align=\"center\" colspan=\"2\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">2</td>
				<td align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">3</td>  
                <td align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">4</td>        
                <td align=\"center\"  style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">5</td>
                <td align=\"center\"  style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">6</td>
                <td align=\"center\"  style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">7</td>               
            </tr>";
                      
                $csql= "select SUM(nilai) AS nilai FROM trhsp2d  WHERE  tgl_kas_bud < '$tgl' ";
                $hasil2 = $this->db->query($csql);
                $trhsp2d2 = $hasil2->row();          
                $lcsp2d_lalu = $trhsp2d2->nilai;
                
                /*$csqlkasin1= "select SUM(total) AS nilai FROM trhkasin_pkd  WHERE  tgl_sts < '$tgl' ";
                $hasil3 = $this->db->query($csqlkasin1);
                $trhkasinpkd = $hasil3->row();          
                $lckasinpkd = $trhkasinpkd->nilai;*/
                
                $csqlkasin2= "select SUM(total) AS nilai FROM trhkasin_ppkd  WHERE  tgl_sts < '$tgl' ";
                $hasil4 = $this->db->query($csqlkasin2);
                $trhkasinppkd = $hasil4->row();          
                $lckasinppkd = $trhkasinppkd->nilai;
                               
				$kasin_1= $lckasinppkd;
                $posisi_1= $kasin_1-$lcsp2d_lalu;                                            
                                                                                
				/* $sql = "SELECT * FROM
						   (SELECT a.no_kas_bud as kasda,a.no_sp2d AS nomor,a.tgl_kas_bud AS tgl,a.keperluan AS uraian,c.nilai AS nilai,'5' AS jns,a.kd_skpd,c.kd_rek5 FROM trhsp2d a
inner join trdspp c on c.no_spp = a.no_spp and a.kd_skpd = c.kd_skpd 
WHERE a.status='1' 
                            UNION
                            SELECT a.no_kas as kasda,a.no_sts AS nomor,a.tgl_sts AS tgl,a.keterangan AS uraian,c.rupiah AS nilai,'4' AS jns,a.kd_skpd,c.kd_rek5 FROM trhkasin_ppkd a
inner join trdkasin_ppkd c on c.no_sts = a.no_sts and c.kd_skpd = a.kd_skpd
                            ) z WHERE z.tgl='$tgl' ORDER BY z.tgl";*/
					
                    $sql = "SELECT '1' as kun,z.* FROM
						   (SELECT a.no_kas_bud as kasda,a.no_sp2d AS nomor,a.tgl_kas_bud AS tgl,a.keperluan AS uraian,'0' AS nilai,'5' AS jns,a.kd_skpd,'' as kd_rek5 FROM trhsp2d a
WHERE a.status='1' 
                            UNION
                            SELECT a.no_kas as kasda,a.no_sts AS nomor,a.tgl_sts AS tgl,a.keterangan AS uraian,'0' AS nilai,'4' AS jns,a.kd_skpd,'' as kd_rek5 FROM trhkasin_ppkd a
                            ) z WHERE z.tgl='$tgl' 
union all
SELECT '2' as kun,z.* FROM
						   (SELECT a.no_kas_bud as kasda,a.no_sp2d AS nomor,a.tgl_kas_bud AS tgl,a.keperluan AS uraian,c.nilai AS nilai,'5' AS jns,a.kd_skpd,c.kd_rek5 FROM trhsp2d a
inner join trdspp c on c.no_spp = a.no_spp and a.kd_skpd = c.kd_skpd 
WHERE a.status='1' 
                            UNION
                            SELECT a.no_kas as kasda,a.no_sts AS nomor,a.tgl_sts AS tgl,a.keterangan AS uraian,c.rupiah AS nilai,'4' AS jns,a.kd_skpd,c.kd_rek5 FROM trhkasin_ppkd a
inner join trdkasin_ppkd c on c.no_sts = a.no_sts and c.kd_skpd = a.kd_skpd
                            ) z WHERE z.tgl='$tgl' ORDER BY kasda,kun,tgl,kd_rek5";
                    
                    $hasil = $this->db->query($sql);       
                    $lcterima_ini=0;
                    $lckeluar_ini=0;
                    $no=0;
                    foreach ($hasil->result() as $row)
                    {
                       $no      =$no+1;
                       $kun   =$row->kun;
                       $nomor   =$row->nomor;
					   $kasda   =$row->kasda;
                       $tgl     =$row->tgl;
                       $uraian  =$row->uraian; 
                       $nilai   =$row->nilai;
                       $jns     =$row->jns;  
                       $kdrek   =$row->kd_rek5;      
                       $kdskpd   =$row->kd_skpd;   
                      
                                                                
                              
                                                                      	       
                       if ($jns==5){ 
                        
                        if($kun==1){
                             $cRet .="<tr>                                  
								  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$kasda</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$nomor</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$kdskpd</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$uraian</td>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  </tr>";                                                 
                        }else{
                             $cRet .="<tr>                                  
								  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$kdrek</td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($nilai)."</td>
                                  </tr>";                     
                       
                        }
                                                                    
                                $lckeluar_ini=$lckeluar_ini+$nilai;
                       }else{
                            
                            if($kun==1){
                                 $cRet .="<tr>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$kasda</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$nomor</td>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$kdskpd</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$uraian</td>
                                   <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>  
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  </tr>"; 
                            }else{
                                 $cRet .="<tr>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                   <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$kdrek</td>  
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($nilai)."</td>>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  </tr>"; 
                            }
                           
                                   $lcterima_ini=$lcterima_ini+$nilai;
                       }           
                    }
          
                    $posisi_ini=$lcterima_ini-$lckeluar_ini;
                    $posisi=$posisi_1+$posisi_ini;
                 

        $cRet .="<tr>
                    <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;border-top:solid 1px black;\">&nbsp;</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">Jumlah </td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_ini)."</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lckeluar_ini)."</td>
                </tr>";
       if ($posisi_ini<0){
                
                $cRet .="<tr>
                            <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">&nbsp;</td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">Perubahan Posisi Kas</td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($posisi_ini)."</td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\"></td>
                        </tr>";
        }else {
                 $cRet .="<tr>
                            <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">&nbsp;</td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">Perubahan Posisi Kas</td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\"></td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($posisi_ini)."</td>
                        </tr>";
        }       
        $cRet .="<tr>
                    <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\"> &nbsp;</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">Posisi Kas (H-1)</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($kasin_1)."</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcsp2d_lalu)."</td>
                </tr>
                        
                <tr>
                    <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">&nbsp;</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black; border-bottom:solid 1px black;\">Posisi Kas (H)</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black; border-bottom:solid 1px black;\">".number_format($posisi)."</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black; border-bottom:solid 1px black;\"></td>
                </tr>";
        
         $cRet .="
                 <tr>&nbsp;
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white; border-top:solid 1px black;\">&nbsp;</td>                                                                                                                                                                                
                </tr>
                 <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:15px;border: solid 1px white;\">Rekapitulasi Posisi kas di BUD (Rp)</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\"></td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\"></td>                                                                                                                                                                                
                </tr>";
                    
         $sqlsaldo = "SELECT nm_bank as nama,saldo as nilai from saldo_bank order by kd_bank";
                $saldo = $this->db->query($sqlsaldo);
                $totsaldo=0;
                foreach ($saldo->result() as $roww)
                {
                    $nmbank = $roww->nama;
                    $rp = $roww->nilai;
                
                    $cRet .="<tr>
                                <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Saldo di Bank $nmbank </td>
                                <td align=\"right\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\"> ".number_format($rp)."</td>
                                <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"></td>                                                                                                                                                                                
                            </tr>";
                    $totsaldo=$totsaldo+$rp;
               }
         $cRet .="<tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"><b>Total Saldo Kas</b></td>
                    <td align=\"right\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\"><b>".number_format($posisi)."</b></td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"></td>                                                                                                                                                                                
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Sanggau, tanggal ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Bendahara Umum Daerah</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
				<tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>                
                <tr>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px; border: solid 1px white;\"></td>                    
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px; border: solid 1px white;\"><b><u>$lcNmBP</u></b></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"> &nbsp;</td>
                    <td align=\"center\"  style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">NIP. $lcNipBP</td>
      
                </tr>";        
                                  
                
        $cRet .='</table>';
                 
                 $juduls = "Buku Kas Umum";
                 
         $data['prev']= $cRet;    
         if($jnscetak=="0"){
                echo $cRet;
         }else if($jnscetak=="1"){
                $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
         }else if($jnscetak=="2"){
         header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $juduls.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
         }
         //$this->tukd_model->_mpdf('',$cRet,'10','10',5,'0');
         //$this->tukd_model->_mpdf('', $cRet, 10, 10, 10, 'L');
     
    }
         
    function cetak_kas_harian()
    {
        $thn_ang = $this->session->userdata('pcThang');
        $jnscetak = $this->uri->segment(3);
            $bulan =''; 
            
            $lcperiode = $this->tukd_model->getBulan($bulan);
           
         $tgl= $_REQUEST['tgl1'];
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
         
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'BUD' AND a.kd_skpd = '1.20.00.00' and nip='19611019 198412 1 002'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmBP = $trh2->nama;
         $lcNipBP = $trh2->nip;                         
            
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"7\" style=\"font-size:14px;border: solid 1px white;\"><b>PEMERINTAH KABUPATEN SANGGAU <br>LAPORAN POSISI KAS HARIAN</b></td>
            </tr>
              <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">TANGGAL</td>
                <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\">: ".$this->tanggal_format_indonesia($tgl)."</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
            </tr>
            
            <tr>
                <td align=\"center\" rowspan=\"2\" width=\"4%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\" >No.</td>
				<td align=\"center\" rowspan=\"2\" width=\"7%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\" >KASDA</td>
                <td align=\"center\" colspan=\"3\" width=\"30%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Transaksi</td>
                <td align=\"center\" rowspan=\"2\" width=\"29%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Uraian</td>
                <td align=\"center\" rowspan=\"2\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Penerimaan<br>(Rp)</td> 
                <td align=\"center\" rowspan=\"2\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Pengeluaran<br>(Rp)</td>             
            </tr> 
            <tr>
                <td align=\"center\"  width=\"12%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\" >SP2D</td>
                <td align=\"center\"  width=\"12%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">STS</td>
                <td align=\"center\"  width=\"12%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">Lain - Lain</td>
                       
            </tr>           
            <tr>
                <td align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">1</td>
				<td align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">2</td>
                <td align=\"center\" colspan=\"3\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">3</td>
                <td align=\"center\"  style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">4</td>
                <td align=\"center\"  style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">5</td>
                <td align=\"center\"  style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">6</td>               
            </tr>";
                      
                $csql= "select SUM(nilai) AS nilai FROM trhsp2d  WHERE  tgl_kas_bud < '$tgl' ";
                $hasil2 = $this->db->query($csql);
                $trhsp2d2 = $hasil2->row();          
                $lcsp2d_lalu = $trhsp2d2->nilai;
                
                /*$csqlkasin1= "select SUM(total) AS nilai FROM trhkasin_pkd  WHERE  tgl_sts < '$tgl' ";
                $hasil3 = $this->db->query($csqlkasin1);
                $trhkasinpkd = $hasil3->row();          
                $lckasinpkd = $trhkasinpkd->nilai;*/
                
                $csqlkasin2= "select SUM(total) AS nilai FROM trhkasin_ppkd  WHERE  tgl_sts < '$tgl' ";
                $hasil4 = $this->db->query($csqlkasin2);
                $trhkasinppkd = $hasil4->row();          
                $lckasinppkd = $trhkasinppkd->nilai;
                
                //$kasin_1= $lckasinpkd+$lckasinppkd;
				$kasin_1= $lckasinppkd;
                $posisi_1= $kasin_1-$lcsp2d_lalu;                                            
                
                     /*$sql = "SELECT * FROM
						   (SELECT no_kas_bud as kasda,no_sp2d AS nomor,tgl_sp2d AS tgl,keperluan AS uraian,nilai AS nilai,'5' AS jns FROM trhsp2d WHERE STATUS='1'
                            UNION
                            SELECT '' as kasda,no_sts AS nomor,tgl_sts AS tgl,keterangan AS uraian,total AS nilai,'4' AS jns FROM trhkasin_pkd 
                            UNION
                            SELECT no_kas as kasda,no_sts AS nomor,tgl_sts AS tgl,keterangan AS uraian,total AS nilai,'4' AS jns FROM trhkasin_ppkd) z WHERE z.tgl='$tgl' ORDER BY z.tgl";
					 */
				 $sql = "SELECT * FROM
						   (SELECT no_kas_bud as kasda,no_sp2d AS nomor,tgl_kas_bud AS tgl,keperluan AS uraian,nilai AS nilai,'5' AS jns FROM trhsp2d WHERE STATUS='1'
                            UNION
                            SELECT no_kas as kasda,no_sts AS nomor,tgl_sts AS tgl,keterangan AS uraian,total AS nilai,'4' AS jns FROM trhkasin_ppkd) z WHERE z.tgl='$tgl' ORDER BY z.tgl";
					
                    $hasil = $this->db->query($sql);       
                    $lcterima_ini=0;
                    $lckeluar_ini=0;
                    $no=0;
                    foreach ($hasil->result() as $row)
                    {
                       $no      =$no+1;
                       $nomor   =$row->nomor;
					   $kasda   =$row->kasda;
                       $tgl     =$row->tgl;
                       $uraian  =$row->uraian; 
                       $nilai   =$row->nilai;
                       $jns     =$row->jns;                   
                       if ($jns==5){ 
                        $cRet .="<tr>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$no</td>
								  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$kasda</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$nomor</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$uraian</td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($nilai)."</td>
                                  </tr>";                     
                                                                    
                                $lckeluar_ini=$lckeluar_ini+$nilai;
                       }else{
                            $cRet .="<tr>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$no</td>
								  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:none;border-top:none\">$kasda</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$nomor</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:none;border-top:none\">$uraian</td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\">".number_format($nilai)."</td>>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:none;border-top:none\"></td>
                                  </tr>"; 
                                   $lcterima_ini=$lcterima_ini+$nilai;
                       }           
                    }
                    $posisi_ini=$lcterima_ini-$lckeluar_ini;
                    $posisi=$posisi_1+$posisi_ini;
                 

        $cRet .="<tr>
                    <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;border-top:solid 1px black;\">&nbsp;</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">Jumlah </td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcterima_ini)."</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lckeluar_ini)."</td>
                </tr>";
       if ($posisi_ini<0){
                
                $cRet .="<tr>
                            <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">&nbsp;</td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">Perubahan Posisi Kas</td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($posisi_ini)."</td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\"></td>
                        </tr>";
        }else {
                 $cRet .="<tr>
                            <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">&nbsp;</td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">Perubahan Posisi Kas</td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\"></td>
                            <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($posisi_ini)."</td>
                        </tr>";
        }       
        $cRet .="<tr>
                    <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\"> &nbsp;</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">Posisi Kas (H-1)</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($kasin_1)."</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black;\">".number_format($lcsp2d_lalu)."</td>
                </tr>
                        
                <tr>
                    <td align=\"left\" colspan=\"5\" style=\"font-size:12px;border: solid 1px white;border-right:solid 1px black;\">&nbsp;</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black; border-bottom:solid 1px black;\">Posisi Kas (H)</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black; border-bottom:solid 1px black;\">".number_format($posisi)."</td>
                    <td align=\"right\" style=\"font-size:12px;border: solid 1px black; border-bottom:solid 1px black;\"></td>
                </tr>";
        
         $cRet .="
                 <tr>&nbsp;
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white; border-top:solid 1px black;\">&nbsp;</td>                                                                                                                                                                                
                </tr>
                 <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:15px;border: solid 1px white;\">Rekapitulasi Posisi kas di BUD (Rp)</td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\"></td>
                    <td align=\"left\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\"></td>                                                                                                                                                                                
                </tr>";
                    
         $sqlsaldo = "SELECT nm_bank as nama,saldo as nilai from saldo_bank order by kd_bank";
                $saldo = $this->db->query($sqlsaldo);
                $totsaldo=0;
                foreach ($saldo->result() as $roww)
                {
                    $nmbank = $roww->nama;
                    $rp = $roww->nilai;
                
                    $cRet .="<tr>
                                <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Saldo di Bank $nmbank </td>
                                <td align=\"right\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\"> ".number_format($rp)."</td>
                                <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"></td>                                                                                                                                                                                
                            </tr>";
                    $totsaldo=$totsaldo+$rp;
               }
         $cRet .="<tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"><b>Total Saldo Kas</b></td>
                    <td align=\"right\" colspan=\"2\" style=\"font-size:15px;border: solid 1px white;\"><b>".number_format($posisi)."</b></td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"></td>                                                                                                                                                                                
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Sanggau, tanggal ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Bendahara Umum Daerah</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
				<tr>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>                
                <tr>
                    <td align=\"center\" colspan=\"5\" style=\"font-size:12px; border: solid 1px white;\"></td>                    
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px; border: solid 1px white;\"><b><u>$lcNmBP</u></b></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\"> &nbsp;</td>
                    <td align=\"center\"  style=\"font-size:12px;border: solid 1px white;\"></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">NIP. $lcNipBP</td>
      
                </tr>";        
                                  
                
        $cRet .='</table>';
                 
                 $juduls = "Kas Harian";
                 
         $data['prev']= $cRet;    
         if($jnscetak=="0"){
                echo $cRet;
         }else if($jnscetak=="1"){
                $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
         }else if($jnscetak=="2"){
         header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $juduls.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
         }
         //$this->tukd_model->_mpdf('',$cRet,'10','10',5,'0');
         //$this->tukd_model->_mpdf('', $cRet, 10, 10, 10, 'L');
     
    }
    
    function buku_tunai()
    {
        $data['page_title']= 'Buku Kas Tunai';
        $this->template->set('title', 'Buku Kas Tunai');   
        $this->template->load('template','tukd/transaksi/kas_tunai',$data) ; 
    }
    
    function cetak_kas_tunai()
    {
        $thn_ang = $this->session->userdata('pcThang');
        
            $bulan= $_REQUEST['tgl1'];
            
            $lcperiode = $this->tukd_model->getBulan($bulan);
           
       
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
           
         //$tgl= '2014-02-14';//$_REQUEST['tgl1'];
         
         //$tgl_ttd= '2014-02-14';//$_REQUEST['tgl_ttd'];
                  
       
         
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'BP' AND a.kd_skpd = '1.20.05.00'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmBP = $trh2->nama;
         $lcNipBP = $trh2->nip;                  

       
            
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"6\" style=\"font-size:14px;border: solid 1px white;\"><b>KABUPATEN MAHARDIKA<br>BUKU KAS TUNAI<br>BENDAHARA PENGELUARAN</b></td>
            </tr>
              <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            
           
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
            </tr>
            
            <tr>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\" >Tanggal.</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">No. BKU</td>
                <td align=\"center\" width=\"35%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Uraian</td>
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Penerimaan</td> 
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Pengeluaran</td>  
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Saldo</td>            
            </tr> ";
              $sql = "SELECT * FROM (SELECT tgl_kas AS tgl,no_kas AS bku,keterangan AS ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM tr_ambilsimpanan_ppkd
                        UNION
                        SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,total AS jumlah,'2' AS jns,kd_skpd AS kode FROM trhtransout_ppkd WHERE  pay = 'TUNAI' )a where month(a.tgl)<='$bulan' ORDER BY a.tgl";
    
               
               
                                           
                        $hasil = $this->db->query($sql);       
                        $saldo=0;
                        foreach ($hasil->result() as $row)
                        {
                           $bku   =$row->bku ;
                           $tgl     =$row->tgl;
                           $uraian  =$row->ket; 
                           $nilai   =$row->jumlah;
                           $jns     =$row->jns; 
                                             
                           if ($jns==1){ 
                           $saldo=$saldo+$nilai;
                            $cRet .="<tr>
                                      <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$tgl</td>
                                      <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$bku</td>
                                      <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$uraian</td>
                                      <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">".number_format($nilai)."</td>
                                      <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\"></td>
                                      <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">".number_format($saldo)."</td>
                                      </tr>";                     
                                                            
                           }else{
                                $saldo=$saldo-$nilai;
                                $cRet .="<tr>
                                      <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$tgl</td>
                                      <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$bku</td>
                                      <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$uraian</td>
                                      <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\"></td>
                                      <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">".number_format($nilai)."</td>
                                      <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">".number_format($saldo)."</td>
                                      </tr>"; 
                                       
                           }           
                        }  
              
         $cRet .="<tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Mengetahui:</td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">....................., tanggal ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Pengguna Anggaran</td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Bendahara Umum Daerah</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"><b><u>&nbsp;</u></b></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"><b><u>$lcNmBP</u></b></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"> NIP.</td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">NIP. $lcNipBP</td>
      
                </tr>";        
                                  
                
        $cRet .='</table>';
                 
         $data['prev']= $cRet;    
         //$this->tukd_model->_mpdf('',$cRet,'10','10',5,'0');
         //$this->tukd_model->_mpdf('', $cRet, 10, 10, 10, 'L');
         $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
    }
    
     function buku_bank()
    {
        $data['page_title']= 'Buku Simpanan Bank';
        $this->template->set('title', 'Buku Simpanan Bank');   
        $this->template->load('template','tukd/transaksi/kas_bank',$data) ; 
    }
    
    function cetak_simpanan_bank()
    {
        $thn_ang = $this->session->userdata('pcThang');
        
            $bulan= $_REQUEST['tgl1'];
            
            $lcperiode = $this->tukd_model->getBulan($bulan);
           
       
         
         $tgl_ttd= $_REQUEST['tgl_ttd'];
                  
       
         
         $csql="SELECT a.nama, a.nip FROM ms_ttd a WHERE kode = 'BP' AND a.kd_skpd = '1.20.05.00'";
         $hasil = $this->db->query($csql);
         $trh2 = $hasil->row();          
         $lcNmBP = $trh2->nama;
         $lcNipBP = $trh2->nip;                  

       
            
         $cRet = '';
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
            <tr>
                <td align=\"center\" colspan=\"6\" style=\"font-size:14px;border: solid 1px white;\"><b>KABUPATEN MAHARDIKA<br>BUKU PEMBANTU SIMPANAN BANK<br>BENDAHARA PENGELUARAN</b></td>
            </tr>
              <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">SKPD</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">: PPKD</td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;\">PERIODE</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;\">: $lcperiode</td>
            </tr>
            
           
            <tr>
                <td align=\"left\" colspan=\"2\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
                <td align=\"left\" colspan=\"4\" style=\"font-size:12px;border: solid 1px white;border-bottom:solid 2px black;\">&nbsp;</td>
            </tr>
            
            <tr>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\" >Tanggal.</td>
                <td align=\"center\" width=\"10%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">No. BKU</td>
                <td align=\"center\" width=\"35%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Uraian</td>
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Penerimaan</td> 
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Pengeluaran</td>  
                <td align=\"center\" width=\"15%\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black;\">Saldo</td>            
            </tr>  ";
            
             $sql = "SELECT * FROM (SELECT tgl_kas AS tgl,no_kas AS bku,no_sp2d AS ket,nilai AS jumlah,'1' AS jns,kd_skpd AS kode FROM trhsp2d where jns_spp in('1','2','3')
                    UNION
                    SELECT tgl_bukti AS tgl,no_bukti AS bku,ket AS ket,total AS jumlah,'2' AS jns,kd_skpd AS kode FROM trhtransout_ppkd WHERE pay <>'TUNAI' )a where month(a.tgl)<='$bulan' ORDER BY a.tgl";

           
           
                                       
                    $hasil = $this->db->query($sql);       
                    $saldo=0;
                    foreach ($hasil->result() as $row)
                    {
                       $bku   =$row->bku ;
                       $tgl     =$row->tgl;
                       $uraian  =$row->ket; 
                       $nilai   =$row->jumlah;
                       $jns     =$row->jns; 
                                         
                       if ($jns==1){ 
                       $saldo=$saldo+$nilai;
                        $cRet .="<tr>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$tgl</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$bku</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$uraian</td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">".number_format($nilai)."</td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\"></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">".number_format($saldo)."</td>
                                  </tr>";                     
                                                        
                       }else{
                            $saldo=$saldo-$nilai;
                            $cRet .="<tr>
                                  <td valign=\"top\" align=\"center\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$tgl</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$bku</td>
                                  <td valign=\"top\" align=\"left\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">$uraian</td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\"></td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">".number_format($nilai)."</td>
                                  <td valign=\"top\" align=\"right\" style=\"font-size:12px;border-bottom:solid 1px black;border-top:solid 1px black\">".number_format($saldo)."</td>
                                  </tr>"; 
                                   
                       }           
                    }
          
         $cRet .="<tr>
                    <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border-top:solid 1px black\">&nbsp;</td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Mengetahui:</td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">....................., tanggal ".$this->tanggal_format_indonesia($tgl_ttd)."</td>                                                                                                                                                                                
                </tr>
                <tr>                
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Pengguna Anggaran</td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">Bendahara Umum Daerah</td>                    
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">&nbsp;</td>
                    <td align=\"left\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"><b><u>&nbsp;</u></b></td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"><b><u>$lcNmBP</u></b></td>
                </tr>
                <tr>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\"> NIP.</td>
                    <td align=\"center\" colspan=\"3\" style=\"font-size:15px;border: solid 1px white;\">NIP. $lcNipBP</td>
      
                </tr>";        
                                  
                
        $cRet .='</table>';
                 
         $data['prev']= $cRet;    
         //$this->tukd_model->_mpdf('',$cRet,'10','10',5,'0');
         //$this->tukd_model->_mpdf('', $cRet, 10, 10, 10, 'L');
         $this->tukd_model->_mpdf('', $cRet, 10, 5, 10, '0');
    }
    
     function cari_ambilsimpanan() {
    
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where    = '';
        
        if ($kriteria <> ''){                               
            $where="where ( upper(no_kas) like upper('%$kriteria%') )";            
        }
        
        $sql    = "SELECT * from tr_ambilsimpanan_ppkd $where order by no_kas";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id'          => $ii,        
                        'no_kas'      => $resulte['no_kas'],
                        'tgl_kas'     => $this->tukd_model->rev_date($resulte['tgl_kas']),
                        'kd_skpd'     => $resulte['kd_skpd'],
                        'nilai'       => number_format($resulte['nilai']),
                        'bank'        => $resulte['bank'],
                        'nm_rekening' => $resulte['nm_rekening'],
                        'keterangan'  => $resulte['keterangan']    
                        );
                        $ii++;
        }
        echo json_encode($result);
	}
    
    function update_ambilsimpanan(){
        $query  = $this->input->post('st_query');
        $query1 = $this->input->post('st_query1');
        $asg    = $this->db->query($query);
        $asg1   = $this->db->query($query1);
    }
    
    function hapus_ambilsimpanan() {    	
		$no    = $this->input->post('no');
        $skpd  = $this->input->post('skpd');        
        $query = $this->db->query("delete from tr_ambilsimpanan_ppkd where no_kas='$no' and kd_skpd='$skpd' ");
        $query->free_result();
    }
    
    // tambahan  by tox
	function config_bank2(){
		$sql = "SELECT * from ms_bank order by kode";
        $query1 = $this->db->query($sql);
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_bank' => $resulte['kode'],
                        'nama_bank' => $resulte['nama']                                                                                        
                        );
                        $ii++;
        }
		echo json_encode($result);
    	$query1->free_result();   
	}
	
	
	
    function cek_lpj () { 
     	$nlpj = $this->input->post('nlpj');     
      	$sql = "select count(*)as jml from trlpj where no_lpj='$nlpj' ";    
    	$query1 = $this->db->query($sql);
            $config = $query1->row();        
            $result = array('jml' =>$config->jml);
    						
            echo json_encode($result);
            $query1->free_result(); 
	}
	
     function load_lpj_tu() {
		 $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
       $kriteria = '';
        $kriteria = $this->input->post('cari');
		$id  = $this->session->userdata('pcUser');        
        $where =" AND kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ";
        if ($kriteria <> ''){                               
            $where=" AND kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') and (upper(no_lpj) like upper('%$kriteria%') or tgl_lpj like '%$kriteria%' or kd_skpd like '%$kriteria%')";            
        }
        
        $sql = "SELECT count(*) as tot from trhlpj WHERE jenis='3' $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        $sql = " SELECT TOP $rows *,(SELECT a.nm_skpd FROM ms_skpd a where a.kd_skpd=b.kd_skpd) as nm_skpd FROM trhlpj b WHERE jenis = '3' $where 
		AND no_lpj NOT IN (SELECT TOP $offset no_lpj FROM trhlpj WHERE jenis='3' $where order by tgl_lpj, no_lpj)
		order by tgl_lpj, no_lpj";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte) { 
        $row[] = array(
			'id' => $ii,
						'kd_skpd'    => $resulte['kd_skpd'],      
						'nm_skpd'    => $resulte['nm_skpd'],                          
                        'ket'   => $resulte['keterangan'],
                        'no_lpj'   => $resulte['no_lpj'],
                        'no_sp2d'   => $resulte['no_sp2d'],
                        'tgl_lpj'      => $resulte['tgl_lpj'],
                        'status'      => $resulte['status']												
                        );
			$ii++;
        }
		 $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();
	}
	
	
	function cetaklpjtu_ag(){
		
		$cskpd 		=   $this->uri->segment(5);
		$cetak 		=   $this->uri->segment(6);
        $no_sp2d	= 	str_replace('abcdefghij','/',$this->uri->segment(3));
        $no_lpj		=	str_replace('abcdefghij','/',$this->uri->segment(8));
		$ttd1   	= 	str_replace('a',' ',$this->uri->segment(4));

          $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$cskpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
		$sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
       
		/*		
				
		$sql1="SELECT LEFT(kd_kegiatan,18) as kd_program,nm_program,kd_kegiatan,nm_kegiatan
			   FROM trhspp a INNER JOIN trhsp2d b ON a.no_spp = b.no_spp AND a.kd_skpd=b.kd_skpd WHERE no_sp2d = '$no_sp2d'";
		*/
		
		
		
				$sql1="SELECT LEFT(c.kd_kegiatan,18) as kd_program,nm_program,c.kd_kegiatan,c.nm_kegiatan
				FROM trhspp a INNER JOIN trhsp2d b ON a.no_spp = b.no_spp AND a.kd_skpd=b.kd_skpd 
				join trdspp c ON a.no_spp = c.no_spp AND a.kd_skpd=c.kd_skpd 
				WHERE no_sp2d = '$no_sp2d' group by nm_program,c.kd_kegiatan,
				c.nm_kegiatan,LEFT(c.kd_kegiatan,18) ";
				
		$sql2=$this->db->query($sql1);
                 foreach ($sql2->result() as $row)
                {
                    $kd_kegiatan     = $row->kd_kegiatan;
                    $nm_kegiatan     = $row->nm_kegiatan;
					$kd_program      = $row->kd_program;
                    $nm_program      = $row->nm_program;
                }	   
			   
			   
		$cRet  =" <table style=\"border-collapse:collapse;font-size:14px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td align='center' ><b>PEMERINTAH KABUPATEN SANGGAU</b></td>
					</tr>
					<tr>
						<td align='center'><b>LAPORAN PERTANGGUNG JAWABAN TAMBAHAN UANG (TU)</b></td>
					</tr>
					<tr>
						<td align='center'><b>BENDAHARA PENGELUARAN</b></td>
					</tr>
					<tr>
						<td align='center'>&nbsp;</td>
					</tr>
					</table>				
				";

		$cRet .=" <table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td valign='top' align='left' width='15%'> SKPD&nbsp;&nbsp;&nbsp;</td>
						<td valign='top' align='center' width='3%'>:&nbsp;&nbsp;&nbsp;</td>
						<td valign='top' align='left' > ".$cskpd.", ".$this->tukd_model->get_nama($cskpd,'nm_skpd','ms_skpd','kd_skpd')." </td>
					</tr>
					<tr>
						<td valign='top' align='left' width='15%'>Program&nbsp;&nbsp;&nbsp;</td>
						<td valign='top' align='center' width='3%'>:&nbsp;&nbsp;&nbsp;</td>
						<td valign='top' align='left' >".$kd_program.", ".$nm_program."</td>
					</tr>
					<tr>
						<td valign='top' align='left' width='15%'>Kegiatan&nbsp;&nbsp;&nbsp;</td>
						<td valign='top' align='center' width='3%'>:&nbsp;&nbsp;&nbsp;</td>
						<td valign='top' align='left' >".$kd_kegiatan.", ".$nm_kegiatan."</td>
					</tr>
					
					<tr>
						<td valign='top' align='left' width='15%'>No SP2D &nbsp;&nbsp;&nbsp;</td>
						<td valign='top' align='center' width='3%'>:&nbsp;&nbsp;&nbsp;</td>
						<td valign='top' align='left' >".$no_sp2d."</td>
					</tr>
					
					</table>
				<br/>					
				";		

		$cRet .=" <table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
					<thead>
					<tr>
						<td align='center' bgcolor='#CCCCCC' width='30%'>KODE REKENING</td>
						<td align='center' bgcolor='#CCCCCC' width='50%'>URAIAN</td>
						<td align='center' bgcolor='#CCCCCC' width='20%'>JUMLAH</td>
					</tr>
					</thead>
				";		


				$sql = "SELECT
						kd_rek5,nm_rek5,SUM(nilai) as nilai
						FROM
							trlpj c
						LEFT JOIN trhlpj d ON c.no_lpj = d.no_lpj AND c.kd_skpd=d.kd_skpd
						WHERE
						c.no_lpj = '$no_lpj' AND d.kd_skpd='$cskpd'
						GROUP BY kd_rek5,nm_rek5";
				$query1 = $this->db->query($sql);  	
				foreach($query1->result_array() as $resulte){ 
						$kd_rek5=$resulte["kd_rek5"];
						$nm_rek5=$resulte["nm_rek5"];
						$nilai=number_format($resulte["nilai"],"2",",",".");
						$cRet .="
									<tr>
										<td align='left' >$kd_rek5</td>
										<td align='left' >$nm_rek5</td>
										<td align='right' >$nilai</td>
									</tr>					
							";
						}
						
				$sql = "SELECT
						SUM(nilai) nilai
						FROM
							trlpj c
						LEFT JOIN trhlpj d ON c.no_lpj = d.no_lpj
						WHERE
						c.no_lpj = '$no_lpj'";		
				$query1 = $this->db->query($sql);  	
				foreach($query1->result_array() as $resulte){ 
						$total=$resulte["nilai"];
						}

				$sqlp = "SELECT SUM(a.nilai) AS nilai FROM trdspp a LEFT JOIN trhsp2d b ON b.no_spp=a.no_spp  
						 WHERE b.kd_skpd='$cskpd' AND b.jns_spp=3 AND  no_sp2d = '$no_sp2d' ";
				$queryp = $this->db->query($sqlp);  	
				foreach($queryp->result_array() as $nlx){ 
						$persediaan=$nlx["nilai"];
				}
				$cRet .="
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' >&nbsp;</td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Total</b></td>
							<td align='right' ><b>".number_format($total,"2",",",".")."</b></td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Tambahan Uang Persediaan Awal Periode</b></td>
							<td align='right' ><b>".number_format($persediaan,"2",",",".")."</b></td>
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' ><b>Tambahan Uang Persediaan Ahir Periode</b></td>
							<td align='right' ><b>".number_format($persediaan-$total,"2",",",".")."</b></td>
						</tr>
						</tr>
					    ";


				$cRet .="</table><p>";				

 		$cRet .=" <table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td valign='top' align='center' width='50%'>Mengetahui <br> $jabatan	</td>
						<td valign='top' align='center' width='50%'>$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br> Telah diverifikasi<br>Petugas</td>
					</tr>
					<tr>
						<td valign='top' align='center' width='50%'>&nbsp;</td>
						<td valign='top' align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td valign='top' align='center' width='50%'>&nbsp;</td>
						<td valign='top' align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td valign='top' align='center' width='50%'>&nbsp;</td>
						<td valign='top' align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td valign='top' align='center' width='50%'><b><u>$nama</u></b><br>$pangkat</td>
						<td valign='top' align='center' width='50%'>__________________</td>
					</tr>
					<tr>
						<td valign='top' align='center' width='50%'>$nip</td>
						<td valign='top' align='center' width='50%'></td>
					</tr>
				  </table>
				";	

        $data['prev']= $cRet;    
      if($cetak==0){
 
         $data['prev']= $cRet;    
		 echo ("<title>LPJ TU</title>");
		 echo $cRet;}
		 else{

	    $this->_mpdf('',$cRet,10,10,10,'0',0,'');
}
     } 
	 
	
	function load_lpj_up() {
		 $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
       $kriteria = '';
        $kriteria = $this->input->post('cari');
		$id  = $this->session->userdata('pcUser');        
        $where =" AND kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ";
        if ($kriteria <> ''){                               
            $where=" AND kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') and (upper(no_lpj) like upper('%$kriteria%') or tgl_lpj like '%$kriteria%' or kd_skpd like '%$kriteria%')";            
        }
        
        $sql = "SELECT count(*) as tot from trhlpj WHERE jenis='1' $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
		
        
        $sql = " SELECT TOP $rows *,(SELECT a.nm_skpd FROM ms_skpd a where a.kd_skpd=b.kd_skpd) as nm_skpd FROM trhlpj b WHERE jenis = '1' $where 
		AND no_lpj NOT IN (SELECT TOP $offset no_lpj FROM trhlpj WHERE jenis='1' $where order by tgl_lpj, no_lpj)
		order by tgl_lpj, no_lpj";
        $query1 = $this->db->query($sql);  
        $result = array(); 
        $ii = 0;
        foreach($query1->result_array() as $resulte) { 
        $row[] = array(
			'id' => $ii,
			'kd_skpd'    => $resulte['kd_skpd'],      
			'nm_skpd'    => $resulte['nm_skpd'],                          
			'ket'   => $resulte['keterangan'],
			'no_lpj'   => $resulte['no_lpj'],
			'no_sp2d'   => $resulte['no_sp2d'],
			'tgl_lpj'      => $resulte['tgl_lpj'],
			'tgl_sah_bud'      => $resulte['tgl_sah_bud'],
			'status'      => $resulte['status']												
			);
			$ii++;
        }
		 $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
       $query1->free_result();
		
	}
	
	function cetaklpjup_ag(){
		
		$cskpd  = $this->uri->segment(4);
        $ttd1   = str_replace('a',' ',$this->uri->segment(3));
        $ttd2   = str_replace('a',' ',$this->uri->segment(6));
		$ctk    =   $this->uri->segment(5);
        $nomor1 = str_replace('abcdefghij','/',$this->uri->segment(7));
        $nomor  = str_replace('123456789',' ',$nomor1);
		$jns    =   $this->uri->segment(8);
		$lctgl1 = $this->rka_model->get_nama2($nomor,'tgl_awal','trhlpj','no_lpj','kd_skpd',$cskpd);
		$lctgl2 = $this->rka_model->get_nama2($nomor,'tgl_akhir','trhlpj','no_lpj','kd_skpd',$cskpd);
		$lctglspp = $this->rka_model->get_nama2($nomor,'tgl_lpj','trhlpj','no_lpj','kd_skpd',$cskpd);

          
        $sqlsc = "SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$cskpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                 }
		$sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
        /* $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat FROM ms_ttd where kd_skpd='$cskpd' and kode='BK' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                } */
		$cRet  =" <table style=\"border-collapse:collapse;font-size:15px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
    					<tr>
    						<td align='center'> <b>$kab</b></td>
    					</tr>
    					<tr>
    						<td align='center'><b>LAPORAN PERTANGGUNGJAWABAN UANG PERSEDIAAN</b></td>
    					</tr>
						<tr>
    						<td align='center'></td>
    					</tr>
    					<tr>
    						<td align='center'></td>
    					</tr>
						<tr>
    						<td align='center'><b>&nbsp;</b></td>
    					</tr>
		          </table>				
				";

		$cRet .=" <table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
    					<tr>
    						<td align='left' width='10%'> NO LPJ&nbsp;&nbsp;&nbsp;</td>
    						<td align='center' width='5%'>:&nbsp;&nbsp;&nbsp;</td>
    						<td align='left' > ".$nomor."</td>
    					</tr>
						<tr>
    						<td align='left' width='10%'> SKPD&nbsp;&nbsp;&nbsp;</td>
    						<td align='center' width='5%'>:&nbsp;&nbsp;&nbsp;</td>
    						<td align='left' > ".$cskpd." ".$this->tukd_model->get_nama($cskpd,'nm_skpd','ms_skpd','kd_skpd')." </td>
    					</tr>
    					<tr>
    						<td align='left' width='10%'>PERIODE&nbsp;&nbsp;&nbsp;</td>
    						<td align='center' width='5%'>:&nbsp;&nbsp;&nbsp;</td>
    						<td align='left' >".$this->tukd_model->tanggal_format_indonesia($lctgl1).' s/d '.$this->tukd_model->tanggal_format_indonesia($lctgl2)."</td>
    					</tr>
		           </table>				
				";		

		$cRet .=" <table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
					<THEAD>
					<tr>
						<td bgcolor='#CCCCCC' align='center' width='5%'><b>NO</b></td>
						<td bgcolor='#CCCCCC' align='center' width='30%'><b>KODE REKENING</b></td>
						<td bgcolor='#CCCCCC' align='center' width='50%'><b>URAIAN</b></td>
						<td bgcolor='#CCCCCC' align='center' width='20%'><b>JUMLAH</b></td>
					</tr>
					<tr>
						<td bgcolor='#CCCCCC' align='center' width='5%'><b>1</b></td>
						<td bgcolor='#CCCCCC' align='center' width='30%'><b>2</b></td>
						<td bgcolor='#CCCCCC' align='center' width='50%'><b>3</b></td>
						<td bgcolor='#CCCCCC' align='center' width='20%'><b>4</b></td>
					</tr>
					</THEAD>
				";		
			
				if($jns=='0'){
				$sql = "SELECT 1 as urut, LEFT(a.kd_subkegiatan,21) as kode, b.nm_kegiatan as uraian, SUM(a.nilai) as nilai
						FROM trlpj a LEFT JOIN (SELECT DISTINCT kd_kegiatan,nm_kegiatan,kd_skpd FROM trskpd GROUP BY kd_kegiatan,nm_kegiatan,kd_skpd)b 
						ON LEFT(a.kd_kegiatan,21) =b.kd_kegiatan 
						WHERE a.no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						--AND no_bukti IN (SELECT no_bukti FROM trhtransout WHERE kd_skpd='$cskpd'
						--AND (panjar NOT IN ('3','5') or panjar IS NULL) AND jns_spp IN ('1','2','3'))
						GROUP BY LEFT(a.kd_subkegiatan,21), b.nm_kegiatan
						UNION ALL
						SELECT 2 as urut, a.kd_subkegiatan as kode, b.nm_subkegiatan as uraian, SUM(a.nilai) as nilai
						FROM trlpj a LEFT JOIN trskpd b ON a.kd_subkegiatan=b.kd_subkegiatan 
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						--AND no_bukti IN (SELECT no_bukti FROM trhtransout WHERE kd_skpd='$cskpd'
						--AND (panjar NOT IN ('3','5') or panjar IS NULL) AND jns_spp IN ('1','2','3'))
						GROUP BY a.kd_subkegiatan, b.nm_subkegiatan
						UNION ALL
						SELECT 3 as urut, kd_subkegiatan+'.'+LEFT(a.kd_rek5,2) as kode, b.nm_rek2 as uraian, SUM(nilai) as nilai FROM trlpj a
						INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						--AND no_bukti IN (SELECT no_bukti FROM trhtransout WHERE kd_skpd='$cskpd'
						--AND (panjar NOT IN ('3','5') or panjar IS NULL) AND jns_spp IN ('1','2','3'))
						GROUP BY kd_subkegiatan, LEFT(a.kd_rek5,2), b.nm_rek2
						UNION ALL
						SELECT 4 as urut, kd_subkegiatan+'.'+LEFT(a.kd_rek5,3) as kode, b.nm_rek3 as uraian, SUM(nilai) as nilai FROM trlpj a
						INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						--AND no_bukti IN (SELECT no_bukti FROM trhtransout WHERE kd_skpd='$cskpd'
						--AND (panjar NOT IN ('3','5') or panjar IS NULL) AND jns_spp IN ('1','2','3'))
						GROUP BY kd_subkegiatan, LEFT(a.kd_rek5,3), b.nm_rek3
						UNION ALL
						SELECT 5 as urut, kd_subkegiatan+'.'+LEFT(a.kd_rek5,5) as kode, b.nm_rek4 as uraian, SUM(nilai) as nilai FROM trlpj a
						INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						--AND no_bukti IN (SELECT no_bukti FROM trhtransout WHERE kd_skpd='$cskpd'
						--AND (panjar NOT IN ('3','5') or panjar IS NULL) AND jns_spp IN ('1','2','3'))
						GROUP BY kd_subkegiatan, LEFT(a.kd_rek5,5), b.nm_rek4
						UNION ALL
						SELECT 6 as urut, kd_subkegiatan+'.'+kd_rek5 as kode, nm_rek5 as uraian, SUM(nilai) as nilai FROM trlpj
						WHERE no_lpj='$nomor' AND kd_skpd='$cskpd'
						--AND no_bukti IN (SELECT no_bukti FROM trhtransout WHERE kd_skpd='$cskpd'
						--AND (panjar NOT IN ('3','5') or panjar IS NULL) AND jns_spp IN ('1','2','3'))
						GROUP BY kd_subkegiatan, kd_rek5, nm_rek5
						ORDER BY kode";		
				$query1 = $this->db->query($sql); 
				$total=0;
				$i=0;
				foreach ($query1->result() as $row) {
                    $kode=$row->kode;                    
                    $urut=$row->urut;                    
                    $uraian= $row->uraian;
                    $nilai  = $row->nilai;
					
					if ($urut==1){
					$i=$i+1;	
						$cRet .="<tr>
									<td valign='top' align='center' ><i><b>$i</b></i></td>
									<td valign='top' align='left' ><i><b>$kode</b></i></td>
									<td valign='top' align='left' ><i><b>$uraian</b></i></td>
									<td valign='top' align='right'><i><b>".number_format($nilai,"2",",",".")."</b></i></td>
								</tr>";
					} else if ($urut==2){
							$cRet .="<tr>
									<td valign='top' align='center' ><b></b></td>
									<td valign='top' align='left' ><b>$kode</b></td>
									<td valign='top' align='left' ><b>$uraian</b></td>
									<td valign='top' align='right'><b>".number_format($nilai,"2",",",".")."</b></td>
								</tr>";
					}else if ($urut==6){
							$total=$total+$nilai;
							$cRet .="<tr>
									<td valign='top' align='center' ></td>
									<td valign='top' align='left' >$kode</td>
									<td valign='top' align='left' >$uraian</td>
									<td valign='top' align='right'>".number_format($nilai,"2",",",".")."</td>
								</tr>";
					}
					else{
						$cRet .="<tr>
									<td valign='top' align='left' ></td>
									<td valign='top' align='left' >$kode</td>
									<td valign='top' align='left' >$uraian</td>
									<td valign='top' align='right' >".number_format($nilai,"2",",",".")."</td>
								</tr>";	
					}

				}
				} else{
				$sql = "SELECT 1 as urut, LEFT(a.kd_subkegiatan,21) as kode, b.nm_kegiatan as uraian, SUM(a.nilai) as nilai
						FROM trlpj a LEFT JOIN (SELECT DISTINCT kd_kegiatan,nm_kegiatan,kd_skpd FROM trskpd GROUP BY kd_kegiatan,nm_kegiatan,kd_skpd)b 
						ON LEFT(a.kd_subkegiatan,21) =b.kd_kegiatan 
						WHERE a.no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						--AND no_bukti IN (SELECT no_bukti FROM trhtransout WHERE kd_skpd='$cskpd'
						--AND (panjar NOT IN ('3','5') or panjar IS NULL) AND jns_spp IN ('1','2','3'))
						GROUP BY LEFT(a.kd_subkegiatan,21), b.nm_kegiatan
						UNION ALL
						SELECT 2 as urut, a.kd_subkegiatan as kode, b.nm_subkegiatan as uraian, SUM(a.nilai) as nilai
						FROM trlpj a LEFT JOIN trskpd b ON a.kd_subkegiatan=b.kd_subkegiatan 
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						--AND no_bukti IN (SELECT no_bukti FROM trhtransout WHERE kd_skpd='$cskpd'
						--AND (panjar NOT IN ('3','5') or panjar IS NULL) AND jns_spp IN ('1','2','3'))
						GROUP BY a.kd_subkegiatan, b.nm_subkegiatan
						ORDER BY kode";		
				$query1 = $this->db->query($sql); 
				$total=0;
				$i=0;
				foreach ($query1->result() as $row) {
                    $kode=$row->kode;                    
                    $urut=$row->urut;                    
                    $uraian= $row->uraian;
                    $nilai  = $row->nilai;
					
					if ($urut==1){
					$i=$i+1;	
						$cRet .="<tr>
									<td valign='top' align='center' ><b>$i</b></td>
									<td valign='top' align='left' ><b>$kode</b></td>
									<td valign='top' align='left' ><b>$uraian</b></td>
									<td valign='top' align='right'><b>".number_format($nilai,"2",",",".")."</b></td>
								</tr>";
					} else{
						$total=$total+$nilai;
						$cRet .="<tr>
									<td valign='top' align='left' ></td>
									<td valign='top' align='left' >$kode</td>
									<td valign='top' align='left' >$uraian</td>
									<td valign='top' align='right' >".number_format($nilai,"2",",",".")."</td>
								</tr>";	
					}

				}	
				}


				$sqlp = " SELECT SUM(a.nilai) AS nilai FROM trdspp a LEFT JOIN trhsp2d b ON b.no_spp=a.no_spp  
						  WHERE b.kd_skpd='$cskpd' AND (b.jns_spp=1)";
				$queryp = $this->db->query($sqlp);  	
				foreach($queryp->result_array() as $nlx){ 
						$persediaan=$nlx["nilai"];
				}

				$cRet .="
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' >&nbsp;</td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' ><b>Total</b></td>
							<td align='right' ><b>".number_format($total,"2",",",".")."</b></td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' ><b>Uang Persediaan Awal Periode</b></td>
							<td align='right' ><b>".number_format($persediaan,"2",",",".")."</b></td>
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' ><b>Uang Persediaan Ahir Periode</b></td>
							<td align='right' ><b>".number_format($persediaan-$total,"2",",",".")."</b></td>
						</tr>
						</tr>
					    ";


				$cRet .="</table><p>";				
//.$this->tukd_model->tanggal_format_indonesia($this->uri->segment(7)).
 		$cRet .=" <table width='100%' style='font-size:12px' border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td valign='top' align='center' width='50%'>Disetujui 	
						<br>$jabatan</td>
						<td valign='top' align='center' width='50%'>Sanggau, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
						<br>Telah diverifikasi
						<br>Petugas</td>
					</tr>
					<tr>
						<td align='center' width='50%'>&nbsp;</td>
						<td align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='50%'>&nbsp;</td>
						<td align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='50%'>&nbsp;</td>
						<td align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='50%'>&nbsp;</td>
						<td align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='50%'><b><u>$nama</u></b><br>$pangkat</td>
						<td align='center' width='50%'>___________________<br></td>
					</tr>
					<tr>
						<td align='center' width='50%'>$ttd1</td>
						<td align='center' width='50%'></td>
					</tr>
				  </table>
				";		

        $data['prev']= $cRet; 

		switch ($ctk)
        {
            case 0;
			   echo ("<title> LPJ UP</title>");
				echo $cRet;		
				break;
            case 1;
				$this->_mpdf_margin('',$cRet,10,10,10,'0',1,'',$atas,$bawah,$kiri,$kanan);
				//$this->_mpdf('',$cRet,10,10,10,'0',0,'');
               break;
		}
	}	
	
	
	function cetaklpjup_ag_rinci_(){
		
		$cskpd  = $this->uri->segment(4);
        $ttd1   = str_replace('a',' ',$this->uri->segment(3));
        $ttd2   = str_replace('a',' ',$this->uri->segment(6));
		$ctk =   $this->uri->segment(5);
        $nomor   = str_replace('abcdefghij','/',$this->uri->segment(7));
        $nomor   = str_replace('123456789',' ',$nomor);
		$kegiatan =   $this->uri->segment(8);
		$lctgl1 = $this->tukd_model->get_nama($nomor,'tgl_awal','trhlpj','no_lpj');
		$lctgl2 = $this->tukd_model->get_nama($nomor,'tgl_akhir','trhlpj','no_lpj');
		$lctglspp = $this->tukd_model->get_nama($nomor,'tgl_lpj','trhlpj','no_lpj');

          
        $sqlsc = "SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient WHERE kd_skpd='$cskpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                 }
		$sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
        /* $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat FROM ms_ttd where kd_skpd='$cskpd' and kode='BK' and nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip1=$rowttd->nip;                    
                    $nama1= $rowttd->nm;
                    $jabatan1  = $rowttd->jab;
                    $pangkat1  = $rowttd->pangkat;
                } */
		$cRet  =" <table style=\"border-collapse:collapse;font-size:15px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
    					<tr>
    						<td align='center'> <b>$kab</b></td>
    					</tr>
    					<tr>
    						<td align='center'><b>LAPORAN PERTANGGUNG JAWABAN UANG PERSEDIAAN</b></td>
    					</tr>
    					<tr>
    						<td align='center'></td>
    					</tr>
						<tr>
    						<td align='center'><b>&nbsp;</b></td>
    					</tr>
		          </table>				
				";

		$cRet .=" <table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
    					<tr>
    						<td align='left' width='10%'>SKPD&nbsp;&nbsp;&nbsp;</td>
    						<td align='center' width='5%'>:&nbsp;&nbsp;&nbsp;</td>
    						<td align='left' > ".$cskpd." ".$this->tukd_model->get_nama($cskpd,'nm_skpd','ms_skpd','kd_skpd')." </td>
    					</tr>
    					<tr>
    						<td align='left' width='10%'>PERIODE&nbsp;&nbsp;&nbsp;</td>
    						<td align='center' width='5%'>:&nbsp;&nbsp;&nbsp;</td>
    						<td align='left' >".$this->tukd_model->tanggal_format_indonesia($lctgl1).' s/d '.$this->tukd_model->tanggal_format_indonesia($lctgl2)."</td>
    					</tr>
						<tr>
    						<td align='left' width='10%'>Kegiatan&nbsp;&nbsp;&nbsp;</td>
    						<td align='center' width='5%'>:&nbsp;&nbsp;&nbsp;</td>
    						<td align='left' >$kegiatan - ".$this->tukd_model->get_nama($kegiatan,'nm_kegiatan','trskpd','kd_kegiatan')."</td>
    					</tr>
						<tr>
    						<td align='left' width='10%'>&nbsp;&nbsp;&nbsp;</td>
    						<td align='center' width='5%'>&nbsp;&nbsp;&nbsp;</td>
    						<td align='left' ></td>
    					</tr>
		           </table>				
				";		

		$cRet .=" <table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
					<THEAD>
					<tr>
						<td bgcolor='#CCCCCC' align='center' width='5%'><b>NO</b></td>
						<td bgcolor='#CCCCCC' align='center' width='20%'><b>KODE REKENING</b></td>
						<td bgcolor='#CCCCCC' align='center' width='60%'><b>URAIAN</b></td>
						<td bgcolor='#CCCCCC' align='center' width='20%'><b>JUMLAH</b></td>
					</tr>
					<tr>
						<td bgcolor='#CCCCCC' align='center' width='5%'><b>1</b></td>
						<td bgcolor='#CCCCCC' align='center' width='20%'><b>2</b></td>
						<td bgcolor='#CCCCCC' align='center' width='60%'><b>3</b></td>
						<td bgcolor='#CCCCCC' align='center' width='20%'><b>4</b></td>
					</tr>
					</THEAD>
				";		
			
				
				$sql = "SELECT 1 as urut, a.kd_kegiatan as kode, a.kd_kegiatan as rek, b.nm_kegiatan as uraian, SUM(a.nilai) as nilai
						FROM trlpj a LEFT JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan AND a.kd_skpd=b.kd_skpd
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND a.kd_kegiatan='$kegiatan'
						GROUP BY a.kd_kegiatan, b.nm_kegiatan
						UNION ALL
						SELECT 2 as urut, kd_kegiatan+'.'+LEFT(a.kd_rek5,2) as kode, LEFT(a.kd_rek5,2) as rek,  nm_rek2 as uraian, SUM(nilai) as nilai FROM trlpj a
						INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND a.kd_kegiatan='$kegiatan'
						GROUP BY kd_kegiatan, LEFT(a.kd_rek5,2), nm_rek2
						UNION ALL
						SELECT 2 as urut, kd_kegiatan+'.'+LEFT(a.kd_rek5,3) as kode, LEFT(a.kd_rek5,3) as rek,  nm_rek3 as uraian, SUM(nilai) as nilai FROM trlpj a
						INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND a.kd_kegiatan='$kegiatan'
						GROUP BY kd_kegiatan, LEFT(a.kd_rek5,3), nm_rek3
						UNION ALL
						SELECT 2 as urut, kd_kegiatan+'.'+LEFT(a.kd_rek5,5) as kode, LEFT(a.kd_rek5,5) as rek,  nm_rek4 as uraian, SUM(nilai) as nilai FROM trlpj a
						INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4
						WHERE no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND a.kd_kegiatan='$kegiatan'
						GROUP BY kd_kegiatan, LEFT(a.kd_rek5,5), nm_rek4
						UNION ALL
						SELECT 2 as urut, kd_kegiatan+'.'+kd_rek5 as kode, kd_rek5 as rek,  nm_rek5 as uraian, SUM(nilai) as nilai FROM trlpj
						WHERE no_lpj='$nomor' AND kd_skpd='$cskpd'
						AND kd_kegiatan='$kegiatan'
						GROUP BY kd_kegiatan, kd_rek5, nm_rek5
						UNION ALL
						SELECT 3 as urut, a.kd_kegiatan+'.'+a.kd_rek5+'.1' as kode,'' as rek, c.ket+' \\ No BKU: '+a.no_bukti as uraian, a.nilai as nilai
						FROM trlpj a 
						INNER JOIN trhlpj b ON a.no_lpj=b.no_lpj AND a.kd_skpd=b.kd_skpd
						LEFT JOIN trhtransout c ON a.no_bukti=c.no_bukti AND a.kd_skpd=c.kd_skpd
						WHERE a.no_lpj='$nomor' AND a.kd_skpd='$cskpd'
						AND a.kd_kegiatan='$kegiatan'
						GROUP BY a.kd_kegiatan, a.kd_rek5, nm_rek5,a.nilai,a.no_bukti, ket
						ORDER BY kode";		
				$query1 = $this->db->query($sql); 
				$total=0;
				$i=0;
				foreach ($query1->result() as $row) {
                    $kode=$row->kode;                    
                    $rek=$row->rek;                    
                    $urut=$row->urut;                    
                    $uraian= $row->uraian;
                    $nilai  = $row->nilai;
					
					if ($urut==1){
					$i=$i+1;	
						$cRet .="<tr>
									<td valign='top' align='center' ><i><b>$i</b></i></td>
									<td valign='top' align='left' ><i><b>$kode</b></i></td>
									<td valign='top' align='left' ><i><b>$uraian</b></i></td>
									<td valign='top' align='right'><i><b>".number_format($nilai,"2",",",".")."</b></i></td>
								</tr>";
					} else if ($urut==2){
							$cRet .="<tr>
									<td valign='top' align='center' ><b></b></td>
									<td valign='top' align='left' ><b>$kode</b></td>
									<td valign='top' align='left' ><b>$uraian</b></td>
									<td valign='top' align='right'><b>".number_format($nilai,"2",",",".")."</b></td>
								</tr>";
					}else{
						$total=$total+$nilai;
						$cRet .="<tr>
									<td valign='top' align='left' ></td>
									<td valign='top' align='left' >$rek</td>
									<td valign='top' align='left' >$uraian</td>
									<td valign='top' align='right' >".number_format($nilai,"2",",",".")."</td>
								</tr>";	
					}

				}
				

				$cRet .="
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' >&nbsp;</td>
						</tr>					
						<tr>
							<td align='left' >&nbsp;</td>
							<td align='left' >&nbsp;</td>
							<td align='right' ><b>Total</b></td>
							<td align='right' ><b>".number_format($total,"2",",",".")."</b></td>
						</tr>					
						
					    ";


				$cRet .="</table><p>";				
//.$this->tukd_model->tanggal_format_indonesia($this->uri->segment(7)).
 		$cRet .=" <table width='100%' style='font-size:12px' border=\"0\" cellspacing=\"1\" cellpadding=\"1\">
					<tr>
						<td valign='top' align='center' width='50%'>Disetujui 	
						<br>Bendahara Umum Daerah</td>
						<td valign='top' align='center' width='50%'>Sanggau, &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
						<br>Telah diverifikasi
						<br>Petugas</td>
					</tr>
					<tr>
						<td align='center' width='50%'>&nbsp;</td>
						<td align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='50%'>&nbsp;</td>
						<td align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='50%'>&nbsp;</td>
						<td align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='50%'>&nbsp;</td>
						<td align='center' width='50%'>&nbsp;</td>
					</tr>
					<tr>
						<td align='center' width='50%'><b><u>$nama</u></b><br>$pangkat</td>
						<td align='center' width='50%'>___________________<br></td>
					</tr>
					<tr>
						<td align='center' width='50%'>$ttd1</td>
						<td align='center' width='50%'></td>
					</tr>
				  </table>
				";		

        $data['prev']= $cRet; 

		switch ($ctk)
        {
            case 0;
			   echo ("<title> LPJ UP</title>");
				echo $cRet;		
				break;
            case 1;
				$this->_mpdf('',$cRet,10,10,10,'0',0,'');
               break;
		}
	}
	
	
	
	function load_giat_lpj(){
        $kode     = $this->session->userdata('kdskpd');
		$nomor = $this->input->post('lpj');
        $query1 = $this->db->query("
		select a.kd_subkegiatan, c.nm_subkegiatan
		from trlpj a 
		INNER JOIN trhlpj b ON a.no_lpj=b.no_lpj AND a.kd_skpd=b.kd_skpd
		LEFT JOIN trskpd c ON a.kd_subkegiatan=c.kd_subkegiatan
		WHERE a.no_lpj = '$nomor' AND a.kd_skpd='$kode'
		GROUP BY a.kd_subkegiatan,c.nm_subkegiatan
		ORDER BY a.kd_subkegiatan");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_subkegiatan' => $resulte['kd_subkegiatan'],                       
                        'nm_subkegiatan' => $resulte['nm_subkegiatan']                      
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);
           $query1->free_result();	
	}
	
	
	function select_data1_lpj_ag($lpj='') {

    $lpj = $this->input->post('lpj');
    $kdskpd = $this->input->post('kdskpd');
   
   
        $sql = "SELECT a.kd_skpd, a.no_bukti, a.no_lpj,a.kd_kegiatan,a.kd_rek5,a.nm_rek5, a.nilai FROM trlpj a WHERE no_lpj='$lpj' AND kd_skpd='$kdskpd'
		order by no_bukti";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'idx'        => $ii, 						
                        'no_bukti' => $resulte['no_bukti'],     
                        'kdkegiatan' => $resulte['kd_kegiatan'],     
                        'kdrek5'     => $resulte['kd_rek5'],  
                        'nmrek5'     => $resulte['nm_rek5'], 						 
                        'nilai1'      => number_format($resulte['nilai'])

                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
	
	
		function setuju_lpj() {
    $lpj = $this->input->post('no_lpj');
    $tgl_sah = $this->input->post('tgl_sah');
    $kdskpd = $this->input->post('kd_skpd');
	$sql = "UPDATE trhlpj SET status='2',tgl_sah_bud='$tgl_sah' WHERE no_lpj='$lpj' AND kd_skpd='$kdskpd'";
	$asg = $this->db->query($sql);  
	if ($asg > 0){  	
                    echo '2';
                    exit();
               } else {
                    echo '0';
                    exit();
               }
	}	
	
	
	function setuju_lpj_tu() {
    $lpj = $this->input->post('no_lpj');
    $kdskpd = $this->input->post('kd_skpd');
	$sql = "UPDATE trhlpj SET status='1' WHERE no_lpj='$lpj' AND kd_skpd='$kdskpd'";
	$asg = $this->db->query($sql);  
	if ($asg > 0){  	
                    echo '2';
                    exit();
               } else {
                    echo '0';
                    exit();
               }
	}
	
	function batal_lpj() {
    $lpj = $this->input->post('no_lpj');
    $kdskpd = $this->input->post('kd_skpd');
	$sql = "UPDATE trhlpj SET status='0' WHERE no_lpj='$lpj' AND kd_skpd='$kdskpd'";
	$asg = $this->db->query($sql);  
	if ($asg > 0){  	
                    echo '1';
                    exit();
               } else {
                    echo '0';
                    exit();
               }
	}
	
	function ambil_nilai_anggaran() {
	// created by TOX
    $kegi = $this->input->post('kegi');
    $rek = $this->input->post('rek');   
   
        $sql = "SELECT nilai,nilai_ubah FROM trdrka WHERE kd_kegiatan='$kegi' and kd_rek5='$rek'";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'idx'       => $ii, 					
                        'nilai_ssn' => number_format($resulte['nilai']), 						 
                        'nilai_ubh' => number_format($resulte['nilai_ubah'])
                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
	
	function ambil_nilai_sp2d_tu() {
	// created by TOX
    $sp2d = $this->input->post('sp2d');
	
    $kegi = $this->input->post('kegi');
    $rek = $this->input->post('rek');   
   
        $sql = "select d.nilai from trhsp2d a inner join trhspm b on a.no_spm=b.no_spm 
					inner join trhspp c on b.no_spp =c.no_spp inner join trdspp d on c.no_spp=d.no_spp 
					where a.no_sp2d='$sp2d' and d.kd_kegiatan='$kegi' and d.kd_rek5='$rek' ";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
                       $result[] = array(
                        'idx'        => $ii, 					 						 
                        'nilai_sp2d' => number_format($resulte['nilai'])
                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
	
		 function simpan_hlpj_tu(){
		$kdskpd  =$this->input->post('kode');
		$nlpj = $this->input->post('nlpj');
		
		$nsp2d = $this->input->post('sp2d');
		$ntgllpj = $this->input->post('tgllpj');
		
		$cket = $this->input->post('ket');
		
    	$csql = "INSERT INTO trhlpj (no_lpj,kd_skpd,keterangan,tgl_lpj,status,jenis,no_sp2d) values ('$nlpj','$kdskpd','$cket','$ntgllpj','0','3','$nsp2d')";
    	$query1 = $this->db->query($csql);
    					
                if($query1){
                    echo '2';
                }else{
                    echo '0';
                }
            }
	
	
	   function update_lpj(){
		$nlpj = $this->input->post('nlpj');
		$ntgllpj = $this->input->post('tgllpj');
		$cket = $this->input->post('ket');
		$kdskpd  = $this->input->post('kode');
		$xnnmrek = $this->input->post('cnnmrek');
		$xnnilai = $this->input->post('cnnilai');

		$xnkdgiat = $this->input->post('cnkdgiat'); 
		$xnkdrek = $this->input->post('cnkdrek');

		$cwaktu = date("Y-m-d H:i:s");		
		$user =  $this->session->userdata('pcNama');  	
		$kdkegiatan = $this->left($xnkdgiat,21);



		

        $csql = "delete from trlpj where no_lpj= '$nlpj' and no_bukti= '$nbukti' ";
    	$query1 = $this->db->query($csql);
    
    
	
    	$csql = "INSERT INTO trlpj (no_lpj,no_bukti,tgl_lpj,keterangan,kd_rek5,username,tgl_update,nm_rek5,nilai,kd_skpd,kd_kegiatan) values ('$nlpj','','$ntgllpj','$cket','$xnkdrek','$user','$cwaktu','$xnnmrek','$xnnilai','$kdskpd','$xnkdgiat')";
    	
    	$query1 = $this->db->query($csql);
	
		
		
        if ( $query1 > 0 ){
           echo '2';
        } else {
           echo '0';
        }
    
    }
		
		function update_hlpj(){
		$kdskpd  = $this->session->userdata('kdskpd');	
		$nlpj = $this->input->post('nlpj');
		$nlpj_hide = $this->input->post('nlpj_hide');
		$nsp2d = $this->input->post('sp2d');
		$ntgllpj = $this->input->post('tgllpj');
		$cket = $this->input->post('ket');
		
         $csql = "delete from trhlpj where no_lpj= '$nlpj' ";
    	$query1 = $this->db->query($csql);
	
    	$csql = "update trhlpj set no_lpj='$nlpj',kd_skpd='$kdskpd',keterangan='$cket',tgl_lpj='$ntgllpj',status='0',no_sp2d='$nsp2d' where no_lpj='$nlpj_hide'";
    	$query1 = $this->db->query($csql);
    					
                if($query1){
                    echo '2';
                }else{
                    echo '0';
                }
            }	
			
	  function simpan_lpj_tu(){
	  
		$kdskpd  = $this->input->post('kode');
		$nlpj = $this->input->post('nlpj');
		$ntgllpj = $this->input->post('tgllpj');
		$cket = $this->input->post('ket');
		
		$xnkdgiat = $this->input->post('cnkdgiat');
		$xnkdrek = $this->input->post('cnkdrek');
		$xnnmrek = $this->input->post('cnnmrek');
		$xnnilai = $this->input->post('cnnilai');
		
		$cwaktu = date("Y-m-d H:i:s");		
		$user =  $this->session->userdata('pcNama');  		
        
    	$csql = "INSERT INTO trlpj (no_lpj,no_bukti,tgl_lpj,keterangan,kd_rek5,username,tgl_update,nm_rek5,nilai,kd_skpd,kd_kegiatan) values ('$nlpj','','$ntgllpj','$cket','$xnkdrek','$user','$cwaktu','$xnnmrek','$xnnilai','$kdskpd','$xnkdgiat')";
    	$query1 = $this->db->query($csql);
    					
                if($query1){
                    echo '2';
                }else{
                    echo '0';
                }
            }
		
	  function dsimpan_lpj()
	{
	       $no_lpj      = $this->input->post('cnolpj');
           $vno_bukti   = $this->input->post('cnobukti');
                        
           $sql = "delete from trlpj where no_lpj='$no_lpj' and no_bukti='$vno_bukti' ";
           $asg = $this->db->query($sql);

           echo '1';
	}
		
  function hhapuslpj() {    	
		$nomor = $this->input->post('no');        
        $query = $this->db->query("delete from trlpj where no_lpj='$nomor'");
        $query = $this->db->query("delete from trhlpj where no_lpj='$nomor'");
         $query->free_result();
    }
    
	
    function sp2d_tu_list() {

        $skpd  = $this->input->post('kode');
        $v_ats_beban  = $this->input->post('v_ats_beban');
        $sql   = " select no_sp2d, tgl_sp2d from trhsp2d where kd_skpd='$skpd' and jns_spp='$v_ats_beban'";
       // $sql   = " select no_spd, tgl_spd from trhspd ";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],  
                        'tgl_sp2d' => $resulte['tgl_sp2d']  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	
		
	function load_transaksi_sp2d_tu() {
    
        $kdskpd = $this->input->post('kode');
        $sp2d = $this->input->post('sp2d');

        $sql    = "select d.kd_kegiatan,f.nm_kegiatan,d.kd_rek5,d.nm_rek5,d.nilai from trhsp2d a inner join trhspm b on a.no_spm=b.no_spm 
					inner join trhspp c on b.no_spp =c.no_spp inner join trdspp d on c.no_spp=d.no_spp inner join ms_rek5 e on d.kd_rek5=e.kd_rek5
					inner join m_giat f on d.kd_kegiatan=f.kd_kegiatan where a.no_sp2d='$sp2d' and a.kd_skpd='$kdskpd' 
					ORDER BY d.kd_kegiatan, d.kd_rek5"; 
			
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'idx' => $ii,
                        'kdkegiatan' => $resulte['kd_kegiatan'],
                        'nmkegiatan' => $resulte['nm_kegiatan'],       
                        'kdrek5'     => $resulte['kd_rek5'],  
                        'nmrek5'     => $resulte['nm_rek5'],  
                        'nilai1'     => number_format($resulte['nilai']),
                        );
                        $ii++;
        }
           echo json_encode($result);
           $query1->free_result();
    }
	
	 function load_jenis_beban($jenis='') {
     if ($jenis==3){
		$result = array(( 
						array(
						"id"   => 1 ,
						"text" => " TU",
						"selected"=>true
						) 
					) 
				);
		 
	 } else if($jenis==4){
		$result = array(( 
						array(
						"id"   => 1 ,
						"text" => " LS Bendahara (Transfer)"
						) 
					) ,
						( 
						array( 
					  "id"   => 2 ,
					  "text" => " LS Bendahara (Tunai)"
						) 
					),
						( 
						array( 
					  "id"   => 9 ,
					  "text" => " Gaji Pihak Ketiga"
						) 
					)
				);          
	 } else if($jenis==6){
		$result = array(( 
						array(
						"id"   => 1 ,
						"text" => " LS Bendahara (Tunai)"
						) 
					) ,
						( 
						array( 
					  "id"   => 2 ,
					  "text" => " LS Pihak Ketiga (Tanpa Penagihan)"
						) 
					),
						( 
						array( 
					  "id"   => 3 ,
					  "text" => " LS Pihak Ketiga (Dengan Penagihan)"
						) 
					)
					
				);          
				}
				 echo json_encode($result);
			   
			 }

			 
	function config_tahun() {
        $result = array();
         $tahun  = $this->session->userdata('pcThang');
		 $result = $tahun;
         echo json_encode($result);
    	   
	}

    function kartu_kendali()
    {
        $data['page_title']= 'CETAK KARTU KENDALI';
        $this->template->set('title', 'CETAK KARTU KENDALI');   
        $this->template->load('template','tukd/sp2d/kartu_kendali',$data) ; 
    }
	
    function pgiat($cskpd='') {
        
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
         where a.kd_skpd='$cskpd' order by a.kd_kegiatan";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
	
    function psgiat($cskpd='') {
        
        $sql = "SELECT a.kd_subkegiatan,b.nm_subkegiatan FROM trskpd a INNER JOIN m_sub_giat b ON a.kd_subkegiatan=b.kd_subkegiatan
         where a.kd_skpd='$cskpd' order by a.kd_subkegiatan";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_subkegiatan' => $resulte['kd_subkegiatan'],  
                        'nm_subkegiatan' => $resulte['nm_subkegiatan'],  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    function cetak_kartu_kendali_kegi($dcetak='',$ttd='',$skpd='',$kd_kegi='',$dcetak2=''){

	$print = $this->uri->segment(8);

	$prog=substr($kd_kegi,0,18);
    $ggia=substr($kd_kegi,0,21);
			 
			$cRet ="<table style=\"border-collapse:collapse;font-weight:bold;font-family:arial; font-size:12px\" border=\"0\" width=\"100%\" align=\"center\" cellspacing=\"0\" cellpadding=\"0\">
            <tr >
                <td width=\"100%\" align=\"center\" colspan=2 style=\"font-size:18px\">KARTU KENDALI KEGIATAN<br> <br></td></tr>
					 <TR  width=\"100%\">
						<TD align=\"left\" >SKPD</TD>
						<TD align=\"left\" >: ".$skpd." - ".$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd')."</TD>
					 </TR>
					 <TR>
						<TD align=\"left\">Nama Program</TD>
						<TD align=\"left\"  >: ".$prog." - ".$this->tukd_model->get_nama($prog,'nm_program','trskpd','kd_program')."</TD>
					 </TR>
					  <TR>
						<TD align=\"left\">Nama Kegiatan</TD>
						<TD align=\"left\"  >: ".$ggia." - ".$this->tukd_model->get_nama($ggia,'nm_kegiatan','trskpd','kd_kegiatan')."</TD>
					 </TR>
					 <TR>
						<TD align=\"left\">Nama Sub Kegiatan</TD>
						<TD align=\"left\"  >: ".$kd_kegi." - ".$this->tukd_model->get_nama($kd_kegi,'nm_subkegiatan','trskpd','kd_subkegiatan')."</TD>
					 </TR>
					 <TR>
						<TD align=\"left\" >Periode</TD>
						<TD align=\"left\" >: ".$this->tukd_model->tanggal_format_indonesia($dcetak)." s/d ".$this->tukd_model->tanggal_format_indonesia($dcetak2)."</TD>
					 </TR>
					 </TABLE>";

			$cRet .=" <table style=\"border-collapse:collapse;font-family:arial; font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">               

			   <tr style=\"font-size:12px;font-weight:bold;\">
                    <td style=\"font-size:10px;\" rowspan=2 width=\"2%\" align=\"center\">No.<br>Urut        
                    </td>
                    <td rowspan=2 width=\"5%\" align=\"center\" >Kode<br>Rekening        
                    </td>
                     <td  colspan=2  width=\"20%\" align=\"center\">PAGU ANGGARAN<br>KEGIATAN<br>(Rp)
					 </td>
					 <td rowspan=2 width=\"15%\" align=\"center\" >Uraian        
                    </td>
                    <td  colspan=3  width=\"30%\" align=\"center\">Realisasi Kegiatan (BELANJA)<br>(Rp)
					 </td>
					 
                    <td rowspan=2 width=\"10%\" align=\"center\" >Koreksi / CP
                    </td>
                    <td  rowspan=2 width=\"10%\" align=\"center\">Sisa Pagu Anggaran<br>(Rp.)
                    </td>
                   
                </tr>
				<tr style=\"font-size:12px;font-weight:bold;\">	
					<td width=\"10%\" align=\"center\" >MURNI
                    </td>
					<td width=\"10%\" align=\"center\" >UBAH                 
                    </td>
					<td width=\"10%\" align=\"center\" >UP/GU
                    </td>
					<td width=\"10%\" align=\"center\" >TU
                    </td>
					<td width=\"10%\" align=\"center\" >LS
                    </td>
				</tr>";
			/*	
			$sql ="select c.kd_rek5,nm_rek5,uraian,anggaran_susun,anggaran_ubah,ISNULL(n_upgu,0) n_upgu,ISNULL(n_tu,0) n_tu
					,ISNULL(n_ls,0) n_ls,sisa=anggaran_ubah-(ISNULL(n_upgu,0)+ISNULL(n_tu,0)+ISNULL(n_ls,0)) from(
					select a.kd_rek5,a.nm_rek5,a.nm_rek5 [uraian],
					sum(a.nilai)anggaran_susun,sum(a.nilai_ubah)anggaran_ubah
					from trdrka a 
					where a.kd_kegiatan='$kd_kegi' 
					group by a.kd_rek5,a.nm_rek5,a.nm_rek5) as c left join 
					(select kd_rek5,sum(case when jns_spp in (1,2) then b.nilai else 0 end) n_upgu, 
					sum(case when jns_spp=3 then b.nilai else 0 end) n_tu, 
					sum(case when jns_spp in (4,5,6) then b.nilai else 0 end) n_ls from data_belanja b
					where sp2d_batal=0 and b.kd_kegiatan='$kd_kegi' 
					and sp2d_batal =0 and tgl_sp2d <='$dcetak2'
					group by b.kd_rek5
					) as d on c.kd_rek5=d.kd_rek5 order by c.kd_rek5";
			*/
			$field = $this->get_status($dcetak2,$skpd);
			$sql ="select c.kd_rek5,nm_rek5,uraian,anggaran_susun,anggaran_ubah,ISNULL(n_upgu,0)n_upgu,ISNULL(n_tu,0) 	n_tu,ISNULL(n_ls,0) n_ls,
                    k_cp=ISNULL(k_upgu,0)+ISNULL(k_tu,0)+ISNULL(k_ls,0),sisa=anggaran_ubah-(ISNULL(n_upgu,0)+ISNULL(n_tu,0)+ISNULL(n_ls,0)
                    +ISNULL(k_upgu,0)+ISNULL(k_tu,0)+ISNULL(k_ls,0)) from(
                    select a.kd_rek5,a.nm_rek5,a.nm_rek5 [uraian],
                    sum(a.nilai)anggaran_susun,sum(a.$field)anggaran_ubah
                    from trdrka a 
                    where a.kd_subkegiatan='$kd_kegi' 
                    group by a.kd_rek5,a.nm_rek5,a.nm_rek5) as c 
                    left join 
                    (select kd_rek5,sum(case when jns_spp in (1,2) then b.nilai else 0 end) n_upgu, 
                    sum(case when jns_spp=3 then b.nilai else 0 end) n_tu, 
                    sum(case when jns_spp in (4,5,6) then b.nilai else 0 end) n_ls from data_belanja b
                    where sp2d_batal=0 and b.kd_subkegiatan='$kd_kegi' and sp2d_batal =0 and tgl_sp2d <='$dcetak2'
                    group by b.kd_rek5
                    ) as d on c.kd_rek5=d.kd_rek5 
                    left join 
                    (
                    select kd_rek5,
                    sum(case when jns_spp in (1,2) then b.nilai else 0 end) k_upgu, 
                    sum(case when jns_spp=3 then b.nilai else 0 end) k_tu, 
                    sum(case when jns_spp in (4,5,6) then b.nilai else 0 end) k_ls from trhtransout a join trdtransout b 
                    on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd
                    where b.kd_subkegiatan='$kd_kegi' and a.tgl_bukti <='$dcetak2' and a.panjar='3'
                    group by b.kd_rek5
                    ) as e on d.kd_rek5=e.kd_rek5
                    order by c.kd_rek5";


			 $hasil = $this->db->query($sql);
                    $lcno = 0;
                    $lntotal = 0;
                     $total_upgu=0;
                     $total_tu=0;
                     $total_ls=0;
                     $total_anggaran_susun=0;
					 $total_anggaran_ubah=0;
                     $total_sisa=0;
					 $tkorek_cp = 0;
					 
					 foreach ($hasil->result() as $row)
                    {
                       $lcno = $lcno + 1;
					   $total_upgu=$row->n_upgu+$total_upgu;
					   $total_tu=$row->n_tu+$total_tu;
					   $total_ls=$row->n_ls+$total_ls;
					   $tkorek_cp = $row->k_cp+$tkorek_cp;
					   $total_anggaran_susun=$row->anggaran_susun+$total_anggaran_susun;
					   $total_anggaran_ubah=$row->anggaran_ubah+$total_anggaran_ubah;
					   $total_sisa=$row->sisa+$total_sisa;
					   
					   $k_cp = $this->rp_minus($row->k_cp);
					   
					   /*
					   if ( $row->tgl_sp2d !=''){
							$tgl_sp2d=$this->tukd_model->tanggal_ind($row->tgl_sp2d);
					
					   }else{
						   $tgl_sp2d = '';
					   }          */         					
       $cRet .=" <tr >
                    <td valign=\"top\" align=\"center\" style=\"font-size:12px\">$lcno  
                    </td>
                    <td valign=\"top\"  align=\"left\" style=\"font-size:12px\">".$this->dotrek($row->kd_rek5)."
					</td>					
                    <td valign=\"top\"  align=\"right\" style=\"font-size:12px\">".number_format($row->anggaran_susun,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\"  align=\"right\" style=\"font-size:12px\">".number_format($row->anggaran_ubah,"2",",",".")."&nbsp; 
					</td>
					<td valign=\"top\"  align=\"left\" style=\"font-size:12px\">$row->uraian  
                    </td>
                    <td valign=\"top\"  align=\"right\" style=\"font-size:12px\">".number_format($row->n_upgu,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\"  align=\"right\" style=\"font-size:12px\">".number_format($row->n_tu,"2",",",".")."&nbsp; 
					</td>
					<td valign=\"top\"  align=\"right\" style=\"font-size:12px\">".number_format($row->n_ls,"2",",",".")."&nbsp; 
					</td>
					<td valign=\"top\"  align=\"right\" style=\"font-size:12px\">$k_cp &nbsp; 
					</td>
					<td valign=\"top\"  align=\"right\" style=\"font-size:12px\">".number_format($row->sisa,"2",",",".")."&nbsp; 
					 </td>					 
                </tr>
				";
				};
				
				$tkorek_cp =  $this->rp_minus($tkorek_cp);
				       $cRet .=" <tr style=\"font-size:12px;font-weight:bold;\">
                    <td colspan=\"2\" align=\"center\" >TOTAL
                    </td>
                    <td valign=\"top\"  align=\"right\" >".number_format($total_anggaran_susun,"2",",",".")."&nbsp; 
					 </td>
					  <td valign=\"top\"  align=\"right\" >".number_format($total_anggaran_ubah,"2",",",".")."&nbsp; 
					 </td>
					   <td valign=\"top\"  align=\"center\" >&nbsp;&nbsp; 
					 </td>
					  <td valign=\"top\"  align=\"right\" >".number_format($total_upgu,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\"  align=\"right\">".number_format($total_tu,"2",",",".")."&nbsp; 
					</td>
					<td valign=\"top\"  align=\"right\">".number_format($total_ls,"2",",",".")."&nbsp; 
					</td>
					<td valign=\"top\"  align=\"right\" >$tkorek_cp &nbsp; 
					</td>
					<td valign=\"top\"  align=\"right\" >".number_format($total_sisa,"2",",",".")."&nbsp; 
					 </td>					 
                </tr>
				";
			$cRet .='</table>';
			
			$nip = str_replace('a',' ',$ttd);

 $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip='$nip' AND kode='BUD'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
		$tanggal_ttd = date('d-m-Y');
		$daerah = 'Pontianak';
$cRet .='<TABLE style="border-collapse:collapse; font-size:12px" width="100%" border="0" cellspacing="0" cellpadding="0" align=center>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$daerah.', '.$tanggal_ttd.'</TD>
					</TR>
					
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$jabatan.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" ><b><u>'.$nama.'</u></b><br>'.$pangkat.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$nip.'</TD>
					</TR>
					</TABLE><br/>';
			
			$data['prev']= 'Kartu Kendali';
			if ($print==1){
				$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'1'); 

		} else{
		  echo $cRet;
		}
	
	}
	
	
   function cetak_kartu_kendali($dcetak='',$ttd='',$skpd='',$kd_kegi='',$rek5='',$dcetak2=''){ //Tox

	$print = $this->uri->segment(9);
//echo $print;
$field = $this->get_status($dcetak2,$skpd);
	$sql = "select sum(nilai)nilai,sum($field)nilai_ubah from trdrka where kd_subkegiatan='$kd_kegi' AND kd_rek5='$rek5'";
			 $hasil = $this->db->query($sql);
			 $data1 = $hasil->row();
			 $ang = $data1->nilai_ubah;
             
             $kegi = substr($kd_kegi,0,21);
			 
			$cRet ="<table style=\"border-collapse:collapse;font-weight:bold;font-family:arial; font-size:12px\" border=\"0\" width=\"100%\" align=\"center\" cellspacing=\"0\" cellpadding=\"0\">
            <tr >
                <td width=\"100%\" align=\"center\" colspan=2 style=\"font-size:18px\">KARTU KENDALI KEGIATAN<br> <br></td></tr>
					 <TR  width=\"100%\">
						<TD align=\"left\" >SKPD</TD>
						<TD align=\"left\" >: ".$skpd." - ".$this->tukd_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd')."</TD>
					 </TR>
					  <TR>
						<TD align=\"left\">Nama Kegiatan</TD>
						<TD align=\"left\"  >: ".$kegi." - ".$this->tukd_model->get_nama($kegi,'nm_kegiatan','trskpd','kd_kegiatan')."</TD>
					 </TR>
					 <TR>
						<TD align=\"left\">Nama Sub Kegiatan</TD>
						<TD align=\"left\"  >: ".$kd_kegi." - ".$this->tukd_model->get_nama($kd_kegi,'nm_subkegiatan','trskpd','kd_subkegiatan')."</TD>
					 </TR>
					 <TR>
						<TD align=\"left\">Nama Rekening</TD>
						<TD align=\"left\"  >: ".$kd_kegi.".".$rek5." - ".$this->tukd_model->get_nama($rek5,'nm_rek5','ms_rek5','kd_rek5')."</TD>
					 </TR>
					 <TR>
						<TD align=\"left\">Anggaran Penyusunan</TD>
						<TD align=\"left\"  >: ".number_format($data1->nilai,"2",".",",")."</TD>
					 </TR>
					 <TR>
						<TD align=\"left\">Anggaran Perubahan</TD>
						<TD align=\"left\"  >: ".number_format($data1->nilai_ubah,"2",".",",")."</TD>
					 </TR>
					 <TR>
						<TD align=\"left\" >Periode</TD>
						<TD align=\"left\" >: ".$this->tukd_model->tanggal_format_indonesia($dcetak)." s/d ".$this->tukd_model->tanggal_format_indonesia($dcetak2)."</TD>
					 </TR>
					 </TABLE>";

			$cRet .=" <table style=\"border-collapse:collapse;font-family:arial; font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">               

			   <tr style=\"font-size:12px;font-weight:bold;\">
                    <td rowspan=2 width=\"2%\" align=\"center\">No.<br>Urut        
                    </td>
                    <td rowspan=2 width=\"5%\" align=\"center\" >Kode<br>Rekening        
                    </td>
                    <td rowspan=2 width=\"8%\" align=\"center\">Tanggal     
                    </td>
                    <td rowspan=2 width=\"25%\" align=\"center\">Uraian       
                    </td>
                    <td  colspan=3  width=\"30%\" align=\"center\">Realisasi Kegiatan (BELANJA)<br>(Rp)
					 </td>
					 
                    <td rowspan=2 width=\"15%\" align=\"center\" >Koreksi / CP
                    </td>
                    <td  rowspan=2 width=\"15%\" align=\"center\">Sisa Pagu Anggaran<br>(Rp.)
                    </td>
                   
                </tr>
				<tr style=\"font-size:12px;font-weight:bold;\">				                   
					<td width=\"10%\" align=\"center\" >UP/GU
                    </td>
					<td width=\"10%\" align=\"center\" >TU
                    </td>
					<td width=\"10%\" align=\"center\" >LS
                    </td>
				</tr>";
			/*
			 $sql = "select a.kd_rek5,a.nm_rek5,tgl_sp2d,rtrim(keperluan) as uraian, 
					sum(case when jns_spp in (1,2) then a.nilai else 0 end)n_upgu,
					sum(case when jns_spp=3 then a.nilai else 0 end)n_tu, 
					sum(case when jns_spp in (4,5,6) then a.nilai else 0 end)n_ls,
					sum(b.nilai)anggaran,(sum(b.nilai)-sum(a.nilai))sisa 
					from data_Belanja a inner join trdrka b on a.kd_kegiatan=b.kd_kegiatan and a.kd_rek5=b.kd_rek5
					where sp2d_batal=0 and a.kd_kegiatan='$kd_kegi' 
					AND a.kd_rek5 = '$rek5' 
					And sp2d_batal =0 and tgl_sp2d <='$dcetak2' group by a.kd_rek5,a.nm_rek5,tgl_sp2d,rtrim(keperluan) ";
			 */
             $sql = "select f.kd_rek5,f.nm_rek5,f.tgl_sp2d,f.uraian,f.n_upgu,f.n_tu,f.n_ls,k_cp=f.k_jurnalgu+f.k_jurnaltu+f.k_jurnalls from (
                        select a.kd_rek5,a.nm_rek5,tgl_sp2d,rtrim(keperluan) as uraian, 
    					sum(case when jns_spp in (1,2) then a.nilai else 0 end)n_upgu,
    					sum(case when jns_spp=3 then a.nilai else 0 end)n_tu, 
    					sum(case when jns_spp in (4,5,6) then a.nilai else 0 end)n_ls,0 [k_jurnalgu],0 [k_jurnaltu],0 [k_jurnalls]
    					from data_Belanja a 
    					where sp2d_batal=0 and a.kd_subkegiatan='$kd_kegi' 
    					AND a.kd_rek5 = '$rek5' 
    					And sp2d_batal =0 and tgl_sp2d <='$dcetak2' group by a.kd_rek5,a.nm_rek5,tgl_sp2d,rtrim(keperluan)
                    union all
                        select c.kd_rek5,c.nm_rek5,a.tgl_bukti,a.ket, 0 n_upgu,0 n_tu,0 n_ls,
                        sum(case when jns_spp in (1) then c.nilai else 0 end)[k_jurnalgu],
                        sum(case when jns_spp=3 then c.nilai else 0 end)[k_jurnaltu], 
                        sum(case when jns_spp in (4,5,6) then c.nilai else 0 end)[k_jurnalls]
                        from trhtransout a join trdtransout c on a.no_bukti=c.no_bukti and a.kd_skpd=c.kd_skpd 
                        where c.kd_subkegiatan='$kd_kegi' and c.kd_rek5 = '$rek5'  and a.tgl_bukti<='$dcetak2' and a.panjar='3' 
                        group by c.kd_rek5,c.nm_rek5,a.tgl_bukti,a.ket
                    ) as f order by tgl_sp2d
                    ";
			 $sisapagu = 0;
			 $hasil = $this->db->query($sql);
                    $lcno = 0;
                    $lntotal = 0;
                     $total_upgu=0;
                     $total_tu=0;
                     $total_ls=0;
                     $total_anggaran=0;
					 $tkorek_cp = 0;
                     //$sisa=$data1->nilai_ubah;
					 
					 foreach ($hasil->result() as $row)
                    {
                       $lcno = $lcno + 1;
					   $total_upgu=$row->n_upgu+$total_upgu;
					   $total_tu=$row->n_tu+$total_tu;
					   $total_ls=$row->n_ls+$total_ls;
					   //$total_anggaran=$row->anggaran+$total_anggaran;
					   $tkorek_cp = $tkorek_cp + $row->k_cp;
					   //$sisa=$sisa-$total_upgu-$total_tu-$total_ls;
					   $sisapagu=$ang-$total_upgu-$total_tu-$total_ls-$tkorek_cp;
					   $tgl_sp2d=$this->tukd_model->tanggal_ind($row->tgl_sp2d);
					   $k_cp = $this->rp_minus($row->k_cp);
					                       					
       $cRet .=" <tr >
                    <td valign=\"top\"  align=\"center\" style=\"font-size:12px\">$lcno  
                    </td>
                    <td valign=\"top\"  align=\"center\" style=\"font-size:12px\">$row->kd_rek5     
                    </td>
                    <td valign=\"top\"  align=\"center\" style=\"font-size:12px\">$tgl_sp2d
                    </td>
					<td valign=\"top\"  align=\"left\" style=\"font-size:12px\">$row->uraian  
                    </td>
                    <td valign=\"top\"  align=\"center\" style=\"font-size:12px\">".number_format($row->n_upgu,"2",".",",")."&nbsp; 
					 </td>
					<td valign=\"top\"  align=\"center\" style=\"font-size:12px\">".number_format($row->n_tu,"2",".",",")."&nbsp; 
					</td>
					<td valign=\"top\"  align=\"center\" style=\"font-size:12px\">".number_format($row->n_ls,"2",".",",")."&nbsp; 
					</td>
					<td valign=\"top\"  align=\"center\" style=\"font-size:12px\">$k_cp &nbsp; 
					</td>
					<td valign=\"top\"  align=\"center\" style=\"font-size:12px\">".number_format($sisapagu,"2",".",",")."&nbsp; 
					 </td>					 
                </tr>
				";
				};
				
					$tkorek_cp = $this->rp_minus($tkorek_cp );
				       $cRet .=" <tr style=\"font-size:12px;font-weight:bold;\">
                    <td colspan=\"4\" align=\"center\" >TOTAL
                    </td>
                    <td  align=\"center\" >".number_format($total_upgu,"2",".",",")."&nbsp; 
					 </td>
					<td  align=\"center\">".number_format($total_tu,"2",".",",")."&nbsp; 
					</td>
					<td  align=\"center\">".number_format($total_ls,"2",".",",")."&nbsp; 
					</td>
					<td  align=\"center\" >$tkorek_cp &nbsp; 
					</td>
					<td  align=\"center\" >".number_format($sisapagu,"2",".",",")."&nbsp; 
					 </td>					 
                </tr>
				";
			$cRet .='</table>';
			
			$nip = str_replace('abc',' ',$ttd);

 $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip='$nip' AND kode='BUD'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
		$tanggal_ttd = date('d-m-Y');
		$daerah = 'Pontianak';
$cRet .='<TABLE style="border-collapse:collapse; font-size:12px" width="100%" border="0" cellspacing="0" cellpadding="0" align=center>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$daerah.', '.$tanggal_ttd.'</TD>
					</TR>
					
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$jabatan.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" ><b><u>'.$nama.'</u></b><br>'.$pangkat.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$nip.'</TD>
					</TR>
					</TABLE><br/>';
			
			$data['prev']= 'Kartu Kendali';
			if ($print==1){
				$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'1'); 

		} else{
		  echo $cRet;
		}
	
	}

	
	function load_d_uji() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
	
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where    = " ";
        if ($kriteria <> ''){                               
            $where="  and (upper(a.no_uji) like upper('%$kriteria%') or a.tgl_uji like '%$kriteria%') ";            
        }


        $sql = "SELECT count(*) as tot from trhuji" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();


        $sql = "SELECT top $rows * from trhuji  a where a.no_uji not in (SELECT TOP $offset  no_uji from  
                trhuji order by tgl_uji,no_uji ) $where order by a.tgl_uji, a.no_uji ";//limit $offset,$rows";


		
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
		
		  { 
           
            $row[] = array(
                        'id' => $ii,
						'no_uji'    => $resulte['no_uji'],
						'tgl_uji'    => $resulte['tgl_uji']
                        );
                        $ii++;
        }						           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
    	$query1->free_result();    
		
	}
	
	
	function select_detail_uji($vno_uji='') {

    $luji = $this->input->post('vno_uji');
   
   
        $sql = "SELECT no_uji, tgl_uji, a.no_sp2d,b.tgl_sp2d,no_spm,tgl_spm,nilai 
				FROM TRDUJI a inner join trhsp2d b on a.no_sp2d=b.no_sp2d WHERE no_uji='$luji'";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'idx'        => $ii, 						
                        'no_sp2d' => $resulte['no_sp2d'],     
                        'tgl_sp2d'     => $resulte['tgl_sp2d'],  
                        'no_spm'     => $resulte['no_spm'], 						 
                        'tgl_spm'     => $resulte['tgl_spm'], 						 
                        'nilai1'      => number_format($resulte['nilai'])
                        );
                        $ii++;
        }
           
           echo json_encode($result);
     $query1->free_result();
    }
	
	  function sp2d_list_uji() {
	   $lccr = $this->input->post('q');
        $sql   = " select no_sp2d, tgl_sp2d,no_spm,tgl_spm,nilai from trhsp2d where no_sp2d not in 
                    (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) and upper(no_sp2d) like upper('%$lccr%') ";
       // $sql   = " select no_spd, tgl_spd from trhspd ";        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],  
                        'tgl_sp2d' => $resulte['tgl_sp2d'],
                        'no_spm' => $resulte['no_spm'],
                        'tgl_spm' => $resulte['tgl_spm'],
                        'nilai' => $resulte['nilai']						
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	

	
	function no_urut(){
    $kd_skpd = $this->session->userdata('kdskpd'); 
	$query1 = $this->db->query("select case when max(nomor+1) is null then 1 else max(nomor+1) end as nomor from (
	select no_kas_bud nomor,'Pencairan SP2D' ket,kd_skpd from trhsp2d where isnumeric(no_kas_bud)=1 and status_bud=1
	) z 
	");
	    $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'no_urut' => $resulte['nomor']
                        );
                        $ii++;
        }
		
        echo json_encode($result);
    	$query1->free_result();   
    }
	
	function no_urut_ppkd(){
    $kd_skpd = $this->session->userdata('kdskpd'); 
	$query1 = $this->db->query("select case when max(nomor+1) is null then 1 else max(nomor+1) end as nomor from (
	select no_kas nomor,'Terima STS' ket,kd_skpd from trhkasin_ppkd where isnumeric(no_kas)=1 
	) z 
	");
	    $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'no_urut' => $resulte['nomor']
                        );
                        $ii++;
        }
		
        echo json_encode($result);
    	$query1->free_result();   
    }
	
	
	
	function simpan_update_d_uji(){
		$no_uji = $this->input->post('no_uji');		
		$tgl_uji = $this->input->post('tgl_uji');
		$no_blk = $this->input->post('no_blk');
		$cwaktu = date("Y-m-d H:i:s");		
		$user =  $this->session->userdata('pcNama'); 
		$lcst=$this->input->post('lcst');
		$r_nomor='2';
		if ($lcst=='tambah')
		{
			
			$sql = "Select isnull(Max((no_urut)),0) As maks From trhuji";
			$hasil = $this->db->query($sql);
			$nomor7 = $hasil->row();
			$nomor7_urut=$nomor7->maks+1;
			$r_nomor=strval($nomor7_urut).$no_blk;
			
    	$csql = "INSERT INTO trhuji (no_uji,tgl_uji,username,tgl_update,no_urut) values ('$r_nomor','$tgl_uji','$user','$cwaktu','$nomor7_urut')";
    	$query1 = $this->db->query($csql);    					
                if($query1){
                    echo json_encode($r_nomor);
                }else{
                    echo '0';
                }
		} else {
			$csql = "update trhuji set tgl_uji='$tgl_uji',username='$user',tgl_update='$cwaktu' where no_uji='$no_uji' ";
			$query1 = $this->db->query($csql);    					
                if($query1){
                    echo json_encode($r_nomor);
                }else{
                    echo '0';
                }
		}
    }
	
	function simpan_detail_d_uji(){
	  
		$no_uji = $this->input->post('no_uji');		
		$tgl_uji = $this->input->post('tgl_uji');
		$no_sp2d = $this->input->post('no_sp2d');
        
    	$csql = "INSERT INTO trduji (no_uji,tgl_uji,no_sp2d) values ('$no_uji','$tgl_uji','$no_sp2d')";
    	$query1 = $this->db->query($csql);
    					
                if($query1){
                    echo '2';
                }else{
                    echo '0';
                }
            }
 
    function simpan_detail_d_uji_hapus()
	{
           $no_uji  = trim($this->input->post('no_uji'));

               $sql     = " delete trduji where no_uji='$no_uji' ";
               $asg     = $this->db->query($sql); 	
               if ($asg > 0){  	
                    echo '1';
                    exit();
               } else {
                    echo '0';
                    exit();
               }
    }   

    
	function cetak_register_sp2d_baru($dcetak='',$ttd='',$skpd='',$tstatus='',$dcetak2='',$cetak=1,$jenis='',$urut='', $pilihan=''){ //Tox
	$print = $cetak;    
	 $tahun  = $this->session->userdata('pcThang');
    $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
		$where2='';
		  switch ($tstatus){
                        case '1': //SP2D Keluar
						$where2='';
                            break;
                        case '2': //SP2D lunas
							$where2=" and status_bud=1 ";
                            break;
                        case '3': //SP2D Advice
                            $where2=" and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) ";
                            break;
                        case '4': //SP2D belum Bayar
                           $where2=" and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) and status_bud <> 1 ";
                            break;                       
					    case '5': //Belum Advice
                           $where2=" and no_sp2d NOT IN (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) ";
                            break;                       
                    }
			 switch ($jenis){
                        case '1': //BL
						$where4="AND b.jns_spp not in ('4','5')";
                            break;
                        case '2': //BTL
							$where4=" AND b.jns_spp in ('4','5')";
                            break;
                      }
					  
			switch ($pilihan){
                        case '1': //SEMUA
							$where3="";
                            break;
                        case '2': //BULAN
                           $where3=" and MONTH(tgl_sp2d)='$dcetak' ";
                            break;
						case '3': //PERIODE
                           $where3= " and ( tgl_sp2d between '$dcetak' and '$dcetak2') ";
                            break;
                      }		
						   
			switch ($urut){
							case '1': //BL
							$order="ORDER BY tgl_sp2d,no_sp2d";
								break;
							case '2': //BTL
								$order=" ORDER BY CAST(no_kas_bud as int)";
								break;
						  }
		
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"15\"><b>PEMERINTAH ".strtoupper($kab)."</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"15\"><b>DAFTAR SPM DAN SP2D TAHUN ANGGARAN $tahun</b></td>
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b> $a $nama</b><br>&nbsp;</td>
        </tr>
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"3%\" rowspan=\"3\"><b>No.<br>Urut</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"40%\" colspan=\"7\"><b>SPM</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"40%\" colspan=\"7\"><b>SP2D</td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>NO</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>TANGGAL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>UP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>GU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>TU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" colspan=\"2\"><b>LS</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>NO</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>TANGGAL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>UP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>GU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>TU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" colspan=\"2\"><b>LS</b></td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>GAJI/ BTL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>Barang <br>& Jasa</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>GAJI/ BTL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>Barang <br>& Jasa</b></td>           
        </tr>
         
          </thead>
          <tr>
            <td style=\"font-size:10px\" align=\"center\" ><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>5</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>6</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>7</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>8</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>9</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>10</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>11</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>12</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>13</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>14</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>15</b></td>
          </tr>";
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $skpd;
        $where ="where (c.sp2d_batal IS NULL  OR c.sp2d_batal !=1) ";
        if ($kriteria <> '--'){                               
            $where=" where  (c.sp2d_batal IS NULL  OR c.sp2d_batal !=1) and a.kd_skpd ='$kriteria' ";            
        }       
              
        $sql = "SELECT a.no_spm,a.tgl_spm,b.tgl_sp2d,b.no_sp2d,b.keperluan,
				(case when a.jns_spp=1 then b.nilai else 0  end)up,
				(case when a.jns_spp=2 then b.nilai else 0  end)gu,
				(case when a.jns_spp=3 then b.nilai else 0  end)tu,
				(case when a.jns_spp in (4,5) then b.nilai else 0  end)gaji,
				(case when a.jns_spp=6 then b.nilai else 0  end)ls
				 FROM TRHSPM a inner JOIN TRHSP2D b ON a.no_spm=b.no_spm 
				  inner join TRHSPp c on a.no_spp=c.no_spp $where $where2 $where4 $where3
				  $order ";
                $hasil = $this->db->query($sql);
                $lcno = 0;
				 $t_up= 0;
                    $t_gu=0;
                    $t_tu=0;
                    $t_gaji=0;
                    $t_ls=0;
                foreach ($hasil->result() as $row)
                {
                    $spm= $row->no_spm;
                    $tgl_spm=$row->tgl_spm;
                    $sp2d= $row->no_sp2d;
                    $tgl_sp2d=$row->tgl_sp2d;
                    $kkeperluan= $row->keperluan;
                    $n_up= $row->up;
                    $n_gu= $row->gu;
                    $n_tu= $row->tu;
                    $n_gaji= $row->gaji;
                    $n_ls= $row->ls;
                    $t_up= $t_up+$n_up;
                    $t_gu= $t_gu+$n_gu;
                    $t_tu= $t_tu+$n_tu;
                    $t_gaji=$t_gaji+$n_gaji;
                    $t_ls= $t_ls+$n_ls;

                    $lcno = $lcno + 1;
                    
                    $cRet .=  "<tr>
                                <td align=\"left\" style=\"font-size:12px\">$lcno</td>
                                <td align=\"left\" style=\"font-size:12px\">$spm</td>
                                <td align=\"left\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_spm)."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_up,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_gu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_tu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_gaji,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_ls,"2",",",".")."</td>
                                <td align=\"left\" style=\"font-size:12px\">$sp2d</td>
                                <td align=\"left\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_sp2d)."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_up,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_gu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_tu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_gaji,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_ls,"2",",",".")."</td>
                              </tr>  "; 
                   
                }

                    $cRet .=  "<tr  style=\"font-size:12px;font-weight:bold;\">
                                <td align=\"center\" style=\"font-size:12px\" colspan=3> Jumlah</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_up,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_tu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gaji,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_ls,"2",",",".")."</td>
                                <td align=\"center\" style=\"font-size:12px\" colspan=2> Jumlah</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_up,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_tu,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gaji,"2",",",".")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_ls,"2",",",".")."</td>
                              </tr>  "; 
                   
  
				
        $cRet .="</table>";
		
		$nip = str_replace('a',' ',$ttd);
		 $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip='$nip' AND kode='BUD'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
		$tanggal_ttd = date('d-m-Y');		
		$cRet .='<TABLE style="border-collapse:collapse; font-size:12px" width="100%" border="0" cellspacing="0" cellpadding="0" align=center>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$daerah.', '.$tanggal_ttd.'</TD>
					</TR>
					
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$jabatan.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" ><b><u>'.$nama.'</u></b><br>'.$pangkat.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$nip.'</TD>
					</TR>
					</TABLE><br/>';
		
        $data['prev']= $cRet;    
		if ($print==1){
				$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'1'); 

		} else{
		echo ("<title>REGISTER SP2D</title>");
  	    echo $cRet;
		}
		//echo("$cRet");   
    }
	
	
	function cetak_register_sp2d_baru2($dcetak='',$ttd='',$skpd='',$tstatus='',$dcetak2='',$cetak=1,$jenis='',$urut='', $pilihan=''){ //Tox
	$print = $cetak;    
	 $tahun  = $this->session->userdata('pcThang');
    $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
		$where2='';
		  switch ($tstatus){
                        case '1': //SP2D Keluar
						$where2='';
                            break;
                        case '2': //SP2D lunas
							$where2=" and status_bud=1 ";
                            break;
                        case '3': //SP2D Advice
                            $where2=" and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) ";
                            break;
                        case '4': //SP2D belum Bayar
                           $where2=" and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) and status_bud <> 1 ";
                            break;                       
					    case '5': //Belum Advice
                           $where2=" and no_sp2d NOT IN (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) ";
                            break;                       
                    }
			 switch ($jenis){
                        case '1': //BL
						$where4="AND b.jns_spp not in ('4','5')";
                            break;
                        case '2': //BTL
							$where4=" AND b.jns_spp in ('4','5')";
                            break;
                      }
					  
			switch ($pilihan){
                        case '1': //SEMUA
							$where3="";
                            break;
                        case '2': //BULAN
                           $where3=" and MONTH(tgl_sp2d)='$dcetak' ";
                            break;
						case '3': //PERIODE
                           $where3= " and ( tgl_sp2d between '$dcetak' and '$dcetak2') ";
                            break;
                      }		
						   
			switch ($urut){
							case '1': //BL
							$order="ORDER BY no_sp2d";
								break;
							case '2': //BTL
								$order=" ORDER BY CAST(no_kas_bud as int)";
								break;
						  }
		
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"16\"><b>PEMERINTAHAN ".strtoupper($kab)."</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"16\"><b>DAFTAR SPM DAN SP2D TAHUN ANGGARAN $tahun</b></td>
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"16\"><b> $a $nama</b><br>&nbsp;</td>
        </tr>
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"3%\" rowspan=\"3\"><b>No.<br>Urut</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"40%\" colspan=\"7\"><b>SPM</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"40%\" colspan=\"8\"><b>SP2D</td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>NO</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>TANGGAL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>UP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>GU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>TU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" colspan=\"2\"><b>LS</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" rowspan=\"2\"><b>NO</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>NO KASDA</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>TANGGAL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>UP</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>GU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" rowspan=\"2\"><b>TU</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" colspan=\"2\"><b>LS</b></td>
        </tr>  
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>GAJI/ BTL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>Barang <br>& Jasa</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>GAJI/ BTL</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\" ><b>Barang <br>& Jasa</b></td>           
        </tr>
         
          </thead>
          <tr>
            <td style=\"font-size:10px\" align=\"center\" ><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>5</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>6</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>7</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>8</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>9</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>10</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>11</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>12</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>13</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>14</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>15</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>16</b></td>
          </tr>";
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $skpd;
        $where ="where (c.sp2d_batal IS NULL  OR c.sp2d_batal !=1) ";
        if ($kriteria <> '--'){                               
            $where=" where  (c.sp2d_batal IS NULL  OR c.sp2d_batal !=1) and a.kd_skpd ='$kriteria' ";            
        }       
              
        $sql = "SELECT a.no_spm,a.tgl_spm,b.tgl_sp2d,b.no_sp2d,b.keperluan,no_kas_bud,
				(case when a.jns_spp=1 then b.nilai else 0  end)up,
				(case when a.jns_spp=2 then b.nilai else 0  end)gu,
				(case when a.jns_spp=3 then b.nilai else 0  end)tu,
				(case when a.jns_spp in (4,5) then b.nilai else 0  end)gaji,
				(case when a.jns_spp=6 then b.nilai else 0  end)ls
				 FROM TRHSPM a inner JOIN TRHSP2D b ON a.no_spm=b.no_spm 
				  inner join TRHSPp c on a.no_spp=c.no_spp $where $where2 $where4 $where3 
				  $order ";
                $hasil = $this->db->query($sql);
                $lcno = 0;
				 $t_up= 0;
                    $t_gu=0;
                    $t_tu=0;
                    $t_gaji=0;
                    $t_ls=0;
                foreach ($hasil->result() as $row)
                {
                    $spm= $row->no_spm;
                    $tgl_spm=$row->tgl_spm;
                    $sp2d= $row->no_sp2d;
                    $no_kas_bud= $row->no_kas_bud;
                    $tgl_sp2d=$row->tgl_sp2d;
                    $kkeperluan= $row->keperluan;
                    $n_up= $row->up;
                    $n_gu= $row->gu;
                    $n_tu= $row->tu;
                    $n_gaji= $row->gaji;
                    $n_ls= $row->ls;
                    $t_up= $t_up+$n_up;
                    $t_gu= $t_gu+$n_gu;
                    $t_tu= $t_tu+$n_tu;
                    $t_gaji=$t_gaji+$n_gaji;
                    $t_ls= $t_ls+$n_ls;

                    $lcno = $lcno + 1;
                    
                    $cRet .=  "<tr>
                                <td align=\"left\" style=\"font-size:12px\">$lcno</td>
                                <td align=\"left\" style=\"font-size:12px\">$spm</td>
                                <td align=\"left\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_spm)."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_up,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_gu,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_tu,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_gaji,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_ls,"2",".",",")."</td>
                                <td align=\"left\" style=\"font-size:12px\">$sp2d</td>
                                <td align=\"left\" style=\"font-size:12px\">$no_kas_bud</td>
                                <td align=\"left\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_sp2d)."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_up,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_gu,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_tu,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_gaji,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_ls,"2",".",",")."</td>
                              </tr>  "; 
                   
                }

                    $cRet .=  "<tr  style=\"font-size:12px;font-weight:bold;\">
                                <td align=\"center\" style=\"font-size:12px\" colspan=3> Jumlah</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_up,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gu,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_tu,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gaji,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_ls,"2",".",",")."</td>
                                <td align=\"center\" style=\"font-size:12px\" colspan=3> Jumlah</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_up,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gu,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_tu,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_gaji,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_ls,"2",".",",")."</td>
                              </tr>  "; 
                   
  
				
        $cRet .="</table>";
		
		$nip = str_replace('a',' ',$ttd);

 $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip='$nip' AND kode='BUD'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
			$tanggal_ttd = date('d-m-Y');
			$daerah = 'Pontianak';
			$cRet .='<TABLE style="border-collapse:collapse; font-size:12px" width="100%" border="0" cellspacing="0" cellpadding="0" align=center>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$daerah.', '.$tanggal_ttd.'</TD>
					</TR>
					
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$jabatan.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" ><b><u>'.$nama.'</u></b><br>'.$pangkat.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$nip.'</TD>
					</TR>
					</TABLE><br/>';
		
        $data['prev']= $cRet;    
		if ($print==1){
				$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'1'); 

		} else{
		echo ("<title>REGISTER SP2D</title>");
  	    echo $cRet;
		}
		//echo("$cRet");   
    }
	


	function cetak_realisasi_sp2d($dcetak='',$ttd='',$skpd='',$tstatus='',$dcetak2='',$cetak=1,$jenis='', $pilihan='',$anggaran){ //Anguz
	$print = $cetak;    
	 $tahun  = $this->session->userdata('pcThang');
    $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
		$where2='';
		  
			 switch ($anggaran){
                        case '1': //
						$ang="nilai";
                            break;
                        case '2': //
						$ang="nilai_sempurna";
                            break;
						case '3': //
						$ang="nilai_ubah";
                            break;
                      }
					  
			switch ($pilihan){
                        case '1': //SEMUA
							$where3="";
                            break;
                        case '2': //BULAN
                           $where3=" and MONTH(tgl_sp2d)='$dcetak' ";
                            break;
						case '3': //PERIODE
                           $where3= " and ( tgl_sp2d between '$dcetak' and '$dcetak2') ";
                            break;
                      }		
						   
		/*        $kd = $this->uri->segment(3);
        if ($kd <> ''){
            $a ='SKPD :';
        $sqls="SELECT nm_skpd FROM ms_skpd where kd_skpd='$kd'";
                 $sqls =$this->db->query($sqls);
                 foreach ($sqls->result() as $row)
                {
                    $nama     = $row->nm_skpd;
                    
                   
                }
        } */
		$cRet ="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">
				<tr>            
                    <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"15\"><b>PEMERINTAH KABUPATEN SANGGAU</b></td>
        </tr>
                <tr>
                    <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"15\"><b>REALISASI SURAT PERINTAH PENCAIRAN DANA (SP2D) PERDINAS/ISNTANSI/UNIT KERJA</b></td>            
                </tr>        
        </table>
		";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="
		<thead>
        <tr>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"7%\" rowspan=\"2\"><b>Kode</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"20%\" rowspan=\"2\"><b>Urusan Permerintah Daerah</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"20%\" colspan=\"2\"><b>Belanja Tidak Langsung</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"4%\" rowspan=\"2\"><b>Persen<BR>tase</b></td>
			<td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"20%\" colspan=\"2\"><b>Belanja Langsung</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"4%\" rowspan=\"2\"><b>Persen<BR>tase</b></td>
			<td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"20%\" colspan=\"2\"><b>Jumlah Keseluruhan</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"4%\" rowspan=\"2\"><b>Persen<BR>tase</b></td>
        </tr>  
		<tr>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" ><b>Plafond</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" ><b>Realisasi SP2D</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" ><b>Plafond</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" ><b>Realisasi SP2D</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" ><b>Plafond</b></td>
            <td style=\"font-size:12px\" bgcolor=\"#CCCCCC\" align=\"center\" ><b>Realisasi SP2D</b></td>
          </tr>
        <tr>
            <td style=\"font-size:12px\" align=\"center\" ><b>1</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>2</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>3</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>4</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>5</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>6</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>7</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>8</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>9</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>10</b></td>
            <td style=\"font-size:12px\" align=\"center\" ><b>11</b></td>
          </tr>
      </thead>
		  ";
        
            
        $sql = "SELECT a.kd_skpd as kode ,a.nm_skpd as nama
				,ISNULL(ang_btl,0) as ang_btl
				,ISNULL(ang_bl,0) as ang_bl
				,ISNULL(bel_btl,0) as bel_btl
				,ISNULL(bel_bl,0) as bel_bl
				FROM ms_skpd a 
				LEFT JOIN
				(SELECT a.kd_skpd 
				,ISNULL(ang_btl,0) as ang_btl
				,ISNULL(ang_bl,0) as ang_bl
				,ISNULL(bel_btl,0) as bel_btl
				,ISNULL(bel_bl,0) as bel_bl
				FROM 
				(SELECT a.kd_skpd, a.nm_skpd 
				,SUM(CASE WHEN LEFT(a.kd_rek5,2) ='51' THEN a.$ang ELSE 0 END) AS ang_btl
				,SUM(CASE WHEN LEFT(a.kd_rek5,2) ='52' THEN a.$ang ELSE 0 END) AS ang_bl
				FROM trdrka a
				GROUP BY a.kd_skpd, a.nm_skpd)a
				LEFT JOIN 
				(SELECT a.kd_skpd
				,SUM(CASE WHEN LEFT(d.kd_rek5,2) ='51' THEN d.nilai ELSE 0 END) AS bel_btl
				,SUM(CASE WHEN LEFT(d.kd_rek5,2) in ('52','11') THEN d.nilai ELSE 0 END) AS bel_bl
				FROM trhsp2d a  
				INNER JOIN trhspm b ON a.no_spm=b.no_spm AND a.kd_skpd = b.kd_skpd  
				INNER JOIN trhspp c ON b.no_spp=c.no_spp AND b.kd_skpd = c.kd_skpd 
				INNER JOIN trdspp d ON c.no_spp=d.no_spp AND c.kd_skpd = d.kd_skpd
				WHERE (c.sp2d_batal=0 OR c.sp2d_batal is NULL) 
				and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji)
				$where3
				GROUP BY a.kd_skpd)b
				ON a.kd_skpd=b.kd_skpd)c
				ON a.kd_skpd=c.kd_skpd
				UNION ALL
				SELECT a.kd_org as kode ,a.nm_org as nama
				,ISNULL(ang_btl,0) as ang_btl
				,ISNULL(ang_bl,0) as ang_bl
				,ISNULL(bel_btl,0) as bel_btl
				,ISNULL(bel_bl,0) as bel_bl
				FROM ms_organisasi a 
				LEFT JOIN
				(SELECT a.kode 
				,ISNULL(ang_btl,0) as ang_btl
				,ISNULL(ang_bl,0) as ang_bl
				,ISNULL(bel_btl,0) as bel_btl
				,ISNULL(bel_bl,0) as bel_bl
				FROM 
				(SELECT LEFT(a.kd_skpd,7) as kode 
				,SUM(CASE WHEN LEFT(a.kd_rek5,2) ='51' THEN a.$ang ELSE 0 END) AS ang_btl
				,SUM(CASE WHEN LEFT(a.kd_rek5,2) ='52' THEN a.$ang ELSE 0 END) AS ang_bl
				FROM trdrka a
				GROUP BY  LEFT(a.kd_skpd,7))a
				LEFT JOIN 
				(SELECT LEFT(a.kd_skpd,7) as kode
				,SUM(CASE WHEN LEFT(d.kd_rek5,2) ='51' THEN d.nilai ELSE 0 END) AS bel_btl
				,SUM(CASE WHEN LEFT(d.kd_rek5,2) in ('52','11') THEN d.nilai ELSE 0 END) AS bel_bl
				FROM trhsp2d a  
				INNER JOIN trhspm b ON a.no_spm=b.no_spm AND a.kd_skpd = b.kd_skpd  
				INNER JOIN trhspp c ON b.no_spp=c.no_spp AND b.kd_skpd = c.kd_skpd 
				INNER JOIN trdspp d ON c.no_spp=d.no_spp AND c.kd_skpd = d.kd_skpd
				WHERE (c.sp2d_batal=0 OR c.sp2d_batal is NULL)
				and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji)
				$where3
				GROUP BY LEFT(a.kd_skpd,7))b
				ON a.kode=b.kode)c
				ON a.kd_org=c.kode

				UNION ALL

				SELECT a.kd_urusan as kode ,a.nm_urusan as nama
				,ISNULL(ang_btl,0) as ang_btl
				,ISNULL(ang_bl,0) as ang_bl
				,ISNULL(bel_btl,0) as bel_btl
				,ISNULL(bel_bl,0) as bel_bl
				FROM ms_urusan a 
				LEFT JOIN
				(SELECT a.kode 
				,ISNULL(ang_btl,0) as ang_btl
				,ISNULL(ang_bl,0) as ang_bl
				,ISNULL(bel_btl,0) as bel_btl
				,ISNULL(bel_bl,0) as bel_bl
				FROM 
				(SELECT LEFT(a.kd_skpd,4) as kode 
				,SUM(CASE WHEN LEFT(a.kd_rek5,2) ='51' THEN a.$ang ELSE 0 END) AS ang_btl
				,SUM(CASE WHEN LEFT(a.kd_rek5,2) ='52' THEN a.$ang ELSE 0 END) AS ang_bl
				FROM trdrka a
				GROUP BY LEFT(a.kd_skpd,4))a
				LEFT JOIN 
				(SELECT LEFT(a.kd_skpd,4) as kode
				,SUM(CASE WHEN LEFT(d.kd_rek5,2) ='51' THEN d.nilai ELSE 0 END) AS bel_btl
				,SUM(CASE WHEN LEFT(d.kd_rek5,2) in ('52','11') THEN d.nilai ELSE 0 END) AS bel_bl
				FROM trhsp2d a  
				INNER JOIN trhspm b ON a.no_spm=b.no_spm AND a.kd_skpd = b.kd_skpd  
				INNER JOIN trhspp c ON b.no_spp=c.no_spp AND b.kd_skpd = c.kd_skpd 
				INNER JOIN trdspp d ON c.no_spp=d.no_spp AND c.kd_skpd = d.kd_skpd
				WHERE (c.sp2d_batal=0 OR c.sp2d_batal is NULL)
				and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji)
				$where3
				GROUP BY LEFT(a.kd_skpd,4))b
				ON a.kode=b.kode)c
				ON a.kd_urusan=c.kode

				UNION ALL

				SELECT a.kd_urusan1 as kode ,a.nm_urusan1 as nama
				,ISNULL(ang_btl,0) as ang_btl
				,ISNULL(ang_bl,0) as ang_bl
				,ISNULL(bel_btl,0) as bel_btl
				,ISNULL(bel_bl,0) as bel_bl
				FROM ms_urusan1 a 
				LEFT JOIN
				(SELECT a.kode 
				,ISNULL(ang_btl,0) as ang_btl
				,ISNULL(ang_bl,0) as ang_bl
				,ISNULL(bel_btl,0) as bel_btl
				,ISNULL(bel_bl,0) as bel_bl
				FROM 
				(SELECT LEFT(a.kd_skpd,1) as kode 
				,SUM(CASE WHEN LEFT(a.kd_rek5,2) ='51' THEN a.$ang ELSE 0 END) AS ang_btl
				,SUM(CASE WHEN LEFT(a.kd_rek5,2) ='52' THEN a.$ang ELSE 0 END) AS ang_bl
				FROM trdrka a
				GROUP BY LEFT(a.kd_skpd,1))a
				LEFT JOIN 
				(SELECT LEFT(a.kd_skpd,1) as kode
				,SUM(CASE WHEN LEFT(d.kd_rek5,2) ='51' THEN d.nilai ELSE 0 END) AS bel_btl
				,SUM(CASE WHEN LEFT(d.kd_rek5,2) in ('52','11') THEN d.nilai ELSE 0 END) AS bel_bl
				FROM trhsp2d a  
				INNER JOIN trhspm b ON a.no_spm=b.no_spm AND a.kd_skpd = b.kd_skpd  
				INNER JOIN trhspp c ON b.no_spp=c.no_spp AND b.kd_skpd = c.kd_skpd 
				INNER JOIN trdspp d ON c.no_spp=d.no_spp AND c.kd_skpd = d.kd_skpd
				WHERE (c.sp2d_batal=0 OR c.sp2d_batal is NULL)
				and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji)
				$where3
				GROUP BY LEFT(a.kd_skpd,1))b
				ON a.kode=b.kode)c
				ON a.kd_urusan1=c.kode
				ORDER BY kode";
				$tot_ang_btl=0;
				$tot_ang_bl=0;
				$tot_bel_btl=0;
				$tot_bel_bl=0;
                $hasil = $this->db->query($sql);
                foreach ($hasil->result() as $row){
                    $kode= $row->kode;
                    $nama=$row->nama;
                    $ang_btl= $row->ang_btl;
                    $ang_bl=$row->ang_bl;
                    $bel_btl= $row->bel_btl;
                    $bel_bl= $row->bel_bl;
					if($ang_btl==0){
						$per_btl=number_format(0,"2",".",",");
					}else{
						$per_btl=$this->tukd_model->persen_real($ang_btl,$bel_btl);//number_format($bel_btl/$ang_btl,"2",".",",");
					}
					if($ang_bl==0){
						$per_bl=number_format(0,"2",".",",");
					}else{
						$per_bl=$this->tukd_model->persen_real($ang_btl,$bel_btl);//number_format($bel_bl/$ang_bl,"2",".",",");
					}
					$angbtlbl=$ang_bl+$ang_btl;
					$belbtlbl=$bel_bl+$bel_btl;
					if($angbtlbl==0){
						$per_blbtl=number_format(0,"2",".",",");
					}else{
						$per_blbtl=$this->tukd_model->persen_real($angbtlbl,$belbtlbl); ;//number_format($belbtlbl/$angbtlbl,"2",".",",");
					}
					$panjang=strlen($kode);
					if($panjang=='10'){
						$tot_ang_bl=$tot_ang_bl+$ang_bl;
						$tot_ang_btl=$tot_ang_btl+$ang_btl;
						$tot_bel_bl=$tot_bel_bl+$bel_bl;
						$tot_bel_btl=$tot_bel_btl+$bel_btl;
						$tot_p_seluruh = $tot_ang_btl+$tot_ang_bl;
						$tot_r_seluruh = $tot_bel_btl+$tot_bel_bl;
					}
					
					$cek_len = strlen($kode);
					$cek_sub = substr($kode,7,2);					
					
                    $cRet .=  "<tr>
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px\">$kode</td>
                                <td valign=\"top\" align=\"left\" style=\"font-size:12px\">".strtoupper($nama)."</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ang_btl,"2",",",".")."</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($bel_btl,"2",",",".")."</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".$per_btl."</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($ang_bl,"2",",",".")."</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($bel_bl,"2",",",".")."</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".$per_bl."</td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($angbtlbl,"2",",",".")."</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".number_format($belbtlbl,"2",",",".")."</td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".$per_blbtl."</td>
                              </tr>  "; 
					
                }
				$cRet .=  "<tr>
                                <td colspan=\"2\" valign=\"top\" align=\"center\" style=\"font-size:12px\"><b>TOTAL</b></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($tot_ang_btl,"2",",",".")."<b></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($tot_bel_btl,"2",",",".")."<b></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".$this->tukd_model->persen_real($tot_ang_btl,$tot_bel_btl)."<b></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($tot_ang_bl,"2",",",".")."<b></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($tot_bel_bl,"2",",",".")."<b></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".$this->tukd_model->persen_real($tot_ang_bl,$tot_bel_bl)."<b></td>
								<td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($tot_ang_btl+$tot_ang_bl,"2",",",".")."<b></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\"><b>".number_format($tot_bel_btl+$tot_bel_bl,"2",",",".")."<b></td>
                                <td valign=\"top\" align=\"right\" style=\"font-size:12px\">".$this->tukd_model->persen_real($tot_p_seluruh,$tot_r_seluruh) ."</td>
                              </tr>  ";

                   
        $cRet .="</table>";
		
		$nip = str_replace('a',' ',$ttd);

 $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip='$nip' AND kode='BUD'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }

				$tanggal_ttd = date('d-m-Y');
				$cRet .='<TABLE style="border-collapse:collapse; font-size:12px" width="100%" border="0" cellspacing="0" cellpadding="0" align=center>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$daerah.', '.$tanggal_ttd.'</TD>
					</TR>
					
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$jabatan.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" ><b><u>'.$nama.'</u></b><br>'.$pangkat.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$nip.'</TD>
					</TR>
					</TABLE><br/>';
		
        $data['prev']= $cRet;    
		if ($print==1){
				$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'1'); 

		} else{
		echo ("<title>REGISTER SP2D</title>");
  	    echo $cRet;
		}
		//echo("$cRet");   
    }
	
	
	
	 function cetak_register_pajak($dcetak='',$ttd='',$skpd='',$tstatus='',$dcetak2='',$cetak=1){ //Tox

	$print = $cetak;
    $tahun  = $this->session->userdata('pcThang');
    $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
		$where2='';
		  switch ($tstatus) 
                    {
                        case '1': //UP
						$where2='';
                            break;
                        case '2': //GU
							$where2=" and status_bud=1 ";
                            break;
                        case '3': //TU
                            $where2=" and no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) ";
                            break;
                        case '4': //LS gaji
                           $where2=" and status_bud <> 1 ";
                            break;                            
                    }
					
                           $where3=" and ( tgl_sp2d between '$dcetak' and '$dcetak2') ";
						   
		/*        $kd = $this->uri->segment(3);
        if ($kd <> ''){
            $a ='SKPD :';
        $sqls="SELECT nm_skpd FROM ms_skpd where kd_skpd='$kd'";
                 $sqls =$this->db->query($sqls);
                 foreach ($sqls->result() as $row)
                {
                    $nama     = $row->nm_skpd;
                    
                   
                }
        } */
		
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"15\"><b> $kab</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"15\"><b>DAFTAR POTONGAN SP2D <br> TAHUN ANGGARAN $tahun</b></td>
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b> $a $nama</b><br>&nbsp;</td>
        </tr>
		</tr>  
		<tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2 width=\"2%\" ><b>NO.<br>Urut</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2width=\"5%\" ><b>Kode <br>SKPD</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2 width=\"20%\" ><b>Nama SKPD</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" colspan=6 width=\"60%\" ><b>Potongan</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2 width=\"10%\" ><b>TOTAL POTONGAN</b></td>
        </tr>           
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>PPH 21</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>PPH 22</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>PPH 23</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>Pasal 4<br>Ayat 2</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>PPN</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>LAINNYA</b></td>
        </tr>           
          <tr>
            <td style=\"font-size:10px\" align=\"center\" ><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>5</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>6</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>7</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>8</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>9</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>10</b></td>
          </tr>
		            </thead>";
		  
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $skpd;
        $where ="where c.sp2d_batal=1 ";
        if ($kriteria <> '--'){                               
            $where=" where  c.sp2d_batal=1 and a.kd_skpd ='$kriteria' ";            
        }       
		
        $sql = "SELECT b.kd_skpd,b.nm_skpd,
				sum(case when d.kd_rek5='2130301' then d.nilai else 0  end)PPN,
				sum(case when d.kd_rek5='2130101' then d.nilai else 0  end)pph21,
				sum(case when d.kd_rek5='2130201' then d.nilai else 0  end)pph22,
				sum(case when d.kd_rek5='2130401' then d.nilai else 0  end)pph23,
				sum(case when d.kd_rek5='2110901' then d.nilai else 0  end)PPnpn,
				sum(case when d.kd_rek5='2130501' then d.nilai else 0  end)PP4,
				sum(case when d.kd_rek5='2110801' then d.nilai else 0  end)hkpg,
				sum(case when d.kd_rek5='2110501' then d.nilai else 0  end)taperum,
				sum(case when d.kd_rek5='2110101' then d.nilai else 0  end)taspen,
				sum(case when d.kd_rek5='2110701' then d.nilai else 0  end)iwp,
				sum(case when d.kd_rek5 not in ('2130301','2130101','2130201','2130401','2110901','2130501','2110801','2110501','2110101','2110701') then d.nilai else 0  end)lain
				FROM TRHSPM a inner JOIN TRHSP2D b ON a.no_spm=b.no_spm 
				inner join TRHSPp c on a.no_spp=c.no_spp
				left join trspmpot d on a.no_spm=d.no_spm $where $where2 $where3 group by b.kd_skpd,b.nm_skpd";
		
                $hasil = $this->db->query($sql);
                $lcno = 0;
				 $t_PPN= 0;
                    $t_pph21=0;
                    $t_pph22=0;
                    $t_pph23=0;
                    $t_PPnpn=0;
                    $t_PP4=0;
                    $t_hkpg=0;
                    $t_taperum=0;
                    $t_taspen=0;
                    $t_iwp=0;
                    $t_lain=0;
                    $t_lain2=0;
                    $t_total_pjk=0;

					foreach ($hasil->result() as $row)
                {
                    $kd_skpd=$row->kd_skpd;
                    $nm_skpd= $row->nm_skpd;
                    $n_PPN= $row->PPN;
                    $n_pph21= $row->pph21;
                    $n_pph22= $row->pph22;
                    $n_pph23= $row->pph23;
                    $n_PPnpn= $row->PPnpn;
					$n_PP4= $row->PP4;
					$n_hkpg= $row->hkpg;
					$n_taperum= $row->taperum;
					$n_taspen= $row->taspen;
					$n_iwp= $row->iwp;
					$n_lain= $row->lain;
					
					$lain2=$n_hkpg+$n_taperum+$n_taspen+$n_iwp+$n_lain+$n_PPnpn;
					$total_pjk=$n_PPN+$n_pph21+$n_pph22+$n_pph23+$n_PP4+$lain2;
					
					  $t_PPN=$t_PPN+$n_PPN;
					    $t_pph21=$t_pph21+$n_pph21;
						  $t_pph22=$t_pph22+$n_pph22;
						    $t_pph23=$t_pph23+$n_pph23;
							  $t_PPnpn=$t_PPnpn+$n_PPnpn;
								
                    $t_PP4= $t_PP4+$n_PP4;
                    $t_hkpg= $t_hkpg+$n_hkpg;
                    $t_taperum= $t_taperum+$n_taperum;
                    $t_taspen=$t_taspen+$n_taspen;
                    $t_iwp= $t_iwp+$n_iwp;
                    $t_lain= $t_lain+$n_lain;

					$t_lain2=$t_lain2+$lain2;
					
					$t_total_pjk=$t_total_pjk+$total_pjk;

                    $lcno = $lcno + 1;
                    
                    $cRet .=  "<tr>
                                <td align=\"center\" style=\"font-size:12px\">$lcno</td>
                                <td align=\"center\" style=\"font-size:12px\">$kd_skpd</td>
                                <td align=\"center\" style=\"font-size:12px\">$nm_skpd</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_pph21,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_pph22,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_pph23,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_PP4,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_PPN,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($lain2,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($total_pjk,"2",".",",")."</td>
                              </tr>  "; 
                   
                }

                    $cRet .=  "<tr  style=\"font-size:12px;font-weight:bold;\">
                                <td align=\"center\" style=\"font-size:12px\" colspan=3> Jumlah</td>
                                 <td align=\"right\" style=\"font-size:12px\">".number_format($t_pph21,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_pph22,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_pph23,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_PP4,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_PPN,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_lain2,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_total_pjk,"2",".",",")."</td>
                              </tr>  "; 
                   
  
				
        $cRet .="</table>";
        $data['prev']= $cRet;    
		if ($print==1){
				$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'1'); 

		} else{
		  echo $cRet;
		}
		//echo("$cRet");   
    }
	
	
	function cetak_register_pajak_detail($dcetak='',$ttd='',$skpd='',$tstatus='',$dcetak2='',$cetak=1){ //Tox

	$print = $cetak;
    $tahun  = $this->session->userdata('pcThang');
    $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                   
                }
                
        $kd ='';
        $a ='';
        $nama ='';
		$where2='';
		  switch ($tstatus) 
                    {
                        case '1': //UP
						$where2='';
                            break;
                        case '2': //GU
							$where2=" and status_bud=1 ";
                            break;
                        case '3': //TU
                            $where2=" and b.no_sp2d in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) ";
                            break;
                        case '4': //LS gaji
                           $where2=" and status_bud <> 1 ";
                            break;                            
                    }
					
                           $where3=" and ( b.tgl_sp2d between '$dcetak' and '$dcetak2') ";
						   
		/*        $kd = $this->uri->segment(3);
        if ($kd <> ''){
            $a ='SKPD :';
        $sqls="SELECT nm_skpd FROM ms_skpd where kd_skpd='$kd'";
                 $sqls =$this->db->query($sqls);
                 foreach ($sqls->result() as $row)
                {
                    $nama     = $row->nm_skpd;
                    
                   
                }
        } */
				
        $cRet = "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"1\" cellpadding=\"1\">";
        $cRet .="<thead>
        <tr>
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"15\"><b> $kab</b></td>            
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px white;\" colspan=\"15\"><b>DAFTAR POTONGAN SP2D <br> TAHUN ANGGARAN $tahun</b></td>
        </tr>
        <tr>            
            <td align=\"center\" style=\"font-size:14px;border: solid 1px white;border-bottom:solid 1px black;\" colspan=\"15\"><b> $a $nama</b><br>&nbsp;</td>
        </tr>
		</tr>  
		<tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2 width=\"2%\" ><b>NO.<br>Urut</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2 width=\"5%\" ><b>Kode <br>Tanggal</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2 width=\"8%\" ><b>No SP2D</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2 width=\"20%\" ><b>Uraian</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" rowspan=2 width=\"10%\" ><b>Jumlah SP2D</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" colspan=6 width=\"60%\" ><b>POTONGAN</b></td>
        </tr>           
        <tr>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>PPH 21</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>PPH 22</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>PPH 23</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>Pasal 4<br>Ayat 2</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>PPN</b></td>
            <td style=\"font-size:10px\" bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\" ><b>LAINNYA</b></td>
        </tr>           
          <tr>
            <td style=\"font-size:10px\" align=\"center\" ><b>1</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>2</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>3</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>4</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>5</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>6</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>7</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>8</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>9</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>10</b></td>
            <td style=\"font-size:10px\" align=\"center\" ><b>11</b></td>
			</tr>
		  </thead>";
		  
        //$skpd = $this->uri->segment(3); 
        $kriteria = '';
        $kriteria = $skpd;
        $where ="where c.sp2d_batal=1 ";
        if ($kriteria <> '--'){                               
            $where=" where  c.sp2d_batal=1 and a.kd_skpd ='$kriteria' ";            
        }       
        		
			$sql = " SELECT b.tgl_sp2d,b.no_sp2d,b.keperluan,sum(b.nilai)nsp2d,
				sum(case when d.kd_rek5='2130301' then d.nilai else 0  end)PPN,
				sum(case when d.kd_rek5='2130101' then d.nilai else 0  end)pph21,
				sum(case when d.kd_rek5='2130201' then d.nilai else 0  end)pph22,
				sum(case when d.kd_rek5='2130401' then d.nilai else 0  end)pph23,
				sum(case when d.kd_rek5='2110901' then d.nilai else 0  end)PPnpn,
				sum(case when d.kd_rek5='2130501' then d.nilai else 0  end)PP4,
				sum(case when d.kd_rek5='2110801' then d.nilai else 0  end)hkpg,
				sum(case when d.kd_rek5='2110501' then d.nilai else 0  end)taperum,
				sum(case when d.kd_rek5='2110101' then d.nilai else 0  end)taspen,
				sum(case when d.kd_rek5='2110701' then d.nilai else 0  end)iwp,
				sum(case when d.kd_rek5 not in ('2130301','2130101','2130201','2130401','2110901','2130501','2110801','2110501','2110101','2110701') then d.nilai else 0  end)lain
				FROM TRHSPM a inner JOIN TRHSP2D b ON a.no_spm=b.no_spm 
				inner join TRHSPp c on a.no_spp=c.no_spp
				left join trspmpot d on a.no_spm=d.no_spm $where $where2 $where3 group by b.tgl_sp2d,b.no_sp2d,b.keperluan";
				
                $hasil = $this->db->query($sql);
                $lcno = 0;
					$t_PPN= 0;
					$t_sp2d=0;
                    $t_pph21=0;
                    $t_pph22=0;
                    $t_pph23=0;
                    $t_PPnpn=0;
                    $t_PP4=0;
                    $t_hkpg=0;
                    $t_taperum=0;
                    $t_taspen=0;
                    $t_iwp=0;
                    $t_lain=0;
                    $t_lain2=0;
                    $t_total_pjk=0;

				foreach ($hasil->result() as $row)
                {					
                    $no_sp2d=$row->no_sp2d;
                    $keperluan= $row->keperluan;
					$n_sp2d= $row->nsp2d;
					$tgl_sp2d=$row->tgl_sp2d;
                    $n_PPN= $row->PPN;
                    $n_pph21= $row->pph21;
                    $n_pph22= $row->pph22;
                    $n_pph23= $row->pph23;
                    $n_PPnpn= $row->PPnpn;
					$n_PP4= $row->PP4;
					$n_hkpg= $row->hkpg;
					$n_taperum= $row->taperum;
					$n_taspen= $row->taspen;
					$n_iwp= $row->iwp;
					$n_lain= $row->lain;
					
					$lain2=$n_hkpg+$n_taperum+$n_taspen+$n_iwp+$n_lain+$n_PPnpn;
					$total_pjk=$n_PPN+$n_pph21+$n_pph22+$n_pph23+$n_PP4+$lain2;
					
					$t_sp2d=$t_sp2d+$n_sp2d;
					$t_PPN=$t_PPN+$n_PPN;
					$t_pph21=$t_pph21+$n_pph21;
					$t_pph22=$t_pph22+$n_pph22;
					$t_pph23=$t_pph23+$n_pph23;
					$t_PPnpn=$t_PPnpn+$n_PPnpn;
								
                    $t_PP4= $t_PP4+$n_PP4;
                    $t_hkpg= $t_hkpg+$n_hkpg;
                    $t_taperum= $t_taperum+$n_taperum;
                    $t_taspen=$t_taspen+$n_taspen;
                    $t_iwp= $t_iwp+$n_iwp;
                    $t_lain= $t_lain+$n_lain;

					$t_lain2=$t_lain2+$lain2;
					
					$t_total_pjk=$t_total_pjk+$total_pjk;

                    $lcno = $lcno + 1;
                    
                    $cRet .=  "<tr>
                                <td align=\"center\" style=\"font-size:12px\">$lcno</td>
								<td align=\"center\" style=\"font-size:12px\">".$this->tanggal_indonesia($tgl_sp2d)."</td>
                                <td align=\"center\" style=\"font-size:12px\">$no_sp2d</td>
                                <td align=\"left\" style=\"font-size:12px\">$keperluan</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_sp2d,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_pph21,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_pph22,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_pph23,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_PP4,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($n_PPN,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($lain2,"2",".",",")."</td>
                              </tr>  "; 
                   
                }
				
                    $cRet .=  "<tr  style=\"font-size:12px;font-weight:bold;\">
                                <td align=\"center\" style=\"font-size:12px\" colspan=4> Jumlah</td>
								<td align=\"right\" style=\"font-size:12px\">".number_format($t_sp2d,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_pph21,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_pph22,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_pph23,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_PP4,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_PPN,"2",".",",")."</td>
                                <td align=\"right\" style=\"font-size:12px\">".number_format($t_lain2,"2",".",",")."</td>
                              </tr>  "; 
                   
  
				
        $cRet .="</table>";
        $data['prev']= $cRet;    
		if ($print==1){
				$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'1'); 

		} else{
		  echo $cRet;
		}
		//echo("$cRet");   
    }
    
	function spd1_ag($jenis='',$tgl_spp='') {
		if ($jenis=='4') {
			$jenis = '51';
		}
		else {
			$jenis='52';
		}
        $skpd  = $this->session->userdata('kdskpd');
		if ($tgl_spp==''){
        $sql   = " select no_spd, tgl_spd from trhspd where kd_skpd='$skpd' and jns_beban='$jenis'";
		}else{
        $sql   = " select no_spd, tgl_spd from trhspd where kd_skpd='$skpd' and jns_beban='$jenis' and tgl_spd<='$tgl_spp' ";
        }
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],  
                        'tgl_spd' => $resulte['tgl_spd']  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	
		function load_ttd($ttd){
        $kd_skpd = $this->session->userdata('kdskpd'); 		
		$sql = "SELECT * FROM ms_ttd WHERE kd_skpd= '$kd_skpd' and kode='$ttd'";

        $mas = $this->db->query($sql);
        $result = array();
        $ii = 0;        
        foreach($mas->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],
                        'jabatan' => $resulte['jabatan']
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $mas->free_result();
    	   
	}
	
	function load_ttd_ppkd($ttd){
        $kd_skpd = $this->session->userdata('kdskpd'); 
		$sql = "SELECT * FROM ms_ttd WHERE kode='$ttd'";

        $mas = $this->db->query($sql);
        $result = array();
        $ii = 0;        
        foreach($mas->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],
                        'jabatan' => $resulte['jabatan']
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $mas->free_result();
    	   
	}
	
	function skpd_ppkd() {
		$kd_skpd = $this->session->userdata('kdskpd');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where kd_skpd = '$kd_skpd' ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result(); 	  
	}
	function total_spd_ppkd() {  
        
        $ckdkegi  = $this->input->post('kegiatan');
        $ckdskpd  = $this->input->post('kd_skpd');
        $tglspd   = $this->input->post('tglspd');
        $beban   = $this->input->post('beban');
        $kd_rek5   = $this->input->post('kdrek5');
        if($beban==4){
			$query1   = $this->db->query(" SELECT  a.kd_kegiatan, a.kd_rek5, SUM(a.nilai) as nilai FROM trdspd a INNER JOIN trhspd b ON a.no_spd=b.no_spd 
			where kd_skpd = '$ckdskpd' and  a.kd_kegiatan = '$ckdkegi' AND a.kd_rek5='$kd_rek5' GROUP BY a.kd_kegiatan, a.kd_rek5
			");
			  
		} else{
			$query1   = $this->db->query(" SELECT  a.kd_kegiatan, SUM(a.nilai) as nilai FROM trdspd a INNER JOIN trhspd b ON a.no_spd=b.no_spd 
			where kd_skpd = '$ckdskpd' and  a.kd_kegiatan = '$ckdkegi' GROUP BY a.kd_kegiatan
			");    
		}
        
        $result   = array();
        $ii       = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id'             => $ii,        
                        'nilai'          => number_format($resulte['nilai'],2,'.',','),
                       // 'nilai_spp_lalu' => number_format($resulte['rektotal_spp_lalu'],2,'.',',')
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();	
    }
	//Tambahan Anguz
	function rth(){
        $data['page_title']= 'RTH';
        $this->template->set('title', 'RTH');   
        $this->template->load('template','tukd/transaksi/rth',$data) ; 
    }
	function _mpdf_sp2d($judul='',$isi='',$lMargin='',$rMargin='',$font=0,$orientasi='') {
        
        ini_set("memory_limit","-1");
        ini_set("MAX_EXECUTION_TIME","-1");
        $this->load->library('mpdf');
        
        
        $this->mpdf->defaultheaderfontsize = 6;	/* in pts */
        $this->mpdf->defaultheaderfontstyle = BI;	/* blank, B, I, or BI */
        $this->mpdf->defaultheaderline = 1; 	/* 1 to include line below header/above footer */

        $this->mpdf->defaultfooterfontsize = 6;	/* in pts */
        $this->mpdf->defaultfooterfontstyle = BI;	/* blank, B, I, or BI */
        $this->mpdf->defaultfooterline = 1; 
        $this->mpdf->SetLeftMargin = $lMargin;
        $this->mpdf->SetRightMargin = $rMargin;
        $jam = date("H:i:s");
		$this->mpdf = new mPDF('utf-8', array(215,330),$size); //folio
        $this->mpdf->AddPage($orientasi,'','',1,1,$lMargin,$rMargin,15,5);
		//$this->mpdf->SetFooter("Printed on Simakda || Halaman {PAGENO} ");
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
        $this->mpdf->writeHTML($isi);      
        $this->mpdf->Output();
    }
	function _mpdf_daftar_penguji($judul='',$isi='',$lMargin=10,$rMargin=10,$font='',$orientasi='',$hal='', $fonsize='',$atas='', $bawah='', $kiri='', $kanan='') {

        ini_set("memory_limit","-1");
        ini_set("MAX_EXECUTION_TIME","-1");
        $this->load->library('mpdf');
        
      $header = array (
  'odd' => array (
    'L' => array (
      'content' => '  ',
      'font-size' => 11,
      'font-style' => '',
      'font-family' => 'arial',
      'color'=>'#000000'
    ),
    'C' => array (
      'content' => ' ',
      'font-size' => 15,
      'font-style' => 'B',
      'font-family' => 'arial',
      'color'=>'#000000'
    ),
    'R' => array (
      'content' => '<br>Lembaran ke {PAGENO} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <br> Terdiri dari {nb} lembar ',
      'font-size' => 10,
      'font-style' => '',
      'font-family' => 'arial',
      'color'=>'#000000'
    ),
    'line' => 0,
  ),
  'even' => array ()
);

        $this->mpdf->SetLeftMargin = $lMargin;
        $this->mpdf->SetRightMargin = $rMargin;
        $jam = date("H:i:s");

		$this->mpdf = new mPDF('utf-8',array(215,330),$size); //folio
				//$this->mpdf->SetHeader($header,'');

        $this->mpdf->AddPage($orientasi,'',1,1,'',$kiri,$kanan,$atas,$bawah);
		//$this->mpdf->SetHeader(" || Halaman {PAGENO} ");
		//$this->mpdf->SetHeader($header,'');
		//$this->mpdf->SetFooter("Printed on Simakda || Halaman {PAGENO} ");
		//$PageCount =  $this->mpdf->getPageCount();		
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
		
		//$isi = str_replace('$page', $this->mpdf->getPageCount(), $isi);
		
        $this->mpdf->writeHTML($isi);      
		//$this->mpdf->WriteHTML("ewe".$PageCount."2323");		
        $this->mpdf->Output();
    }
	
	function _mpdf_sp2d2($judul='',$isi='',$lMargin='',$rMargin='',$font=0,$orientasi='') {
        
        ini_set("memory_limit","-1");
        ini_set("MAX_EXECUTION_TIME","-1");
        $this->load->library('mpdf');
        
        
        $this->mpdf->defaultheaderfontsize = 6;	/* in pts */
        $this->mpdf->defaultheaderfontstyle = BI;	/* blank, B, I, or BI */
        $this->mpdf->defaultheaderline = 1; 	/* 1 to include line below header/above footer */

        $this->mpdf->defaultfooterfontsize = 6;	/* in pts */
        $this->mpdf->defaultfooterfontstyle = BI;	/* blank, B, I, or BI */
        $this->mpdf->defaultfooterline = 1; 
        $this->mpdf->SetLeftMargin = $lMargin;
        $this->mpdf->SetRightMargin = $rMargin;
        $jam = date("H:i:s");
		$this->mpdf = new mPDF('utf-8', array(215.9,330.2),$size); //folio
        $this->mpdf->AddPage($orientasi,'','',1,1,$lMargin,$rMargin,15,5);
		//$this->mpdf->SetFooter("Printed on Simakda || Halaman {PAGENO} ");
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
        $this->mpdf->writeHTML($isi);      
        $this->mpdf->Output();
    }
	
	
	function cetak_rth($nbulan='',$ctk='',$ttd='', $tgl=''){
        $nip = str_replace('123456789',' ',$ttd);
		$tanggal_ttd = $this->tukd_model->tanggal_format_indonesia($tgl);
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                 {
                    $kab     = $rowsc->kab_kota;
                    $prov     = $rowsc->provinsi;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                 }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where nip='$nip' AND kode='BUD'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                    $pangkat  = $rowttd->pangkat;
                }
       
		
			$cRet ='<TABLE style="border-collapse:collapse; font-size:14px" width="100%" border="0" cellspacing="0" cellpadding="1" align=center>
					<TR>
						<TD align="center" ><b>REKAPITULASI TRANSAKSI HARIAN BELANJA DAERAH (RTH) </TD>
					</TR>
					<tr></tr>
                    <TR>
					<TD align="center" ><b>PEMERINTAH KOTA '.strtoupper($daerah).'	 <br>
					BULAN '.strtoupper($this->tukd_model->getBulan($nbulan)).'</TD>
					</TR>
					</TABLE><br/>';			

			$cRet .='<TABLE style="border-collapse:collapse; font-size:12px" width="100%" border="1" cellspacing="0" cellpadding="3" align=center>
					 <thead>
					 <TR>
						<TD rowspan="2" bgcolor="#CCCCCC" align="center" >No.</TD>
                        <TD rowspan="2" bgcolor="#CCCCCC" align="center" >NAMA SKPD / BUD</TD>
						<TD colspan="2" bgcolor="#CCCCCC" align="center" >SPM / SPD </TD>
						<TD colspan="2" bgcolor="#CCCCCC" align="center" >SP2D</TD>
						<TD rowspan="2" bgcolor="#CCCCCC" align="center" >POTONGAN PAJAK</TD>
						<TD rowspan="2" bgcolor="#CCCCCC" align="center" >KET</TD>
					 </TR>
					 <TR>
                        <TD bgcolor="#CCCCCC" align="center" >JUMLAH<BR>TOTAL</TD>
						<TD bgcolor="#CCCCCC" align="center" >NILAI BELANJA<BR>TOTAL</TD>						
						<TD bgcolor="#CCCCCC" align="center" >JUMLAH<BR>TOTAL </TD>
						<TD bgcolor="#CCCCCC" align="center" >NILAI BELANJA<BR>TOTAL</TD>
					 </TR>
					 </thead>
					 ';
		
			$query = $this->db->query("exec cetak_rth $nbulan");
			$no=0;
			$tot_spm=0;
			$totNilspm=0;
			$tot_sp2d=0;
			$totNilsp2d=0;
			$totNilpot=0;
			   foreach ($query->result() as $row) {
				$no=$no+1;
				$kd_skpd = $row->kd_skpd; 
				$nm_skpd = $row->nm_skpd;                   
				$banyak_spm = $row->banyak_spm;                   
				$nil_spm = $row->nil_spm;                   
				$banyak_sp2d = $row->banyak_sp2d;
				$nil_sp2d =$row->nil_sp2d;
				$nil_pot=$row->nil_pot;
				$tot_spm=$tot_spm + $banyak_spm;
				$totNilspm=$totNilspm + $nil_spm;
				$tot_sp2d=$tot_sp2d + $banyak_sp2d;
				$totNilsp2d=$totNilsp2d + $nil_sp2d;
				$totNilpot=$totNilpot + $nil_pot;
				$banyak_spm1  = empty($banyak_spm) || $banyak_spm == 0 ? 0 :$banyak_spm;	
				$nil_spm1  = empty($nil_spm) || $nil_spm == 0 ? number_format(0,"2",",",".") :number_format($nil_spm,"2",",",".");	
				$banyak_sp2d1 = empty($banyak_sp2d) || $banyak_sp2d == 0 ? 0 :$banyak_sp2d;	
				$nil_sp2d1  = empty($nil_sp2d) || $nil_sp2d == 0 ? number_format(0,"2",",",".") :number_format($nil_sp2d,"2",",",".");	
				$nil_pot1  = empty($nil_pot) || $nil_pot == 0 ? number_format(0,"2",",",".") :number_format($nil_pot,"2",",",".");
			   
				$cRet .="<tr>
						<td valign=\"top\" align=\"center\"> $no </td>
						<td valign=\"top\" align=\"left\"> $nm_skpd </td>
						<td valign=\"top\" align=\"center\"> $banyak_spm1 </td>
						<td valign=\"top\" align=\"right\"> $nil_spm1 &nbsp;</td>
						<td valign=\"top\" align=\"center\"> $banyak_sp2d1 </td>
						<td valign=\"top\" align=\"right\"> $nil_sp2d1 &nbsp;</td>
						<td valign=\"top\" align=\"right\"> $nil_pot1 &nbsp;</td>
						<td valign=\"top\" align=\"right\"> &nbsp;</td>
						</tr>"  ;
				}	
				$cRet .="<tr>
						<td valign=\"top\" align=\"center\"><b> TOTAL </b></td>
						<td valign=\"top\" align=\"center\"><b> $no </b></td>
						<td valign=\"top\" align=\"center\"><b> $tot_spm</b> </td>
						<td valign=\"top\" align=\"right\"><b> ".number_format($totNilspm,"2",",",".")." </b>&nbsp;</td>
						<td valign=\"top\" align=\"center\"><b> $tot_sp2d </b></td>
						<td valign=\"top\" align=\"right\"> <b>".number_format($totNilsp2d,"2",",",".")."</b> &nbsp;</td>
						<td valign=\"top\" align=\"right\"><b> ".number_format($totNilpot,"2",",",".")."</b> &nbsp;</td>
						<td valign=\"top\" align=\"right\"> &nbsp;</td>
						</tr>"  ;
				   
			
				
			$cRet .='</TABLE>';
			
			$cRet .='<TABLE style="border-collapse:collapse; font-size:12px" width="100%" border="0" cellspacing="0" cellpadding="0" align=center>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$daerah.', '.$tanggal_ttd.'</TD>
					</TR>
					
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$jabatan.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
					<TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" ><b><u>'.$nama.'</u></b><br>'.$pangkat.'</TD>
					</TR>
                    <TR>
						<TD width="50%" align="center" ><b>&nbsp;</TD>
						<TD align="center" >'.$nip.'</TD>
					</TR>
					</TABLE><br/>';

			$data['prev']= $cRet;
             switch ($ctk)
        {
            case 0;
			echo ("<title>RTH</title>");
				echo $cRet;
				break;
            case 1;
				$this->_mpdf('',$cRet,10,10,10,'P',1,'');
               break;
			case 2;        
				header("Cache-Control: no-cache, no-store, must-revalidate");
				header("Content-Type: application/vnd.ms-excel");
				header("Content-Disposition: attachment; filename=RTH_$nbulan.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
			break;   
		}
	}
	function _mpdf($judul='',$isi='',$lMargin=10,$rMargin=10,$font='',$orientasi='',$hal='', $fonsize='') {
                

        ini_set("memory_limit","-1M");
        ini_set("MAX_EXECUTION_TIME","-1");
        $this->load->library('mpdf');
		//$this->mpdf->SetHeader('||Halaman {PAGENO} /{nb}');
        
        
        $this->mpdf->defaultheaderfontsize = 10;	/* in pts */
        $this->mpdf->defaultheaderfontstyle = I;	/* blank, B, I, or BI */
        $this->mpdf->defaultheaderline = 1; 	/* 1 to include line below header/above footer */

        $this->mpdf->defaultfooterfontsize = 3;	/* in pts */
        $this->mpdf->defaultfooterfontstyle = I;	/* blank, B, I, or BI */
        $this->mpdf->defaultfooterline = 1; 
		$sa=1;
		$tes=0;
		if ($hal==''){
		$hal1=1;
		} 
		if($hal!==''){
		$hal1=$hal;
		}
		if ($fonsize==''){
		$size=12;
		}else{
		$size=$fonsize;
		} 
		
		$this->mpdf = new mPDF('utf-8', array(215,330),$size); //folio
							//$this->mpdf->useOddEven = 1;						

        $this->mpdf->AddPage($orientasi,'',$hal,'1','off');
		if ($hal==''){
			$this->mpdf->SetFooter("");
		}
		else{
			$this->mpdf->SetFooter("Printed on Simakda || Halaman {PAGENO}  ");
		}
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
        $this->mpdf->writeHTML($isi);         
        $this->mpdf->Output();
    }
	
	function simpan_sp2d(){
			$no_spp = $this->input->post('no_spp');
			$no_spm = $this->input->post('no_spm');
			//$no_sp2d = $this->input->post('no_sp2d');
			$kd_skpd = $this->input->post('cskpd');
			$keperluan = $this->input->post('keperluan');
			$jns_spp = $this->input->post('jns_spp');
			$jns_beban = $this->input->post('jenis');
			$tgl_spp = $this->input->post('tgl_spp');
			$tgl_spm = $this->input->post('tgl_spm');
			$tgl_sp2d = $this->input->post('tgl_sp2d');                        
			$bulan = $this->input->post('bulan');                        
			$spd = $this->input->post('cspd');
			$bank= $this->input->post('bank');
			$nmrekan= $this->input->post('rekanan');
			$no_rek= $this->input->post('rekening');
			$npwp= $this->input->post('npwp');
			$nm_skpd= $this->input->post('nmskpd');
			$nilai= $this->input->post('nilai');
			$dir = $this->input->post('dir');
			$usernm= $this->session->userdata('pcNama');
			$sp2d_blk=$this->input->post('sp2d_blk');
			//date_default_timezone_set('Asia/Bangkok');
			$last_update=  "";
			$no_sementara = $this->input->post('no_sp2d');
			$lcstatus_input= $this->input->post('lcstatus_input');
			$no_sp2d_tag = $this->input->post('no_sp2d_tag');
			$nomor_urut='';
            
            
            $sqql = "select COUNT(*) as jum from trhsp2d where no_sp2d='$no_sementara'";
            $asg7 = $this->db->query($sqql)->row(); 
            
            if($asg7->jum>0){
                echo '3';
            }else{
            
			$real_no_sp2d='7777';
			$lc_save='2';
//						echo $real_no_sp2d;
            
            
                    
           /* $sql = "delete from trhsp2d where kd_skpd='$kd_skpd' and no_sp2d='$no_sp2d'";
           $asg = $this->db->query($sql);    */
		   if ($lcstatus_input=='tambah'){ 
		   $query2 ="insert into trhsp2d(no_sp2d,tgl_sp2d,no_spm,tgl_spm,no_spp,kd_skpd,nm_skpd,tgl_spp,bulan,no_spd,keperluan,username,last_update,status,jns_spp,bank,nmrekan,no_rek,npwp,nilai,status_terima,jenis_beban) 
                    values('$no_sementara','$tgl_sp2d','$no_spm','$tgl_spm','$no_spp','$kd_skpd','$nm_skpd','$tgl_spp','$bulan','$spd','$keperluan','$usernm','$last_update','0','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nilai','0','$jns_beban') ";
			} else{
	
			 $query2 = " UPDATE trhsp2d SET no_sp2d='$no_sp2d_tag',tgl_sp2d='$tgl_sp2d', no_spm='$no_spm', tgl_spm='$tgl_spm', bulan='$bulan', kd_skpd='$kd_skpd',
			 nm_skpd='$nm_skpd', no_spp='$no_spp', tgl_spp='$tgl_spp', no_spd='$spd', username='$usernm', status='0', last_update='$last_update',
			 keperluan='$keperluan', jns_spp='$jns_spp', no_rek='$no_rek', bank='$bank',nmrekan='$nmrekan',npwp='$npwp',nilai='$nilai' where no_sp2d='$no_sp2d_tag' "; 
		
  //  $query2 ="insert into trhsp2d(no_sp2d,tgl_sp2d,no_spm,tgl_spm,no_spp,kd_skpd,nm_skpd,tgl_spp,bulan,no_spd,keperluan,username,last_update,status,jns_spp,bank,nmrekan,no_rek,npwp,nilai,status_terima,jenis_beban) 
    //                values('$no_sementara','$tgl_sp2d','$no_spm','$tgl_spm','$no_spp','$kd_skpd','$nm_skpd','$tgl_spp','$bulan','$spd','$keperluan','$usernm','$last_update','0','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nilai','0','$jns_beban') ";	
			}           
			$asg2 = $this->db->query($query2); 
          
          $query1="update trhspm set status='1' where no_spm='$no_spm'";
          $asg3 = $this->db->query($query1);
		   if($asg3){
                $lc_save='1';
            }else{
                $lc_save='2';
            }
            
            /*
			
		  // untuk sementara sp2d manual		
		//get nomor sp2d by tox
		//if ($jns_spp<>'4'){
		if ($lcstatus_input=='tambah'){
			$sql = "insert into nomor_sp2d (no_sp2d) values ('$no_sementara')";
            $asg = $this->db->query($sql);
            if($asg){
                $lc_save='1';
            }else{
                $lc_save='2';
            }
			
			
		$hasil=$this->db->query(" select nomor FROM  nomor_sp2d where no_sp2d='$no_sementara' ");
		foreach ($hasil->result_array() as $row){
		$nomor_urut=$row['nomor'];	
		}
		$real_no_sp2d =strval($nomor_urut).$sp2d_blk;
		
            $sql = "update nomor_sp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sementara'";
            $asg = $this->db->query($sql);
            if($asg){
               // echo $real_no_sp2d;
			   $lc_save='1';
            }else{
				echo '2';                
            }
			
		$sql = "update trhsp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sementara'";
            $asg = $this->db->query($sql);
            if($asg){
              $lc_save='1';
            }else{
                $lc_save='2';
            }
		}
		 else{
		// sp2d ini sementara manual dulu by tox
				
		$hasil=$this->db->query(" select nomor FROM  nomor_sp2d where no_sp2d='$no_sp2d_tag' ");
		foreach ($hasil->result_array() as $row){
		$nomor_urut=$row['nomor'];	
		}
		$real_no_sp2d =strval($nomor_urut).$sp2d_blk;
		
            $sql = "update nomor_sp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sp2d_tag'";
            $asg = $this->db->query($sql);
            if($asg){
                $lc_save='1';
            }else{
                $lc_save='2';
            }	  
			
		$sql = "update trhsp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sp2d_tag'";
            $asg = $this->db->query($sql);
            if($asg){
               
            $lc_save='1';
            }else{
                $lc_save='2';
            }			

			}
		//}
        */
		
		if ($lc_save=='1')
		{  
			//echo json_encode($real_no_sp2d);
            echo json_encode($no_sementara);
		}
		else
		{
			echo '2';
			}
        }       
         
	}
	
	function simpan_sp2d_gj(){
			$no_spp = $this->input->post('no_spp');
			$no_spm = $this->input->post('no_spm');
			//$no_sp2d = $this->input->post('no_sp2d');
			$kd_skpd = $this->input->post('cskpd');
			$keperluan = $this->input->post('keperluan');
			$jns_spp = $this->input->post('jns_spp');
			$jns_beban = $this->input->post('jenis');
			$tgl_spp = $this->input->post('tgl_spp');
			$tgl_spm = $this->input->post('tgl_spm');
			$tgl_sp2d = $this->input->post('tgl_sp2d');                        
			$bulan = $this->input->post('bulan');                        
			$spd = $this->input->post('cspd');
			$bank= $this->input->post('bank');
			$nmrekan= $this->input->post('rekanan');
			$no_rek= $this->input->post('rekening');
			$npwp= $this->input->post('npwp');
			$nm_skpd= $this->input->post('nmskpd');
			$nilai= $this->input->post('nilai');
			$dir = $this->input->post('dir');
			$usernm= $this->session->userdata('pcNama');
			$sp2d_blk=$this->input->post('sp2d_blk');
			//date_default_timezone_set('Asia/Bangkok');
			$last_update=  "";
			$no_sementara = $this->input->post('no_sp2d');
			$lcstatus_input= $this->input->post('lcstatus_input');
			$no_sp2d_tag = $this->input->post('no_sp2d_tag');
			$nomor_urut='';
			$real_no_sp2d='7777';
            
             $sqql = "select COUNT(*) as jum from trhsp2d where no_sp2d='$no_sementara'";
            $asg7 = $this->db->query($sqql)->row(); 
            
            if($asg7->jum>0){
                echo '3';
            }else{
            
			$lc_save='2';
//						echo $real_no_sp2d;
                    
           /* $sql = "delete from trhsp2d where kd_skpd='$kd_skpd' and no_sp2d='$no_sp2d'";
           $asg = $this->db->query($sql);    */
		   if ($lcstatus_input=='tambah'){ 
		   $query2 ="insert into trhsp2d(no_sp2d,tgl_sp2d,no_spm,tgl_spm,no_spp,kd_skpd,nm_skpd,tgl_spp,bulan,no_spd,keperluan,username,last_update,status,jns_spp,bank,nmrekan,no_rek,npwp,nilai,status_terima,jenis_beban) 
                    values('$no_sementara','$tgl_sp2d','$no_spm','$tgl_spm','$no_spp','$kd_skpd','$nm_skpd','$tgl_spp','$bulan','$spd','$keperluan','$usernm','$last_update','0','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nilai','0','$jns_beban') ";
			} else{
	
			 $query2 = " UPDATE trhsp2d SET no_sp2d='$no_sp2d_tag',tgl_sp2d='$tgl_sp2d', no_spm='$no_spm', tgl_spm='$tgl_spm', bulan='$bulan', kd_skpd='$kd_skpd',
			 nm_skpd='$nm_skpd', no_spp='$no_spp', tgl_spp='$tgl_spp', no_spd='$spd', username='$usernm', status='0', last_update='$last_update',
			 keperluan='$keperluan', jns_spp='$jns_spp', no_rek='$no_rek', bank='$bank',nmrekan='$nmrekan',npwp='$npwp',nilai='$nilai' where no_sp2d='$no_sp2d_tag' "; 
		
  //  $query2 ="insert into trhsp2d(no_sp2d,tgl_sp2d,no_spm,tgl_spm,no_spp,kd_skpd,nm_skpd,tgl_spp,bulan,no_spd,keperluan,username,last_update,status,jns_spp,bank,nmrekan,no_rek,npwp,nilai,status_terima,jenis_beban) 
    //                values('$no_sementara','$tgl_sp2d','$no_spm','$tgl_spm','$no_spp','$kd_skpd','$nm_skpd','$tgl_spp','$bulan','$spd','$keperluan','$usernm','$last_update','0','$jns_spp','$bank','$nmrekan','$no_rek','$npwp','$nilai','0','$jns_beban') ";	
			}           
			$asg2 = $this->db->query($query2); 
          
          $query1="update trhspm set status='1' where no_spm='$no_spm'";
          $asg3 = $this->db->query($query1);
		   if($asg3){
                $lc_save='1';
            }else{
                $lc_save='2';
            }
			
		  // untuk sementara sp2d manual		
		//get nomor sp2d by tox
		if ($jns_spp<>'4'){
		   if ($lcstatus_input=='tambah'){
		$sql = "insert into nomor_sp2d (no_sp2d) values ('$no_sementara')";
            $asg = $this->db->query($sql);
            if($asg){
                $lc_save='1';
            }else{
                $lc_save='2';
            }
			
			
		$hasil=$this->db->query(" select nomor FROM  nomor_sp2d where no_sp2d='$no_sementara' ");
		foreach ($hasil->result_array() as $row){
		$nomor_urut=$row['nomor'];	
		}
		$real_no_sp2d =strval($nomor_urut).$sp2d_blk;
		
            $sql = "update nomor_sp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sementara'";
            $asg = $this->db->query($sql);
            if($asg){
               // echo $real_no_sp2d;
			   $lc_save='1';
            }else{
				echo '2';                
            }
			
		$sql = "update trhsp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sementara'";
            $asg = $this->db->query($sql);
            if($asg){
              $lc_save='1';
            }else{
                $lc_save='2';
            }
		}
		 else{
		// sp2d ini sementara manual dulu by tox
				
		$hasil=$this->db->query(" select nomor FROM  nomor_sp2d where no_sp2d='$no_sp2d_tag' ");
		foreach ($hasil->result_array() as $row){
		$nomor_urut=$row['nomor'];	
		}
		$real_no_sp2d =strval($nomor_urut).$sp2d_blk;
		
            $sql = "update nomor_sp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sp2d_tag'";
            $asg = $this->db->query($sql);
            if($asg){
                $lc_save='1';
            }else{
                $lc_save='2';
            }	  
			
		$sql = "update trhsp2d set no_sp2d='$real_no_sp2d' where no_sp2d='$no_sp2d_tag'";
            $asg = $this->db->query($sql);
            if($asg){
               
            $lc_save='1';
            }else{
                $lc_save='2';
            }			

			}
		}
		
		if ($lc_save=='1')
		{  
			echo json_encode($real_no_sp2d);
		}
		else
		{
			echo '2';
			}
            }
       //   echo '1';
          //$asg->free_result();
//          $query1->free_result();  
	}
	
	
	function load_data_sp2d_uji($dtgl1='',$dtgl2='') {
    
        $dtgl1  = $this->input->post('tgl1');
        $dtgl2  = $this->input->post('tgl2');

        $sql    = " SELECT no_sp2d, tgl_sp2d,no_spm,tgl_spm,SUM(b.nilai) as nilai from trhsp2d a
					INNER JOIN trdspp b ON a.no_spp=b.no_spp AND a.kd_skpd=b.kd_skpd
					WHERE tgl_sp2d BETWEEN '$dtgl1' AND '$dtgl2' AND 
					no_sp2d not in (select no_sp2d from trhuji a inner join trduji b on a.no_uji=b.no_uji) 
					GROUP BY no_sp2d, tgl_sp2d,no_spm,tgl_spm
					ORDER BY tgl_sp2d,no_sp2d"; 
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'no_sp2d' => $resulte['no_sp2d'],  
                        //'tgl_sp2d' => $this->tanggal_indonesia($resulte['tgl_sp2d']),
                        'tgl_sp2d' =>$resulte['tgl_sp2d'],
						'no_spm' => $resulte['no_spm'],
						//'tgl_spm' => $this->tanggal_indonesia($resulte['tgl_spm']),
						'tgl_spm' => $resulte['tgl_spm'],
						'nilai' =>number_format($resulte['nilai'],"2",".",",") 				
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	
    }
	
	function simpan_daftar_uji(){
        $tabel    = $this->input->post('tabel');        
		$no_uji = $this->input->post('no_uji');		
		$tgl_uji = $this->input->post('tgl_uji');
		$no_blk = $this->input->post('no_blk');
		$cwaktu = date("Y-m-d H:i:s");		
		$user =  $this->session->userdata('pcNama'); 
		$lcst=$this->input->post('lcst');
		$r_nomor='2';
		
		if ($tabel == 'trhuji') {	
		$sql = "Select isnull(Max((no_urut)),0) As maks From trhuji";
		$hasil = $this->db->query($sql);
		$nomor7 = $hasil->row();
		$nomor7_urut=$nomor7->maks+1;
		$r_nomor=strval($nomor7_urut).$no_blk;
			
    	$csql = "INSERT INTO trhuji (no_uji,tgl_uji,username,tgl_update,no_urut) values ('$r_nomor','$tgl_uji','$user','$cwaktu','$nomor7_urut')";
    	$query1 = $this->db->query($csql);    					
                if($query1){
                    echo json_encode($r_nomor);
                }else{
                    echo '0';
                }
		}
		else if ($tabel == 'trduji') {
			$nomor_baru = $this->input->post('nomor_baru');
			$csql     = $this->input->post('sql');            
            // Simpan Detail //                       
				$sql = "delete from TRDUJI where no_uji='$nomor_baru'";
                $asg = $this->db->query($sql);
				
				
				if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into TRDUJI(no_uji,tgl_uji,no_sp2d)"; 
                    $asg = $this->db->query($sql.$csql);
					
					
					if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                     //   exit();
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }
			
		}
    }
	
	function edit_daftar_uji(){
        $tabel    = $this->input->post('tabel');        
		$no_uji = $this->input->post('no_uji');		
		$no_uji_hide = $this->input->post('no_uji_hide');		
		$tgl_uji = $this->input->post('tgl_uji');
		$cwaktu = date("Y-m-d H:i:s");		
		$user =  $this->session->userdata('pcNama'); 
				
		if ($tabel == 'trhuji') {
		$csql = "update trhuji set tgl_uji='$tgl_uji',username='$user',tgl_update='$cwaktu' where no_uji='$no_uji_hide'";
    	$query1 = $this->db->query($csql);	
    	        if($query1){
                    echo json_encode($no_uji);
                }else{
                    echo '0';
                }
		}
		else if ($tabel == 'trduji') {
			$csql     = $this->input->post('sql');            
            // Simpan Detail //                       
				$sql = "delete from TRDUJI where no_uji='$no_uji_hide'";
                $asg = $this->db->query($sql);
				
				
				if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into TRDUJI(no_uji,tgl_uji,no_sp2d)"; 
                    $asg = $this->db->query($sql.$csql);
					
					
					if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                     //   exit();
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }
			
		}
    }
	
	
	function hhapusuji() {    	
		$nomor = $this->input->post('no');        
        $query = $this->db->query("delete from TRHUJI where no_uji='$nomor'");
        $query = $this->db->query("delete from TRDUJI where no_uji='$nomor'");
         $query->free_result();
    }
	
	function cetak_daftar_penguji($no_uji='',$ttd='',$dcetak='',$cetak='',$atas='',$bawah='',$kiri='',$kanan=''){
	$print = $cetak;
	
			$no_uji = str_replace('123456789','/',$this->uri->segment(3));
			$lcttd = str_replace('abcdefg',' ',$this->uri->segment(4));
		
		    $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd where kode='BUD' and nip='$lcttd'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
					$pangkat=$rowttd->pangkat;
                }
			$sqlcount="SELECT COUNT(a.no_sp2d) as jumlah FROM trduji a INNER JOIN trhuji b ON a.no_uji=b.no_uji WHERE a.no_uji='$no_uji'";
                 $sql123=$this->db->query($sqlcount);
                 foreach ($sql123->result() as $rowcount)
                {
                    $jumlah=$rowcount->jumlah;                    
                   
                }
			$PageCount='$page';	
			$cRet ='';
			$cRet .="<table style=\"border-collapse:collapse;font-weight:bold;font-family:Tahoma; font-size:12px\" border=\"0\" width=\"100%\" align=\"center\" cellspacing=\"0\" cellpadding=\"0\">
            <tr >
                <td width=\"100%\" align=\"center\" colspan=4 style=\"font-size:18px\">DAFTAR PENGUJI / PENGANTAR<br>SURAT PERINTAH PENCAIRAN DANA</td></tr>
					 <TR >
						<TD align=\"left\" width=\"10%\">Tanggal </TD>
						<TD align=\"left\" width=\"70%\">: ".$this->tukd_model->tanggal_format_indonesia($dcetak)."</TD>
						<TD align=\"left\" width=\"10%\"></TD>
						<TD align=\"right\"  width=\"20%\">Lembaran ke 1</TD>
					 </TR>					 
					 <TR>
						<TD align=\"left\"> Nomor</TD>
						<TD align=\"left\"  >: ".$no_uji."</TD>
						<TD align=\"left\" > </TD>
						<TD align=\"right\" >Terdiri dari ".$jumlah." lembar </TD>
					 </TR>
					 </TABLE>";

			$cRet .=" <table style=\"border-collapse:collapse;font-family:Tahoma; font-size:11px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"1\">               
				<thead>
			   <tr style=\"font-size:12px;font-weight:bold;\">
                    <td width=\"5%\" align=\"center\"><b>NO</b></td>
                    <td width=\"10%\" align=\"center\" ><b>TANGGAL DAN<br>NOMOR SP2D</b></td>
                     <td  width=\"28%\" align=\"center\"><b>ATAS NAMA<br>( YANG BERHAK )</b>
					 </td>
					 <td width=\"20%\" align=\"center\" ><b>SKPD</b>        
                    </td>
                    <td  width=\"10%\" align=\"center\"><b>JUMLAH KOTOR<br>(Rp)</b>
					 </td>					 
                    <td width=\"10%\" align=\"center\" ><b>JUMLAH<br>POTONGAN</b>
                    </td>
                    <td width=\"10%\" align=\"center\"><b>JUMLAH<br>BERSIH</b>
                    </td>
                    <td  width=\"10%\" align=\"center\"><b>TANGGAL<br>TRANSFER</b>
                    </td>
                   
                </tr>
				<tr style=\"font-size:11px;font-weight:bold;\">	
					<td align=\"center\" >1
                    </td>
					<td align=\"center\" >2
                    </td>
					<td align=\"center\" >3
                    </td>
					<td align=\"center\" >4
                    </td>
					<td align=\"center\" >5
                    </td>
					<td align=\"center\" >6
                    </td>
					<td align=\"center\" >7
                    </td>
					<td align=\"center\" >8
                    </td>
				</tr>
				</thead>
				";
			
			  $sql = "select b.no_sp2d,c.tgl_sp2d,c.nmrekan,c.pimpinan,c.alamat,c.kd_skpd,c.nm_skpd
,c.jns_spp,c.jenis_beban,c.kotor,c.pot FROM TRHUJI a inner join TRDUJI b on a.no_uji=b.no_uji LEFT join (
SELECT a.*,ISNULL(SUM(b.nilai),0)pot FROM (select no_sp2d,no_spm,tgl_sp2d,b.nmrekan,b.alamat,b.pimpinan,
a.kd_skpd,d.nm_skpd,a.jns_spp,a.jenis_beban, isnull(SUM(z.nilai),0)kotor
from trhsp2d a inner join trhspp b on a.no_spp=b.no_spp AND a.kd_skpd=b.kd_skpd
INNER JOIN trdspp z ON b.no_spp=z.no_spp AND b.kd_skpd=z.kd_skpd
INNER JOIN ms_skpd d on a.kd_skpd=d.kd_skpd
GROUP BY no_sp2d,no_spm,tgl_sp2d,b.nmrekan,b.alamat,b.pimpinan,
a.kd_skpd,d.nm_skpd,a.jns_spp,a.jenis_beban)a 
LEFT JOIN 
trspmpot b ON a.no_spm=b.no_spm and a.kd_skpd=b.kd_skpd
GROUP BY no_sp2d,a.no_spm,tgl_sp2d,a.nmrekan,a.alamat,a.pimpinan,
a.kd_skpd,a.nm_skpd,a.jns_spp,a.jenis_beban,a.kotor) c on b.no_sp2d=c.no_sp2d WHERE a.no_uji='$no_uji'";
			 $hasil = $this->db->query($sql);
                    $lcno = 0;
                     $total_kotor=0;
                     $total_pot=0;
					 
					 foreach ($hasil->result() as $row)
                    {
                       $lcno = $lcno + 1;
					   $no_sp2d=empty($row->no_sp2d) || $row->no_sp2d == '' ? ' ' :$row->no_sp2d;
					   //$tgl_sp2d=$row->tgl_sp2d;
					   $nmrekan=empty($row->nmrekan) || $row->nmrekan == '' ? ' ' :$row->nmrekan;
					   $pimpinan=empty($row->pimpinan) || $row->pimpinan == '' ? ' ' :$row->pimpinan;
					   $alamat=empty($row->alamat) || $row->alamat == '' ? ' ' :$row->alamat;
					   $kd_skpd=empty($row->kd_skpd) || $row->kd_skpd == '' ? ' ' :$row->kd_skpd;
					   $nm_skpd=empty($row->nm_skpd) || $row->nm_skpd == '' ? ' ' :$row->nm_skpd;
					   $jns=empty($row->jns_spp) || $row->jns_spp == '' ? ' ' :$row->jns_spp;
					   $jns_bbn=empty($row->jenis_beban) || $row->jenis_beban == '' ? ' ' :$row->jenis_beban;
					   $kotor=empty($row->kotor) || $row->kotor == '' ? 0 :$row->kotor;
					   $pot=empty($row->pot) || $row->pot == '' ? 0 :$row->pot;
					   $total_kotor=$kotor+$total_kotor;
					   $total_pot=$pot+$total_pot;
					   //$total_bersih=$total_kotor-$total_pot;
					   $tgl_sp2d=empty($row->tgl_sp2d) || $row->tgl_sp2d == '' ? ' ' :$this->tukd_model->tanggal_ind($row->tgl_sp2d);
			
						$sqlnam="SELECT TOP 1 * FROM ms_ttd WHERE kd_skpd = '$kd_skpd' AND kode='BK'";
							 $sqlnam=$this->db->query($sqlnam);
							 foreach ($sqlnam->result() as $rownam)
							{
								$nama_ben=$rownam->nama;                    
								$jabat_ben=$rownam->jabatan;                    
							}
						$nama_ben = empty($nama_ben) || $nama_ben == 'NULL' ? 'Belum Ada data Bendahara' :$nama_ben;
						$jabat_ben = empty($jabat_ben) || $jabat_ben == 0 ? ' ' :$jabat_ben;
						
						
		if(($jns==6) && ($jns_bbn==3) ){
					                       					
       $cRet .=" <tr >
                    <td valign=\"top\" align=\"center\">$lcno  
                    </td>
                    <td valign=\"top\" align=\"center\" >$no_sp2d <br> $tgl_sp2d
					</td>					
                    <td valign=\"top\" align=\"left\">$nmrekan, $pimpinan <br>$alamat
					</td>					
                    <td valign=\"top\" align=\"left\" >$kd_skpd<br>$nm_skpd
					</td>					
                    <td valign=\"top\" align=\"right\" >".number_format($kotor,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\" align=\"right\" >".number_format($pot,"2",",",".")."&nbsp; 
                    </td>
                    <td valign=\"top\" align=\"right\" >".number_format($kotor-$pot,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\" align=\"center\" >&nbsp; 
					</td>
									 
                </tr>
				";
		} else if(($jns==5) ){
					                       					
       $cRet .=" <tr >
                    <td valign=\"top\" align=\"center\">$lcno  
                    </td>
                    <td valign=\"top\" align=\"center\" >$no_sp2d <br> $tgl_sp2d
					</td>					
                    <td valign=\"top\" align=\"left\">$nmrekan <br> $alamat
					</td>					
                    <td valign=\"top\" align=\"left\" >$kd_skpd<br>$nm_skpd
					</td>					
                    <td valign=\"top\" align=\"right\" >".number_format($kotor,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\" align=\"right\" >".number_format($pot,"2",",",".")."&nbsp; 
                    </td>
                    <td valign=\"top\" align=\"right\" >".number_format($kotor-$pot,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\" align=\"center\" >&nbsp; 
					</td>
									 
                </tr>
				";
		}  else{
		  $cRet .=" <tr >
                    <td valign=\"top\" align=\"center\" >$lcno  
                    </td>
                    <td valign=\"top\" align=\"center\" >$no_sp2d <br> $tgl_sp2d
					</td>					
                    <td valign=\"top\" align=\"left\" >$nama_ben <br>$jabat_ben $nm_skpd
					</td>					
                    <td valign=\"top\" align=\"left\" >$kd_skpd<br>$nm_skpd
					</td>					
                    <td valign=\"top\" align=\"right\" >".number_format($kotor,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\" align=\"right\" >".number_format($pot,"2",",",".")."&nbsp; 
                    </td>
                    <td valign=\"top\" align=\"right\" >".number_format($kotor-$pot,"2",",",".")."&nbsp; 
					 </td>
					<td valign=\"top\" align=\"center\" >&nbsp; 
					</td>
									 
                </tr>
				";
			
		}
				};
				
			 $cRet .=" <tr style=\"font-size:11px;font-weight:bold;\">
                    <td colspan=\"4\" align=\"center\" >TOTAL
                    </td>
                    <td  align=\"right\" >".number_format($total_kotor,"2",",",".")."&nbsp; 
					</td>
					<td  align=\"right\" >".number_format($total_pot,"2",",",".")."&nbsp; 
					</td>
					<td  align=\"right\" >".number_format($total_kotor-$total_pot,"2",",",".")."&nbsp;
					</td>
					<td  align=\"center\" >&nbsp; 
					</td>
                </tr>
				";
			$cRet .='</table>';
			
			$cRet .=" <table style=\"border-collapse:collapse;font-weight:bold;font-family:Tahoma; font-size:11px;\" border=\"0\" width=\"100%\" align=\"center\" cellspacing=\"0\" cellpadding=\"0\">
			
			<tr >
				<td align=\"left\" width=\"70%\" style=\"height: 30px;\" >&nbsp;&nbsp;Diterima oleh : ................................................</td>
				<td align=\"center\" width=\"30%\" >$jabatan</td>
				
				</tr>
			<tr>
				<td>&nbsp;&nbsp;.....................................................</td>
				<td align=\"center\">  </td>
				</tr>
			<tr>
				<td colspan=\"2\" ><br>&nbsp;&nbsp;Petugas Bank / Pos</td>
				</tr>
			<tr >
				<td width=\"100%\" colspan=\"2\" style=\"height: 50px;\" >&nbsp;</td>
				</tr>
			<tr>
				<td>&nbsp;</td>
				<td align=\"center\"><u>$nama</u></td>
				</tr>
			<tr>
				<td>&nbsp;</td>
				<td align=\"center\">$pangkat</td>
				</tr>
			<tr>
				<td><align=\"left\" style=\"width: 250px;\">__________________________________</td>
				<td align=\"center\">NIP. $nip</td>
				</tr>
				</table>";

			$data['prev']= 'Kartu Kendali';
			if ($print==1){
			//$cRet = str_replace('$page', $this->mpdf->getPageCount(), $cRet);
	    $this->_mpdf_daftar_penguji('',$cRet,10,10,10,'L',0,'',$atas,$bawah,$kiri,$kanan);

				

		} else{
		  $cRet = str_replace('$page', '', $cRet);
		  echo $cRet;
		}
	
	}
	
    function _mpdf2($judul='',$isi='',$lMargin=10,$rMargin=10,$font='',$orientasi='',$hal='', $fonsize='') {
                

        ini_set("memory_limit","-1M");
        ini_set("MAX_EXECUTION_TIME","-1");
        $this->load->library('mpdf');
		//$this->mpdf->SetHeader('||Halaman {PAGENO} /{nb}');
        
        
        $this->mpdf->defaultheaderfontsize = 10;	/* in pts */
        $this->mpdf->defaultheaderfontstyle = I;	/* blank, B, I, or BI */
        $this->mpdf->defaultheaderline = 1; 	/* 1 to include line below header/above footer */

        $this->mpdf->defaultfooterfontsize = 3;	/* in pts */
        $this->mpdf->defaultfooterfontstyle = I;	/* blank, B, I, or BI */
        $this->mpdf->defaultfooterline = 1; 
		$sa=1;
		$tes=0;
		if ($hal==''){
		$hal1=1;
		} 
		if($hal!==''){
		$hal1=$hal;
		}
		if ($fonsize==''){
		$size=12;
		}else{
		$size=$fonsize;
		} 
		
		$this->mpdf = new mPDF('utf-8', array(215,330),$size); //folio
							//$this->mpdf->useOddEven = 1;						

        $this->mpdf->AddPage($orientasi,'',$hal1,'1','off');
		if ($hal==''){
			$this->mpdf->SetFooter("Printed on Simakda ||  ");
		}
		else{
			$this->mpdf->SetFooter("Printed on Simakda || Halaman {PAGENO}  ");
		}
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
        $this->mpdf->writeHTML($isi);         
        $this->mpdf->Output();
               
    }
function _mpdf_margin($judul='',$isi='',$lMargin=10,$rMargin=10,$font='',$orientasi='',$hal='', $fonsize='',$atas='', $bawah='', $kiri='', $kanan='') {
                

        ini_set("memory_limit","-1M");
        ini_set("MAX_EXECUTION_TIME","-1");
        $this->load->library('mpdf');
		//$this->mpdf->SetHeader('||Halaman {PAGENO} /{nb}');
        
        
        $this->mpdf->defaultheaderfontsize = 10;	/* in pts */
        $this->mpdf->defaultheaderfontstyle = I;	/* blank, B, I, or BI */
        $this->mpdf->defaultheaderline = 1; 	/* 1 to include line below header/above footer */

        $this->mpdf->defaultfooterfontsize = 3;	/* in pts */
        $this->mpdf->defaultfooterfontstyle = I;	/* blank, B, I, or BI */
        $this->mpdf->defaultfooterline = 1; 
		$sa=1;
		$tes=0;
		if ($hal==''){
		$hal1=1;
		} 
		if($hal!==''){
		$hal1=$hal;
		}
		if ($fonsize==''){
		$size=12;
		}else{
		$size=$fonsize;
		} 
		
		$this->mpdf = new mPDF('utf-8', array(215,330),$size); //folio
        $this->mpdf->AddPage($orientasi,'',$hal,'1','off',$kiri,$kanan,$atas,$bawah);
		if ($hal==''){
			$this->mpdf->SetFooter("");
		}
		else{
			$this->mpdf->SetFooter("Printed on Simakda SKPD || Halaman {PAGENO}  ");
		}
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
        $this->mpdf->writeHTML($isi);         
        $this->mpdf->Output();
               
    }

	function _mpdf3($judul='',$isi='',$lMargin=10,$rMargin=10,$font='',$orientasi='',$hal='', $fonsize='') {
                

        ini_set("memory_limit","-1M");
        ini_set("MAX_EXECUTION_TIME","-1");
        $this->load->library('mpdf');
		//$this->mpdf->SetHeader('||Halaman {PAGENO} /{nb}');
        
        
        $this->mpdf->defaultheaderfontsize = 10;	/* in pts */
        $this->mpdf->defaultheaderfontstyle = I;	/* blank, B, I, or BI */
        $this->mpdf->defaultheaderline = 1; 	/* 1 to include line below header/above footer */

        $this->mpdf->defaultfooterfontsize = 3;	/* in pts */
        $this->mpdf->defaultfooterfontstyle = I;	/* blank, B, I, or BI */
        $this->mpdf->defaultfooterline = 1; 
		$sa=1;
		$tes=0;
		if ($hal==''){
		$hal1=1;
		} 
		if($hal!==''){
		$hal1=$hal;
		}
		if ($fonsize==''){
		$size=15;
		}else{
		$size=$fonsize;
		} 
		
		$this->mpdf = new mPDF('utf-8', array(240,280),$size); //folio
							//$this->mpdf->useOddEven = 1;						

        $this->mpdf->AddPage($orientasi,'',$hal1,'1','off');
		if ($hal==''){
			$this->mpdf->SetFooter("Printed on Simakda ||  ");
		}
		else{
			$this->mpdf->SetFooter("Printed on Simakda || Halaman {PAGENO}  ");
		}
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
        $this->mpdf->writeHTML($isi);         
        $this->mpdf->Output();
               
    }

	function lap_trm_str(){
        $data['page_title']= 'BUKU PENERIMAAN DAN PENYETORAN';
        $this->template->set('title', 'BUKU PENERIMAAN DAN PENYETORAN');   
        $this->template->load('template','tukd/pendapatan/trm_str',$data) ; 
    }
    
	
    function ctk_trm_str($dcetak='',$dcetak2='',$skpd='',$jns=''){
   	        $lcskpd2 = $skpd;
            
			$csql11 = " select nm_skpd from ms_skpd where left(kd_skpd,len('$skpd')) = '$skpd'"; 
            $rs1 = $this->db->query($csql11);
            $trh1 = $rs1->row();
            $lcskpd = strtoupper ($trh1->nm_skpd);
            
         


		 $prv = $this->db->query("SELECT provinsi,daerah from sclient WHERE kd_skpd='$lcskpd2' ");
			$prvn = $prv->row();          
			$prov = $prvn->provinsi;         
			$daerah = $prvn->daerah;
            
            $cRet='';

			$cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
             <tr>
                <td align=\"center\" colspan=\"11\" style=\"font-size:14px;border: solid 1px white;\"><b>$lcskpd<br>BUKU PENERIMAAN DAN PENYETORAN <br> BENDAHARA PENERIMAAN</b></td>
            </tr>
           
            <tr>
                <td align=\"left\" colspan=\"3\" style=\"font-size:12px;border: solid 1px white;\">&nbsp;</td>
                <td align=\"left\" colspan=\"6\" style=\"font-size:12px;border: solid 1px white;\"></td>
            </tr>
            <tr>
                <td align=\"left\" colspan=\"3\" style=\"border: solid 1px white;\">SKPD</td>
                <td align=\"left\" colspan=\"6\" style=\"border: solid 1px white;\">:&nbsp;$lcskpd</td>
            </tr>
            
            <tr>
                <td align=\"left\" colspan=\"3\" style=\"border: solid 1px white;border-bottom:solid 1px white;\">PERIODE</td>
                <td align=\"left\" colspan=\"8\" style=\"border: solid 1px white;border-bottom:solid 1px white;\">:&nbsp;".$this->tukd_model->tanggal_format_indonesia($dcetak)." S.D ".$this->tukd_model->tanggal_format_indonesia($dcetak2)."</td>
            </tr>
			</table>";
			
			$cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
            <thead>
			<tr>
                <td bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\">NO</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" colspan=\"6\">Penerimaan</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" colspan=\"3\">Penyetoran</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" rowspan=\"2\">Ket.</td>
            </tr>
            <tr>
                <td bgcolor=\"#CCCCCC\" align=\"center\">Tgl</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\">No Bukti</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\">Cara Pembayaran</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\">Kode Rekening</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\">Uraian</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\">Tgl</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\">No STS</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
            </tr>
            <tr>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\">1</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"15%\">2</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\">3</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\">4</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\">5</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"20%\">6</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\">7</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"15%\">8</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\">9</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"10%\">10</td>
                <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\">11</td>
            </tr>
			</thead>
           ";
					
              $sql1="SELECT a.tgl_terima,a.no_terima,a.kd_rek5,b.nm_rek5,a.nilai,c.tgl_sts,c.no_sts,c.rupiah as total, a.keterangan FROM tr_terima a INNER JOIN ms_rek5 b 
                    ON a.kd_rek5=b.kd_rek5 
					LEFT JOIN (SELECT x.tgl_sts,x.no_sts,x.kd_skpd,y.no_terima,SUM(y.rupiah) as rupiah FROM trhkasin_pkd x INNER JOIN trdkasin_pkd y ON x.no_sts=y.no_sts AND x.kd_skpd=y.kd_skpd
					GROUP BY x.tgl_sts,x.no_sts,x.kd_skpd,y.no_terima) c 
					ON a.no_terima=c.no_terima AND a.kd_skpd=c.kd_skpd
					where a.tgl_terima >= '$dcetak' and a.tgl_terima <= '$dcetak2' and left(a.kd_skpd,len('$skpd')) = '$skpd'
					order by a.tgl_terima, a.no_terima";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $lcno = 0;
                $lnnilai = 0;                                 
                $lntotal = 0;                                 
                foreach ($query->result() as $row)
                {   
                    $lcno = $lcno + 1;
                    $lnnilai = $lnnilai + $row->nilai;
                    $lntotal = $lntotal + $row->total;
                    $tgl=$row->tgl_terima;
                    $bukti=$row->no_terima;
                    $rek=$row->kd_rek5;                    
                    $uraian=$row->nm_rek5;
                    $nilai=number_format($row->nilai,"2",",",".");
                    $tgl_sts=$row->tgl_sts;
					$ket=$row->keterangan;
					if($tgl_sts==''){
						$tgl_sts='';
					} else{
						$tgl_sts=$this->tukd_model->tanggal_ind($tgl_sts);
					}
                    $nosts=$row->no_sts;
                    $total=number_format($row->total,"2",",","."); 
					
                     $cRet    .= " <tr><td align=\"center\" width=\"5%\">$lcno</td>
                                        <td align=\"center\" width=\"15%\">".$this->tukd_model->tanggal_ind($tgl)."</td>
                                        <td align=\"center\" width=\"10%\">$bukti</td>
                                        <td align=\"center\" width=\"5%\">Tunai</td>
                                        <td align=\"center\" width=\"5%\">$rek</td>
                                        <td align=\"left\" width=\"20%\">$uraian</td>
                                        <td align=\"right\" width=\"10%\">$nilai</td>
                                        <td align=\"center\" width=\"15%\">$tgl_sts</td>
                                        <td align=\"center\" width=\"10%\">$nosts</td>
                                        <td align=\"right\" width=\"10%\">$total</td>
                                        <td align=\"left\" width=\"10%\">$ket</td>
                                     </tr>
                                     ";
                }
			
			$cRet    .= " <tr><td colspan=\"6\" align=\"center\"><b>Jumlah</b></td>
								<td align=\"right\" width=\"10%\"><b>".number_format($lnnilai,"2",",",".")."</b></td>
								<td align=\"center\" width=\"15%\"></td>
								<td align=\"center\" width=\"10%\"></td>
								<td align=\"right\" width=\"10%\"><b>".number_format($lntotal,"2",",",".")."</b></td>
								<td align=\"left\" width=\"10%\"></td>
							 </tr>
							 </table>";
							 
			

			$data['prev']= '';
			if ($jns==1){
			$this->_mpdf('',$cRet,10,10,10,'1',1,''); 
			} else{
				echo ("<title>Buku Penerimaan Penyetoran</title>");
				echo $cRet;
				}

	}
    
 
	
	
}